"use strict";(()=>{var a={};a.id=8912,a.ids=[636,3220,8912],a.modules={8732:a=>{a.exports=require("react/jsx-runtime")},8938:a=>{a.exports=import("class-variance-authority")},9640:a=>{a.exports=import("@radix-ui/react-slot")},13020:a=>{a.exports=import("@radix-ui/react-dialog")},14505:a=>{a.exports=import("@radix-ui/react-scroll-area")},16235:a=>{a.exports=import("@radix-ui/react-toast")},20598:a=>{a.exports=import("@radix-ui/react-label")},25665:a=>{a.exports=import("@radix-ui/react-checkbox")},28462:a=>{a.exports=import("@tanstack/react-query")},33873:a=>{a.exports=require("path")},35054:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{P:()=>l});var e=c(28462),f=c(76569),g=c(95965),h=c(71913),i=c(48578),j=c(72373),k=a([e,i]);function l(){let a=(0,e.useQueryClient)(),{toast:b}=(0,f.dj)(),c=(0,e.useMutation)({mutationFn:async({invoiceData:a,editInvoice:b,selectedTrips:c})=>{let d={...a,items:(0,i.jV)(a.items||[])};if(b){let{error:a}=await g.N.from("invoices").update(d).eq("id",b.id);if(a)throw console.error("Error updating invoice:",a),a;return b}{let{data:a,error:b}=await g.N.from("invoices").insert(d).select();if(b)throw console.error("Error creating invoice:",b),b;let e=a[0];if(e&&"id"in e&&c.length>0){let{error:a}=await g.N.from("trips").update({invoice_id:e.id}).in("id",c);if(a)throw Error("Invoice created, but failed to link trips.")}return e}},onSuccess:async(c,d)=>{if(b({title:`Invoice ${d.editInvoice?"updated":"created"}`,description:"Invoice details have been saved."}),a.invalidateQueries({queryKey:["invoices"]}),a.invalidateQueries({queryKey:["availableTrips"]}),c&&"id"in c)try{let{data:b}=await g.N.from("lease_invoices").select("lease_id").eq("invoice_id",c.id).single();b&&(await (0,j.QU)(b.lease_id),a.invalidateQueries({queryKey:["vehicle-leases"]}))}catch(a){console.error("Error syncing lease payment status:",a)}},onError:a=>{b({title:"Error saving invoice",description:a.message||"Failed to save invoice.",variant:"destructive"})}}),d=(0,e.useMutation)({mutationFn:async({invoice:a,amount:b,method:c,date:d,notes:e})=>{let f=(a.paid_amount||0)+b,i=f>=a.total_amount?"paid":"sent",j=`Payment (${(0,h.GP)(new Date(d),"MMM d, yyyy")}): ${e}`,k=a.notes?`${a.notes}

${j}`:j,{error:l}=await g.N.from("invoices").update({paid_amount:f,payment_date:d,payment_method:c,status:i,notes:k}).eq("id",a.id);if(l)throw l;return i},onSuccess:async(c,d)=>{b({title:"Payment recorded",description:"paid"===c?"Invoice marked as fully paid.":"Partial payment recorded."}),a.invalidateQueries({queryKey:["invoices"]});try{let{data:b}=await g.N.from("lease_invoices").select("lease_id").eq("invoice_id",d.invoice.id).single();b&&(await (0,j.QU)(b.lease_id),a.invalidateQueries({queryKey:["vehicle-leases"]}))}catch(a){console.error("Error syncing lease payment status:",a)}},onError:a=>{b({title:"Error",description:a.message||"Failed to record payment.",variant:"destructive"})}}),k=(0,e.useMutation)({mutationFn:async a=>{await g.N.from("trips").update({invoice_id:null}).eq("invoice_id",a);let{error:b}=await g.N.from("invoices").delete().eq("id",a);if(b)throw b},onSuccess:()=>{b({title:"Invoice deleted",description:"The invoice has been removed."}),a.invalidateQueries({queryKey:["invoices"]})},onError:a=>{b({title:"Error",description:a.message||"Failed to delete invoice.",variant:"destructive"})}});return{saveInvoice:c.mutateAsync,isSaving:c.isPending,recordPayment:d.mutateAsync,isRecordingPayment:d.isPending,deleteInvoice:k.mutate,isDeleting:k.isPending}}[e,i]=k.then?(await k)():k,d()}catch(a){d(a)}})},36307:a=>{a.exports=import("@radix-ui/react-dropdown-menu")},38827:a=>{a.exports=import("@radix-ui/react-separator")},40361:a=>{a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},41415:a=>{a.exports=import("sonner")},42752:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>r});var e=c(8732),f=c(82015),g=c(74941),h=c(35054),i=c(66345),j=c(78059),k=c(57049),l=c(74952),m=c(75837),n=c(48647),o=c(39655),p=c(48578),q=a([g,h,i,j,k,m,n,o,p]);function r(){let{invoices:a,clients:b,filteredInvoices:c,isLoading:d,searchTerm:q,setSearchTerm:r,statusFilter:s,setStatusFilter:t,refetch:u}=(0,g.W)(),{deleteInvoice:v}=(0,h.P)(),[w,x]=(0,f.useState)(!1),[y,z]=(0,f.useState)(null),[A,B]=(0,f.useState)(null),[C,D]=(0,f.useState)(null),[E,F]=(0,f.useState)(null),[G,H]=(0,f.useState)("all"),[I,J]=(0,f.useState)(!1),K=(0,f.useMemo)(()=>{if(!a)return{total:0,draft:0,sent:0,paid:0,overdue:0,cancelled:0,totalValue:0,paidValue:0,outstandingValue:0,overdueValue:0,avgInvoiceValue:0};let b=a.filter(a=>null!=a),c=b.length,d=b.filter(a=>"draft"===a.status).length,e=b.filter(a=>"sent"===a.status).length,f=b.filter(a=>"paid"===a.status).length,g=b.filter(a=>"overdue"===a.status).length,h=b.filter(a=>"cancelled"===a.status).length,i=b.reduce((a,b)=>a+(b?.total_amount||0),0),j=b.reduce((a,b)=>a+(b?.paid_amount||0),0),k=b.filter(a=>"paid"!==a.status&&"cancelled"!==a.status).reduce((a,b)=>a+((b?.total_amount||0)-(b?.paid_amount||0)),0),l=b.filter(a=>"overdue"===a.status).reduce((a,b)=>a+((b?.total_amount||0)-(b?.paid_amount||0)),0);return{total:c,draft:d,sent:e,paid:f,overdue:g,cancelled:h,totalValue:i,paidValue:j,outstandingValue:k,overdueValue:l,avgInvoiceValue:c>0?i/c:0}},[a]),L=(0,f.useMemo)(()=>{if(!a)return[];let b=a.filter(a=>null!=a);return q&&(b=b.filter(a=>(a.client_name?.toLowerCase()||"").includes(q.toLowerCase())||(a.id?.toLowerCase()||"").includes(q.toLowerCase())||(a.notes?.toLowerCase()||"").includes(q.toLowerCase()))),"all"!==s&&(b=b.filter(a=>a.status===s)),"all"!==G&&(b=b.filter(a=>a.client_id===G)),b},[a,q,s,G]),M=async()=>{J(!0),await u(),J(!1)};return d?(0,e.jsx)("div",{className:"min-h-screen bg-background",children:(0,e.jsxs)("div",{className:"p-4 px-6 space-y-6",children:[(0,e.jsx)("div",{className:"border-b border-border pb-4 pt-4",children:(0,e.jsx)("div",{children:(0,e.jsx)("h1",{className:"text-2xl font-semibold text-foreground",children:"Invoices"})})}),(0,e.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[void 0,void 0,void 0,void 0].map((a,b)=>(0,e.jsxs)(o.Zp,{children:[(0,e.jsxs)(o.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(o.ZB,{className:"text-sm font-medium",children:(0,e.jsx)("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),(0,e.jsx)("div",{className:"h-4 w-4 bg-gray-200 rounded animate-pulse"})]}),(0,e.jsxs)(o.Wu,{children:[(0,e.jsx)("div",{className:"h-8 bg-gray-200 rounded animate-pulse mb-2"}),(0,e.jsx)("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})]})]},b))})]})}):(0,e.jsx)("div",{className:"min-h-screen bg-background",children:(0,e.jsxs)("div",{className:"p-4 px-6 space-y-6",children:[(0,e.jsx)("div",{className:"border-b border-border pb-4 pt-4",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsx)("div",{children:(0,e.jsx)("h1",{className:"text-2xl font-semibold text-foreground",children:"Invoices"})}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsxs)(i.$,{variant:"outline",size:"sm",onClick:M,disabled:I,children:[(0,e.jsx)(l.e9t,{className:`mr-2 h-4 w-4 ${I?"animate-spin":""}`}),"Refresh"]}),(0,e.jsxs)(i.$,{onClick:()=>{B(null),x(!0)},children:[(0,e.jsx)(l.FWt,{className:"mr-2 h-4 w-4"}),"Create Invoice"]})]})]})}),(0,e.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,e.jsxs)(o.Zp,{children:[(0,e.jsxs)(o.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(o.ZB,{className:"text-sm font-medium",children:"Total Invoices"}),(0,e.jsx)(l.G9t,{className:"h-4 w-4 text-muted-foreground"})]}),(0,e.jsxs)(o.Wu,{children:[(0,e.jsx)("div",{className:"text-2xl font-bold",children:K.total}),(0,e.jsxs)("p",{className:"text-xs text-muted-foreground",children:[K.draft," draft, ",K.sent," sent"]})]})]}),(0,e.jsxs)(o.Zp,{children:[(0,e.jsxs)(o.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(o.ZB,{className:"text-sm font-medium",children:"Total Value"}),(0,e.jsx)(l.ntg,{className:"h-4 w-4 text-muted-foreground"})]}),(0,e.jsxs)(o.Wu,{children:[(0,e.jsx)("div",{className:"text-2xl font-bold",children:(0,p.vv)(K.totalValue)}),(0,e.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Avg: ",(0,p.vv)(K.avgInvoiceValue)]})]})]}),(0,e.jsxs)(o.Zp,{children:[(0,e.jsxs)(o.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(o.ZB,{className:"text-sm font-medium",children:"Outstanding"}),(0,e.jsx)(l.zD7,{className:"h-4 w-4 text-muted-foreground"})]}),(0,e.jsxs)(o.Wu,{children:[(0,e.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:(0,p.vv)(K.outstandingValue)}),(0,e.jsxs)("p",{className:"text-xs text-muted-foreground",children:[K.sent+K.overdue," unpaid"]})]})]}),(0,e.jsxs)(o.Zp,{children:[(0,e.jsxs)(o.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(o.ZB,{className:"text-sm font-medium",children:"Paid Value"}),(0,e.jsx)(l.rAV,{className:"h-4 w-4 text-muted-foreground"})]}),(0,e.jsxs)(o.Wu,{children:[(0,e.jsx)("div",{className:"text-2xl font-bold text-green-600",children:(0,p.vv)(K.paidValue)}),(0,e.jsxs)("p",{className:"text-xs text-muted-foreground",children:[K.paid," paid invoices"]})]})]})]}),(0,e.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,e.jsxs)(o.Zp,{children:[(0,e.jsxs)(o.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(o.ZB,{className:"text-sm font-medium",children:"Overdue"}),(0,e.jsx)(l.RIJ,{className:"h-4 w-4 text-red-500"})]}),(0,e.jsxs)(o.Wu,{children:[(0,e.jsx)("div",{className:"text-2xl font-bold text-red-600",children:(0,p.vv)(K.overdueValue)}),(0,e.jsxs)("p",{className:"text-xs text-muted-foreground",children:[K.overdue," overdue invoices"]})]})]}),(0,e.jsxs)(o.Zp,{children:[(0,e.jsxs)(o.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(o.ZB,{className:"text-sm font-medium",children:"Payment Rate"}),(0,e.jsx)(l.ntg,{className:"h-4 w-4 text-muted-foreground"})]}),(0,e.jsxs)(o.Wu,{children:[(0,e.jsxs)("div",{className:"text-2xl font-bold",children:[K.total>0?Math.round(K.paid/K.total*100):0,"%"]}),(0,e.jsx)("p",{className:"text-xs text-muted-foreground",children:"Invoice completion rate"})]})]}),(0,e.jsxs)(o.Zp,{children:[(0,e.jsxs)(o.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(o.ZB,{className:"text-sm font-medium",children:"Collection Rate"}),(0,e.jsx)(l.G9t,{className:"h-4 w-4 text-muted-foreground"})]}),(0,e.jsxs)(o.Wu,{children:[(0,e.jsxs)("div",{className:"text-2xl font-bold",children:[K.totalValue>0?Math.round(K.paidValue/K.totalValue*100):0,"%"]}),(0,e.jsx)("p",{className:"text-xs text-muted-foreground",children:"Value collection rate"})]})]})]}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,e.jsxs)("div",{className:"relative flex-1",children:[(0,e.jsx)(l.vji,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,e.jsx)(j.p,{placeholder:"Search invoices by client, ID, or notes...",value:q,onChange:a=>r(a.target.value),className:"pl-9"})]}),(0,e.jsxs)(k.l6,{value:s,onValueChange:t,children:[(0,e.jsx)(k.bq,{className:"w-full sm:w-[180px]",children:(0,e.jsx)(k.yv,{placeholder:"Filter by status"})}),(0,e.jsxs)(k.gC,{children:[(0,e.jsx)(k.eb,{value:"all",children:"All Statuses"}),(0,e.jsx)(k.eb,{value:"draft",children:"Draft"}),(0,e.jsx)(k.eb,{value:"sent",children:"Sent"}),(0,e.jsx)(k.eb,{value:"paid",children:"Paid"}),(0,e.jsx)(k.eb,{value:"overdue",children:"Overdue"}),(0,e.jsx)(k.eb,{value:"cancelled",children:"Cancelled"})]})]}),(0,e.jsxs)(k.l6,{value:G,onValueChange:H,children:[(0,e.jsx)(k.bq,{className:"w-full sm:w-[180px]",children:(0,e.jsx)(k.yv,{placeholder:"Filter by client"})}),(0,e.jsxs)(k.gC,{children:[(0,e.jsx)(k.eb,{value:"all",children:"All Clients"}),b?.map(a=>(0,e.jsx)(k.eb,{value:a.id,children:a.name},a.id))]})]})]}),(0,e.jsxs)(o.Zp,{children:[(0,e.jsx)(o.aR,{children:(0,e.jsx)("div",{className:"flex items-center justify-between",children:(0,e.jsx)("div",{children:(0,e.jsx)(o.ZB,{children:"Invoices"})})})}),(0,e.jsx)(o.Wu,{children:(0,e.jsx)(m.v,{invoices:L.filter(a=>null!==a),onView:z,onEdit:a=>{B(a),x(!0)},onRecordPayment:D,onDelete:a=>{F(a)}})})]}),(0,e.jsx)(n.qJ,{isOpen:w,onOpenChange:a=>{a?x(!0):(x(!1),B(null))},editInvoice:A,clients:b}),(0,e.jsx)(n.BN,{isOpen:!!y,onOpenChange:()=>z(null),invoice:y,onRecordPayment:D}),(0,e.jsx)(n.wO,{isOpen:!!C,onOpenChange:()=>D(null),invoice:C}),(0,e.jsx)(n.rz,{isOpen:!!E,onOpenChange:()=>F(null),onConfirm:()=>{E&&(v(E),F(null),y?.id===E&&z(null),A?.id===E&&B(null))}})]})})}[g,h,i,j,k,m,n,o,p]=q.then?(await q)():q,d()}catch(a){d(a)}})},42971:a=>{a.exports=import("zod")},46060:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},47860:a=>{a.exports=import("@radix-ui/react-select")},48303:a=>{a.exports=import("@radix-ui/react-tooltip")},48647:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{BN:()=>K,qJ:()=>J,rz:()=>M,wO:()=>L});var e=c(8732),f=c(82015),g=c(28462),h=c(81575),i=c(17156),j=c(71913),k=c(21839),l=c(56884),m=c(98825),n=c(42971),o=c(38661),p=c(95020),q=c(66345),r=c(78059),s=c(87967),t=c(40273),u=c(4720),v=c(94142),w=c(57049),x=c(85072),y=c(48383),z=c(52307),A=c(95148),B=c(54269),C=c(39655),D=c(74952),E=c(95965),F=c(35054),G=c(48578),H=c(52670),I=a([g,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,F,G,H]);[g,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,F,G,H]=I.then?(await I)():I;let N=n.object({client_id:n.string().min(1,"Please select a client"),date:n.string().min(1,"Invoice date is required"),due_date:n.string().min(1,"Due date is required"),status:n.enum(["draft","sent","paid","overdue","cancelled"]).optional(),notes:n.string().optional(),payment_terms:n.string().optional(),reference_number:n.string().optional()}).refine(a=>{let b=(0,h.H)(a.date),c=(0,h.H)(a.due_date);return!(0,i.Y)(c,b)},{message:"Due date must be after invoice date",path:["due_date"]});function J({isOpen:a,onOpenChange:b,editInvoice:c,clients:d}){let{saveInvoice:h,isSaving:i}=(0,F.P)(),[n,p]=(0,f.useState)([]),[u,v]=(0,f.useState)([{description:"",quantity:1,unit_price:0,amount:0}]),[y,I]=(0,f.useState)(!1),[J,K]=(0,f.useState)(5),[L,M]=(0,f.useState)(0),[O,P]=(0,f.useState)("percentage"),[Q,R]=(0,f.useState)("USD"),[S,T]=(0,f.useState)("net_30"),U=(0,l.useForm)({resolver:(0,m.zodResolver)(N),defaultValues:{client_id:"",date:(0,j.GP)(new Date,"yyyy-MM-dd"),due_date:(0,j.GP)((0,k.f)(new Date,30),"yyyy-MM-dd"),status:"draft",notes:"",payment_terms:"net_30",reference_number:""}}),V=U.watch("client_id"),{data:W}=(0,g.useQuery)({queryKey:["availableTrips",V],queryFn:async()=>{if(!V)return[];let{data:a,error:b}=await E.N.from("trips").select("id, date, pickup_location, dropoff_location, service_type, vehicle_type, soft_skin_count, armoured_count, has_security_escort, escort_count, amount").eq("client_id",V).is("invoice_id",null);if(b)throw b;return a.map(a=>({...a,type:a.service_type||"other"}))},enabled:!!V}),X=d?.find(a=>a.id===V),Y=[{value:"due_on_receipt",label:"Due on Receipt"},{value:"net_15",label:"Net 15 Days"},{value:"net_30",label:"Net 30 Days"},{value:"net_45",label:"Net 45 Days"},{value:"net_60",label:"Net 60 Days"},{value:"custom",label:"Custom Terms"}],Z=[{value:"USD",label:"USD ($)",symbol:"$"},{value:"EUR",label:"EUR (€)",symbol:"€"},{value:"GBP",label:"GBP (\xa3)",symbol:"\xa3"},{value:"SOS",label:"SOS (Sh)",symbol:"Sh"}],$=(a,b,c)=>{let d=[...u];if(d[a]={...d[a],[b]:c},"quantity"===b||"unit_price"===b){let b=d[a].quantity,c=d[a].unit_price;d[a].amount=b*c}v(d)},_=()=>v([...u,{description:"",quantity:1,unit_price:0,amount:0}]),aa=()=>u.every(a=>""!==a.description.trim()&&a.quantity>0&&a.unit_price>=0),ab=async a=>{if(!aa())return void U.setError("root",{message:"Please fill in all invoice items correctly"});let d=(0,G.N9)(u),e=y?J/100*d:0,f="percentage"===O?(L||0)/100*d:L||0,g={client_id:a.client_id,date:a.date,due_date:a.due_date,status:a.status||"draft",items:u,total_amount:d+e-f,paid_amount:c?.paid_amount||0,notes:a.notes||void 0,vat_percentage:y?J:void 0,discount_percentage:L>0?L:void 0,...c?{updated_at:new Date().toISOString()}:{created_at:new Date().toISOString(),updated_at:new Date().toISOString()}};try{await h({invoiceData:g,editInvoice:c,selectedTrips:n}),b(!1)}catch(a){U.setError("root",{message:"Failed to save invoice. Please try again."})}},ac=(0,G.N9)(u),ad=y?J/100*ac:0,ae="percentage"===O?(L||0)/100*ac:L||0,af=ac+ad-ae,ag=Z.find(a=>a.value===Q)?.symbol||"$";return(0,e.jsx)(o.lG,{open:a,onOpenChange:b,children:(0,e.jsxs)(o.Cf,{className:"sm:max-w-5xl max-h-[95vh] flex flex-col",children:[(0,e.jsxs)(o.c7,{className:"flex-shrink-0",children:[(0,e.jsxs)(o.L3,{className:"flex items-center gap-2",children:[(0,e.jsx)(D.TA3,{className:"h-5 w-5"}),c?"Edit Invoice":"Create New Invoice"]}),(0,e.jsx)(o.rr,{children:c?`Editing invoice for ${c.client_name}`:"Create a professional invoice for your client with detailed billing information"})]}),(0,e.jsx)("div",{className:"flex-1 overflow-y-auto px-4",children:(0,e.jsx)(z.lV,{...U,children:(0,e.jsxs)("form",{id:"invoice-form",onSubmit:U.handleSubmit(ab),className:"space-y-6 pt-4 pb-6",children:[U.formState.errors.root&&(0,e.jsxs)(B.Fc,{variant:"destructive",children:[(0,e.jsx)(D.RIJ,{className:"h-4 w-4"}),(0,e.jsx)(B.TN,{children:U.formState.errors.root.message})]}),(0,e.jsxs)(C.Zp,{children:[(0,e.jsxs)(C.aR,{children:[(0,e.jsxs)(C.ZB,{className:"text-lg flex items-center gap-2",children:[(0,e.jsx)(D.R2D,{className:"h-4 w-4"}),"Invoice Information"]}),(0,e.jsx)(C.BT,{children:"Basic details about the invoice and client"})]}),(0,e.jsx)(C.Wu,{className:"space-y-4",children:(0,e.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsx)(z.zB,{control:U.control,name:"client_id",render:({field:a})=>(0,e.jsxs)(z.eI,{children:[(0,e.jsx)(z.lR,{children:"Client *"}),(0,e.jsxs)(w.l6,{onValueChange:a.onChange,value:a.value,disabled:!!c,children:[(0,e.jsx)(z.MJ,{children:(0,e.jsx)(w.bq,{children:(0,e.jsx)(w.yv,{placeholder:"Select a client"})})}),(0,e.jsx)(w.gC,{children:d?.map(a=>(0,e.jsx)(w.eb,{value:a.id,children:(0,e.jsxs)("div",{className:"flex flex-col",children:[(0,e.jsx)("span",{className:"font-medium",children:a.name}),(0,e.jsx)("span",{className:"text-xs text-muted-foreground",children:a.email})]})},a.id))})]}),(0,e.jsx)(z.C5,{})]})}),X&&(0,e.jsxs)("div",{className:"text-xs text-muted-foreground p-3 bg-muted rounded-md",children:[(0,e.jsx)("div",{className:"font-medium",children:X.name}),(0,e.jsx)("div",{children:X.email}),X.phone&&(0,e.jsx)("div",{children:X.phone}),X.address&&(0,e.jsx)("div",{children:X.address})]}),(0,e.jsx)(z.zB,{control:U.control,name:"reference_number",render:({field:a})=>(0,e.jsxs)(z.eI,{children:[(0,e.jsx)(z.lR,{children:"Reference Number"}),(0,e.jsx)(z.MJ,{children:(0,e.jsx)(r.p,{...a,placeholder:"Optional reference number"})}),(0,e.jsx)(z.C5,{})]})})]}),(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,e.jsx)(z.zB,{control:U.control,name:"date",render:({field:a})=>(0,e.jsxs)(z.eI,{children:[(0,e.jsx)(z.lR,{children:"Invoice Date *"}),(0,e.jsx)(z.MJ,{children:(0,e.jsx)(H.l,{...a,className:"w-full"})}),(0,e.jsx)(z.C5,{})]})}),(0,e.jsx)(z.zB,{control:U.control,name:"due_date",render:({field:a})=>(0,e.jsxs)(z.eI,{children:[(0,e.jsx)(z.lR,{children:"Due Date *"}),(0,e.jsx)(z.MJ,{children:(0,e.jsx)(H.l,{...a,className:"w-full"})}),(0,e.jsx)(z.C5,{})]})})]}),(0,e.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(t.J,{htmlFor:"currency",children:"Currency"}),(0,e.jsxs)(w.l6,{value:Q,onValueChange:R,children:[(0,e.jsx)(w.bq,{children:(0,e.jsx)(w.yv,{})}),(0,e.jsx)(w.gC,{children:Z.map(a=>(0,e.jsx)(w.eb,{value:a.value,children:a.label},a.value))})]})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(t.J,{htmlFor:"payment_terms",children:"Payment Terms"}),(0,e.jsxs)(w.l6,{value:S,onValueChange:T,children:[(0,e.jsx)(w.bq,{children:(0,e.jsx)(w.yv,{})}),(0,e.jsx)(w.gC,{children:Y.map(a=>(0,e.jsx)(w.eb,{value:a.value,children:a.label},a.value))})]})]})]}),c&&(0,e.jsx)(z.zB,{control:U.control,name:"status",render:({field:a})=>(0,e.jsxs)(z.eI,{children:[(0,e.jsx)(z.lR,{children:"Status"}),(0,e.jsxs)(w.l6,{onValueChange:a.onChange,value:a.value,children:[(0,e.jsx)(z.MJ,{children:(0,e.jsx)(w.bq,{children:(0,e.jsx)(w.yv,{})})}),(0,e.jsxs)(w.gC,{children:[(0,e.jsx)(w.eb,{value:"draft",children:"Draft"}),(0,e.jsx)(w.eb,{value:"sent",children:"Sent"}),(0,e.jsx)(w.eb,{value:"paid",children:"Paid"}),(0,e.jsx)(w.eb,{value:"overdue",children:"Overdue"}),(0,e.jsx)(w.eb,{value:"cancelled",children:"Cancelled"})]})]}),(0,e.jsx)(z.C5,{})]})})]})]})})]}),!c&&V&&W&&W.length>0&&(0,e.jsxs)(C.Zp,{children:[(0,e.jsxs)(C.aR,{children:[(0,e.jsxs)(C.ZB,{className:"text-lg flex items-center gap-2",children:[(0,e.jsx)(D.VvS,{className:"h-4 w-4"}),"Available Trips"]}),(0,e.jsx)(C.BT,{children:"Select trips to include in this invoice (optional)"})]}),(0,e.jsx)(C.Wu,{children:(0,e.jsx)("div",{className:"space-y-2 max-h-[200px] overflow-y-auto",children:W.map(a=>(0,e.jsxs)("div",{className:"flex items-center space-x-3 p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,e.jsx)(x.S,{id:`trip-${a.id}`,checked:n.includes(a.id),onCheckedChange:b=>{let c=(a.service_type||"").replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase()),d=[];a.vehicle_type&&d.push("armoured"===a.vehicle_type?"Armoured":"Soft Skin"),a.soft_skin_count&&d.push(`Soft Skin: ${a.soft_skin_count}`),a.armoured_count&&d.push(`Armoured: ${a.armoured_count}`);let e=d.join(" | ")||"N/A",f=a.has_security_escort?`${a.escort_count||1} escort vehicle(s)`:"None",g=`Trip from ${a.pickup_location||"N/A"} to ${a.dropoff_location||"N/A"} on ${(0,j.GP)(new Date(a.date),"dd/MM/yyyy")} — Service: ${c}; Vehicle: ${e||"N/A"}; Escort: ${f} (Trip ID: ${String(a.id).substring(0,8).toUpperCase()})`;if(b)p([...n,a.id]),v(b=>[...b.filter(a=>a.description),{description:g,quantity:1,unit_price:a.amount||0,amount:a.amount||0}]);else{p(n.filter(b=>b!==a.id));let b=u.filter(a=>a.description!==g);v(b.length>0?b:[{description:"",quantity:1,unit_price:0,amount:0}])}}}),(0,e.jsx)("div",{className:"flex-1",children:(0,e.jsxs)(t.J,{htmlFor:`trip-${a.id}`,className:"cursor-pointer",children:[(0,e.jsx)("div",{className:"font-medium",children:(0,j.GP)(new Date(a.date),"MMM d, yyyy")}),(0,e.jsxs)("div",{className:"text-sm text-muted-foreground",children:[a.pickup_location," →"," ",a.dropoff_location]})]})}),(0,e.jsxs)("div",{className:"font-medium text-green-600",children:[ag,a.amount?.toFixed(2)||"0.00"]})]},a.id))})})]}),(0,e.jsxs)(C.Zp,{children:[(0,e.jsx)(C.aR,{children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsxs)(C.ZB,{className:"text-lg flex items-center gap-2",children:[(0,e.jsx)(D.iUU,{className:"h-4 w-4"}),"Invoice Items"]}),(0,e.jsx)(C.BT,{children:"Add items and services to be invoiced"})]}),(0,e.jsxs)(q.$,{type:"button",variant:"outline",size:"sm",onClick:_,className:"flex items-center gap-2",children:[(0,e.jsx)(D.FWt,{className:"h-4 w-4"}),"Add Item"]})]})}),(0,e.jsx)(C.Wu,{children:(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsxs)("div",{className:"grid grid-cols-12 gap-3 text-sm font-medium text-muted-foreground px-3",children:[(0,e.jsx)("div",{className:"col-span-5",children:"Description"}),(0,e.jsx)("div",{className:"col-span-2",children:"Quantity"}),(0,e.jsx)("div",{className:"col-span-2",children:"Unit Price"}),(0,e.jsx)("div",{className:"col-span-2",children:"Amount"}),(0,e.jsx)("div",{className:"col-span-1",children:"Action"})]}),u.map((a,b)=>(0,e.jsxs)("div",{className:"grid grid-cols-12 gap-3 items-center p-3 border rounded-lg hover:bg-muted/50 transition-colors",children:[(0,e.jsx)("div",{className:"col-span-5",children:(0,e.jsx)(r.p,{placeholder:"Enter item description...",value:a.description,onChange:a=>$(b,"description",a.target.value),className:"border-0 bg-transparent focus-visible:ring-1"})}),(0,e.jsx)("div",{className:"col-span-2",children:(0,e.jsx)(r.p,{type:"number",placeholder:"1",value:a.quantity,onChange:a=>$(b,"quantity",parseFloat(a.target.value)||1),min:"1",step:"1",className:"border-0 bg-transparent focus-visible:ring-1"})}),(0,e.jsx)("div",{className:"col-span-2",children:(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)("span",{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground",children:ag}),(0,e.jsx)(r.p,{type:"number",placeholder:"0.00",value:a.unit_price,onChange:a=>$(b,"unit_price",parseFloat(a.target.value)||0),min:"0",step:"0.01",className:"border-0 bg-transparent focus-visible:ring-1 pl-8"})]})}),(0,e.jsx)("div",{className:"col-span-2",children:(0,e.jsxs)("div",{className:"flex h-10 items-center px-3 border rounded-md bg-muted/50 font-medium text-right",children:[ag,a.amount.toFixed(2)]})}),(0,e.jsx)("div",{className:"col-span-1 flex justify-center",children:u.length>1&&(0,e.jsx)(q.$,{type:"button",variant:"ghost",size:"icon",onClick:()=>{u.length>1&&v(u.filter((a,c)=>c!==b))},className:"h-8 w-8 text-red-500 hover:text-red-700 hover:bg-red-50",children:(0,e.jsx)(D.lMJ,{className:"h-4 w-4"})})})]},b)),0===u.length&&(0,e.jsxs)("div",{className:"text-center py-8",children:[(0,e.jsx)("div",{className:"text-muted-foreground mb-4",children:"No items added yet"}),(0,e.jsxs)(q.$,{type:"button",variant:"outline",onClick:_,className:"flex items-center gap-2",children:[(0,e.jsx)(D.FWt,{className:"h-4 w-4"}),"Add First Item"]})]})]})})]}),(0,e.jsxs)(C.Zp,{children:[(0,e.jsxs)(C.aR,{children:[(0,e.jsxs)(C.ZB,{className:"text-lg flex items-center gap-2",children:[(0,e.jsx)(D.tEU,{className:"h-4 w-4"}),"Pricing & Totals"]}),(0,e.jsx)(C.BT,{children:"Configure taxes, discounts, and view invoice totals"})]}),(0,e.jsx)(C.Wu,{children:(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)(x.S,{id:"vat",checked:y,onCheckedChange:a=>I(a)}),(0,e.jsx)(t.J,{htmlFor:"vat",className:"text-sm font-medium",children:"Enable VAT/Tax"})]}),y&&(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(t.J,{htmlFor:"vat_rate",children:"Tax Rate (%)"}),(0,e.jsx)(r.p,{id:"vat_rate",type:"number",value:J,onChange:a=>K(parseFloat(a.target.value)||0),min:"0",max:"100",step:"0.1",className:"w-full"})]})]}),(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(t.J,{htmlFor:"discount_type",children:"Discount Type"}),(0,e.jsxs)(w.l6,{value:O,onValueChange:a=>P(a),children:[(0,e.jsx)(w.bq,{children:(0,e.jsx)(w.yv,{})}),(0,e.jsxs)(w.gC,{children:[(0,e.jsx)(w.eb,{value:"percentage",children:"Percentage (%)"}),(0,e.jsxs)(w.eb,{value:"fixed",children:["Fixed Amount (",ag,")"]})]})]})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsxs)(t.J,{htmlFor:"discount",children:["Discount"," ","percentage"===O?"(%)":`(${ag})`]}),(0,e.jsx)(r.p,{id:"discount",type:"number",value:L||"",onChange:a=>M(parseFloat(a.target.value)||0),min:"0",max:"percentage"===O?"100":void 0,step:"percentage"===O?"0.1":"0.01",className:"w-full"})]})]})]}),(0,e.jsx)("div",{className:"bg-muted/50 p-4 rounded-lg",children:(0,e.jsxs)("div",{className:"space-y-3",children:[(0,e.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,e.jsx)("span",{children:"Subtotal:"}),(0,e.jsxs)("span",{className:"font-medium",children:[ag,ac.toFixed(2)]})]}),y&&(0,e.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,e.jsxs)("span",{children:["Tax (",J,"%):"]}),(0,e.jsxs)("span",{className:"font-medium",children:[ag,ad.toFixed(2)]})]}),L>0&&(0,e.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,e.jsxs)("span",{children:["Discount"," ","percentage"===O?`(${L}%)`:"",":"]}),(0,e.jsxs)("span",{className:"font-medium text-red-600",children:["-",ag,ae.toFixed(2)]})]}),(0,e.jsx)(A.w,{}),(0,e.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,e.jsx)("span",{children:"Total:"}),(0,e.jsxs)("span",{className:"text-primary",children:[ag,af.toFixed(2)]})]})]})})]})})]}),(0,e.jsxs)(C.Zp,{children:[(0,e.jsxs)(C.aR,{children:[(0,e.jsxs)(C.ZB,{className:"text-lg flex items-center gap-2",children:[(0,e.jsx)(D.iUU,{className:"h-4 w-4"}),"Additional Information"]}),(0,e.jsx)(C.BT,{children:"Add notes, terms, and payment instructions"})]}),(0,e.jsxs)(C.Wu,{className:"space-y-4",children:[(0,e.jsx)(z.zB,{control:U.control,name:"notes",render:({field:a})=>(0,e.jsxs)(z.eI,{children:[(0,e.jsx)(z.lR,{children:"Notes"}),(0,e.jsx)(z.MJ,{children:(0,e.jsx)(s.T,{...a,placeholder:"Add any additional notes, terms and conditions, or payment instructions...",rows:4,className:"resize-none"})}),(0,e.jsx)(z.C5,{})]})}),"custom"!==S&&(0,e.jsxs)("div",{className:"p-3 bg-blue-50 border border-blue-200 rounded-md",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-blue-800",children:[(0,e.jsx)(D.zD7,{className:"h-4 w-4"}),(0,e.jsx)("span",{className:"font-medium",children:"Payment Terms:"})]}),(0,e.jsx)("p",{className:"text-sm text-blue-700 mt-1",children:Y.find(a=>a.value===S)?.label})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,e.jsxs)(q.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{let a=U.getValues("notes")||"";U.setValue("notes",a+"\n\nTerms & Conditions:\n• Payment is due within the specified payment terms\n• Late payments may incur additional fees\n• Please retain this invoice for your records")},className:"text-xs",children:[(0,e.jsx)(D.FWt,{className:"h-3 w-3 mr-1"}),"Add Terms & Conditions"]}),(0,e.jsxs)(q.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{let a=U.getValues("notes")||"";U.setValue("notes",a+"\n\nPayment Instructions:\n• Bank transfer details will be provided upon request\n• Please reference the invoice number in your payment\n• Contact us for any payment queries")},className:"text-xs",children:[(0,e.jsx)(D.FWt,{className:"h-3 w-3 mr-1"}),"Add Payment Instructions"]})]})]})]}),U.formState.errors&&Object.keys(U.formState.errors).length>0&&(0,e.jsx)(C.Zp,{className:"border-red-200 bg-red-50",children:(0,e.jsxs)(C.Wu,{className:"pt-6",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-red-800 mb-2",children:[(0,e.jsx)(D.RIJ,{className:"h-4 w-4"}),(0,e.jsx)("span",{className:"font-medium",children:"Please fix the following issues:"})]}),(0,e.jsx)("ul",{className:"text-sm text-red-700 space-y-1",children:Object.entries(U.formState.errors).map(([a,b])=>(0,e.jsxs)("li",{children:["• ",b?.message||`${a} is required`]},a))})]})})]})})}),(0,e.jsxs)(o.Es,{className:"flex-shrink-0 gap-2 px-6 py-4 border-t bg-muted/20",children:[(0,e.jsxs)("div",{className:"flex items-center gap-4 flex-1",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[(0,e.jsx)(D.eMP,{className:"h-3 w-3"}),(0,e.jsx)("span",{children:"Changes are saved automatically"})]}),(0,e.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium",children:[(0,e.jsx)("span",{children:"Total: "}),(0,e.jsxs)("span",{className:"text-primary text-lg",children:[ag,af.toFixed(2)]})]})]}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(q.$,{type:"button",variant:"outline",onClick:()=>b(!1),disabled:i,children:"Cancel"}),!c&&(0,e.jsx)(q.$,{type:"button",variant:"secondary",disabled:i||!V||!aa(),onClick:()=>{U.setValue("status","draft"),U.handleSubmit(ab)()},children:i?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(D.e9t,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(D.eMP,{className:"mr-2 h-4 w-4"}),"Save as Draft"]})}),(0,e.jsx)(q.$,{type:"submit",form:"invoice-form",disabled:i||!V||!aa(),className:"min-w-[120px]",children:i?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(D.e9t,{className:"mr-2 h-4 w-4 animate-spin"}),c?"Updating...":"Creating..."]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(D.Jlk,{className:"mr-2 h-4 w-4"}),c?"Update Invoice":"Create Invoice"]})})]})]})]})})}function K({isOpen:a,onOpenChange:b,invoice:c,onRecordPayment:d}){return c?(0,e.jsx)(o.lG,{open:a,onOpenChange:b,children:(0,e.jsxs)(o.Cf,{className:"sm:max-w-2xl max-h-[90vh]",children:[(0,e.jsxs)(o.c7,{children:[(0,e.jsx)(o.L3,{children:"Invoice Details"}),(0,e.jsx)(u.E,{className:(0,G.qY)(c.status),children:(0,G.me)(c.status)})]}),(0,e.jsx)(v.F,{className:"pr-4 max-h-[calc(90vh-8rem)]",children:(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-sm font-medium mb-1",children:"Client"}),(0,e.jsx)("p",{children:c.client_name}),(0,e.jsx)("p",{className:"text-muted-foreground",children:c.client_address}),(0,e.jsx)("p",{className:"text-muted-foreground",children:c.client_email}),c.isLeaseInvoice&&c.leaseDetails&&(0,e.jsxs)("div",{className:"mt-3 p-3 bg-blue-50 rounded-lg",children:[(0,e.jsx)("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Lease Information"}),(0,e.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,e.jsx)("strong",{children:"Contract:"})," ",c.leaseDetails.contractNumber]}),(0,e.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,e.jsx)("strong",{children:"Vehicle:"})," ",c.leaseDetails.vehicleInfo]}),(0,e.jsxs)("p",{className:"text-sm text-blue-800",children:[(0,e.jsx)("strong",{children:"Billing Period:"})," ",(0,G.Yq)(c.leaseDetails.billingPeriod.start)," -"," ",(0,G.Yq)(c.leaseDetails.billingPeriod.end)]})]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-sm font-medium mb-1",children:"Details"}),(0,e.jsxs)("p",{children:["Date: ",(0,G.Yq)(c.date)]}),(0,e.jsxs)("p",{children:["Due: ",(0,G.Yq)(c.due_date)]}),c.isLeaseInvoice&&(0,e.jsx)("p",{className:"text-sm text-blue-600 mt-2",children:(0,e.jsx)("strong",{children:"Auto-generated lease invoice"})})]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-sm font-medium mb-2",children:"Items"}),(0,e.jsxs)(y.XI,{children:[(0,e.jsx)(y.A0,{children:(0,e.jsxs)(y.Hj,{children:[(0,e.jsx)(y.nd,{children:"Description"}),(0,e.jsx)(y.nd,{className:"text-right",children:"Amount"})]})}),(0,e.jsx)(y.BF,{children:c.items.map((a,b)=>(0,e.jsxs)(y.Hj,{children:[(0,e.jsx)(y.nA,{children:a.description}),(0,e.jsx)(y.nA,{className:"text-right",children:(0,G.vv)(a.amount)})]},b))}),(0,e.jsxs)(y.Gg,{children:[c.vat_percentage&&(0,e.jsxs)(y.Hj,{children:[(0,e.jsxs)(y.nA,{colSpan:1,className:"text-right",children:["VAT (",c.vat_percentage,"%)"]}),(0,e.jsx)(y.nA,{className:"text-right",children:(0,G.vv)((0,G.N9)(c.items)*(c.vat_percentage/100))})]}),c.discount_percentage&&(0,e.jsxs)(y.Hj,{children:[(0,e.jsxs)(y.nA,{colSpan:1,className:"text-right",children:["Discount (",c.discount_percentage,"%)"]}),(0,e.jsxs)(y.nA,{className:"text-right",children:["-",(0,G.vv)((0,G.N9)(c.items)*(c.discount_percentage/100))]})]}),(0,e.jsxs)(y.Hj,{children:[(0,e.jsx)(y.nA,{colSpan:1,className:"text-right font-bold",children:"Total"}),(0,e.jsx)(y.nA,{className:"text-right font-bold",children:(0,G.vv)(c.total_amount)})]}),c.paid_amount>0&&(0,e.jsxs)(y.Hj,{children:[(0,e.jsx)(y.nA,{colSpan:1,className:"text-right font-bold",children:"Paid"}),(0,e.jsx)(y.nA,{className:"text-right font-bold text-green-600",children:(0,G.vv)(c.paid_amount)})]}),(0,e.jsxs)(y.Hj,{children:[(0,e.jsx)(y.nA,{colSpan:1,className:"text-right font-bold",children:"Balance Due"}),(0,e.jsx)(y.nA,{className:"text-right font-bold",children:(0,G.vv)(c.total_amount-c.paid_amount)})]})]})]})]}),c.notes&&(0,e.jsxs)("div",{children:[(0,e.jsx)("h3",{className:"text-sm font-medium mb-1",children:"Notes"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:c.notes})]})]})}),(0,e.jsxs)(o.Es,{className:"gap-2",children:["paid"!==c.status&&"cancelled"!==c.status&&(0,e.jsxs)(q.$,{onClick:()=>{d(c),b(!1)},children:[(0,e.jsx)(D.y5g,{className:"mr-2 h-4 w-4"}),"Record Payment"]}),(0,e.jsxs)(q.$,{variant:"outline",onClick:()=>(0,G.LP)(c),children:[(0,e.jsx)(D.f5X,{className:"mr-2 h-4 w-4"}),"PDF"]}),"draft"===c.status&&(0,e.jsxs)(q.$,{onClick:()=>(0,G.ZY)(c),children:[(0,e.jsx)(D.Vnp,{className:"mr-2 h-4 w-4"}),"Send"]})]})]})}):null}function L({isOpen:a,onOpenChange:b,invoice:c}){let{recordPayment:d,isRecordingPayment:g}=(0,F.P)(),[h,i]=(0,f.useState)(0),[k,l]=(0,f.useState)("bank_transfer"),[m,n]=(0,f.useState)((0,j.GP)(new Date,"yyyy-MM-dd")),[p,u]=(0,f.useState)(""),v=async()=>{c&&(await d({invoice:c,amount:h,method:k,date:m,notes:p}),b(!1))};return c?(0,e.jsx)(o.lG,{open:a,onOpenChange:b,children:(0,e.jsxs)(o.Cf,{className:"sm:max-w-md",children:[(0,e.jsxs)(o.c7,{children:[(0,e.jsx)(o.L3,{children:"Record Payment"}),(0,e.jsxs)(o.rr,{children:["For invoice ",c.id.substring(0,8)]})]}),(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(t.J,{htmlFor:"paymentAmount",children:"Amount"}),(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)(D.G9t,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,e.jsx)(r.p,{id:"paymentAmount",type:"number",value:h,onChange:a=>i(parseFloat(a.target.value)),className:"pl-9"})]})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(t.J,{htmlFor:"paymentMethod",children:"Method"}),(0,e.jsxs)(w.l6,{value:k,onValueChange:a=>l(a),children:[(0,e.jsx)(w.bq,{children:(0,e.jsx)(w.yv,{})}),(0,e.jsxs)(w.gC,{children:[(0,e.jsx)(w.eb,{value:"cash",children:"Cash"}),(0,e.jsx)(w.eb,{value:"bank_transfer",children:"Bank Transfer"}),(0,e.jsx)(w.eb,{value:"credit_card",children:"Credit Card"})]})]})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(t.J,{htmlFor:"paymentDate",children:"Date"}),(0,e.jsx)(r.p,{id:"paymentDate",type:"date",value:m,onChange:a=>n(a.target.value)})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(t.J,{htmlFor:"paymentNotes",children:"Notes"}),(0,e.jsx)(s.T,{id:"paymentNotes",value:p,onChange:a=>u(a.target.value)})]})]}),(0,e.jsxs)(o.Es,{children:[(0,e.jsx)(q.$,{variant:"outline",onClick:()=>b(!1),disabled:g,children:"Cancel"}),(0,e.jsxs)(q.$,{onClick:v,disabled:g,children:[(0,e.jsx)(D.Jlk,{className:"mr-2 h-4 w-4"}),g?"Recording...":"Record Payment"]})]})]})}):null}function M({isOpen:a,onOpenChange:b,onConfirm:c}){return(0,e.jsx)(p.Lt,{open:a,onOpenChange:b,children:(0,e.jsxs)(p.EO,{children:[(0,e.jsxs)(p.wd,{children:[(0,e.jsx)(p.r7,{children:"Are you sure?"}),(0,e.jsx)(p.$v,{children:"This will permanently delete this invoice and unlink any associated trips."})]}),(0,e.jsxs)(p.ck,{children:[(0,e.jsx)(p.Zr,{children:"Cancel"}),(0,e.jsx)(p.Rx,{onClick:c,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})})}d()}catch(a){d(a)}})},50802:a=>{a.exports=import("clsx")},53171:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>r,default:()=>n,getServerSideProps:()=>q,getStaticPaths:()=>p,getStaticProps:()=>o,handler:()=>z,reportWebVitals:()=>s,routeModule:()=>y,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>x,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>u,unstable_getStaticProps:()=>t});var e=c(63885),f=c(80237),g=c(81413),h=c(65611),i=c.n(h),j=c(74780),k=c(42752),l=c(12289),m=a([j,k]);[j,k]=m.then?(await m)():m;let n=(0,g.M)(k,"default"),o=(0,g.M)(k,"getStaticProps"),p=(0,g.M)(k,"getStaticPaths"),q=(0,g.M)(k,"getServerSideProps"),r=(0,g.M)(k,"config"),s=(0,g.M)(k,"reportWebVitals"),t=(0,g.M)(k,"unstable_getStaticProps"),u=(0,g.M)(k,"unstable_getStaticPaths"),v=(0,g.M)(k,"unstable_getStaticParams"),w=(0,g.M)(k,"unstable_getServerProps"),x=(0,g.M)(k,"unstable_getServerSideProps"),y=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/Invoices",pathname:"/Invoices",bundlePath:"",filename:""},distDir:".next-fleet",relativeProjectDir:"",components:{App:j.default,Document:i()},userland:k}),z=(0,l.U)({srcPage:"/Invoices",config:r,userland:k,routeModule:y,getStaticPaths:p,getStaticProps:o,getServerSideProps:q});d()}catch(a){d(a)}})},56884:a=>{a.exports=import("react-hook-form")},57312:a=>{a.exports=import("next-themes")},57973:a=>{a.exports=import("@radix-ui/react-alert-dialog")},60461:a=>{a.exports=import("@radix-ui/react-popover")},62224:(a,b,c)=>{c.d(b,{O:()=>e,j:()=>d});let d=a=>a,e=a=>{let b=[];try{"string"==typeof a.items?b=JSON.parse(a.items):Array.isArray(a.items)&&(b=a.items)}catch(a){console.error("Error parsing invoice items:",a)}return{...a,items:b,client_name:a.clients?.name||"Unknown Client",client_email:a.clients?.email||"",client_address:a.clients?.address||"",client_phone:a.clients?.phone||""}}},65515:a=>{a.exports=require("jspdf")},72373:(a,b,c)=>{c.d(b,{QU:()=>e});var d=c(95965);async function e(a){try{let b,{data:c,error:e}=await d.N.from("lease_invoices").select(`
        *,
        invoices:invoice_id (
          status
        )
      `).eq("lease_id",a);if(e)return void console.error("Error fetching lease invoices:",e);if(!c||0===c.length)return void await d.N.from("vehicle_leases").update({payment_status:"draft"}).eq("id",a);let f={draft:0,sent:0,paid:0,overdue:0,cancelled:0};c.forEach(a=>{let b=a.invoices?.status;b&&Object.prototype.hasOwnProperty.call(f,b)&&f[b]++}),b=f.overdue>0?"overdue":f.cancelled===c.length?"cancelled":f.paid===c.length?"paid":f.sent>0||f.draft>0?"sent":"draft";let{error:g}=await d.N.from("vehicle_leases").update({payment_status:b,updated_at:new Date().toISOString()}).eq("id",a);g&&console.error("Error updating lease payment status:",g)}catch(a){console.error("Error in updateLeasePaymentStatus:",a)}}},74941:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{W:()=>k});var e=c(82015),f=c(28462),g=c(95965),h=c(62224),i=c(48578),j=a([f,i]);function k(){let a=(0,f.useQueryClient)(),[b,c]=(0,e.useState)(""),[d,j]=(0,e.useState)("all"),{data:k,isLoading:l}=(0,f.useQuery)({queryKey:["invoices"],queryFn:async()=>{let{data:a,error:b}=await g.N.from("invoices").select("*, clients:client_id(name, email, address, phone)").order("date",{ascending:!1});if(b)throw b;let{data:c,error:d}=await g.N.from("lease_invoice_details").select("*").order("invoice_date",{ascending:!1});if(d)throw d;let e=await Promise.all((a||[]).map(async a=>{if(!a||!("id"in a))return null;let{data:b}=await g.N.from("trips").select("*").eq("invoice_id",a.id),c=b?b.map(b=>({...b,type:b.service_type||"other",status:"scheduled",client_name:a.clients?.name||"Unknown Client"})):[],d=(0,h.O)(a);return d.trips=c,d})),f=(c||[]).map(a=>({id:a.invoice_id,client_id:a.client_id,client_name:a.client_name,client_email:a.client_email,client_address:a.client_address,client_phone:a.client_phone,date:a.invoice_date,due_date:a.invoice_due_date,status:a.status||"sent",total_amount:a.amount,paid_amount:0,items:[{description:`Vehicle Lease (${(0,i.Yq)(a.billing_period_start)} - ${(0,i.Yq)(a.billing_period_end)})`,quantity:1,unit_price:a.amount,amount:a.amount}],notes:"",created_at:a.created_at,updated_at:a.updated_at,trips:[],isLeaseInvoice:!0,leaseDetails:{contractNumber:"-",lesseeName:a.client_name,lesseeEmail:a.client_email,vehicleInfo:`${a.make} ${a.model} (${a.registration})`,billingPeriod:{start:a.billing_period_start,end:a.billing_period_end}}})),j=e.filter(a=>null!==a),k=new Set(f.map(a=>a.id));return[...j.filter(a=>!k.has(a.id)),...f].sort((a,b)=>{let c=a?.date?new Date(a.date).getTime():0;return(b?.date?new Date(b.date).getTime():0)-c})}}),{data:m,isLoading:n}=(0,f.useQuery)({queryKey:["clients"],queryFn:async()=>{let{data:a,error:b}=await g.N.from("clients").select("id, name, email, address, phone").order("name");if(b)throw b;return a||[]}}),o=(0,e.useMemo)(()=>k?.filter(a=>{if(!a||!("id"in a))return!1;let c=""===b||a.client_name.toLowerCase().includes(b.toLowerCase())||a.id.substring(0,8).toUpperCase().includes(b.toUpperCase()),e="all"===d||a.status===d;return c&&e}),[k,b,d]);return{invoices:k,clients:m,filteredInvoices:o,isLoading:l||n,searchTerm:b,setSearchTerm:c,statusFilter:d,setStatusFilter:j,refetch:()=>Promise.all([a.invalidateQueries({queryKey:["invoices"]}),a.invalidateQueries({queryKey:["clients"]})])}}[f,i]=j.then?(await j)():j,d()}catch(a){d(a)}})},75837:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{v:()=>o});var e=c(8732),f=c(48383),g=c(4720),h=c(66345),i=c(90192),j=c(74952),k=c(48578),l=c(82015),m=c(76569),n=a([f,g,h,i,k]);function o({invoices:a,onView:b,onEdit:c,onRecordPayment:d,onDelete:n}){let[o,p]=(0,l.useState)(new Set),q=async a=>{if(!a.client_email)return void(0,m.oR)({title:"No Email Address",description:"This client doesn't have an email address.",variant:"destructive"});p(b=>new Set(b).add(a.id));try{await (0,k.ZY)(a)&&(0,m.oR)({title:"Email Sent",description:`Invoice sent to ${a.client_email}`})}catch(a){console.error("Error sending email:",a)}finally{p(b=>{let c=new Set(b);return c.delete(a.id),c})}};return 0===a.length?(0,e.jsx)("div",{className:"border rounded-lg bg-card",children:(0,e.jsxs)(f.XI,{children:[(0,e.jsx)(f.A0,{children:(0,e.jsxs)(f.Hj,{children:[(0,e.jsx)(f.nd,{children:"Invoice #"}),(0,e.jsx)(f.nd,{children:"Client"}),(0,e.jsx)(f.nd,{children:"Date"}),(0,e.jsx)(f.nd,{children:"Due Date"}),(0,e.jsx)(f.nd,{children:"Amount"}),(0,e.jsx)(f.nd,{children:"Balance"}),(0,e.jsx)(f.nd,{children:"Status"}),(0,e.jsx)(f.nd,{className:"text-right",children:"Actions"})]})}),(0,e.jsx)(f.BF,{children:(0,e.jsx)(f.Hj,{children:(0,e.jsx)(f.nA,{colSpan:8,className:"text-center py-12",children:(0,e.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,e.jsx)(j.iUU,{className:"h-12 w-12 text-muted-foreground"}),(0,e.jsx)("p",{className:"text-lg font-medium",children:"No invoices found"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:"Create your first invoice to get started"})]})})})})]})}):(0,e.jsx)("div",{className:"border rounded-lg bg-card overflow-x-auto",children:(0,e.jsxs)(f.XI,{children:[(0,e.jsx)(f.A0,{children:(0,e.jsxs)(f.Hj,{children:[(0,e.jsx)(f.nd,{className:"min-w-[120px]",children:"Invoice #"}),(0,e.jsx)(f.nd,{className:"min-w-[200px]",children:"Client"}),(0,e.jsx)(f.nd,{className:"min-w-[100px]",children:"Date"}),(0,e.jsx)(f.nd,{className:"min-w-[140px]",children:"Due Date"}),(0,e.jsx)(f.nd,{className:"min-w-[120px] text-right",children:"Amount"}),(0,e.jsx)(f.nd,{className:"min-w-[120px] text-right",children:"Balance"}),(0,e.jsx)(f.nd,{className:"min-w-[120px]",children:"Status"}),(0,e.jsx)(f.nd,{className:"min-w-[60px] text-right",children:"Actions"})]})}),(0,e.jsx)(f.BF,{children:a.map(a=>{let l=a.total_amount-(a.paid_amount||0),m="overdue"===a.status,p="paid"===a.status;return(0,e.jsxs)(f.Hj,{className:`hover:bg-muted/50 ${m?"bg-red-50 hover:bg-red-100":""}`,children:[(0,e.jsx)(f.nA,{className:"font-mono font-medium",children:(0,k.I$)(a.id)}),(0,e.jsx)(f.nA,{children:(0,e.jsxs)("div",{className:"space-y-1",children:[(0,e.jsx)("div",{className:"font-medium",children:a.client_name}),(0,e.jsx)("div",{className:"text-sm text-muted-foreground",children:a.client_email}),a.isLeaseInvoice&&a.leaseDetails&&(0,e.jsxs)("div",{className:"text-xs text-blue-600 bg-blue-50 px-2 py-1 rounded",children:["Lease: ",a.leaseDetails.contractNumber]})]})}),(0,e.jsx)(f.nA,{className:"text-sm",children:(0,k.Yq)(a.date)}),(0,e.jsx)(f.nA,{children:(0,e.jsxs)("div",{className:"space-y-1",children:[(0,e.jsx)("div",{className:"text-sm",children:(0,k.Yq)(a.due_date)}),(a=>{let b=(a=>{let b=new Date(a),c=new Date,d=b.getTime()-c.getTime();return Math.ceil(d/864e5)})(a.due_date);return"paid"===a.status?(0,e.jsxs)("div",{className:"text-green-600 text-sm",children:[(0,e.jsx)(j.rAV,{className:"h-3 w-3 inline mr-1"}),"Paid"]}):b<0?(0,e.jsxs)("div",{className:"text-red-600 text-sm",children:[(0,e.jsx)(j.RIJ,{className:"h-3 w-3 inline mr-1"}),Math.abs(b)," days overdue"]}):0===b?(0,e.jsxs)("div",{className:"text-orange-600 text-sm",children:[(0,e.jsx)(j.zD7,{className:"h-3 w-3 inline mr-1"}),"Due today"]}):b<=7?(0,e.jsxs)("div",{className:"text-orange-600 text-sm",children:[(0,e.jsx)(j.zD7,{className:"h-3 w-3 inline mr-1"}),"Due in ",b," days"]}):(0,e.jsxs)("div",{className:"text-muted-foreground text-sm",children:["Due in ",b," days"]})})(a)]})}),(0,e.jsx)(f.nA,{className:"text-right",children:(0,e.jsxs)("div",{className:"space-y-1",children:[(0,e.jsx)("div",{className:"font-medium",children:(0,k.vv)(a.total_amount)}),a.paid_amount>0&&(0,e.jsxs)("div",{className:"text-xs text-green-600",children:["Paid: ",(0,k.vv)(a.paid_amount)]})]})}),(0,e.jsx)(f.nA,{className:"text-right",children:(0,e.jsx)("div",{className:`font-medium ${p?"text-green-600":l>0?"text-red-600":"text-muted-foreground"}`,children:(0,k.vv)(l)})}),(0,e.jsx)(f.nA,{children:(0,e.jsxs)(g.E,{className:`${(0,k.qY)(a.status)} flex items-center gap-1 w-fit`,children:[(a=>{switch(a){case"draft":return(0,e.jsx)(j.ffu,{className:"h-3 w-3"});case"sent":return(0,e.jsx)(j.gE4,{className:"h-3 w-3"});case"paid":return(0,e.jsx)(j.rAV,{className:"h-3 w-3"});case"overdue":return(0,e.jsx)(j.RIJ,{className:"h-3 w-3"});case"cancelled":return(0,e.jsx)(j.Jpz,{className:"h-3 w-3"});default:return(0,e.jsx)(j.zD7,{className:"h-3 w-3"})}})(a.status),(0,k.me)(a.status)]})}),(0,e.jsx)(f.nA,{className:"text-right",children:(0,e.jsxs)(i.rI,{children:[(0,e.jsx)(i.ty,{asChild:!0,children:(0,e.jsxs)(h.$,{variant:"ghost",size:"icon",className:"h-8 w-8",children:[(0,e.jsx)(j.a4,{className:"h-4 w-4"}),(0,e.jsx)("span",{className:"sr-only",children:"Open menu"})]})}),(0,e.jsxs)(i.SQ,{align:"end",className:"w-56",children:[(0,e.jsx)(i.lp,{children:"Invoice Actions"}),(0,e.jsx)(i.mB,{}),(0,e.jsxs)(i._2,{onClick:()=>b(a),children:[(0,e.jsx)(j.kU3,{className:"h-4 w-4 mr-2"}),"View Details"]}),(0,e.jsxs)(i._2,{onClick:()=>c(a),children:[(0,e.jsx)(j.ffu,{className:"h-4 w-4 mr-2"}),"Edit Invoice"]}),(0,e.jsx)(i.mB,{}),(0,e.jsxs)(i._2,{onClick:()=>(0,k.LP)(a),children:[(0,e.jsx)(j.f5X,{className:"h-4 w-4 mr-2"}),"Download PDF"]}),a.client_email&&(0,e.jsxs)(i._2,{onClick:()=>q(a),disabled:o.has(a.id),children:[(0,e.jsx)(j.Vnp,{className:"h-4 w-4 mr-2"}),o.has(a.id)?"Sending PDF...":"Send PDF to Client"]}),"paid"!==a.status&&"cancelled"!==a.status&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(i.mB,{}),(0,e.jsxs)(i._2,{onClick:()=>d(a),children:[(0,e.jsx)(j.y5g,{className:"h-4 w-4 mr-2"}),"Record Payment"]})]}),(0,e.jsx)(i.mB,{}),(0,e.jsxs)(i._2,{onClick:()=>n(a.id),className:"text-red-600 focus:text-red-600",children:[(0,e.jsx)(j.lMJ,{className:"h-4 w-4 mr-2"}),"Delete Invoice"]})]})]})})]},a.id)})})]})})}[f,g,h,i,k]=n.then?(await n)():n,d()}catch(a){d(a)}})},75979:a=>{a.exports=import("tailwind-merge")},82015:a=>{a.exports=require("react")},83501:a=>{a.exports=import("jspdf-autotable")},86093:a=>{a.exports=require("react-day-picker")},93939:a=>{a.exports=require("@supabase/supabase-js")},94142:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{F:()=>j});var e=c(8732),f=c(82015),g=c(14505),h=c(87092),i=a([g,h]);[g,h]=i.then?(await i)():i;let j=f.forwardRef(({className:a,children:b,...c},d)=>(0,e.jsxs)(g.Root,{ref:d,className:(0,h.cn)("relative overflow-hidden",a),...c,children:[(0,e.jsx)(g.Viewport,{className:"h-full w-full rounded-[inherit]",children:b}),(0,e.jsx)(k,{}),(0,e.jsx)(g.Corner,{})]}));j.displayName=g.Root.displayName;let k=f.forwardRef(({className:a,orientation:b="vertical",...c},d)=>(0,e.jsx)(g.ScrollAreaScrollbar,{ref:d,orientation:b,className:(0,h.cn)("flex touch-none select-none transition-colors","vertical"===b&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===b&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...c,children:(0,e.jsx)(g.ScrollAreaThumb,{className:"relative flex-1 rounded-full bg-border"})}));k.displayName=g.ScrollAreaScrollbar.displayName,d()}catch(a){d(a)}})},98825:a=>{a.exports=import("@hookform/resolvers/zod")}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[4952,5611,5781,1913,4780,5833,3720],()=>b(b.s=53171));module.exports=c})();