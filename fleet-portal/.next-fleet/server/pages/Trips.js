"use strict";(()=>{var a={};a.id=7992,a.ids=[636,3220,7992],a.modules={1009:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{u:()=>m});var e=c(8732),f=c(66345),g=c(39655),h=c(74952),i=c(34954),j=c(91416),k=c(4720),l=a([f,g,j,k]);function m({viewTrip:a,assignments:b,drivers:c,setTripToAssign:d,setAssignOpen:l}){let m=b&&b.length>0,n={pending:{icon:(0,e.jsx)(h.zD7,{className:"h-4 w-4 text-amber-300"}),label:"Pending",className:"bg-amber-900/30 text-amber-300 border-amber-800"},accepted:{icon:(0,e.jsx)(h.rAV,{className:"h-4 w-4 text-emerald-300"}),label:"Accepted",className:"bg-emerald-900/30 text-emerald-300 border-emerald-800"},rejected:{icon:(0,e.jsx)(h.Jpz,{className:"h-4 w-4 text-red-300"}),label:"Rejected",className:"bg-red-900/30 text-red-300 border-red-800"}},o=()=>{d(a),l(!0)};return(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)(g.Zp,{className:"border-slate-800/50 overflow-hidden bg-transparent",children:[(0,e.jsxs)(g.aR,{className:"pb-2 bg-slate-900/50 border-b border-slate-800/50",children:[(0,e.jsxs)(g.ZB,{className:"text-md flex items-center text-white",children:[(0,e.jsx)(h.KJW,{className:"h-4 w-4 mr-2 text-purple-400"}),"Current Driver"]}),(0,e.jsx)(g.BT,{className:"text-slate-400",children:"Driver assigned to this trip"})]}),(0,e.jsx)(g.Wu,{className:"pt-4 bg-slate-900/30",children:a.driver_name&&"No Driver"!==a.driver_name?(0,e.jsxs)("div",{className:"flex items-center space-x-4 p-4 bg-slate-900/50 rounded-lg border border-slate-800/50",children:[(0,e.jsxs)(j.eu,{className:"h-14 w-14 border-2 border-purple-900",children:[(0,e.jsx)(j.BK,{src:a.driver_avatar,alt:a.driver_name}),(0,e.jsx)(j.q5,{className:"bg-purple-900/50 text-purple-200",children:a.driver_name.substring(0,2).toUpperCase()})]}),(0,e.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,e.jsx)("p",{className:"font-medium text-white",children:a.driver_name}),a.driver_contact&&(0,e.jsx)("p",{className:"text-sm text-slate-400",children:a.driver_contact})]}),(0,e.jsx)(f.$,{onClick:o,variant:"outline",size:"sm",className:"border-purple-800 bg-purple-900/20 text-purple-300 hover:bg-purple-800/30",children:"Change"})]}):(0,e.jsxs)("div",{className:"flex flex-col items-center justify-center py-8 bg-slate-900/30 rounded-lg border border-dashed border-slate-700",children:[(0,e.jsx)(h.RIJ,{className:"h-10 w-10 text-slate-500 mb-3"}),(0,e.jsx)("p",{className:"text-center text-slate-400 mb-2",children:"No driver assigned to this trip"}),(0,e.jsxs)(f.$,{onClick:o,variant:"outline",className:"mt-2 border-purple-800 bg-purple-900/20 text-purple-300 hover:bg-purple-800/30",children:[(0,e.jsx)(h.KJW,{className:"mr-2 h-4 w-4"}),"Assign Driver"]})]})})]}),"organization"===a.client_type&&a.passengers&&0!==a.passengers.length?(0,e.jsxs)(g.Zp,{className:"mt-6 border-slate-800/50 bg-transparent",children:[(0,e.jsxs)(g.aR,{className:"pb-2 bg-slate-900/50 rounded-t-lg border-b border-slate-800/50",children:[(0,e.jsxs)(g.ZB,{className:"text-md flex items-center text-white",children:[(0,e.jsx)(h.zWC,{className:"h-4 w-4 mr-2 text-purple-400"}),"Passengers"]}),(0,e.jsxs)(g.BT,{className:"text-slate-400",children:[a.passengers.length," passenger",1!==a.passengers.length?"s":""," registered"]})]}),(0,e.jsx)(g.Wu,{className:"pt-4 bg-slate-900/30",children:(0,e.jsx)("ul",{className:"divide-y divide-slate-800/50",children:a.passengers.map((a,b)=>(0,e.jsxs)("li",{className:"py-2 px-1 flex items-center gap-3 text-sm",children:[(0,e.jsx)(h.KJW,{className:"h-4 w-4 text-purple-400"}),(0,e.jsx)("span",{className:"text-white",children:a})]},b))})})]}):null,m&&(0,e.jsxs)(g.Zp,{className:"border-slate-800/50 overflow-hidden bg-transparent",children:[(0,e.jsxs)(g.aR,{className:"pb-2 bg-slate-900/50 border-b border-slate-800/50",children:[(0,e.jsxs)(g.ZB,{className:"text-md flex items-center text-white",children:[(0,e.jsx)(h.zD7,{className:"h-4 w-4 mr-2 text-purple-400"}),"Assignment History"]}),(0,e.jsxs)(g.BT,{className:"text-slate-400",children:[b.length," assignment",1!==b.length?"s":""," for this trip"]})]}),(0,e.jsx)(g.Wu,{className:"pt-4 bg-slate-900/30",children:(0,e.jsx)("div",{className:"space-y-4 divide-y divide-slate-800/50",children:b.map(a=>(0,e.jsxs)("div",{className:"flex items-start pt-4 first:pt-0",children:[(0,e.jsxs)(j.eu,{className:"h-10 w-10 mr-3 mt-1 border border-slate-700",children:[(0,e.jsx)(j.BK,{src:a.driver_avatar,alt:a.driver_name||"Driver"}),(0,e.jsx)(j.q5,{className:"bg-slate-800 text-slate-300",children:(a.driver_name||"DR").substring(0,2).toUpperCase()})]}),(0,e.jsxs)("div",{className:"flex-1",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,e.jsx)("span",{className:"font-medium text-white",children:a.driver_name||"Unknown Driver"}),(0,e.jsxs)(k.E,{variant:"outline",className:`text-xs flex items-center gap-1 ${n[a.status].className}`,children:[n[a.status].icon,n[a.status].label]})]}),(0,e.jsxs)("div",{className:"text-xs text-slate-400",children:["Assigned on ",(0,i.Yq)(a.assigned_at)," at ",(0,i.fU)(a.assigned_at.split("T")[1])]}),a.notes&&(0,e.jsx)("div",{className:"text-xs mt-2 bg-slate-900/50 p-2 rounded italic text-slate-300 border border-slate-800/50",children:a.notes})]})]},a.id))})})]})]})}[f,g,j,k]=l.then?(await l)():l,d()}catch(a){d(a)}})},2412:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{o:()=>l});var e=c(8732),f=c(66345),g=c(78059),h=c(57049),i=c(74952),j=c(4720),k=a([f,g,h,j]);function l({searchTerm:a,statusFilter:b,setSearchTerm:c,setStatusFilter:d}){let k=""!==a||"all"!==b;return(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsxs)("div",{className:"flex flex-col lg:flex-row gap-4",children:[(0,e.jsxs)("div",{className:"flex-1 relative group",children:[(0,e.jsx)(i.vji,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground group-focus-within:text-primary transition-colors"}),(0,e.jsx)(g.p,{placeholder:"Search trips by client, destination, or notes...",value:a,onChange:a=>c(a.target.value),className:"pl-9 h-11 border-border/50 focus:border-primary/50 transition-all duration-200"}),a&&(0,e.jsx)(f.$,{variant:"ghost",size:"sm",className:"absolute right-1 top-1 h-7 w-7 p-0 hover:bg-muted/50",onClick:()=>c(""),children:(0,e.jsx)(i.X,{className:"h-3 w-3"})})]}),(0,e.jsx)("div",{className:"flex items-center gap-3",children:(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsxs)(h.l6,{value:b,onValueChange:d,children:[(0,e.jsxs)(h.bq,{className:"w-[140px] h-11 border-border/50 focus:border-primary/50",children:[(0,e.jsx)(i.dJT,{className:"mr-2 h-4 w-4"}),(0,e.jsx)(h.yv,{placeholder:"Status"})]}),(0,e.jsxs)(h.gC,{children:[(0,e.jsx)(h.eb,{value:"all",children:"All Status"}),(0,e.jsx)(h.eb,{value:"scheduled",children:"Scheduled"}),(0,e.jsx)(h.eb,{value:"in_progress",children:"In Progress"}),(0,e.jsx)(h.eb,{value:"completed",children:"Completed"}),(0,e.jsx)(h.eb,{value:"cancelled",children:"Cancelled"})]})]})})})]}),k&&(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{className:"flex flex-wrap gap-2",children:[a&&(0,e.jsxs)(j.E,{variant:"secondary",className:"gap-1",children:['Search: "',a,'"',(0,e.jsx)(f.$,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-transparent",onClick:()=>c(""),children:(0,e.jsx)(i.X,{className:"h-3 w-3"})})]}),"all"!==b&&(0,e.jsxs)(j.E,{variant:"secondary",className:"gap-1",children:["Status: ",b.replace("_"," "),(0,e.jsx)(f.$,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-transparent",onClick:()=>d("all"),children:(0,e.jsx)(i.X,{className:"h-3 w-3"})})]})]}),(0,e.jsxs)(f.$,{variant:"outline",size:"sm",onClick:()=>{c(""),d("all")},className:"shrink-0 text-muted-foreground hover:text-foreground",children:[(0,e.jsx)(i.X,{className:"mr-2 h-4 w-4"}),"Clear All"]})]})]})}[f,g,h,j]=k.then?(await k)():k,d()}catch(a){d(a)}})},2691:(a,b,c)=>{c.d(b,{y:()=>e});var d=c(82015);function e(){let[a,b]=(0,d.useState)(""),[c,e]=(0,d.useState)("all"),[f,g]=(0,d.useState)(null),[h,i]=(0,d.useState)(null),[j,k]=(0,d.useState)(!1),[l,m]=(0,d.useState)(!1),[n,o]=(0,d.useState)(!1),[p,q]=(0,d.useState)(null),[r,s]=(0,d.useState)(null),[t,u]=(0,d.useState)(""),[v,w]=(0,d.useState)(""),[x,y]=(0,d.useState)(""),[z,A]=(0,d.useState)(!1),[B,C]=(0,d.useState)(null),[D,E]=(0,d.useState)("details"),[F,G]=(0,d.useState)(!1);return{searchTerm:a,setSearchTerm:b,statusFilter:c,setStatusFilter:e,viewTrip:f,setViewTrip:g,editTrip:h,setEditTrip:i,bookingOpen:j,setBookingOpen:k,assignOpen:l,setAssignOpen:m,messageOpen:n,setMessageOpen:o,tripToAssign:p,setTripToAssign:q,tripToMessage:r,setTripToMessage:s,assignDriver:t,setAssignDriver:u,assignNote:v,setAssignNote:w,newMessage:x,setNewMessage:y,deleteDialogOpen:z,setDeleteDialogOpen:A,tripToDelete:B,setTripToDelete:C,activeTab:D,setActiveTab:E,calendarView:F,setCalendarView:G}}},5354:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{L:()=>i});var e=c(8732),f=c(40273),g=c(78059),h=a([f,g]);function i({serviceType:a,editTrip:b}){return"airport_pickup"!==a&&"airport_dropoff"!==a?null:(0,e.jsxs)("div",{className:"border p-4 rounded-md space-y-4",children:[(0,e.jsx)("h3",{className:"text-sm font-medium",children:"Flight Details"}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(f.J,{htmlFor:"flight_number",children:"Flight Number"}),(0,e.jsx)(g.p,{id:"flight_number",name:"flight_number",placeholder:"e.g. BA123",defaultValue:b?.flight_number||""})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(f.J,{htmlFor:"airline",children:"Airline"}),(0,e.jsx)(g.p,{id:"airline",name:"airline",placeholder:"e.g. British Airways",defaultValue:b?.airline||""})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(f.J,{htmlFor:"terminal",children:"Terminal"}),(0,e.jsx)(g.p,{id:"terminal",name:"terminal",placeholder:"e.g. Terminal 5",defaultValue:b?.terminal||""})]})]})]})}[f,g]=h.then?(await h)():h,d()}catch(a){d(a)}})},8458:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{N:()=>l});var e=c(8732),f=c(40273),g=c(52670),h=c(78059),i=c(82015);c(81575);var j=c(71913),k=a([f,g,h]);function l({editTrip:a,serviceType:b,onDateTimeChange:c}){let[d,k]=(0,i.useState)(),[l,m]=(0,i.useState)(),[n,o]=(0,i.useState)();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(f.J,{htmlFor:"date",children:"Date"}),(0,e.jsx)(g.l,{date:d,onDateChange:a=>{k(a),c&&(a?c("date",(0,j.GP)(a,"yyyy-MM-dd")):c("date",""))}}),(0,e.jsx)("input",{type:"hidden",name:"date",value:d?(0,j.GP)(d,"yyyy-MM-dd"):"",required:!0})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(f.J,{htmlFor:"time",children:"Time"}),(0,e.jsx)(h.p,{id:"time",type:"time",value:l||"",onChange:a=>{let b=a.target.value;m(b),c&&c("time",b||"")},className:"h-11",step:60,required:!0}),(0,e.jsx)("input",{type:"hidden",name:"time",value:l||"",required:!0})]})]}),["round_trip","security_escort","full_day_hire"].includes(b)&&(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(f.J,{htmlFor:"return_time",children:"Return Time"}),(0,e.jsx)(h.p,{id:"return_time",type:"time",value:n||"",onChange:a=>o(a.target.value),className:"h-11",step:60}),(0,e.jsx)("input",{type:"hidden",name:"return_time",value:n||""})]})]})}[f,g,h]=k.then?(await k)():k,d()}catch(a){d(a)}})},8732:a=>{a.exports=require("react/jsx-runtime")},8938:a=>{a.exports=import("class-variance-authority")},9608:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{R:()=>k});var e=c(8732),f=c(40273),g=c(86009),h=c(57049),i=c(39655),j=a([f,g,h,i]);function k({hasSecurityEscort:a,setHasSecurityEscort:b,escortCount:c,setEscortCount:d}){return(0,e.jsx)(i.Zp,{className:"border-dashed",children:(0,e.jsxs)(i.Wu,{className:"pt-6",children:[(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsx)("div",{className:"flex items-center space-x-2",children:(0,e.jsx)(f.J,{htmlFor:"security_escort",className:"text-sm font-medium",children:"Security Escort"})}),(0,e.jsx)(g.d,{id:"security_escort",checked:a,onCheckedChange:a=>{b(a),a?0===c&&d(1):d(0)}})]}),a&&(0,e.jsxs)("div",{className:"space-y-2 pl-6",children:[(0,e.jsx)(f.J,{htmlFor:"escort_count",className:"text-sm text-muted-foreground",children:"Number of Escort Vehicles"}),(0,e.jsxs)(h.l6,{name:"escort_count",value:c.toString(),onValueChange:a=>{let b=parseInt(a);d(b)},children:[(0,e.jsx)(h.bq,{id:"escort_count",className:"w-full",children:(0,e.jsx)(h.yv,{placeholder:"Select escort count"})}),(0,e.jsxs)(h.gC,{children:[(0,e.jsx)(h.eb,{value:"1",children:"1 Escort Vehicle"}),(0,e.jsx)(h.eb,{value:"2",children:"2 Escort Vehicles"})]})]})]})]}),(0,e.jsx)("input",{type:"hidden",name:"has_security_escort",value:a?"true":"false"}),(0,e.jsx)("input",{type:"hidden",name:"escort_count",value:a?c.toString():"0"})]})})}[f,g,h,i]=j.then?(await j)():j,d()}catch(a){d(a)}})},9640:a=>{a.exports=import("@radix-ui/react-slot")},9812:a=>{a.exports=import("@radix-ui/react-switch")},9879:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{g:()=>h});var e=c(8732),f=c(48383),g=a([f]);function h(){return(0,e.jsx)(f.Hj,{children:(0,e.jsx)(f.nA,{colSpan:8,className:"text-center py-8",children:"No trips found. Try adjusting your search or create a new trip."})})}f=(g.then?(await g)():g)[0],d()}catch(a){d(a)}})},11468:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{Zk:()=>r});var e=c(8732),f=c(71913),g=c(4720),h=c(91416),i=c(66345),j=c(74952),k=c(48383),l=c(63289),m=c(34954),n=c(90192),o=c(95067),p=c(97856),q=a([g,h,i,k,n,o,p]);[g,h,i,k,n,o,p]=q.then?(await q)():q;let s=a=>{if(!a)return"";try{return(0,f.GP)(new Date(`2000-01-01T${a}`),"h:mm a")}catch(b){return console.error("Error formatting time:",b),a}};function r({trip:a,setViewTrip:b,setEditTrip:c,setTripToMessage:d,setMessageOpen:q,setTripToAssign:r,setAssignOpen:t,setTripToAssignVehicle:u,setAssignVehicleOpen:v,setTripToDelete:w,setDeleteDialogOpen:x,updateTripStatus:y}){var z,A;let B=Array.isArray(a.passengers)?a.passengers:[],C=(0,m.BY)(a.notes),D=Array.from(new Set([...B,...C])),E=D.length>0;return(0,e.jsxs)(k.Hj,{className:"group",children:[(0,e.jsx)(k.nA,{className:"font-medium",children:(z=a.id)?z.substring(0,8).toUpperCase():"N/A"}),(0,e.jsxs)(k.nA,{children:[(0,e.jsx)("div",{className:"font-medium",children:(a=>{if(!a)return"No date";try{return(0,f.GP)(new Date(a),"MMM d, yyyy")}catch(a){return console.error("Error formatting date:",a),"Invalid date"}})(a.date)}),(0,e.jsx)("div",{className:"text-sm text-muted-foreground",children:s(a.time)}),a.return_time&&(0,e.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Return: ",s(a.return_time)]}),(0,e.jsx)(p.g,{trip:a,className:"mt-1"})]}),(0,e.jsxs)(k.nA,{children:[(0,e.jsx)("div",{className:"font-medium",children:a.client_name}),"organization"===a.client_type&&(0,e.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,e.jsx)(g.E,{variant:"outline",className:"text-xs",children:"Organization"}),E&&(0,e.jsxs)("div",{className:"mt-1 text-xs text-muted-foreground",children:[(0,e.jsxs)("div",{className:"flex items-center gap-1",children:[(0,e.jsx)(j.zWC,{className:"h-3 w-3"}),1===D.length?(0,e.jsx)("span",{title:D[0],children:D[0].length>15?`${D[0].substring(0,15)}...`:D[0]}):(0,e.jsxs)("span",{title:D.join(", "),children:[D.length," passengers"]})]}),D.length>1&&(0,e.jsxs)("div",{className:"mt-1 text-xs text-muted-foreground ml-4",children:[D.slice(0,2).map((a,b)=>(0,e.jsxs)("div",{className:"truncate max-w-[120px]",title:a,children:["-"," ",a.length>15?`${a.substring(0,15)}...`:a]},b)),D.length>2&&(0,e.jsxs)("div",{className:"text-xs italic",children:["+ ",D.length-2," more"]})]})]})]})]}),(0,e.jsx)(k.nA,{children:(0,e.jsxs)("div",{className:"flex items-center gap-1",children:[(a.type||console.warn("TripListItem: trip.type is undefined/null for trip:",{id:a.id,service_type:a.service_type,display_type:a.display_type,ui_service_type:a.ui_service_type}),(0,e.jsx)(l.N,{type:a.type})),((a,b,c)=>{if(!a)return"Unknown";if(b){let a={airport_pickup:"Airport Pickup",airport_dropoff:"Airport Dropoff",round_trip:"Round Trip",one_way:"One Way Transfer",full_day_hire:"Full Day Hire",half_day:"Half Day"};if(b in a)return a[b]}return a.replace(/_/g," ").split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" ")})(a.type,a.ui_service_type,a.notes)]})}),(0,e.jsxs)(k.nA,{className:"max-w-[200px]",children:[a.pickup_location&&(0,e.jsxs)("div",{className:"flex items-start gap-1 truncate",children:[(0,e.jsx)(j.sDd,{className:"h-3 w-3 mt-1 shrink-0"}),(0,e.jsx)("span",{className:"truncate",children:a.pickup_location})]}),a.dropoff_location&&(0,e.jsxs)("div",{className:"flex items-start gap-1 truncate",children:[(0,e.jsx)(j.Qpb,{className:"h-3 w-3 mt-1 shrink-0"}),(0,e.jsx)("span",{className:"truncate",children:a.dropoff_location})]})]}),(0,e.jsx)(k.nA,{className:"max-w-[150px]",children:a.stops&&a.stops.length>0?(0,e.jsxs)("div",{className:"space-y-1",children:[a.stops.slice(0,2).map((a,b)=>(0,e.jsxs)("div",{className:"text-xs text-muted-foreground truncate",children:["• ",a]},b)),a.stops.length>2&&(0,e.jsxs)("div",{className:"text-xs text-muted-foreground italic",children:["+",a.stops.length-2," more"]})]}):(0,e.jsx)("span",{className:"text-xs text-muted-foreground",children:"—"})}),(0,e.jsx)(k.nA,{children:(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(h.eu,{className:"h-8 w-8",children:a.driver_avatar?(0,e.jsx)(h.BK,{src:a.driver_avatar,alt:a.driver_name}):(0,e.jsx)(h.q5,{className:"bg-primary/10 text-primary",children:a.driver_name?.charAt(0)||"D"})}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"font-medium text-sm",children:a.driver_name}),a.driver_contact&&(0,e.jsx)("div",{className:"text-xs text-muted-foreground truncate max-w-[120px]",children:a.driver_contact})]})]})}),(0,e.jsx)(k.nA,{children:(0,e.jsx)(g.E,{className:(a=>{switch(a){case"scheduled":return"bg-blue-100 text-blue-700";case"in_progress":return"bg-yellow-100 text-yellow-700";case"completed":return"bg-green-100 text-green-700";case"cancelled":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}})(a.status),children:(A=a.status)?A.replace(/_/g," ").split(" ").map(a=>a.charAt(0).toUpperCase()+a.slice(1)).join(" "):"Unknown"})}),(0,e.jsx)(k.nA,{className:"text-right",children:(0,e.jsxs)("div",{className:"flex justify-end",children:[(0,e.jsxs)(i.$,{variant:"ghost",size:"icon",onClick:()=>b(a),children:[(0,e.jsx)(j.iUU,{className:"h-4 w-4"}),(0,e.jsx)("span",{className:"sr-only",children:"View details"})]}),(0,e.jsxs)(n.rI,{children:[(0,e.jsx)(n.ty,{asChild:!0,children:(0,e.jsxs)(i.$,{variant:"ghost",size:"icon",children:[(0,e.jsx)(j.a4,{className:"h-4 w-4"}),(0,e.jsx)("span",{className:"sr-only",children:"Actions"})]})}),(0,e.jsx)(n.SQ,{align:"end",children:(0,e.jsx)(o.e,{trip:a,setViewTrip:b,setEditTrip:c,setTripToMessage:d,setMessageOpen:q,setTripToAssign:r,setAssignOpen:t,setTripToAssignVehicle:u,setAssignVehicleOpen:v,setTripToDelete:w,setDeleteDialogOpen:x,updateTripStatus:y})})]})]})})]},a.id)}d()}catch(a){d(a)}})},11936:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{Q:()=>k});var e=c(8732),f=c(4720),g=c(39655),h=c(74952),i=c(16417),j=a([f,g,i]);function k({trip:a}){let{vehicles:b=[]}=(0,i.s)();if(!a.has_security_escort)return null;let c=(a.escort_vehicle_ids||[]).map(a=>b.find(b=>b.id===a)).filter(Boolean);return(0,e.jsxs)(g.Zp,{className:"border-red-600/50 dark:border-red-500/50 overflow-hidden shadow-md bg-red-950/20",children:[(0,e.jsx)(g.aR,{className:"pb-2 bg-red-950/40 border-b border-red-600/50",children:(0,e.jsxs)(g.ZB,{className:"text-md flex items-center justify-between text-red-100",children:[(0,e.jsxs)("div",{className:"flex items-center",children:[(0,e.jsx)(h.ekZ,{className:"h-4 w-4 mr-2 text-red-400"}),"Security Escort Required",(0,e.jsxs)(f.E,{variant:"destructive",className:"ml-2 text-xs",children:[(0,e.jsx)(h.hcu,{className:"h-3 w-3 mr-1"}),"High Security"]})]}),(()=>{switch(a.escort_status){case"fully_assigned":return(0,e.jsxs)(f.E,{variant:"default",className:"bg-green-600 hover:bg-green-700",children:[(0,e.jsx)(h.rAV,{className:"h-3 w-3 mr-1"}),"Fully Assigned"]});case"partially_assigned":return(0,e.jsxs)(f.E,{variant:"secondary",className:"bg-yellow-600 hover:bg-yellow-700 text-white",children:[(0,e.jsx)(h.zD7,{className:"h-3 w-3 mr-1"}),"Partially Assigned"]});default:return(0,e.jsxs)(f.E,{variant:"destructive",children:[(0,e.jsx)(h.X,{className:"h-3 w-3 mr-1"}),"Not Assigned"]})}})()]})}),(0,e.jsx)(g.Wu,{className:"pt-4",children:(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsx)("span",{className:"text-sm font-medium text-red-100",children:"Escort Vehicles Required:"}),(0,e.jsxs)(f.E,{variant:"outline",className:"border-red-600 text-red-200",children:[a.escort_count||1," vehicle",(a.escort_count||1)>1?"s":""]})]}),c.length>0&&(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)("span",{className:"text-sm font-medium text-red-100",children:"Assigned Escort Vehicles:"}),(0,e.jsx)("div",{className:"space-y-2",children:c.map((a,b)=>(0,e.jsxs)("div",{className:"flex items-center gap-2 p-2 bg-red-950/60 rounded border border-red-600/30",children:[(0,e.jsx)(h.THT,{className:"h-4 w-4 text-red-400"}),(0,e.jsxs)("span",{className:"text-sm text-red-100",children:["Escort ",b+1,": ",a?.make," ",a?.model," (",a?.registration,")"]}),a?.type&&(0,e.jsx)(f.E,{variant:"armoured"===a.type?"default":"secondary",className:"text-xs",children:"armoured"===a.type?"Armoured":"Soft Skin"})]},a?.id||b))})]}),a.escort_assigned_at&&(0,e.jsxs)("div",{className:"text-xs text-red-300 flex items-center gap-1",children:[(0,e.jsx)(h.zD7,{className:"h-3 w-3"}),"Escorts assigned on"," ",new Date(a.escort_assigned_at).toLocaleDateString()," at"," ",new Date(a.escort_assigned_at).toLocaleTimeString()]}),(0,e.jsxs)("div",{className:"text-red-600 dark:text-red-400 text-xs p-2 bg-red-950/40 rounded border border-red-600/30",children:[(0,e.jsx)(h.hcu,{className:"h-3 w-3 inline mr-1"}),"Escort vehicles must be assigned and coordinated before trip departure for security protocols."]})]})})]})}[f,g,i]=j.then?(await j)():j,d()}catch(a){d(a)}})},12919:(a,b,c)=>{c.d(b,{P:()=>f});var d=c(21638),e=c(68794);function f(a,b){let c=(0,d.a)(a);if(isNaN(b))return(0,e.w)(a,NaN);if(!b)return c;let f=c.getDate(),g=(0,e.w)(a,c.getTime());return(g.setMonth(c.getMonth()+b+1,0),f>=g.getDate())?g:(c.setFullYear(g.getFullYear(),g.getMonth(),f),c)}},13020:a=>{a.exports=import("@radix-ui/react-dialog")},13085:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{q:()=>m});var e=c(8732),f=c(34954),g=c(91202),h=c(39655),i=c(74952),j=c(4720),k=c(11936),l=a([h,j,k]);function m({viewTrip:a}){let b="airport_pickup"===a.type||"airport_dropoff"===a.type,c=a.flight_number||a.airline||a.terminal,d=a.notes?(0,f.BY)(a.notes):[],l=Array.isArray(a.passengers)?a.passengers:[],m=Array.from(new Set([...l,...d])),n="organization"===a.client_type&&m.length>0;return(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)(h.Zp,{className:"border-border overflow-hidden shadow-md bg-card",children:[(0,e.jsx)(h.aR,{className:"pb-2 bg-muted/50 border-b border-border",children:(0,e.jsxs)(h.ZB,{className:"text-md flex items-center text-card-foreground",children:[(0,e.jsx)(i.R2D,{className:"h-4 w-4 mr-2 text-primary"}),"Trip Information"]})}),(0,e.jsxs)(h.Wu,{className:"pt-4 divide-y divide-border",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4 pb-4",children:[(0,e.jsxs)("div",{className:"flex items-start gap-3",children:[(0,e.jsx)(i.VvS,{className:"h-5 w-5 mt-0.5 text-primary"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Date"}),(0,e.jsx)("div",{className:"text-foreground",children:(0,f.Yq)(a.date)})]})]}),(0,e.jsxs)("div",{className:"flex items-start gap-3",children:[(0,e.jsx)(i.zD7,{className:"h-5 w-5 mt-0.5 text-primary"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Time"}),(0,e.jsxs)("div",{className:"text-foreground",children:[a.time&&(0,f.fU)(a.time),a.return_time&&` - ${(0,f.fU)(a.return_time)}`]})]})]})]}),(0,e.jsxs)("div",{className:"py-4",children:[(0,e.jsxs)("div",{className:"flex items-start gap-3 mb-3",children:[(0,e.jsx)(i.Vxl,{className:"h-5 w-5 mt-0.5 text-primary"}),(0,e.jsx)("div",{className:"flex-1",children:(0,e.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Route"})})]}),(0,e.jsxs)("div",{className:"pl-8 space-y-3",children:[a.pickup_location&&(0,e.jsxs)("div",{className:"flex items-start",children:[(0,e.jsx)(i.sDd,{className:"h-4 w-4 mt-0.5 text-green-500 mr-2"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"text-xs text-muted-foreground",children:"Pickup Location"}),(0,e.jsx)("div",{className:"text-foreground",children:a.pickup_location})]})]}),Array.isArray(a.stops)&&a.stops.length>0&&a.stops.map((a,b)=>(0,e.jsxs)("div",{className:"flex items-start",children:[(0,e.jsx)(i.sDd,{className:"h-4 w-4 mt-0.5 text-yellow-500 mr-2"}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Stop ",b+1]}),(0,e.jsx)("div",{className:"text-foreground",children:a})]})]},b)),a.dropoff_location&&(0,e.jsxs)("div",{className:"flex items-start",children:[(0,e.jsx)(i.sDd,{className:"h-4 w-4 mt-0.5 text-red-500 mr-2"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"text-xs text-muted-foreground",children:"Dropoff Location"}),(0,e.jsx)("div",{className:"text-foreground",children:a.dropoff_location})]})]})]})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4 py-4",children:[(0,e.jsxs)("div",{className:"flex items-start gap-3",children:[(0,e.jsx)(i.R2D,{className:"h-5 w-5 mt-0.5 text-primary"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Service Type"}),(0,e.jsx)("div",{className:"text-foreground",children:g.I[a.type]||a.type})]})]}),b&&c&&(0,e.jsxs)("div",{className:"flex items-start gap-3",children:[(0,e.jsx)(i.Zcv,{className:"h-5 w-5 mt-0.5 text-primary"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"text-sm font-medium text-muted-foreground",children:"Flight Details"}),(0,e.jsx)("div",{className:"text-foreground",children:(0,f.gF)(a.flight_number,a.airline,a.terminal)})]})]})]})]})]}),(0,e.jsx)(k.Q,{trip:a}),n&&(0,e.jsxs)(h.Zp,{className:"border-border overflow-hidden shadow-md bg-card",children:[(0,e.jsx)(h.aR,{className:"pb-2 bg-muted/50 border-b border-border",children:(0,e.jsxs)(h.ZB,{className:"text-md flex items-center text-card-foreground",children:[(0,e.jsx)(i.zWC,{className:"h-4 w-4 mr-2 text-primary"}),"Passengers (",m.length,")"]})}),(0,e.jsx)(h.Wu,{className:"pt-4",children:(0,e.jsx)("div",{className:"space-y-3",children:m.map((a,b)=>(0,e.jsxs)("div",{className:"flex items-center space-x-3 p-2 rounded-md bg-muted/50 border border-border",children:[(0,e.jsx)("div",{className:"h-8 w-8 rounded-full bg-primary/10 flex items-center justify-center text-primary font-medium",children:a.charAt(0).toUpperCase()}),(0,e.jsx)("div",{className:"flex-1",children:(0,e.jsx)("div",{className:"text-foreground",children:a})}),(0,e.jsxs)(j.E,{variant:"outline",className:"bg-muted text-muted-foreground border-border",children:["Passenger ",b+1]})]},b))})})]}),a.notes&&(0,e.jsxs)(h.Zp,{className:"border-border shadow-md bg-card",children:[(0,e.jsx)(h.aR,{className:"pb-2 bg-muted/50 border-b border-border",children:(0,e.jsxs)(h.ZB,{className:"text-md flex items-center text-card-foreground",children:[(0,e.jsx)(i.R2D,{className:"h-4 w-4 mr-2 text-primary"}),"Notes"]})}),(0,e.jsx)(h.Wu,{className:"pt-4",children:(0,e.jsx)("div",{className:"text-sm whitespace-pre-wrap text-muted-foreground bg-muted/50 p-3 rounded-md border border-border",children:a.notes})})]})]})}[h,j,k]=l.then?(await l)():l,d()}catch(a){d(a)}})},14505:a=>{a.exports=import("@radix-ui/react-scroll-area")},16235:a=>{a.exports=import("@radix-ui/react-toast")},16712:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{k:()=>j});var e=c(8732),f=c(66345),g=c(38661),h=c(74952),i=a([f,g]);function j({viewTrip:a,setEditTrip:b,setTripToDelete:c,setDeleteDialogOpen:d}){return(0,e.jsxs)(g.Es,{className:"flex flex-wrap gap-2 mt-6 sm:justify-between border-t pt-4 border-border",children:[(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsxs)(f.$,{variant:"outline",className:"border-purple-500 bg-purple-500/10 text-purple-600 hover:bg-purple-500/20 hover:text-purple-700 dark:text-purple-400 dark:hover:text-purple-300 rounded-full px-4",onClick:()=>b(a),children:[(0,e.jsx)(h.qUP,{className:"h-4 w-4 mr-2"}),"Edit Trip"]}),(0,e.jsxs)(f.$,{variant:"outline",className:"border-red-500 bg-red-500/10 text-red-600 hover:bg-red-500/20 hover:text-red-700 dark:text-red-400 dark:hover:text-red-300 rounded-full px-4",onClick:()=>{c(a.id),d(!0)},children:[(0,e.jsx)(h.otA,{className:"h-4 w-4 mr-2"}),"Delete"]})]}),(0,e.jsx)(g.HM,{asChild:!0,children:(0,e.jsxs)(f.$,{variant:"secondary",className:"bg-secondary hover:bg-secondary/80 text-secondary-foreground border border-border rounded-full px-4",children:[(0,e.jsx)(h.Jpz,{className:"h-4 w-4 mr-2"}),"Close"]})})]})}[f,g]=i.then?(await i)():i,d()}catch(a){d(a)}})},18502:(a,b,c)=>{c.d(b,{k:()=>e});var d=c(21638);function e(a,b){let c=(0,d.a)(a.start),e=(0,d.a)(a.end),f=+c>+e,g=f?+c:+e,h=f?e:c;h.setHours(0,0,0,0);let i=b?.step??1;if(!i)return[];i<0&&(i=-i,f=!f);let j=[];for(;+h<=g;)j.push((0,d.a)(h)),h.setDate(h.getDate()+i),h.setHours(0,0,0,0);return f?j.reverse():j}},19640:a=>{a.exports=import("@radix-ui/react-tabs")},20598:a=>{a.exports=import("@radix-ui/react-label")},21616:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{F:()=>k});var e=c(8732),f=c(40273),g=c(78059),h=c(66345),i=c(82015);c(23852);var j=a([f,g,h]);function k({editTrip:a,serviceType:b}){let[c,d]=(0,i.useState)([]),[j,k]=(0,i.useState)(!1),l=async a=>{let b=window.google;if(b?.maps)try{let c=b.maps.importLibrary?await b.maps.importLibrary("places"):b.maps.places,d=c?.PlaceAutocompleteElement;if(d){let b=new d;b.inputElement=a,b.addEventListener("gmp-placeselect",c=>{let d=c?.detail?.place||b?.value,e=d?.location,f="function"==typeof e?.lat?e.lat():e?.lat,g="function"==typeof e?.lng?e.lng():e?.lng,h=d?.formatted_address||d?.displayName||a.value;a.value=h;let i=a.parentElement?.querySelector('input[name$="_lat"]'),j=a.parentElement?.querySelector('input[name$="_lng"]');i&&"number"==typeof f&&(i.value=String(f)),j&&"number"==typeof g&&(j.value=String(g))});return}if(b.maps.places?.Autocomplete){let c=new b.maps.places.Autocomplete(a,{fields:["formatted_address","geometry","name"],types:["geocode"]});c.addListener("place_changed",()=>{let b=c.getPlace(),d=b.geometry?.location?.lat?.(),e=b.geometry?.location?.lng?.(),f=b.formatted_address||b.name||a.value;a.value=f;let g=a.parentElement?.querySelector('input[name$="_lat"]'),h=a.parentElement?.querySelector('input[name$="_lng"]');g&&"number"==typeof d&&(g.value=String(d)),h&&"number"==typeof e&&(h.value=String(e))})}}catch{}},m=a=>{a&&window.google?.maps&&setTimeout(()=>{l(a)},0)};return(0,e.jsxs)("div",{className:"grid grid-cols-1 gap-4",children:[(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(f.J,{htmlFor:"pickup_location",children:"Pickup Location"}),(0,e.jsx)(g.p,{id:"pickup_location",name:"pickup_location",placeholder:"Enter pickup location",defaultValue:a?.pickup_location||"",required:!0,ref:m,autoComplete:"off"}),(0,e.jsx)("input",{type:"hidden",name:"pickup_lat",defaultValue:""+a?.pickup_lat||""}),(0,e.jsx)("input",{type:"hidden",name:"pickup_lng",defaultValue:""+a?.pickup_lng||""})]}),c.map((a,b)=>(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(f.J,{htmlFor:`stop_${b}`,children:`Stop ${b+1}`}),(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsx)(g.p,{id:`stop_${b}`,name:"stops[]",placeholder:"Enter stop location",value:a,onChange:a=>((a,b)=>{let e=[...c];e[a]=b,d(e)})(b,a.target.value),ref:m,autoComplete:"off"}),(0,e.jsx)(h.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>(a=>{let b=c.filter((b,c)=>c!==a);d(b)})(b),children:"Remove"})]})]},b)),(0,e.jsx)(h.$,{type:"button",variant:"outline",size:"sm",onClick:()=>d([...c,""]),className:"w-fit",children:"+ Add Stop"}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(f.J,{htmlFor:"dropoff_location",children:"Dropoff Location"}),(0,e.jsx)(g.p,{id:"dropoff_location",name:"dropoff_location",placeholder:"Enter dropoff location",defaultValue:a?.dropoff_location||"",required:!0,ref:m,autoComplete:"off"}),(0,e.jsx)("input",{type:"hidden",name:"dropoff_lat",defaultValue:""+a?.dropoff_lat||""}),(0,e.jsx)("input",{type:"hidden",name:"dropoff_lng",defaultValue:""+a?.dropoff_lng||""})]})]})}[f,g,h]=j.then?(await j)():j,d()}catch(a){d(a)}})},21839:(a,b,c)=>{c.d(b,{f:()=>f});var d=c(21638),e=c(68794);function f(a,b){let c=(0,d.a)(a);return isNaN(b)?(0,e.w)(a,NaN):(b&&c.setDate(c.getDate()+b),c)}},25665:a=>{a.exports=import("@radix-ui/react-checkbox")},28462:a=>{a.exports=import("@tanstack/react-query")},30255:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{I:()=>i});var e=c(8732),f=c(66345),g=c(38661),h=a([f,g]);function i({onClose:a,isEditing:b}){return(0,e.jsxs)(g.Es,{className:"pt-4",children:[(0,e.jsx)(f.$,{type:"button",variant:"outline",onClick:a,children:"Cancel"}),(0,e.jsx)(f.$,{type:"submit",children:b?"Save Changes":"Book Trip"})]})}[f,g]=h.then?(await h)():h,d()}catch(a){d(a)}})},31672:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{k:()=>t});var e=c(8732),f=c(68953),g=c(38661),h=c(74952),i=c(75207),j=c(1009),k=c(13085),l=c(65336),m=c(62724),n=c(16712),o=c(4720),p=c(66345),q=c(34954),r=c(91202),s=a([f,g,i,j,k,l,n,o,p]);function t({viewTrip:a,activeTab:b,setActiveTab:c,messages:d,assignments:s,drivers:t,newMessage:u,setNewMessage:v,handleSendMessage:w,setTripToAssign:x,setAssignOpen:y,setTripToMessage:z,setMessageOpen:A,setEditTrip:B,setTripToDelete:C,setDeleteDialogOpen:D,setViewTrip:E,queryClient:F}){let G="organization"===a.client_type,H=G&&Array.isArray(a.passengers)&&a.passengers.length>0;return console.log("Trip in TripDetailView:",a),console.log("Is organization trip:",G),console.log("Passengers:",a.passengers),(0,e.jsxs)("div",{className:"w-full",children:[(0,e.jsxs)("div",{className:"bg-gradient-to-r from-muted/50 to-muted/30 dark:from-muted/70 dark:to-muted/50 p-6 rounded-lg mb-6 border border-border",children:[(0,e.jsxs)(g.L3,{className:"text-xl font-semibold mb-3 text-foreground flex items-center",children:[(0,e.jsx)(h.VvS,{className:"h-5 w-5 mr-2 text-primary"}),(0,q.Yq)(a.date),(0,e.jsx)("span",{className:"mx-2 text-muted-foreground",children:"•"}),(0,e.jsx)(h.sDd,{className:"h-5 w-5 mr-2 text-primary"}),(a.pickup_location||"Unknown").split(",")[0]]}),(0,e.jsxs)("div",{className:"flex flex-wrap items-center gap-2 mb-3",children:[(0,e.jsx)(o.E,{variant:"outline",className:`font-medium ${(a=>{switch(a){case"scheduled":return"bg-blue-500/10 text-blue-600 border-blue-500/20 hover:bg-blue-500/20 dark:bg-blue-500/20 dark:text-blue-400 dark:border-blue-500/40";case"in_progress":return"bg-amber-500/10 text-amber-600 border-amber-500/20 hover:bg-amber-500/20 dark:bg-amber-500/20 dark:text-amber-400 dark:border-amber-500/40";case"completed":return"bg-green-500/10 text-green-600 border-green-500/20 hover:bg-green-500/20 dark:bg-green-500/20 dark:text-green-400 dark:border-green-500/40";case"cancelled":return"bg-red-500/10 text-red-600 border-red-500/20 hover:bg-red-500/20 dark:bg-red-500/20 dark:text-red-400 dark:border-red-500/40";default:return"bg-muted text-muted-foreground border-border hover:bg-muted/80"}})(a.status)}`,children:a.status.replace("_"," ").toUpperCase()}),(0,e.jsx)(o.E,{variant:"outline",className:"bg-primary/10 text-primary border-primary/20 hover:bg-primary/20",children:r.I[a.type]}),G&&(0,e.jsx)(o.E,{variant:"outline",className:"bg-secondary/10 text-secondary border-secondary/20 hover:bg-secondary/20",children:"Organization"}),H&&(0,e.jsxs)(o.E,{variant:"outline",className:"bg-accent/10 text-accent-foreground border-accent/20 hover:bg-accent/20",children:[a.passengers?.length," ",a.passengers?.length===1?"Passenger":"Passengers"]}),a.has_security_escort&&(0,e.jsxs)(o.E,{variant:"destructive",className:"bg-red-500/10 text-red-600 border-red-500/20 hover:bg-red-500/20",children:[(0,e.jsx)(h.ekZ,{className:"h-3 w-3 mr-1"}),"Security Escort Required"]})]}),(0,e.jsxs)(g.rr,{className:"text-sm text-muted-foreground mb-2",children:["Trip ID: ",a.id.substring(0,8).toUpperCase()]}),"completed"===a.status&&a.log_sheet_url&&(0,e.jsx)("div",{className:"mt-4",children:(0,e.jsx)(p.$,{asChild:!0,children:(0,e.jsxs)("a",{href:a.log_sheet_url,target:"_blank",rel:"noopener noreferrer",children:[(0,e.jsx)(h.iUU,{className:"h-4 w-4 mr-2"}),"Download Log Sheet"]})})})]}),(0,e.jsx)(m.W,{viewTrip:a}),(0,e.jsxs)(f.tU,{value:b,onValueChange:c,className:"w-full space-y-4",children:[(0,e.jsxs)(f.j7,{className:"w-full bg-muted p-1 border border-border rounded-md",children:[(0,e.jsxs)(f.Xi,{value:"details",className:"flex-1 text-muted-foreground data-[state=active]:bg-accent data-[state=active]:text-accent-foreground",children:[(0,e.jsx)(h.iUU,{className:"h-4 w-4 mr-2"}),"Details"]}),G&&(0,e.jsxs)(f.Xi,{value:"passengers",className:"flex-1 text-muted-foreground data-[state=active]:bg-accent data-[state=active]:text-accent-foreground",children:[(0,e.jsx)(h.zWC,{className:"h-4 w-4 mr-2"}),"Passengers"]}),(0,e.jsxs)(f.Xi,{value:"messages",className:"flex-1 text-muted-foreground data-[state=active]:bg-accent data-[state=active]:text-accent-foreground",children:[(0,e.jsx)(h.oFn,{className:"h-4 w-4 mr-2"}),"Messages"]}),(0,e.jsxs)(f.Xi,{value:"assignments",className:"flex-1 text-muted-foreground data-[state=active]:bg-accent data-[state=active]:text-accent-foreground",children:[(0,e.jsx)(h.GvK,{className:"h-4 w-4 mr-2"}),"Assignments"]})]}),(0,e.jsx)(f.av,{value:"details",className:"space-y-4 mt-4",children:(0,e.jsx)(k.q,{viewTrip:a})}),G&&(0,e.jsx)(f.av,{value:"passengers",className:"space-y-4 mt-4",children:(0,e.jsx)(l.H,{viewTrip:a,setViewTrip:E,queryClient:F})}),(0,e.jsx)(f.av,{value:"messages",className:"space-y-4 mt-4",children:(0,e.jsx)(i.k,{messages:d,newMessage:u,setNewMessage:v,handleSendMessage:w})}),(0,e.jsx)(f.av,{value:"assignments",className:"space-y-4 mt-4",children:(0,e.jsx)(j.u,{viewTrip:a,assignments:s,drivers:t,setTripToAssign:x,setAssignOpen:y})})]}),(0,e.jsx)(n.k,{viewTrip:a,setEditTrip:B,setTripToDelete:C,setDeleteDialogOpen:D})]})}[f,g,i,j,k,l,n,o,p]=s.then?(await s)():s,d()}catch(a){d(a)}})},33873:a=>{a.exports=require("path")},36307:a=>{a.exports=import("@radix-ui/react-dropdown-menu")},37765:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{Q:()=>i});var e=c(8732),f=c(40273),g=c(57049),h=a([f,g]);function i({clients:a,editTrip:b,selectedClientId:c,serviceType:d,handleClientChange:h,setServiceType:i}){return(0,e.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(f.J,{htmlFor:"client_id",children:"Client"}),(0,e.jsxs)(g.l6,{name:"client_id",value:c||b?.client_id,onValueChange:h,required:!0,children:[(0,e.jsx)(g.bq,{id:"client_id",children:(0,e.jsx)(g.yv,{placeholder:"Select client"})}),(0,e.jsx)(g.gC,{children:a?.map(a=>(0,e.jsxs)(g.eb,{value:a.id,children:[a.name," ","organization"===a.type&&"\uD83C\uDFE2"]},a.id))})]})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(f.J,{htmlFor:"service_type",children:"Service Type"}),(0,e.jsxs)(g.l6,{name:"service_type",value:d,onValueChange:a=>i(a),required:!0,children:[(0,e.jsx)(g.bq,{id:"service_type",children:(0,e.jsx)(g.yv,{placeholder:"Select service type"})}),(0,e.jsxs)(g.gC,{children:[(0,e.jsx)(g.eb,{value:"airport_pickup",children:"Airport Pickup"}),(0,e.jsx)(g.eb,{value:"airport_dropoff",children:"Airport Dropoff"}),(0,e.jsx)(g.eb,{value:"one_way",children:"One Way Transfer"}),(0,e.jsx)(g.eb,{value:"round_trip",children:"Round Trip"}),(0,e.jsx)(g.eb,{value:"full_day_hire",children:"Full Day Hire"}),(0,e.jsx)(g.eb,{value:"half_day",children:"Half Day"})]})]})]})]})}[f,g]=h.then?(await h)():h,d()}catch(a){d(a)}})},39655:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{BT:()=>l,Wu:()=>m,ZB:()=>k,Zp:()=>i,aR:()=>j,wL:()=>n});var e=c(8732),f=c(82015),g=c(87092),h=a([g]);g=(h.then?(await h)():h)[0];let i=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("div",{ref:c,className:(0,g.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...b}));i.displayName="Card";let j=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("div",{ref:c,className:(0,g.cn)("flex flex-col space-y-1.5 p-6",a),...b}));j.displayName="CardHeader";let k=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("h3",{ref:c,className:(0,g.cn)("text-2xl font-semibold leading-none tracking-tight",a),...b}));k.displayName="CardTitle";let l=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("p",{ref:c,className:(0,g.cn)("text-sm text-muted-foreground",a),...b}));l.displayName="CardDescription";let m=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("div",{ref:c,className:(0,g.cn)("p-6 pt-0",a),...b}));m.displayName="CardContent";let n=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("div",{ref:c,className:(0,g.cn)("flex items-center p-6 pt-0",a),...b}));n.displayName="CardFooter",d()}catch(a){d(a)}})},40361:a=>{a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},41415:a=>{a.exports=import("sonner")},43208:(a,b,c)=>{c.d(b,{B:()=>f,i:()=>e});var d=c(95965);let e=async a=>{if(!a)throw Error("No trip ID provided");try{await d.N.from("trip_messages").delete().eq("trip_id",a),await d.N.from("trip_assignments").delete().eq("trip_id",a);let{error:b}=await d.N.from("trips").delete().eq("id",a);if(b)throw b;return!0}catch(a){throw console.error("Error in deleteTripFromDatabase:",a),a}},f=async(a,b,c,d,f,g,h,i,j)=>{if(a){g(!1);try{await e(a),i({title:"Trip deleted",description:"Trip has been deleted successfully"}),b&&b.id===a&&d(null),c&&c.id===a&&f(null),j.invalidateQueries({queryKey:["trips"]}),j.invalidateQueries({queryKey:["vehicles"]})}catch(a){console.error("Error deleting trip:",a),i({title:"Error",description:"Failed to delete trip",variant:"destructive"})}finally{h(null)}}}},46060:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},46807:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{U:()=>m});var e=c(8732),f=c(82015),g=c(78059),h=c(40273),i=c(66345),j=c(95965),k=c(41415),l=a([g,h,i,k]);function m({passengers:a,serviceType:b,editTrip:c}){let[d,l]=(0,f.useState)(c?.passport_documents||[]),[m,n]=(0,f.useState)(c?.invitation_documents||[]),[o,p]=(0,f.useState)(!1),q=a.filter(a=>a&&""!==a.trim());if("airport_pickup"!==b&&"airport_dropoff"!==b||0===q.length)return null;let r=async(a,b,c)=>{try{p(!0);let d=a.name.split(".").pop(),e=`${c}_${b.replace(/\s+/g,"_")}_${Date.now()}.${d}`,f=`${e}`,{error:g}=await j.N.storage.from("trip_documents").upload(f,a);if(g)throw g;let{data:{publicUrl:h}}=j.N.storage.from("trip_documents").getPublicUrl(f),i={name:a.name,url:h,passenger_name:b};"passport"===c?l(a=>[...a,i]):n(a=>[...a,i]),k.toast.success(`${"passport"===c?"Passport":"Invitation letter"} uploaded successfully`)}catch(a){console.error("Upload error:",a),k.toast.error("Failed to upload document")}finally{p(!1)}},s=async(a,b)=>{try{let c=a.url.split("/").pop();c&&await j.N.storage.from("trip_documents").remove([c]),"passport"===b?l(b=>b.filter(b=>b.url!==a.url)):n(b=>b.filter(b=>b.url!==a.url)),k.toast.success("Document removed successfully")}catch(a){console.error("Remove error:",a),k.toast.error("Failed to remove document")}},t=(a,b,c)=>(0,e.jsxs)("div",{className:"space-y-3",children:[(0,e.jsx)("h4",{className:"text-sm font-medium",children:a}),q.map((a,d)=>{let f=b.filter(b=>b.passenger_name===a);return(0,e.jsxs)("div",{className:"space-y-2 p-3 rounded-md border",children:[(0,e.jsx)(h.J,{className:"text-sm font-medium",children:a}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(g.p,{type:"file",accept:"image/*,.pdf",onChange:b=>((a,b,c)=>{let d=a.target.files?.[0];if(d){if(!["image/jpeg","image/png","image/jpg","application/pdf"].includes(d.type))return void k.toast.error("Please upload only images (JPG, PNG) or PDF files");if(d.size>5242880)return void k.toast.error("File size must be less than 5MB");r(d,b,c)}a.target.value=""})(b,a,c),className:"h-9",disabled:o}),(0,e.jsx)(i.$,{type:"button",variant:"outline",size:"sm",disabled:o,children:o?"Uploading...":"Upload"})]}),f.length>0&&(0,e.jsx)("div",{className:"space-y-2",children:f.map((a,b)=>(0,e.jsxs)("div",{className:"flex items-center justify-between p-2 bg-muted rounded",children:[(0,e.jsx)("span",{className:"text-sm truncate max-w-[70%]",children:a.name}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(i.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>window.open(a.url,"_blank"),children:"Open"}),(0,e.jsx)(i.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>s(a,c),className:"text-destructive hover:text-destructive/90",children:"Remove"})]})]},b))})]},d)})]});return(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsx)("input",{type:"hidden",name:"passport_documents",value:JSON.stringify(d)}),(0,e.jsx)("input",{type:"hidden",name:"invitation_documents",value:JSON.stringify(m)}),(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsx)("h3",{className:"text-sm font-medium",children:"Airport Service Documents"}),(0,e.jsxs)("div",{className:"grid gap-6",children:[t("Passport Pictures",d,"passport"),t("Invitation Letters",m,"invitation")]})]})]})}[g,h,i,k]=l.then?(await l)():l,d()}catch(a){d(a)}})},47661:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{T:()=>n});var e=c(8732),f=c(38661),g=c(63394),h=c(31672),i=c(93820),j=c(70843),k=c(89315),l=c(82268),m=a([f,g,h,i,j,k,l]);function n({viewTrip:a,editTrip:b,bookingOpen:c,assignOpen:d,messageOpen:m,deleteDialogOpen:n,tripToAssign:o,tripToMessage:p,tripToDelete:q,assignDriver:r,assignNote:s,newMessage:t,activeTab:u,clients:v,vehicles:w,drivers:x,trips:y,messages:z,assignments:A,assignVehicleOpen:B,tripToAssignVehicle:C,setViewTrip:D,setEditTrip:E,setBookingOpen:F,setAssignOpen:G,setMessageOpen:H,setDeleteDialogOpen:I,setTripToAssign:J,setTripToMessage:K,setTripToDelete:L,setAssignDriver:M,setAssignNote:N,setNewMessage:O,setActiveTab:P,setAssignVehicleOpen:Q,setTripToAssignVehicle:R,handleTripFormSubmit:S,handleDriverAssignment:T,handleMessageSend:U,queryClient:V}){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f.lG,{open:!!b||c,onOpenChange:a=>!a&&(E(null),F(!1)),children:(0,e.jsxs)(f.Cf,{className:"sm:max-w-2xl max-h-[90vh]",children:[(0,e.jsx)(f.L3,{children:b?"Edit Trip":"Book New Trip"}),(0,e.jsx)(f.rr,{children:b?"Update the trip details below.":"Enter the trip details to book a new trip."}),(0,e.jsx)(g._,{editTrip:b,clients:v,vehicles:w,drivers:x,trips:y,onClose:()=>{E(null),F(!1)},onSubmit:S})]})}),(0,e.jsx)(f.lG,{open:!!a,onOpenChange:a=>{a||D(null)},children:(0,e.jsxs)(f.Cf,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,e.jsx)(f.L3,{children:"Trip Details"}),(0,e.jsx)(f.rr,{children:"View and manage trip information, assignments, and communications."}),a&&(0,e.jsx)(h.k,{viewTrip:a,activeTab:u,setActiveTab:P,messages:z||[],assignments:A||[],drivers:x||[],newMessage:t,setNewMessage:O,handleSendMessage:U,setTripToAssign:J,setAssignOpen:G,setTripToMessage:K,setMessageOpen:H,setEditTrip:E,setTripToDelete:L,setDeleteDialogOpen:I,setViewTrip:D,queryClient:V})]})}),(0,e.jsx)(i.g,{open:d,tripToAssign:o,onClose:()=>{G(!1),J(null),M(""),N("")},onDriverAssigned:()=>{V.invalidateQueries({queryKey:["trips"]}),V.invalidateQueries({queryKey:["vehicles"]}),a&&V.invalidateQueries({queryKey:["tripAssignments",a.id]})}}),(0,e.jsx)(l.i,{open:B,trip:C,onClose:()=>{Q(!1),R(null)},onVehicleAssigned:()=>{V.invalidateQueries({queryKey:["trips"]})}}),(0,e.jsx)(j.R,{open:m,tripToMessage:p,newMessage:t,onMessageChange:O,onSendMessage:U,onClose:()=>{H(!1),K(null),O("")}}),(0,e.jsx)(k.Z,{open:n,tripId:q||"",onClose:()=>{I(!1),L(null)},onTripDeleted:()=>{V.invalidateQueries({queryKey:["trips"]}),V.invalidateQueries({queryKey:["vehicles"]}),a&&a.id===q&&D(null),b&&b.id===q&&E(null)}})]})}[f,g,h,i,j,k,l]=m.then?(await m)():m,d()}catch(a){d(a)}})},47833:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{o:()=>j});var e=c(8732),f=c(82015),g=c(40273),h=c(57049),i=a([g,h]);function j({editTrip:a}){let[b,c]=(0,f.useState)(a?.status||"scheduled");return a?(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(g.J,{htmlFor:"status",children:"Status"}),(0,e.jsxs)(h.l6,{name:"status",value:b,onValueChange:a=>c(a),required:!0,children:[(0,e.jsx)(h.bq,{id:"status",children:(0,e.jsx)(h.yv,{placeholder:"Select status"})}),(0,e.jsxs)(h.gC,{children:[(0,e.jsx)(h.eb,{value:"scheduled",children:"Scheduled"}),(0,e.jsx)(h.eb,{value:"in_progress",disabled:!0,children:"In Progress (use Dispatch)"}),(0,e.jsx)(h.eb,{value:"completed",disabled:!0,children:"Completed (use Dispatch)"}),(0,e.jsx)(h.eb,{value:"cancelled",children:"Cancelled"})]})]})]}):null}[g,h]=i.then?(await i)():i,d()}catch(a){d(a)}})},47860:a=>{a.exports=import("@radix-ui/react-select")},48303:a=>{a.exports=import("@radix-ui/react-tooltip")},48889:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{a:()=>i});var e=c(8732),f=c(40273),g=c(87967),h=a([f,g]);function i({editTrip:a}){return(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(f.J,{htmlFor:"special_notes",children:"Notes"}),(0,e.jsx)(g.T,{id:"special_notes",name:"special_notes",placeholder:"Add any special instructions or notes",defaultValue:a?.notes||"",className:"min-h-[80px]"})]})}[f,g]=h.then?(await h)():h,d()}catch(a){d(a)}})},50073:(a,b,c)=>{c.d(b,{W:()=>d});function d(a,b="",c="all"){return{filteredTrips:a?.filter(a=>{let d=""===b||a.client_name.toLowerCase().includes(b.toLowerCase())||a.driver_name.toLowerCase().includes(b.toLowerCase())||a.vehicle_details.toLowerCase().includes(b.toLowerCase())||a.id.substring(0,8).toUpperCase().includes(b.toUpperCase()),e="all"===c||a.status===c;return d&&e})}}},50802:a=>{a.exports=import("clsx")},53209:(a,b,c)=>{c.d(b,{BG:()=>h.B,MX:()=>n,H9:()=>m,QR:()=>o.Q,Ji:()=>g});let d={airport_pickup:"airport_pickup",airport_dropoff:"airport_dropoff",round_trip:"round_trip",one_way:"one_way_transfer",full_day_hire:"full_day",hourly:"hourly",multi_day:"multi_day",other:"other"};var e=c(95965),f=c(29894);let g=async(a,b,c,d,g,h)=>{try{let i={status:b};"completed"!==b||c?.actual_dropoff_time||c?.actual_end_time||(i.actual_dropoff_time=new Date().toISOString());let{error:j}=await e.N.from("trips").update(i).eq("id",a);if(j)throw j;g({title:"Trip updated",description:`Trip status changed to ${b.replace(/_/g," ").charAt(0).toUpperCase()+b.replace(/_/g," ").slice(1)}`}),f.cacheInvalidationManager.markRecentUpdates(),"cancelled"===b?(await f.cacheInvalidationManager.clearAllCaches(),await Promise.all([h.refetchQueries({queryKey:["trips"]}),h.refetchQueries({queryKey:["vehicles"]}),h.refetchQueries({queryKey:["drivers"]}),h.refetchQueries({queryKey:["clients"]})])):await f.cacheInvalidationManager.invalidateAndRefetch([["trips"],["vehicles"],["drivers"]]),c&&c.id===a&&d({...c,status:b})}catch(a){console.error("Error updating trip status:",a),g({title:"Error",description:"Failed to update trip status",variant:"destructive"})}};var h=c(43208),i=c(21839),j=c(12919);let k=async(a,b,c)=>{let d=new Date(a.get("date")),e=[];for(let g=0;g<b;g++){let b;if("daily"===c)b=(0,i.f)(d,g);else if("weekly"===c){var f;f=g,b=(0,i.f)(d,7*f)}else b=(0,j.P)(d,g);let h=["round_trip","full_day_hire"].includes(a.get("service_type"));e.push({client_id:a.get("client_id"),vehicle_id:a.get("vehicle_id"),driver_id:a.get("driver_id"),date:b.toISOString().split("T")[0],time:a.get("time"),return_time:h?a.get("return_time"):null,service_type:a.get("service_type"),amount:0,pickup_location:a.get("pickup_location")||null,dropoff_location:a.get("dropoff_location")||null,notes:a.get("special_notes")||null,is_recurring:!0})}return e};var l=c(44874);let m=async(a,b,c,f,g,h)=>{a.preventDefault();let i=new FormData(a.currentTarget),j=i.get("service_type")||"one_way",m=(a=>{switch(a){case"airport_pickup":case"airport_dropoff":case"round_trip":case"one_way_transfer":case"full_day":return a;default:return"one_way_transfer"}})(d[j]||"other"),n="on"===i.get("is_recurring"),o=i.get("time"),p=i.get("return_time"),q=["round_trip","full_day_hire"].includes(j),r="airport_pickup"===j||"airport_dropoff"===j?i.get("flight_number"):null,s="airport_pickup"===j||"airport_dropoff"===j?i.get("airline"):null,t="airport_pickup"===j||"airport_dropoff"===j?i.get("terminal"):null,u=i.get("special_notes")||"",v=i.get("status")||"scheduled";i.get("client_type");let w=[],x=i.get("passengers");if(x)try{w=JSON.parse(x)}catch(a){console.error("Error parsing passengers:",a),"string"==typeof x&&(w=x.split(",").map(a=>a.trim()).filter(Boolean))}let y=[],z=[],A=i.get("passport_documents"),B=i.get("invitation_documents"),C=i.getAll("stops[]").map(a=>a.trim()).filter(a=>a.length>0);if(A)try{y=JSON.parse(A)}catch(a){console.error("Error parsing passport documents:",a)}if(B)try{z=JSON.parse(B)}catch(a){console.error("Error parsing invitation documents:",a)}let D=i.get("amount"),E=D?parseFloat(D):0,F=parseInt(i.get("soft_skin_count"))||0,G=parseInt(i.get("armoured_count"))||0,H=i.get("vehicle_type"),I="armoured"===H||"soft_skin"===H?H:null,J="true"===i.get("has_security_escort"),K=J?parseInt(i.get("escort_count"))||1:0;try{let a=i.get("client_id")||"",d=i.get("date")||"";if(!a)return void g({title:"Missing client",description:"Please select a client before saving.",variant:"destructive"});if(!d)return void g({title:"Missing date",description:"Please select a trip date before saving.",variant:"destructive"});if(b){let f={client_id:a,date:d,service_type:m,amount:E,status:v};o&&(f.time=o),q&&p&&(f.return_time=p);let h=i.get("pickup_location")||"",j=i.get("dropoff_location")||"";h&&(f.pickup_location=h),j&&(f.dropoff_location=j),u&&(f.notes=u),r&&(f.flight_number=r),s&&(f.airline=s),t&&(f.terminal=t),w.length>0&&(f.passengers=w),I&&(f.vehicle_type=I),y.length>0&&(f.passport_documents=y),z.length>0&&(f.invitation_documents=z),f.has_security_escort=J,f.escort_count=J?Math.max(1,K||1):null,F&&(f.soft_skin_count=F),G&&(f.armoured_count=G),C.length>0&&(f.stops=C);let{error:k}=await e.N.from("trips").update(f).eq("id",b.id);if(k)throw k;await (0,l.Mx)({title:`Trip updated: ${i.get("pickup_location")||""} to ${i.get("dropoff_location")||""}`,type:"trip",relatedId:b.id}),g({title:"Trip updated",description:"Trip details have been updated successfully"}),c(null)}else if(n){let a=parseInt(i.get("occurrences"))||1,b=i.get("frequency"),c=await k(i,a,b);c.forEach(a=>{a.flight_number=r,a.airline=s,a.terminal=t,a.status="scheduled",a.passengers=w.length>0?w:null,a.amount=E,a.passport_documents=y.length>0?y:null,a.invitation_documents=z.length>0?z:null,a.vehicle_type=I,a.driver_id=null,a.vehicle_id=null,a.time=o||null,a.return_time=q&&p||null,a.has_security_escort=J,a.escort_count=K,a.soft_skin_count=F,a.armoured_count=G,a.stops=C.length>0?C:null});let{data:d,error:h}=await e.N.from("trips").insert(c).select("id");if(h)throw h;d&&d.length>0&&await (0,l.Mx)({title:`${c.length} recurring trips created`,type:"trip",relatedId:d[0].id}),g({title:"Recurring trips created",description:`${c.length} trips have been scheduled successfully`}),f(!1)}else{let b={client_id:a,date:d,service_type:m,amount:E,status:"scheduled",driver_id:null,vehicle_id:null};o&&(b.time=o),q&&p&&(b.return_time=p);let c=i.get("pickup_location")||"",h=i.get("dropoff_location")||"";c&&(b.pickup_location=c),h&&(b.dropoff_location=h),u&&(b.notes=u),r&&(b.flight_number=r),s&&(b.airline=s),t&&(b.terminal=t),w.length>0&&(b.passengers=w),y.length>0&&(b.passport_documents=y),z.length>0&&(b.invitation_documents=z),I&&(b.vehicle_type=I),b.has_security_escort=J,b.escort_count=J?Math.max(1,K||1):null,F&&(b.soft_skin_count=F),G&&(b.armoured_count=G),C.length>0&&(b.stops=C);let{data:j,error:k}=await e.N.from("trips").insert(b).select("id").single();if(k)throw console.error("Error creating trip:",k),k;j&&await (0,l.Mx)({title:`New trip created: ${i.get("pickup_location")||""} to ${i.get("dropoff_location")||""}`,type:"trip",relatedId:j.id}),g({title:"Trip created",description:"New trip has been booked successfully"}),f(!1)}h.invalidateQueries({queryKey:["trips"]}),h.invalidateQueries({queryKey:["vehicles"]})}catch(a){console.error("Error saving trip:",a),g({title:"Error",description:a?.message||"Failed to save trip details",variant:"destructive"})}},n=async(a,b,c,d,f,g,h,i,j)=>{if(a&&b)try{let{error:k}=await e.N.from("trip_assignments").insert([{trip_id:a.id,driver_id:b,assigned_at:new Date().toISOString(),status:"pending",notes:c||null}]);if(k)throw k;let{error:m}=await e.N.from("trips").update({driver_id:b}).eq("id",a.id);if(m)throw m;let n=a&&a.pickup_location&&a.dropoff_location?`${a.pickup_location} to ${a.dropoff_location}`:`Trip-${a.id.slice(0,8)}`;await (0,l.Mx)({title:`Driver assigned to ${n}`,type:"driver",relatedId:a.id}),i({title:"Driver assigned",description:"Driver has been assigned to the trip"}),j.invalidateQueries({queryKey:["trips"]}),j.invalidateQueries({queryKey:["vehicles"]}),j.invalidateQueries({queryKey:["tripAssignments",a.id]}),d(!1),f(null),g(""),h("")}catch(a){console.error("Error assigning driver:",a),i({title:"Error",description:"Failed to assign driver",variant:"destructive"})}};var o=c(42324)},57312:a=>{a.exports=import("next-themes")},57563:(a,b,c)=>{c.d(b,{nG:()=>d});function d(a){switch(a.service_type){case"airport_pickup":default:return"airport_pickup";case"airport_dropoff":return"airport_dropoff";case"round_trip":return"round_trip";case"one_way_transfer":return"one_way";case"full_day":return"full_day_hire";case"half_day":return"half_day"}}},57973:a=>{a.exports=import("@radix-ui/react-alert-dialog")},60461:a=>{a.exports=import("@radix-ui/react-popover")},62724:(a,b,c)=>{c.d(b,{W:()=>f});var d=c(8732),e=c(74952);function f({viewTrip:a}){return(0,d.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[(0,d.jsxs)("div",{className:"flex items-start gap-3 bg-muted/50 p-4 rounded-lg border border-border",children:[(0,d.jsx)(e.tIP,{className:"h-5 w-5 text-primary mt-0.5"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-muted-foreground font-medium",children:"Client"}),(0,d.jsx)("div",{className:"text-base font-semibold text-foreground",children:a.client_name}),a.client_type&&(0,d.jsx)("div",{className:"text-xs text-muted-foreground mt-1",children:a.client_type.charAt(0).toUpperCase()+a.client_type.slice(1)})]})]}),(0,d.jsxs)("div",{className:"flex items-start gap-3 bg-muted/50 p-4 rounded-lg border border-border",children:[(0,d.jsx)(e.THT,{className:"h-5 w-5 text-primary mt-0.5"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-muted-foreground font-medium",children:"Vehicle"}),(0,d.jsx)("div",{className:"text-base font-semibold text-foreground",children:a.vehicle_details||"Not specified"})]})]}),(0,d.jsxs)("div",{className:"flex items-start gap-3 bg-muted/50 p-4 rounded-lg border border-border",children:[(0,d.jsx)(e.Vxl,{className:"h-5 w-5 text-primary mt-0.5"}),(0,d.jsxs)("div",{children:[(0,d.jsx)("div",{className:"text-sm text-muted-foreground font-medium",children:"Route"}),(0,d.jsx)("div",{className:"text-base font-semibold text-foreground truncate",title:a.pickup_location||"Unknown",children:(a.pickup_location||"Unknown").split(",")[0]}),a.dropoff_location&&(0,d.jsxs)("div",{className:"text-xs text-muted-foreground mt-1 truncate",title:a.dropoff_location,children:["To: ",a.dropoff_location.split(",")[0]]})]})]})]})}},63289:(a,b,c)=>{c.d(b,{N:()=>f});var d=c(8732),e=c(74952);function f({type:a,className:b}){if(!a)return(0,d.jsx)(e.THT,{className:b||"h-4 w-4"});if("string"!=typeof a)return console.warn("TripTypeIcon: Invalid type provided",a),(0,d.jsx)(e.THT,{className:b||"h-4 w-4"});let c=String(a).toLowerCase().trim();if(!c)return(0,d.jsx)(e.THT,{className:b||"h-4 w-4"});switch(c){case"airport_pickup":case"airport_dropoff":return(0,d.jsx)(e.Zcv,{className:b||"h-4 w-4"});case"other":case"one_way_transfer":return(0,d.jsx)(e.Qpb,{className:b||"h-4 w-4"});case"hourly":return(0,d.jsx)(e.zD7,{className:b||"h-4 w-4"});case"full_day":case"multi_day":return(0,d.jsx)(e.VvS,{className:b||"h-4 w-4"});case"round_trip":return(0,d.jsx)(e.kM6,{className:b||"h-4 w-4"});case"security_escort":return(0,d.jsx)(e.ekZ,{className:b||"h-4 w-4"});default:return(0,d.jsx)(e.THT,{className:b||"h-4 w-4"})}}},63394:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{_:()=>v});var e=c(8732),f=c(82015),g=c(94142),h=c(86973),i=c(46807),j=c(5354),k=c(82299),l=c(47833),m=c(37765),n=c(21616),o=c(8458),p=c(48889),q=c(30255),r=c(9608);c(57563),c(34954);var s=c(40273),t=c(78059),u=a([g,h,i,j,k,l,m,n,o,p,q,r,s,t]);function v({editTrip:a,clients:b,vehicles:c,drivers:d,trips:u,onClose:v,onSubmit:w}){let[x,y]=(0,f.useState)("airport_pickup"),[z,A]=(0,f.useState)(!1),[B,C]=(0,f.useState)("weekly"),[D,E]=(0,f.useState)(""),[F,G]=(0,f.useState)(""),[H,I]=(0,f.useState)([""]),[J,K]=(0,f.useState)(""),[L,M]=(0,f.useState)(a?.date||""),[N,O]=(0,f.useState)(a?.time||""),[P,Q]=(0,f.useState)(!1),[R,S]=(0,f.useState)(1),T=()=>{J.trim()&&(I([...H.filter(a=>a.trim()),J.trim()]),K(""))},U=H.filter(a=>a&&""!==a.trim());return(0,e.jsx)(g.F,{className:"pr-4 max-h-[calc(90vh-8rem)]",children:(0,e.jsxs)("form",{onSubmit:w,className:"space-y-6",children:[(0,e.jsx)("input",{type:"hidden",name:"client_type",value:F}),(0,e.jsx)("input",{type:"hidden",name:"passengers",value:JSON.stringify(U)}),(0,e.jsx)("input",{type:"hidden",name:"has_security_escort",value:P.toString()}),(0,e.jsx)("input",{type:"hidden",name:"escort_count",value:R.toString()}),a&&(0,e.jsx)("input",{type:"hidden",name:"vehicle_type",value:a.vehicle_type||""}),(0,e.jsx)(m.Q,{clients:b,editTrip:a,selectedClientId:D,serviceType:x,handleClientChange:a=>{if(E(a),!a){G(""),I([""]);return}let c=b?.find(b=>b.id===a);c&&(G(c.type||"individual"),I([""]))},setServiceType:y}),(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsx)("h3",{className:"font-medium",children:"Vehicle Requirements"}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(s.J,{htmlFor:"soft_skin_count",children:"Soft Skin Vehicles"}),(0,e.jsx)(t.p,{id:"soft_skin_count",name:"soft_skin_count",type:"number",min:"0",defaultValue:a?.soft_skin_count??0})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(s.J,{htmlFor:"armoured_count",children:"Armoured Vehicles"}),(0,e.jsx)(t.p,{id:"armoured_count",name:"armoured_count",type:"number",min:"0",defaultValue:a?.armoured_count??0})]})]})]}),(0,e.jsx)(r.R,{hasSecurityEscort:P,setHasSecurityEscort:Q,escortCount:R,setEscortCount:S}),(0,e.jsx)("input",{type:"hidden",name:"client_type",value:F}),(0,e.jsx)(h.o,{passengers:H,setPassengers:I,newPassenger:J,setNewPassenger:K,addPassenger:T,updatePassenger:(a,b)=>{let c=[...H];c[a]=b,I(c)},removePassenger:a=>{let b=H.filter((b,c)=>c!==a);I(b.length?b:[""])},handleKeyDown:a=>{"Enter"===a.key&&J.trim()&&(a.preventDefault(),T())}}),(0,e.jsx)(i.U,{passengers:H,serviceType:x,editTrip:a}),(0,e.jsx)(j.L,{serviceType:x,editTrip:a}),(0,e.jsx)(o.N,{editTrip:a,serviceType:x,onDateTimeChange:(a,b)=>{"date"===a?M(b):O(b)}}),(0,e.jsx)(n.F,{editTrip:a,serviceType:x}),(0,e.jsx)(p.a,{editTrip:a}),a&&(0,e.jsx)(l.o,{editTrip:a}),!a&&(0,e.jsx)(k.i,{isRecurring:z,setIsRecurring:A,frequency:B,setFrequency:C}),(0,e.jsx)(q.I,{onClose:v,isEditing:!!a})]})})}[g,h,i,j,k,l,m,n,o,p,q,r,s,t]=u.then?(await u)():u,d()}catch(a){d(a)}})},65336:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{H:()=>m});var e=c(8732),f=c(82015),g=c(66345),h=c(78059),i=c(95965),j=c(74952),k=c(76569),l=a([g,h]);function m({viewTrip:a,setViewTrip:b,queryClient:c}){let{toast:d}=(0,k.dj)(),[l,m]=(0,f.useState)(Array.isArray(a.passengers)?[...a.passengers]:[]),[n,o]=(0,f.useState)(""),[p,q]=(0,f.useState)(!1),r=()=>{n.trim()&&(m([...l,n.trim()]),o(""))},s=async()=>{try{let{error:e}=await i.N.from("trips").update({passengers:l}).eq("id",a.id);if(e)throw e;b({...a,passengers:[...l]}),c.invalidateQueries({queryKey:["trips"]}),d({title:"Passengers updated",description:"The passenger list has been updated successfully"}),q(!1)}catch(a){console.error("Error saving passengers:",a),d({title:"Error",description:"Failed to update passengers",variant:"destructive"})}};return(0,e.jsxs)("div",{className:"space-y-4 py-4",children:[(0,e.jsxs)("div",{className:"flex justify-between items-center",children:[(0,e.jsx)("h3",{className:"text-lg font-medium",children:"Passengers"}),(0,e.jsx)("div",{className:"space-x-2",children:p?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(g.$,{size:"sm",variant:"outline",onClick:()=>{m(Array.isArray(a.passengers)?[...a.passengers]:[]),o(""),q(!1)},children:"Cancel"}),(0,e.jsxs)(g.$,{size:"sm",onClick:s,children:[(0,e.jsx)(j.eMP,{className:"h-4 w-4 mr-1"}),"Save"]})]}):(0,e.jsx)(g.$,{size:"sm",onClick:()=>{q(!0)},children:"Edit Passengers"})})]}),p&&(0,e.jsxs)("div",{className:"flex items-center gap-2 mb-4",children:[(0,e.jsx)(h.p,{placeholder:"Add passenger name",value:n,onChange:a=>o(a.target.value),onKeyDown:a=>{"Enter"===a.key&&n.trim()&&(a.preventDefault(),r())}}),(0,e.jsx)(g.$,{onClick:r,disabled:!n.trim(),size:"icon",children:(0,e.jsx)(j.FWt,{className:"h-4 w-4"})})]}),(0,e.jsx)("div",{className:"space-y-2",children:l.length>0?l.map((a,b)=>(0,e.jsxs)("div",{className:"flex items-center justify-between p-3 rounded-md bg-secondary/50",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(j.GvK,{className:"h-5 w-5 text-muted-foreground"}),(0,e.jsx)("span",{children:a})]}),p&&(0,e.jsx)(g.$,{variant:"ghost",size:"icon",onClick:()=>{m(l.filter((a,c)=>c!==b))},className:"h-8 w-8 text-destructive hover:text-destructive/90 hover:bg-destructive/10",children:(0,e.jsx)(j.lMJ,{className:"h-4 w-4"})})]},b)):(0,e.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,e.jsx)(j.GvK,{className:"mx-auto h-8 w-8 mb-2 opacity-50"}),(0,e.jsx)("p",{children:"No passengers added to this trip."}),p&&(0,e.jsx)("p",{className:"text-sm mt-1",children:"Use the input above to add passengers."})]})}),("airport_pickup"===a.type||"airport_dropoff"===a.type)&&(a.passport_documents&&a.passport_documents.length>0||a.invitation_documents&&a.invitation_documents.length>0)&&(0,e.jsxs)("div",{className:"mt-8",children:[(0,e.jsx)("h3",{className:"text-lg font-medium mb-4",children:"Airport Service Documents"}),a.passport_documents&&a.passport_documents.length>0&&(0,e.jsxs)("div",{className:"mb-6",children:[(0,e.jsxs)("h4",{className:"text-md font-medium mb-3 flex items-center gap-2",children:[(0,e.jsx)(j.iUU,{className:"h-4 w-4"}),"Passport Pictures"]}),(0,e.jsx)("div",{className:"space-y-2",children:a.passport_documents.map((a,b)=>(0,e.jsxs)("div",{className:"flex items-center justify-between p-3 bg-secondary/50 rounded-md",children:[(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)(j.iUU,{className:"h-4 w-4 text-muted-foreground"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"font-medium",children:a.passenger_name}),(0,e.jsx)("div",{className:"text-sm text-muted-foreground",children:a.name})]})]}),(0,e.jsx)(g.$,{variant:"ghost",size:"sm",onClick:()=>window.open(a.url,"_blank"),children:(0,e.jsx)(j.f5X,{className:"h-4 w-4"})})]},b))})]}),a.invitation_documents&&a.invitation_documents.length>0&&(0,e.jsxs)("div",{children:[(0,e.jsxs)("h4",{className:"text-md font-medium mb-3 flex items-center gap-2",children:[(0,e.jsx)(j.iUU,{className:"h-4 w-4"}),"Invitation Letters"]}),(0,e.jsx)("div",{className:"space-y-2",children:a.invitation_documents.map((a,b)=>(0,e.jsxs)("div",{className:"flex items-center justify-between p-3 bg-secondary/50 rounded-md",children:[(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)(j.iUU,{className:"h-4 w-4 text-muted-foreground"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"font-medium",children:a.passenger_name}),(0,e.jsx)("div",{className:"text-sm text-muted-foreground",children:a.name})]})]}),(0,e.jsx)(g.$,{variant:"ghost",size:"sm",onClick:()=>window.open(a.url,"_blank"),children:(0,e.jsx)(j.f5X,{className:"h-4 w-4"})})]},b))})]})]})]})}[g,h]=l.then?(await l)():l,d()}catch(a){d(a)}})},66293:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{$:()=>k});var e=c(8732),f=c(66345),g=c(19918),h=c.n(g),i=c(74952),j=a([f]);function k({calendarView:a,setCalendarView:b,setBookingOpen:c,isAnalyticsView:d=!1}){return(0,e.jsxs)("div",{className:"flex flex-col gap-4",children:[d&&(0,e.jsx)(h(),{href:"/trips",className:"-mt-2 -ml-1 mb-2",children:(0,e.jsxs)(f.$,{variant:"ghost",size:"sm",className:"text-muted-foreground hover:text-foreground",children:[(0,e.jsx)(i.JGc,{className:"h-4 w-4 mr-1"}),"Back to Trips"]})}),(0,e.jsxs)("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4",children:[(0,e.jsx)("div",{children:(0,e.jsx)("h2",{className:"text-xl font-semibold tracking-tight",children:d?"Trip Analytics":"Trips"})}),d?null:(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsxs)(f.$,{variant:"outline",size:"sm",onClick:()=>b(!1),className:a?"":"bg-muted",children:[(0,e.jsx)(i.B8B,{className:"mr-2 h-4 w-4"}),"List"]}),(0,e.jsxs)(f.$,{variant:"outline",size:"sm",onClick:()=>b(!0),className:a?"bg-muted":"",children:[(0,e.jsx)(i.VvS,{className:"mr-2 h-4 w-4"}),"Calendar"]}),(0,e.jsxs)(f.$,{variant:"outline",onClick:()=>c(!0),children:[(0,e.jsx)(i.f5w,{className:"mr-2 h-4 w-4"}),"New Trip"]})]})]})]})}f=(j.then?(await j)():j)[0],d()}catch(a){d(a)}})},68698:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{x:()=>j});var e=c(8732),f=c(48383),g=c(11468),h=c(9879),i=a([f,g,h]);function j({filteredTrips:a,setViewTrip:b,setEditTrip:c,setTripToMessage:d,setMessageOpen:i,setTripToAssign:j,setAssignOpen:k,setTripToAssignVehicle:l,setAssignVehicleOpen:m,setTripToDelete:n,setDeleteDialogOpen:o,updateTripStatus:p}){return(0,e.jsx)("div",{className:"bg-card rounded-lg shadow border border-border",children:(0,e.jsxs)(f.XI,{children:[(0,e.jsx)(f.A0,{children:(0,e.jsxs)(f.Hj,{children:[(0,e.jsx)(f.nd,{children:"Trip ID"}),(0,e.jsx)(f.nd,{children:"Date"}),(0,e.jsx)(f.nd,{children:"Client"}),(0,e.jsx)(f.nd,{children:"Service"}),(0,e.jsx)(f.nd,{children:"Route"}),(0,e.jsx)(f.nd,{children:"Stops"}),(0,e.jsx)(f.nd,{children:"Driver"}),(0,e.jsx)(f.nd,{children:"Status"}),(0,e.jsx)(f.nd,{className:"text-right",children:"Actions"})]})}),(0,e.jsx)(f.BF,{children:a?.length===0?(0,e.jsx)(h.g,{}):a?.map(a=>(0,e.jsx)(g.Zk,{trip:a,setViewTrip:b,setEditTrip:c,setTripToMessage:d,setMessageOpen:i,setTripToAssign:j,setAssignOpen:k,setTripToAssignVehicle:l,setAssignVehicleOpen:m,setTripToDelete:n,setDeleteDialogOpen:o,updateTripStatus:p},a.id))})]})})}[f,g,h]=i.then?(await i)():i,d()}catch(a){d(a)}})},74651:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{f:()=>o});var e=c(8732),f=c(82015),g=c(71913),h=c(18502),i=c(8218),j=c(10493),k=c(32771),l=c(39655),m=c(66345),n=a([l,m]);function o({filteredTrips:a,setViewTrip:b}){let c,[d,n]=(0,f.useState)(new Date),o=(0,h.k)({start:(0,i.w)(d),end:(0,j.p)(d)});return(0,e.jsxs)(l.Zp,{children:[(0,e.jsxs)(l.aR,{className:"flex flex-row items-center justify-between",children:[(0,e.jsx)(l.ZB,{children:"Trip Calendar"}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(m.$,{variant:"outline",size:"sm",onClick:()=>n(new Date(d.getFullYear(),d.getMonth()-1)),children:"Previous"}),(0,e.jsx)("span",{className:"font-medium",children:(0,g.GP)(d,"MMMM yyyy")}),(0,e.jsx)(m.$,{variant:"outline",size:"sm",onClick:()=>n(new Date(d.getFullYear(),d.getMonth()+1)),children:"Next"})]})]}),(0,e.jsxs)(l.Wu,{children:[(0,e.jsx)("div",{className:"grid grid-cols-7 gap-1 mb-1",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(a=>(0,e.jsx)("div",{className:"text-center font-medium text-sm py-2",children:a},a))}),(0,e.jsxs)("div",{className:"grid grid-cols-7 gap-1",children:[Array.from({length:(c=(0,i.w)(d),new Date(c.getFullYear(),c.getMonth(),1).getDay())}).map((a,b)=>(0,e.jsx)("div",{className:"h-24 p-1 border rounded-md bg-muted/30"},`empty-${b}`)),o.map(c=>{let d=a?.filter(a=>(0,k.r)(new Date(a.date),c))||[];return(0,e.jsxs)("div",{className:`h-24 p-1 border rounded-md overflow-hidden ${(0,k.r)(c,new Date)?"bg-blue-50 border-blue-200":""}`,children:[(0,e.jsx)("div",{className:"font-medium text-sm mb-1",children:(0,g.GP)(c,"d")}),(0,e.jsxs)("div",{className:"space-y-1 overflow-y-auto max-h-[calc(100%-22px)]",children:[d.slice(0,3).map(a=>{var c;return(0,e.jsxs)("div",{className:"text-xs p-1 rounded cursor-pointer bg-primary/10 truncate",onClick:()=>b(a),children:[(c=a.time)?(0,g.GP)(new Date(`2000-01-01T${c}`),"h:mm a"):""," - ",a.client_name]},a.id)}),d.length>3&&(0,e.jsxs)("div",{className:"text-xs text-center text-muted-foreground",children:["+",d.length-3," more"]})]})]},c.toString())})]})]})]})}[l,m]=n.then?(await n)():n,d()}catch(a){d(a)}})},75207:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{k:()=>m});var e=c(8732);c(82015);var f=c(39655),g=c(66345),h=c(87967),i=c(94142),j=c(91416),k=c(71913),l=a([f,g,h,i,j]);function m({messages:a,newMessage:b,setNewMessage:c,handleSendMessage:d}){return(0,e.jsxs)(f.Zp,{children:[(0,e.jsx)(f.aR,{className:"pb-2",children:(0,e.jsx)(f.ZB,{className:"text-lg",children:"Messages"})}),(0,e.jsxs)(f.Wu,{className:"space-y-4",children:[(0,e.jsx)(i.F,{className:"h-[400px] pr-4",children:0===a.length?(0,e.jsx)("div",{className:"flex items-center justify-center h-40 text-muted-foreground",children:"No messages yet"}):(0,e.jsx)("div",{className:"space-y-4",children:a.map(a=>{let b;return(0,e.jsx)("div",{className:`flex ${"admin"===a.sender_type?"justify-end":"justify-start"}`,children:(0,e.jsxs)("div",{className:`max-w-[80%] rounded-lg p-3 ${"admin"===a.sender_type?"bg-primary text-primary-foreground ml-auto":"bg-muted"}`,children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[(0,e.jsx)(j.eu,{className:"h-6 w-6",children:(0,e.jsx)(j.q5,{className:"text-xs",children:a.sender_name.charAt(0)})}),(0,e.jsx)("p",{className:"text-xs font-medium",children:a.sender_name})]}),(0,e.jsx)("p",{className:"text-sm",children:a.message}),(0,e.jsx)("p",{className:"text-xs mt-1 opacity-70",children:(b=a.timestamp,(0,k.GP)(new Date(b),"MMM d, yyyy 'at' h:mm a"))})]})},a.id)})})}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(h.T,{placeholder:"Type your message here...",value:b,onChange:a=>c(a.target.value),className:"min-h-[100px]"}),(0,e.jsx)(g.$,{onClick:d,disabled:!b.trim(),className:"ml-auto",children:"Send Message"})]})]})]})}[f,g,h,i,j]=l.then?(await l)():l,d()}catch(a){d(a)}})},75979:a=>{a.exports=import("tailwind-merge")},82015:a=>{a.exports=require("react")},82268:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{i:()=>s});var e=c(8732),f=c(82015),g=c(38661),h=c(66345),i=c(57049),j=c(40273),k=c(16417),l=c(28462),m=c(95965),n=c(76569),o=c(44874),p=c(4720),q=c(41750),r=a([g,h,i,j,k,l,p]);function s({open:a,trip:b,onClose:c,onVehicleAssigned:d,isEditMode:r=!1}){let{vehicles:s=[],trips:t=[]}=(0,k.s)(),[u,v]=(0,f.useState)([]),[w,x]=(0,f.useState)(null),y=(0,l.useQueryClient)(),{toast:z}=(0,n.dj)(),A=(0,f.useMemo)(()=>b?[...Array(b.armoured_count||0).fill("armoured"),...Array(b.soft_skin_count||0).fill("soft_skin")]:[],[b]),B=s.map(a=>{if(!b)return{...a,isAvailable:!0,reason:void 0,isCompatible:!0,conflicts:[]};let c=(0,q.AT)(a.id,b.date,b.time||"00:00",t,b.return_time,b.id,{bufferHours:1}),d=!b.vehicle_type||a.type===b.vehicle_type;return{...a,isAvailable:c.isAvailable,conflicts:c.conflicts,reason:c.reason,isCompatible:d}}),C=a=>{let b=u.filter((b,c)=>c!==a&&b),c=A[a];return B.filter(a=>!b.includes(a.id)&&a.isCompatible&&(!c||a.type===c))},D=(0,l.useMutation)({mutationFn:async({tripId:a,vehicleIds:b})=>{let{error:c}=await m.N.from("trips").update({vehicle_id:b[0],assigned_vehicle_ids:b}).eq("id",a);if(c)throw c},onSuccess:async()=>{y.setQueryData(["trips"],a=>{if(!a||!b)return a;let c=u.filter(Boolean);return a.map(a=>a.id===b.id?{...a,vehicle_id:c[0]||a.vehicle_id,assigned_vehicle_ids:c}:a)}),await Promise.all([y.invalidateQueries({queryKey:["trips"]}),y.invalidateQueries({queryKey:["vehicles"]}),y.invalidateQueries({queryKey:["drivers"]})]),await Promise.all([y.refetchQueries({queryKey:["trips"]}),y.refetchQueries({queryKey:["vehicles"]})]),z({title:"Vehicle Assigned",description:"The vehicle has been successfully assigned to the trip."}),b&&(0,o.Mx)({title:`Vehicle assigned for trip ${b.id}`,type:"trip",relatedId:b.id.toString()}),d(),c()},onError:a=>{z({title:"Error",description:`Failed to assign vehicle: ${a.message}`,variant:"destructive"})}});return(0,e.jsx)(g.lG,{open:a,onOpenChange:a=>{a||c()},children:(0,e.jsxs)(g.Cf,{children:[(0,e.jsxs)(g.c7,{children:[(0,e.jsx)(g.L3,{children:"Assign Vehicles"}),(0,e.jsxs)(g.rr,{children:["Assign required vehicles for trip"," ",b?.id?b.id.substring(0,8).toUpperCase():"",". This trip requires:",(0,e.jsxs)("ul",{className:"list-disc list-inside mt-2",children:[(b?.soft_skin_count||0)>0&&(0,e.jsxs)("li",{children:[(0,e.jsx)(p.E,{variant:"secondary",className:"mr-1",children:b?.soft_skin_count||0}),"Soft Skin vehicle(s)"]}),(b?.armoured_count||0)>0&&(0,e.jsxs)("li",{children:[(0,e.jsx)(p.E,{variant:"default",className:"mr-1",children:b?.armoured_count||0}),"Armoured vehicle(s)"]}),0===A.length&&(0,e.jsx)("li",{children:"No specific vehicle types requested."})]})]})]}),(0,e.jsxs)("form",{onSubmit:a=>{if(a.preventDefault(),!b)return;let c=u.filter(Boolean);return c.length!==A.length?void z({title:"Assignment Incomplete",description:`Please assign ${A.length-c.length} more vehicle(s).`,variant:"destructive"}):new Set(c).size!==c.length?void z({title:"Duplicate Vehicles",description:"Please ensure each selected vehicle is unique.",variant:"destructive"}):void D.mutate({tripId:b.id,vehicleIds:c})},children:[(0,e.jsxs)("div",{className:"space-y-4 py-4",children:[0===A.length&&(0,e.jsx)("p",{className:"text-muted-foreground",children:"No specific vehicle types were requested for this trip."}),A.map((a,b)=>(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsxs)(j.J,{htmlFor:`vehicle-${b}`,children:["Vehicle ",b+1," – ",a.replace("_"," ")," (",C(b).length," available)"]}),(0,e.jsxs)(i.l6,{onValueChange:a=>{let c=[...u];c[b]=a,v(c)},value:u[b]||"none",children:[(0,e.jsx)(i.bq,{id:`vehicle-${b}`,children:(0,e.jsx)(i.yv,{placeholder:`Select ${a.replace("_"," ")} vehicle`})}),(0,e.jsx)(i.gC,{children:C(b).map(a=>(0,e.jsx)(i.eb,{value:a.id,children:(0,e.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,e.jsxs)("span",{children:[a.make," ",a.model," (",a.registration,")"]}),(0,e.jsxs)("div",{className:"flex gap-1",children:[(0,e.jsx)(p.E,{className:`${a.isAvailable?"bg-green-500 hover:bg-green-600":"bg-amber-500 hover:bg-amber-600"} text-white text-xs`,children:a.isAvailable?"Available":"Busy"}),(0,e.jsx)(p.E,{variant:"outline",className:"text-xs",children:"armoured"===a.type?"Armoured":"Soft Skin"})]})]})},a.id))})]})]},b)),w&&(0,e.jsxs)("div",{className:"bg-amber-900/30 border border-amber-500/50 text-amber-200 p-3 rounded-md flex items-start gap-2",children:[(0,e.jsx)("div",{className:"h-5 w-5 text-amber-400 mt-0.5 flex-shrink-0",children:"⚠️"}),(0,e.jsx)("p",{className:"text-sm",children:w})]})]}),(0,e.jsxs)(g.Es,{children:[(0,e.jsx)(h.$,{type:"button",variant:"outline",onClick:c,children:"Cancel"}),(0,e.jsx)(h.$,{type:"submit",disabled:u.filter(Boolean).length!==A.length||D.isPending,children:D.isPending?"Assigning...":"Assign Vehicles"})]})]})]})})}[g,h,i,j,k,l,p]=r.then?(await r)():r,d()}catch(a){d(a)}})},82299:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{i:()=>k});var e=c(8732),f=c(40273),g=c(78059),h=c(85072),i=c(57049),j=a([f,g,h,i]);function k({isRecurring:a,setIsRecurring:b,frequency:c,setFrequency:d}){return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)(h.S,{id:"is_recurring",name:"is_recurring",checked:a,onCheckedChange:a=>b(!0===a)}),(0,e.jsx)(f.J,{htmlFor:"is_recurring",className:"cursor-pointer",children:"This is a recurring trip"})]}),a&&(0,e.jsxs)("div",{className:"grid grid-cols-2 gap-4 border p-4 rounded-md",children:[(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(f.J,{htmlFor:"occurrences",children:"Number of Occurrences"}),(0,e.jsx)(g.p,{id:"occurrences",name:"occurrences",type:"number",defaultValue:"4",min:"2",required:a})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(f.J,{htmlFor:"frequency",children:"Frequency"}),(0,e.jsxs)(i.l6,{name:"frequency",value:c,onValueChange:a=>d(a),children:[(0,e.jsx)(i.bq,{id:"frequency",children:(0,e.jsx)(i.yv,{placeholder:"Select frequency"})}),(0,e.jsxs)(i.gC,{children:[(0,e.jsx)(i.eb,{value:"daily",children:"Daily"}),(0,e.jsx)(i.eb,{value:"weekly",children:"Weekly"}),(0,e.jsx)(i.eb,{value:"monthly",children:"Monthly"})]})]})]})]})]})}[f,g,h,i]=j.then?(await j)():j,d()}catch(a){d(a)}})},85072:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{S:()=>k});var e=c(8732),f=c(82015),g=c(25665),h=c(74952),i=c(87092),j=a([g,i]);[g,i]=j.then?(await j)():j;let k=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Root,{ref:c,className:(0,i.cn)("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus:outline-none focus:ring-0 focus-visible:ring-0 focus:ring-offset-0 focus-visible:ring-offset-0 focus:border-ring focus-visible:border-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground transition-colors",a),...b,children:(0,e.jsx)(g.Indicator,{className:(0,i.cn)("flex items-center justify-center text-current"),children:(0,e.jsx)(h.Jlk,{className:"h-4 w-4"})})}));k.displayName=g.Root.displayName,d()}catch(a){d(a)}})},86009:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{d:()=>j});var e=c(8732),f=c(82015),g=c(9812),h=c(87092),i=a([g,h]);[g,h]=i.then?(await i)():i;let j=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Root,{className:(0,h.cn)("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus:outline-none focus:ring-0 focus-visible:ring-0 focus:ring-offset-0 focus-visible:ring-offset-0 focus:border-ring focus-visible:border-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",a),...b,ref:c,children:(0,e.jsx)(g.Thumb,{className:(0,h.cn)("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));j.displayName=g.Root.displayName,d()}catch(a){d(a)}})},86093:a=>{a.exports=require("react-day-picker")},86973:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{o:()=>j});var e=c(8732),f=c(78059),g=c(66345),h=c(74952),i=a([f,g]);function j({passengers:a,newPassenger:b,setNewPassenger:c,addPassenger:d,updatePassenger:i,removePassenger:j,handleKeyDown:k}){let l=a.filter(a=>a&&""!==a.trim());return(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsx)("h3",{className:"text-sm font-medium",children:"Passengers"}),(0,e.jsx)("input",{type:"hidden",name:"passengers",value:JSON.stringify(l)}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(f.p,{placeholder:"Add new passenger",value:b,onChange:a=>c(a.target.value),onKeyDown:k,className:"flex-1"}),(0,e.jsx)(g.$,{type:"button",variant:"outline",size:"sm",onClick:d,disabled:!b.trim(),className:"h-10",children:"Add"})]}),(0,e.jsxs)("div",{className:"space-y-3 max-h-[200px] overflow-y-auto",children:[a.filter(a=>a.trim()).map((a,b)=>(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(f.p,{value:a,onChange:a=>i(b,a.target.value),className:"flex-1",placeholder:"Passenger name"}),(0,e.jsx)("button",{type:"button",onClick:()=>j(b),className:"text-destructive hover:text-destructive/80 p-1",children:(0,e.jsx)(h.X,{className:"h-4 w-4"})})]},b)),0===a.filter(a=>a.trim()).length&&(0,e.jsx)("div",{className:"text-sm text-muted-foreground italic p-2 text-center",children:"No passengers added yet"})]})]})}[f,g]=i.then?(await i)():i,d()}catch(a){d(a)}})},89315:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{Z:()=>k});var e=c(8732),f=c(82015),g=c(95020),h=c(76569),i=c(43208),j=a([g]);function k({open:a,tripId:b,onClose:c,onTripDeleted:d}){let{toast:j}=(0,h.dj)(),[k,l]=(0,f.useState)(!1),m=async a=>{if(a.preventDefault(),b&&!k){l(!0);try{await (0,i.i)(b),j({title:"Trip deleted",description:"Trip has been successfully deleted"}),d()}catch(a){console.error("Error deleting trip:",a),j({title:"Error",description:a instanceof Error?a.message:"Failed to delete trip",variant:"destructive"})}finally{l(!1),c()}}};return(0,e.jsx)(g.Lt,{open:a,onOpenChange:a=>{a||k||c()},children:(0,e.jsxs)(g.EO,{children:[(0,e.jsxs)(g.wd,{children:[(0,e.jsx)(g.r7,{children:"Are you sure?"}),(0,e.jsx)(g.$v,{children:"This action cannot be undone. This will permanently delete the trip and all associated messages and driver assignments."})]}),(0,e.jsxs)(g.ck,{children:[(0,e.jsx)(g.Zr,{disabled:k,children:"Cancel"}),(0,e.jsx)(g.Rx,{onClick:m,disabled:k,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:k?"Deleting...":"Delete Trip"})]})]})})}g=(j.then?(await j)():j)[0],d()}catch(a){d(a)}})},91416:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{BK:()=>k,eu:()=>j,q5:()=>l});var e=c(8732),f=c(82015),g=c(92549),h=c(87092),i=a([g,h]);[g,h]=i.then?(await i)():i;let j=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Root,{ref:c,className:(0,h.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...b}));j.displayName=g.Root.displayName;let k=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Image,{ref:c,className:(0,h.cn)("aspect-square h-full w-full",a),...b}));k.displayName=g.Image.displayName;let l=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Fallback,{ref:c,className:(0,h.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...b}));l.displayName=g.Fallback.displayName,d()}catch(a){d(a)}})},92549:a=>{a.exports=import("@radix-ui/react-avatar")},93820:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{g:()=>r});var e=c(8732),f=c(82015),g=c(38661),h=c(66345),i=c(40273),j=c(87967),k=c(57049),l=c(76569),m=c(95965),n=c(74952),o=c(28462),p=c(4720);c(41750);var q=a([g,h,i,j,k,o,p]);function r({open:a,tripToAssign:b,onClose:c,onDriverAssigned:d}){let{toast:q}=(0,l.dj)(),r=(0,o.useQueryClient)(),[s,t]=(0,f.useState)(!1),[u,v]=(0,f.useState)([]),[w,x]=(0,f.useState)(""),[y,z]=(0,f.useState)(""),[A,B]=(0,f.useState)(null);r.getQueryData(["trips"]);let C=async()=>{if(b&&w){t(!0);try{let{error:a}=await m.N.from("trip_assignments").insert([{trip_id:b.id,driver_id:w,notes:y,status:"pending"}]);if(a)throw a;let{error:c}=await m.N.from("trips").update({driver_id:w,status:b.status}).eq("id",b.id);if(c)throw c;r.setQueryData(["trips"],a=>a?a.map(a=>a.id===b.id?{...a,driver_id:w}:a):a),q({title:"Driver assigned",description:"Driver has been successfully assigned to the trip"}),r.invalidateQueries({queryKey:["trips"]}),r.invalidateQueries({queryKey:["vehicles"]}),d(),D()}catch(a){console.error("Error assigning driver:",a),q({title:"Error",description:a instanceof Error?a.message:"Failed to assign driver",variant:"destructive"})}finally{t(!1)}}},D=()=>{x(""),z(""),B(null),t(!1),c()};return(0,e.jsx)(g.lG,{open:a,onOpenChange:D,children:(0,e.jsxs)(g.Cf,{className:"sm:max-w-md bg-slate-900 border border-slate-800 shadow-lg rounded-lg",children:[(0,e.jsxs)(g.c7,{className:"border-b border-slate-800 pb-4",children:[(0,e.jsxs)(g.L3,{className:"text-white flex items-center",children:[(0,e.jsx)(n.MWd,{className:"h-5 w-5 mr-2 text-purple-400"}),"Assign Driver"]}),(0,e.jsxs)(g.rr,{className:"text-slate-400",children:["Assign a driver to trip"," ",b?b.id.substring(0,8).toUpperCase():""]})]}),(0,e.jsxs)("div",{className:"grid gap-5 py-4",children:[(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsxs)(i.J,{htmlFor:"driver",className:"text-slate-300",children:["Select Driver (",u.length," available)"]}),(0,e.jsxs)(k.l6,{value:w,onValueChange:x,children:[(0,e.jsx)(k.bq,{className:"bg-slate-800 border-slate-700 text-slate-300 focus:ring-purple-500 rounded-md",children:(0,e.jsx)(k.yv,{placeholder:"Select a driver"})}),(0,e.jsx)(k.gC,{className:"bg-slate-800 border-slate-700",children:u.map(a=>(0,e.jsx)(k.eb,{value:a.id,className:"text-slate-300 hover:bg-slate-700 focus:bg-slate-700",children:(0,e.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,e.jsx)("span",{children:a.name}),(0,e.jsx)(p.E,{className:`ml-2 ${a.isAvailable?"bg-green-500 hover:bg-green-600":"bg-amber-500 hover:bg-amber-600"} text-white text-xs`,children:a.isAvailable?"Available":"Busy"})]})},a.id))})]})]}),A&&(0,e.jsxs)("div",{className:"bg-amber-900/30 border border-amber-500/50 text-amber-200 p-3 rounded-md flex items-start gap-2",children:[(0,e.jsx)(n.RIJ,{className:"h-5 w-5 text-amber-400 mt-0.5 flex-shrink-0"}),(0,e.jsx)("p",{className:"text-sm",children:A})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(i.J,{htmlFor:"notes",className:"text-slate-300",children:"Assignment Notes"}),(0,e.jsx)(j.T,{id:"notes",placeholder:"Add any notes about this assignment...",value:y,onChange:a=>z(a.target.value),className:"bg-slate-800 border-slate-700 text-slate-300 placeholder:text-slate-500 focus:ring-purple-500 min-h-[100px] rounded-md"})]})]}),(0,e.jsxs)(g.Es,{className:"border-t border-slate-800 pt-4",children:[(0,e.jsx)(h.$,{variant:"outline",onClick:D,className:"bg-slate-800 border-slate-700 text-slate-300 hover:bg-slate-700 hover:text-slate-200 rounded-full",children:"Cancel"}),(0,e.jsx)(h.$,{onClick:C,disabled:!w||s,className:"bg-purple-600 hover:bg-purple-700 text-white rounded-full",children:s?"Assigning...":"Assign Driver"})]})]})})}[g,h,i,j,k,o,p]=q.then?(await q)():q,d()}catch(a){d(a)}})},93939:a=>{a.exports=require("@supabase/supabase-js")},94016:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>t});var e=c(8732),f=c(28462),g=c(76569),h=c(16417),i=c(98808),j=c(82015),k=c(66293),l=c(2412),m=c(68698),n=c(74651),o=c(47661),p=c(2691),q=c(50073),r=c(53209),s=a([f,h,i,k,l,m,n,o]);function t(){let{toast:a}=(0,g.dj)(),b=(0,f.useQueryClient)(),{searchTerm:c,setSearchTerm:d,statusFilter:s,setStatusFilter:t,viewTrip:u,setViewTrip:v,editTrip:w,setEditTrip:x,bookingOpen:y,setBookingOpen:z,assignOpen:A,setAssignOpen:B,messageOpen:C,setMessageOpen:D,tripToAssign:E,setTripToAssign:F,tripToMessage:G,setTripToMessage:H,assignDriver:I,setAssignDriver:J,assignNote:K,setAssignNote:L,newMessage:M,setNewMessage:N,deleteDialogOpen:O,setDeleteDialogOpen:P,tripToDelete:Q,setTripToDelete:R,activeTab:S,setActiveTab:T,calendarView:U,setCalendarView:V}=(0,p.y)(),[W,X]=(0,j.useState)(!1),[Y,Z]=(0,j.useState)(null),{trips:$,isLoading:_,clients:aa,vehicles:ab,drivers:ac}=(0,h.s)(),{filteredTrips:ad}=(0,q.W)($,c,s),{messages:ae,assignments:af}=(0,i.j)(u),ag=b=>a(b);return _?(0,e.jsx)("div",{className:"min-h-screen bg-background",children:(0,e.jsx)("div",{className:"p-4 px-6 space-y-6",children:(0,e.jsx)("div",{className:"border-b border-border pb-4 pt-4",children:(0,e.jsx)("div",{children:(0,e.jsx)("h1",{className:"text-2xl font-semibold text-foreground",children:"Trips"})})})})}):(0,e.jsx)("div",{className:"min-h-screen bg-background",children:(0,e.jsxs)("div",{className:"p-4 px-6 space-y-6",children:[(0,e.jsx)(k.$,{calendarView:U,setCalendarView:V,setBookingOpen:z}),(0,e.jsx)(l.o,{searchTerm:c,statusFilter:s,setSearchTerm:d,setStatusFilter:t}),U?(0,e.jsx)(n.f,{filteredTrips:ad,setViewTrip:v}):(0,e.jsx)(m.x,{filteredTrips:ad,setViewTrip:v,setEditTrip:x,setTripToMessage:H,setMessageOpen:D,setTripToAssign:F,setAssignOpen:B,setTripToAssignVehicle:Z,setAssignVehicleOpen:X,setTripToDelete:R,setDeleteDialogOpen:P,updateTripStatus:(a,c)=>(0,r.Ji)(a,c,u,v,ag,b)}),(0,e.jsx)(o.T,{viewTrip:u,editTrip:w,bookingOpen:y,assignOpen:A,messageOpen:C,deleteDialogOpen:O,tripToAssign:E,tripToMessage:G,tripToDelete:Q,assignDriver:I,assignNote:K,newMessage:M,activeTab:S,clients:aa,vehicles:ab,drivers:ac,trips:$,messages:ae||[],assignments:af||[],assignVehicleOpen:W,tripToAssignVehicle:Y,setViewTrip:v,setEditTrip:x,setBookingOpen:z,setAssignOpen:B,setMessageOpen:D,setDeleteDialogOpen:P,setTripToAssign:F,setTripToMessage:H,setTripToDelete:R,setAssignDriver:J,setAssignNote:L,setNewMessage:N,setActiveTab:T,setAssignVehicleOpen:X,setTripToAssignVehicle:Z,handleTripFormSubmit:a=>(0,r.H9)(a,w,x,z,ag,b),handleDriverAssignment:()=>(0,r.MX)(E,I,K,B,F,J,L,ag,b),handleMessageSend:()=>(0,r.QR)(G||u,M,N,ag,b),queryClient:b})]})})}[f,h,i,k,l,m,n,o]=s.then?(await s)():s,d()}catch(a){d(a)}})},94142:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{F:()=>j});var e=c(8732),f=c(82015),g=c(14505),h=c(87092),i=a([g,h]);[g,h]=i.then?(await i)():i;let j=f.forwardRef(({className:a,children:b,...c},d)=>(0,e.jsxs)(g.Root,{ref:d,className:(0,h.cn)("relative overflow-hidden",a),...c,children:[(0,e.jsx)(g.Viewport,{className:"h-full w-full rounded-[inherit]",children:b}),(0,e.jsx)(k,{}),(0,e.jsx)(g.Corner,{})]}));j.displayName=g.Root.displayName;let k=f.forwardRef(({className:a,orientation:b="vertical",...c},d)=>(0,e.jsx)(g.ScrollAreaScrollbar,{ref:d,orientation:b,className:(0,h.cn)("flex touch-none select-none transition-colors","vertical"===b&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===b&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...c,children:(0,e.jsx)(g.ScrollAreaThumb,{className:"relative flex-1 rounded-full bg-border"})}));k.displayName=g.ScrollAreaScrollbar.displayName,d()}catch(a){d(a)}})},95067:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{e:()=>k});var e=c(8732),f=c(90192),g=c(74952),h=c(28462),i=c(76569),j=a([f,h]);function k({trip:a,setViewTrip:b,setEditTrip:c,setTripToMessage:d,setMessageOpen:j,setTripToAssign:k,setAssignOpen:l,setTripToAssignVehicle:m,setAssignVehicleOpen:n,setTripToDelete:o,setDeleteDialogOpen:p,updateTripStatus:q}){(0,h.useQueryClient)();let{toast:r}=(0,i.dj)(),s=!0===a._isTestData;console.log("Trip data for actions menu:",{id:a.id,status:a.status,invoice_id:a.invoice_id,isTestData:s});let t=async b=>{if(s)return void r({title:"Test Data",description:"Cannot update status for test data",variant:"destructive"});await q(a.id,b)};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(f.lp,{children:"Actions"}),(0,e.jsxs)(f._2,{onClick:()=>b(a),children:[(0,e.jsx)(g.iUU,{className:"h-4 w-4 mr-2"}),"View Details"]}),(0,e.jsxs)(f._2,{onClick:()=>c(a),children:[(0,e.jsx)(g.iUU,{className:"h-4 w-4 mr-2"}),"Edit Trip"]}),(0,e.jsxs)(f._2,{onClick:()=>{d(a),j(!0)},children:[(0,e.jsx)(g.oFn,{className:"h-4 w-4 mr-2"}),"Send Message"]}),(0,e.jsx)(f.mB,{}),(0,e.jsx)(f.lp,{children:"Change Status"}),"scheduled"!==a.status&&(0,e.jsxs)(f._2,{onClick:()=>t("scheduled"),className:"text-blue-600",children:[(0,e.jsx)(g.VvS,{className:"h-4 w-4 mr-2"}),"Set as Scheduled"]}),"in_progress"!==a.status&&(0,e.jsxs)(f._2,{onClick:()=>t("in_progress"),className:"text-yellow-600",children:[(0,e.jsx)(g.zD7,{className:"h-4 w-4 mr-2"}),"Set as In Progress"]}),"completed"!==a.status&&(0,e.jsxs)(f._2,{onClick:()=>t("completed"),className:"text-green-600",children:[(0,e.jsx)(g.Jlk,{className:"h-4 w-4 mr-2"}),"Mark as Completed"]}),"cancelled"!==a.status&&(0,e.jsxs)(f._2,{onClick:()=>t("cancelled"),className:"text-red-600",children:[(0,e.jsx)(g.X,{className:"h-4 w-4 mr-2"}),"Cancel Trip"]}),(0,e.jsx)(f.mB,{}),(0,e.jsxs)(f._2,{onClick:()=>{if(s)return void r({title:"Test Data",description:"Cannot delete test data",variant:"destructive"});o(a.id),p(!0)},className:"text-red-600",children:[(0,e.jsx)(g.lMJ,{className:"h-4 w-4 mr-2"}),"Delete Trip ",s&&"(Test Data)"]})]})}[f,h]=j.then?(await j)():j,d()}catch(a){d(a)}})},96881:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>r,default:()=>n,getServerSideProps:()=>q,getStaticPaths:()=>p,getStaticProps:()=>o,handler:()=>z,reportWebVitals:()=>s,routeModule:()=>y,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>x,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>u,unstable_getStaticProps:()=>t});var e=c(63885),f=c(80237),g=c(81413),h=c(65611),i=c.n(h),j=c(74780),k=c(94016),l=c(12289),m=a([j,k]);[j,k]=m.then?(await m)():m;let n=(0,g.M)(k,"default"),o=(0,g.M)(k,"getStaticProps"),p=(0,g.M)(k,"getStaticPaths"),q=(0,g.M)(k,"getServerSideProps"),r=(0,g.M)(k,"config"),s=(0,g.M)(k,"reportWebVitals"),t=(0,g.M)(k,"unstable_getStaticProps"),u=(0,g.M)(k,"unstable_getStaticPaths"),v=(0,g.M)(k,"unstable_getStaticParams"),w=(0,g.M)(k,"unstable_getServerProps"),x=(0,g.M)(k,"unstable_getServerSideProps"),y=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/Trips",pathname:"/Trips",bundlePath:"",filename:""},distDir:".next-fleet",relativeProjectDir:"",components:{App:j.default,Document:i()},userland:k}),z=(0,l.U)({srcPage:"/Trips",config:r,userland:k,routeModule:y,getStaticPaths:p,getStaticProps:o,getServerSideProps:q});d()}catch(a){d(a)}})},97856:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{g:()=>i});var e=c(8732),f=c(4720),g=c(74952),h=a([f]);function i({trip:a,className:b=""}){if(!a||"object"!=typeof a)return null;let c=new Date,d=c.toISOString().split("T")[0],h=c.toTimeString().split(" ")[0].substring(0,5);if(!a.status||"scheduled"!==a.status)return null;let i=a.date;if(!i||"string"!=typeof i)return null;let j=a.time||a.start_time;if(!j||"string"!=typeof j||!/^\d{4}-\d{2}-\d{2}$/.test(i)||!/^\d{2}:\d{2}(:\d{2})?$/.test(j))return null;let k=j.substring(0,5);try{let a=i<d||i===d&&k<h,c=i===d&&k<=h&&!a&&30>=function(a,b){if(!a||!b||"string"!=typeof a||"string"!=typeof b)return 0;try{let c=a.split(":"),d=b.split(":");if(c.length<2||d.length<2)return 0;let[e,f]=c.map(Number),[g,h]=d.map(Number);if(isNaN(e)||isNaN(f)||isNaN(g)||isNaN(h))return 0;return 60*e+f-(60*g+h)}catch(a){return 0}}(k,h);if(a)return(0,e.jsxs)(f.E,{variant:"outline",className:`bg-red-500/20 text-red-700 dark:text-red-300 border-red-500/50 ${b}`,children:[(0,e.jsx)(g.hcu,{className:"h-3 w-3 mr-1"}),"Overdue"]});if(c)return(0,e.jsxs)(f.E,{variant:"outline",className:`bg-amber-500/20 text-amber-700 dark:text-amber-300 border-amber-500/50 ${b}`,children:[(0,e.jsx)(g.zD7,{className:"h-3 w-3 mr-1"}),"Starting Soon"]});return null}catch(a){return null}}f=(h.then?(await h)():h)[0],d()}catch(a){d(a)}})},98808:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{j:()=>i});var e=c(28462),f=c(82015),g=c(95965),h=a([e]);function i(a){(0,e.useQueryClient)(),(0,f.useRef)(null);let b=(0,e.useQuery)({queryKey:["tripMessages",a?.id],queryFn:async()=>{if(!a)return[];let{data:b,error:c}=await g.N.from("trip_messages").select("*").eq("trip_id",a.id).order("timestamp",{ascending:!0});if(c)throw c;return b},enabled:!!a}),c=(0,e.useQuery)({queryKey:["tripAssignments",a?.id],queryFn:async()=>{if(!a)return[];let{data:b,error:c}=await g.N.from("trip_assignments").select(`
          *,
          drivers:driver_id(name, avatar_url)
        `).eq("trip_id",a.id).order("assigned_at",{ascending:!1});if(c)throw c;return b.map(a=>({...a,driver_name:a.drivers?.name,driver_avatar:a.drivers?.avatar_url}))},enabled:!!a});return{messages:b.data,assignments:c.data}}e=(h.then?(await h)():h)[0],d()}catch(a){d(a)}})}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[4952,5611,5781,1913,2333,4780,5833,7784],()=>b(b.s=96881));module.exports=c})();