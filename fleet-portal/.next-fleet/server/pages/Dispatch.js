"use strict";(()=>{var a={};a.id=358,a.ids=[358,636,3220],a.modules={939:(a,b,c)=>{function d(a){try{if(!a||"string"!=typeof a||""===a.trim())return null!=a&&console.warn("Invalid icon name provided:",a),e();let b=a.replace(/[^a-zA-Z0-9_-]/g,"");return b!==a&&console.warn(`Icon name sanitized: "${a}" -> "${b}"`),`https://fonts.gstatic.com/s/i/materialicons/${b}/v1/24px.svg`}catch(b){return console.warn("Error generating Google icon URL:",b,"for icon:",a),e()}}function e(){return"https://fonts.gstatic.com/s/i/materialicons/place/v1/24px.svg"}function f(a,b){try{if(!a||!a.currentTarget)return void console.warn("Invalid event object in handleImageError");let c=a.currentTarget;c&&c.style&&(c.style.display="none"),b&&b.style&&(b.style.display="block")}catch(a){console.warn("Error handling image load failure:",a)}}function g(a,b){return a?{filter:"invert(1) brightness(0.9)",opacity:.9}:{filter:"none",opacity:.8}}c.d(b,{Ow:()=>g,Us:()=>f,q1:()=>d})},4193:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{$m:()=>m,As:()=>l,nD:()=>k,ub:()=>n});var e=c(8732),f=c(82015),g=c(8758),h=c(74952),i=c(87092),j=a([g,i]);[g,i]=j.then?(await j)():j;let k=g.Root,l=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Item,{ref:c,className:(0,i.cn)("border-b",a),...b}));l.displayName="AccordionItem";let m=f.forwardRef(({className:a,children:b,...c},d)=>(0,e.jsx)(g.Header,{className:"flex",children:(0,e.jsxs)(g.Trigger,{ref:d,className:(0,i.cn)("flex flex-1 items-center justify-between py-4 font-medium transition-all hover:no-underline [&[data-state=open]>svg]:rotate-180",a),...c,children:[b,(0,e.jsx)(h.yQN,{className:"h-4 w-4 shrink-0 transition-transform duration-200"})]})}));m.displayName=g.Trigger.displayName;let n=f.forwardRef(({className:a,children:b,...c},d)=>(0,e.jsx)(g.Content,{ref:d,className:"overflow-hidden text-sm transition-all data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down",...c,children:(0,e.jsx)("div",{className:(0,i.cn)("pb-4 pt-0",a),children:b})}));n.displayName=g.Content.displayName,d()}catch(a){d(a)}})},4720:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{E:()=>i});var e=c(8732);c(82015);var f=c(8938),g=c(87092),h=a([f,g]);[f,g]=h.then?(await h)():h;let j=(0,f.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i({className:a,variant:b,...c}){return(0,e.jsx)("div",{className:(0,g.cn)(j({variant:b}),a),...c})}d()}catch(a){d(a)}})},8732:a=>{a.exports=require("react/jsx-runtime")},8758:a=>{a.exports=import("@radix-ui/react-accordion")},8938:a=>{a.exports=import("class-variance-authority")},9640:a=>{a.exports=import("@radix-ui/react-slot")},9762:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>y});var e=c(8732),f=c(82015),g=c(76569),h=c(28462),i=c(16417),j=c(58581),k=c(70843),l=c(71845),m=c(92608),n=c(12419),o=c(95965),p=c(71913),q=c(15612),r=c(51055),s=c(74479),t=c(42324),u=c(68953),v=c(33574),w=c(80840),x=a([h,i,j,k,l,m,n,q,s,u,v,w]);function y(){let{toast:a}=(0,g.dj)(),b=(0,h.useQueryClient)(),{trips:d=[],isLoading:x,drivers:y=[],vehicles:z=[]}=(0,i.s)(),{interestPoints:A=[]}=(0,v.L1)(),[B,C]=(0,f.useState)(0),[D,E]=(0,f.useState)(!1),[F,G]=(0,f.useState)(!1),[H,I]=(0,f.useState)(null),[J,K]=(0,f.useState)(null),[L,M]=(0,f.useState)(""),[N,O]=(0,f.useState)(!1),[P,Q]=(0,f.useState)(null),[R,S]=(0,f.useState)(!1),[T,U]=(0,f.useState)(null),[V,W]=(0,f.useState)("overview"),[X,Y]=(0,f.useState)(!1),[Z,$]=(0,f.useState)(new Date),_=(0,f.useMemo)(()=>Array.isArray(d)?d.filter(a=>a&&"object"==typeof a):[],[d]);(0,n.k)(_),(0,f.useMemo)(()=>{let a=new Date;a.setHours(0,0,0,0);let b=_.filter(b=>{if(!b.date)return!1;let c=new Date(b.date);return c.setHours(0,0,0,0),c.getTime()===a.getTime()}),c=_.filter(a=>"scheduled"===a.status).length,d=_.filter(a=>"in_progress"===a.status).length,e=_.filter(a=>"completed"===a.status).length,f=_.filter(a=>!!a.date&&!!a.time&&new Date(`${a.date}T${a.time}`)<new Date&&"scheduled"===a.status).length,g=_.filter(a=>!a.driver_id&&"scheduled"===a.status).length,h=_.filter(a=>!a.vehicle_id&&"scheduled"===a.status).length,i=_.filter(a=>"in_progress"===a.status),j=new Set(i.map(a=>a.driver_id).filter(a=>!!a)),k=new Set;for(let a of i)if(a.vehicle_id&&k.add(a.vehicle_id),Array.isArray(a.assigned_vehicle_ids))for(let b of a.assigned_vehicle_ids)k.add(b);let l=Math.max(0,(y?.length||0)-j.size),m=Math.max(0,(z?.length||0)-k.size);return{todayTrips:b.length,scheduledCount:c,inProgressCount:d,completedCount:e,overdueCount:f,unassignedDrivers:g,unassignedVehicles:h,availableDrivers:Math.max(0,l),availableVehicles:Math.max(0,m),totalRevenue:_.reduce((a,b)=>a+(b.amount||0),0),completionRate:c+d+e>0?Math.round(e/(c+d+e)*100):0}},[_,y,z]);let aa=(0,f.useMemo)(()=>_,[_]);(0,f.useCallback)(async()=>{Y(!0);try{b.clear(),await Promise.all([b.refetchQueries({queryKey:["trips"]}),b.refetchQueries({queryKey:["vehicles"]}),b.refetchQueries({queryKey:["drivers"]}),b.refetchQueries({queryKey:["clients"]})]),await new Promise(a=>setTimeout(a,100)),C(a=>a+1),a({title:"Refreshed",description:"Dispatch data has been updated"})}catch(b){console.error("Error refreshing:",b),a({title:"Error",description:"Failed to refresh data",variant:"destructive"})}finally{Y(!1)}},[b,a,C]);let ab=(0,f.useCallback)(async()=>{await (0,t.Q)(H,L,M,b=>a(b),b),E(!1)},[H,L,a,b]),ac=(0,f.useCallback)(async()=>{b.clear(),await Promise.all([b.refetchQueries({queryKey:["trips"]}),b.refetchQueries({queryKey:["vehicles"]}),b.refetchQueries({queryKey:["drivers"]})]),await new Promise(a=>setTimeout(a,100)),C(a=>a+1),O(!1),a({title:"Escort Vehicles Assigned",description:"Security escort vehicles have been successfully assigned to the trip"})},[b,a,C]),ad=(0,f.useCallback)(async(d,e)=>{try{let{error:f}=await o.N.from("trips").update({status:e}).eq("id",d);if(f)throw f;let{cacheInvalidationManager:g}=await Promise.resolve().then(c.bind(c,29894));g.markRecentUpdates(),"cancelled"===e?(await g.clearAllCaches(),await Promise.all([b.refetchQueries({queryKey:["trips"]}),b.refetchQueries({queryKey:["vehicles"]}),b.refetchQueries({queryKey:["drivers"]}),b.refetchQueries({queryKey:["clients"]})]),await new Promise(a=>setTimeout(a,100)),C(a=>a+1)):await g.invalidateAndRefetch([["trips"],["vehicles"],["drivers"]]),a({title:"Trip Updated",description:`Trip status changed to ${e}`})}catch(b){console.error("Error updating trip status:",b),a({title:"Error",description:"Failed to update trip status",variant:"destructive"})}},[b,a,C]),ae=(0,f.useCallback)(async(c,d)=>{try{if(!d)return void a({title:"Error",description:"Please upload a log sheet to complete the trip.",variant:"destructive"});let e=d.name.split(".").pop(),f=`${c.id}-${Date.now()}.${e}`,g=`${f}`,{error:h}=await o.N.storage.from("log_sheets").upload(g,d);if(h)throw Error(`Failed to upload log sheet: ${h.message}`);let{data:i}=o.N.storage.from("log_sheets").getPublicUrl(g);if(!i.publicUrl)throw Error("Could not get public URL for the uploaded file.");let j=i.publicUrl,{error:k}=await o.N.from("trips").update({status:"completed",log_sheet_url:j}).eq("id",c.id);if(k)throw Error(`Failed to update trip: ${k.message}`);a({title:"Trip Completed",description:"Log sheet uploaded and trip marked as completed."}),await b.invalidateQueries({queryKey:["trips"]}),await b.invalidateQueries({queryKey:["vehicles"]}),G(!1)}catch(c){console.error("Error completing trip:",c);let b=c instanceof Error?c.message:"Unknown error occurred";a({title:"Error",description:`Failed to complete trip: ${b}`,variant:"destructive"})}},[b,a]);return x?(0,e.jsx)("div",{className:"min-h-screen bg-background",children:(0,e.jsxs)("div",{className:"p-4 px-6 space-y-6",children:[(0,e.jsx)("div",{className:"border-b border-border pb-4 pt-4",children:(0,e.jsx)("div",{children:(0,e.jsx)("h1",{className:"text-2xl font-semibold text-foreground",children:"Dispatch"})})}),(0,e.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3",children:[void 0,void 0,void 0,void 0].map((a,b)=>(0,e.jsxs)("div",{className:"border rounded-md p-4 bg-card animate-pulse",children:[(0,e.jsx)("div",{className:"h-4 bg-muted rounded w-1/2"}),(0,e.jsx)("div",{className:"h-6 bg-muted rounded w-3/4 mt-3"})]},b))})]})}):(0,e.jsxs)("div",{className:"relative h-full w-full overflow-hidden m-0 p-0",children:[(0,e.jsx)("div",{className:"absolute inset-0 z-0 m-0 p-0 overflow-hidden",children:(0,e.jsx)(r.L,{trips:_,interestPoints:A,variant:"fullscreen",onMapClick:(a,b)=>{U({lat:a,lng:b}),S(!0)},showInterestPoints:"map"===V||"interest-points"===V})}),(0,e.jsx)("div",{className:"absolute inset-x-0 z-20 flex justify-center pointer-events-none",style:{top:8},children:(0,e.jsx)("div",{className:"pointer-events-auto rounded-md border border-border/40 bg-background/70 backdrop-blur supports-[backdrop-filter]:bg-background/50 px-1 py-1 shadow-sm",children:(0,e.jsx)(u.tU,{value:V,onValueChange:a=>W(a),children:(0,e.jsxs)(u.j7,{className:"bg-transparent gap-1",children:[(0,e.jsx)(u.Xi,{value:"overview",className:"px-3 py-1.5 text-xs md:text-sm rounded-md border border-transparent text-muted-foreground hover:bg-foreground/5 data-[state=active]:text-foreground data-[state=active]:bg-white/10 data-[state=active]:backdrop-blur data-[state=active]:border-white/20 data-[state=active]:shadow-[0_8px_24px_-10px_rgba(0,0,0,0.6)] transition-colors",children:"Overview"}),(0,e.jsx)(u.Xi,{value:"trips",className:"px-3 py-1.5 text-xs md:text-sm rounded-md border border-transparent text-muted-foreground hover:bg-foreground/5 data-[state=active]:text-foreground data-[state=active]:bg-white/10 data-[state=active]:backdrop-blur data-[state=active]:border-white/20 data-[state=active]:shadow-[0_8px_24px_-10px_rgba(0,0,0,0.6)] transition-colors",children:"Trips"}),(0,e.jsx)(u.Xi,{value:"map",className:"px-3 py-1.5 text-xs md:text-sm rounded-md border border-transparent text-muted-foreground hover:bg-foreground/5 data-[state=active]:text-foreground data-[state=active]:bg-white/10 data-[state=active]:backdrop-blur data-[state=active]:border-white/20 data-[state=active]:shadow-[0_8px_24px_-10px_rgba(0,0,0,0.0)] transition-colors",children:"Map"}),(0,e.jsx)(u.Xi,{value:"interest-points",className:"px-3 py-1.5 text-xs md:text-sm rounded-md border border-transparent text-muted-foreground hover:bg-foreground/5 data-[state=active]:text-foreground data-[state=active]:bg-white/10 data-[state=active]:backdrop-blur data-[state=active]:border-white/20 data-[state=active]:shadow-[0_8px_24px_-10px_rgba(0,0,0,0.6)] transition-colors",children:"Interest Points"})]})})})}),"map"!==V&&"interest-points"!==V&&(0,e.jsx)("div",{className:`absolute left-4 top-24 z-10 ${"overview"===V?"w-max":"w-[760px]"} max-w-[95vw]`,children:(0,e.jsx)("div",{className:`bg-background/80 backdrop-blur supports-[backdrop-filter]:bg-background/50 border border-border/40 rounded-md overflow-hidden ${"overview"===V?"":"h-[72vh] flex flex-col"}`,children:"overview"===V?(0,e.jsxs)("div",{className:"pt-2 px-3 pb-3 m-0",children:[(0,e.jsx)("div",{className:"mb-1",children:(0,e.jsxs)("div",{className:"text-sm md:text-base font-medium text-foreground",children:[(0,p.GP)(Z,"EEE, MMM d, yyyy")," •"," ",(0,e.jsx)("span",{className:"font-mono tabular-nums",children:(0,p.GP)(Z,"HH:mm:ss")})]})}),(0,e.jsx)(q.j,{trips:_,drivers:y||[],vehicles:z||[],variant:"strip"})]}):(0,e.jsx)("div",{className:"flex-1 overflow-hidden p-0 m-0",children:(0,e.jsx)("div",{className:"h-full overflow-hidden",children:(0,e.jsx)(j.F,{trips:aa,allTrips:_,drivers:y||[],vehicles:z||[],onSendMessage:a=>{I(a),E(!0)},onCompleteTrip:a=>{K(a),G(!0)},onUpdateStatus:ad,onAssignEscort:a=>{Q(a),O(!0)},variant:"overlay"})})})})}),"interest-points"===V&&(0,e.jsx)("div",{className:"absolute left-4 top-24 z-10 w-[760px] max-w-[95vw]",children:(0,e.jsx)("div",{className:"bg-background/80 backdrop-blur supports-[backdrop-filter]:bg-background/50 border border-border/40 rounded-md overflow-hidden h-[72vh] flex flex-col",children:(0,e.jsx)("div",{className:"flex-1 overflow-hidden p-0 m-0",children:(0,e.jsx)("div",{className:"h-full overflow-hidden",children:(0,e.jsx)(s.z,{onInterestPointSelected:a=>{window.google?.maps&&new window.google.maps.LatLng(a.latitude,a.longitude)},onInterestPointUpdated:()=>{b.invalidateQueries({queryKey:["interest-points"]})}})})})})}),(0,e.jsx)(k.R,{open:D,tripToMessage:H,newMessage:L,onMessageChange:M,onSendMessage:ab,onClose:()=>E(!1)}),(0,e.jsx)(l.j,{open:F,trip:J,onClose:()=>G(!1),onConfirm:ae}),(0,e.jsx)(m.I,{open:N,trip:P,onClose:()=>O(!1),onEscortAssigned:ac}),(0,e.jsx)(w.s,{open:R,onClose:()=>{S(!1),U(null)},initialCoordinates:T||void 0,onInterestPointAdded:()=>{b.invalidateQueries({queryKey:["interest-points"]})}})]})}[h,i,j,k,l,m,n,q,s,u,v,w]=x.then?(await x)():x,d()}catch(a){d(a)}})},12419:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{k:()=>h}),c(82015);var e=c(28462),f=c(76569),g=a([e]);function h(a=[]){let{toast:b}=(0,f.dj)();return(0,e.useQueryClient)(),{checkOverdueTrips:async()=>{let b=new Date;for(let c of a){if("scheduled"!==c.status)continue;let{date:a,time:d}=c;if(!a||!d)continue;let e=new Date(`${a}T${d}`);if(isNaN(e.getTime())){console.warn(`Invalid date/time for trip ${c.id}: ${a} ${d}`);continue}b.getTime(),e.getTime()}}}}e=(g.then?(await g)():g)[0],d()}catch(a){d(a)}})},12475:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{D:()=>r});var e=c(8732),f=c(82015),g=c(38661),h=c(66345),i=c(78059),j=c(40273),k=c(87967),l=c(57049),m=c(33574),n=c(43348),o=c(74952),p=c(87603),q=a([g,h,i,j,k,l,m,p]);function r({open:a,onClose:b,interestPoint:c,onInterestPointUpdated:d}){let{updateInterestPoint:q,isUpdating:r}=(0,m.L1)(),[s,t]=(0,f.useState)({name:"",description:"",category:"general",latitude:0,longitude:0,icon:"\uD83D\uDCCD",color:"#FF6B6B"}),u=async a=>{if(a.preventDefault(),s.name?.trim())try{await q(c.id,s),d?.(),b()}catch(a){console.error("Error updating interest point:",a)}},v=(a,b)=>{let c=parseFloat(b);isNaN(c)||t(b=>({...b,[a]:c}))};return(0,e.jsx)(g.lG,{open:a,onOpenChange:b,children:(0,e.jsxs)(g.Cf,{className:"sm:max-w-[500px]",children:[(0,e.jsx)(g.c7,{children:(0,e.jsxs)(g.L3,{className:"flex items-center gap-2",children:[(0,e.jsx)(o.sDd,{className:"h-5 w-5"}),"Edit Interest Point"]})}),(0,e.jsxs)("form",{onSubmit:u,className:"space-y-4",children:[(0,e.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(j.J,{htmlFor:"edit-latitude",children:"Latitude"}),(0,e.jsx)(i.p,{id:"edit-latitude",type:"number",step:"any",value:s.latitude,onChange:a=>v("latitude",a.target.value),placeholder:"e.g., 2.0469",required:!0})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(j.J,{htmlFor:"edit-longitude",children:"Longitude"}),(0,e.jsx)(i.p,{id:"edit-longitude",type:"number",step:"any",value:s.longitude,onChange:a=>v("longitude",a.target.value),placeholder:"e.g., 45.3182",required:!0})]})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(j.J,{htmlFor:"edit-name",children:"Name *"}),(0,e.jsx)(i.p,{id:"edit-name",value:s.name,onChange:a=>t(b=>({...b,name:a.target.value})),placeholder:"Enter interest point name",required:!0})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(j.J,{htmlFor:"edit-description",children:"Description"}),(0,e.jsx)(k.T,{id:"edit-description",value:s.description,onChange:a=>t(b=>({...b,description:a.target.value})),placeholder:"Enter description (optional)",rows:3})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(j.J,{htmlFor:"edit-category",children:"Category"}),(0,e.jsxs)(l.l6,{value:s.category,onValueChange:a=>{t(b=>({...b,category:a}))},children:[(0,e.jsx)(l.bq,{children:(0,e.jsx)(l.yv,{placeholder:"Select category"})}),(0,e.jsx)(l.gC,{children:n.v.map(a=>(0,e.jsx)(l.eb,{value:a.value,children:(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("span",{children:a.icon}),(0,e.jsx)("span",{children:a.label})]})},a.value))})]})]}),(0,e.jsx)(p.U,{value:s.icon,onChange:a=>t(b=>({...b,icon:a})),disabled:r}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(j.J,{htmlFor:"edit-color",children:"Color"}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(i.p,{id:"edit-color",type:"color",value:s.color,onChange:a=>t(b=>({...b,color:a.target.value})),className:"w-16 h-10 p-1"}),(0,e.jsx)(i.p,{value:s.color,onChange:a=>t(b=>({...b,color:a.target.value})),placeholder:"#FF6B6B",className:"flex-1"})]})]}),(0,e.jsxs)(g.Es,{children:[(0,e.jsx)(h.$,{type:"button",variant:"outline",onClick:b,children:"Cancel"}),(0,e.jsx)(h.$,{type:"submit",disabled:r||!s.name?.trim(),children:r?"Updating...":"Update Interest Point"})]})]})]})})}[g,h,i,j,k,l,m,p]=q.then?(await q)():q,d()}catch(a){d(a)}})},13020:a=>{a.exports=import("@radix-ui/react-dialog")},13486:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{O:()=>i});var e=c(8732);c(82015);var f=c(95020),g=c(33574),h=a([f,g]);function i({open:a,onOpenChange:b,interestPoint:c,onInterestPointDeleted:d}){let{deleteInterestPoint:h,isDeleting:i}=(0,g.L1)(),j=async()=>{if(c)try{console.log("Deleting interest point:",c.id,c.name),h(c.id),d?.(),b(!1)}catch(a){console.error("Failed to delete interest point:",a)}};return(0,e.jsx)(f.Lt,{open:a,onOpenChange:b,children:(0,e.jsxs)(f.EO,{children:[(0,e.jsxs)(f.wd,{children:[(0,e.jsx)(f.r7,{children:"Delete Interest Point"}),(0,e.jsxs)(f.$v,{children:['Are you sure you want to delete "',c?.name,'"? This action cannot be undone.']})]}),(0,e.jsxs)(f.ck,{children:[(0,e.jsx)(f.Zr,{children:"Cancel"}),(0,e.jsx)(f.Rx,{onClick:j,disabled:i,className:"bg-red-600 hover:bg-red-700",children:i?"Deleting...":"Delete"})]})]})})}[f,g]=h.then?(await h)():h,d()}catch(a){d(a)}})},15612:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{j:()=>k});var e=c(8732),f=c(82015),g=c(28462),h=c(95965),i=c(4720),j=a([g,i]);function k({trips:a,drivers:b,vehicles:c,variant:d="grid"}){let j=(0,g.useQuery)({queryKey:["escort_teams_count"],queryFn:async()=>{let{count:a,error:b}=await h.N.from("escort_teams").select("id",{count:"exact",head:!0});if(b)throw b;return a||0},staleTime:6e4}),k=(0,f.useMemo)(()=>{let d=new Date,e=new Date(d.toDateString()),f=new Date(e);f.setDate(e.getDate()-e.getDay());let g=a.filter(a=>{let b=new Date(a.date);return b.setHours(0,0,0,0),b.getTime()===e.getTime()}),h=a.filter(a=>{let b=new Date(a.date);return b>=f&&b<=d}),i=a.filter(a=>"scheduled"===a.status).length,k=a.filter(a=>"in_progress"===a.status).length,l=a.filter(a=>"completed"===a.status).length,m=a.filter(a=>"cancelled"===a.status).length,n=a.filter(a=>!!a.date&&!!a.time&&"scheduled"===a.status&&new Date(`${a.date}T${a.time}`)<d).length,o=a.filter(a=>a.driver_id&&"in_progress"===a.status).length,p=b.length-o,q=a.filter(a=>a.vehicle_id&&"in_progress"===a.status).length,r=c.length-q,s=j.data??0,t=g.reduce((a,b)=>a+(b.amount||0),0),u=h.reduce((a,b)=>a+(b.amount||0),0),v=i+k+l>0?Math.round(l/(i+k+l)*100):0;return{today:{trips:g.length,revenue:t,completed:g.filter(a=>"completed"===a.status).length},week:{trips:h.length,revenue:u},status:{scheduled:i,inProgress:k,completed:l,cancelled:m,overdue:n},resources:{availableDrivers:p,totalDrivers:b.length,availableVehicles:r,totalVehicles:c.length},security:{securityEscorts:s},efficiency:{completionRate:v}}},[a,b,c,j.data]),l=({title:a,value:b,subtitle:c,children:d})=>(0,e.jsxs)("div",{className:"p-2",children:[(0,e.jsx)("div",{className:"text-[11px] text-muted-foreground",children:a}),(0,e.jsx)("div",{className:"text-xl font-semibold tabular-nums leading-tight",children:b}),c&&(0,e.jsx)("div",{className:"text-[11px] text-muted-foreground mt-0.5",children:c}),d]});return"strip"===d?(0,e.jsxs)("div",{className:"flex items-stretch gap-4 overflow-x-auto overflow-y-hidden px-1 py-1",children:[(0,e.jsx)(l,{title:"Today's Trips",value:k.today.trips,subtitle:`${k.today.completed} completed`}),(0,e.jsx)(l,{title:"Active Trips",value:k.status.inProgress,subtitle:`${k.status.scheduled} scheduled`}),(0,e.jsx)(l,{title:"Driver Availability",value:`${k.resources.availableDrivers}/${k.resources.totalDrivers}`}),(0,e.jsx)(l,{title:"Fleet Availability",value:`${k.resources.availableVehicles}/${k.resources.totalVehicles}`}),(0,e.jsx)(l,{title:"Security Escorts",value:k.security.securityEscorts})]}):(0,e.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-x-4 gap-y-1 mb-2",children:[(0,e.jsx)(l,{title:"Today's Trips",value:k.today.trips,subtitle:`${k.today.completed} completed`}),(0,e.jsx)(l,{title:"Active Trips",value:k.status.inProgress,subtitle:`${k.status.scheduled} scheduled`}),(0,e.jsx)(l,{title:"Driver Availability",value:`${k.resources.availableDrivers}/${k.resources.totalDrivers}`}),(0,e.jsx)(l,{title:"Fleet Availability",value:`${k.resources.availableVehicles}/${k.resources.totalVehicles}`}),(0,e.jsx)(l,{title:"Security Escorts",value:k.security.securityEscorts}),(k.status.overdue>0||0===k.resources.availableDrivers||0===k.resources.availableVehicles)&&(0,e.jsxs)("div",{className:"md:col-span-2 lg:col-span-6 px-2",children:[(0,e.jsx)("div",{className:"text-xs font-medium mb-1",children:"Operational Alerts"}),(0,e.jsxs)("div",{className:"flex flex-wrap gap-2 text-[11px]",children:[k.status.overdue>0&&(0,e.jsxs)(i.E,{variant:"destructive",className:"text-xs",children:[k.status.overdue," overdue"]}),0===k.resources.availableDrivers&&(0,e.jsx)(i.E,{variant:"outline",className:"text-xs",children:"No available drivers"}),0===k.resources.availableVehicles&&(0,e.jsx)(i.E,{variant:"outline",className:"text-xs",children:"No available vehicles"})]})]})]})}[g,i]=j.then?(await j)():j,d()}catch(a){d(a)}})},16235:a=>{a.exports=import("@radix-ui/react-toast")},19640:a=>{a.exports=import("@radix-ui/react-tabs")},20598:a=>{a.exports=import("@radix-ui/react-label")},24957:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{J:()=>n});var e=c(8732),f=c(82015),g=c(66345),h=c(78059),i=c(40273),j=c(38661),k=c(74952),l=c(939),m=a([g,h,i,j]);[g,h,i,j]=m.then?(await m)():m;let o={places:["place","location_on","location_city","home","business","store","restaurant","hotel","local_gas_station","local_hospital","school","account_balance","local_police","park","beach_access","terrain"],checkpoints:["security","shield","verified_user","gavel","local_police","warning","check_circle","verified","lock","lock_outline","security"],market:["store","shopping_cart","local_grocery_store","storefront","shopping_bag","local_mall","inventory","warehouse","local_shipping"],security:["security","shield","verified_user","gavel","local_police","warning","check_circle","verified","lock","lock_outline"],fuel:["local_gas_station","local_fire_department","oil_barrel","fuel","gas_station"],health:["local_hospital","medical_services","health_and_safety","medication","local_pharmacy","emergency","healing","vaccines"],restaurant:["restaurant","local_dining","fastfood","coffee","local_cafe","bakery_dining","local_pizza","ramen_dining","icecream"],hotel:["hotel","bed","room_service","ac_unit","pool","wifi","restaurant_menu"],bank:["account_balance","savings","credit_card","atm","account_balance_wallet","monetization_on","attach_money","local_atm"],school:["school","library_books","menu_book","science","computer","sports_soccer","music_note","palette","psychology"],mosque:["mosque","place_of_worship","temple_buddhist","church","synagogue","spa","self_improvement","nature_people"],general:["place","location_on","pin_drop","my_location","near_me","room","explore","map","navigation","directions"]},p=["place","location_on","pin_drop","my_location","near_me","room","explore","map","navigation","directions","star","favorite","bookmark","flag","marker","push_pin"];function n({value:a,onChange:b,disabled:c,className:d}){let[m,n]=(0,f.useState)(!1),[q,r]=(0,f.useState)(""),[s,t]=(0,f.useState)("all"),[u,v]=(0,f.useState)(!1),w=(0,f.useMemo)(()=>{let a=[];return"all"===s?a=Object.values(o).flat():"popular"===s?a=p:o[s]&&(a=o[s]),a=[...new Set(a)],q.trim()&&(a=a.filter(a=>a.toLowerCase().includes(q.toLowerCase()))),a},[s,q]),x=a=>(0,l.q1)(a),y=a=>(0,l.Ow)(u,a);return(0,e.jsxs)("div",{className:`space-y-2 ${d}`,children:[(0,e.jsx)(i.J,{children:"Icon"}),(0,e.jsxs)(j.lG,{open:m,onOpenChange:n,children:[(0,e.jsx)(j.zM,{asChild:!0,children:(0,e.jsx)(g.$,{type:"button",variant:"outline",disabled:c,className:"w-full justify-start",children:a?(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("img",{src:x(a),alt:a,className:"h-4 w-4",style:y(),onError:a=>(0,l.Us)(a)}),(0,e.jsx)("span",{className:"capitalize",children:a.replace(/_/g," ")})]}):"Select Icon"})}),(0,e.jsxs)(j.Cf,{className:"max-w-2xl max-h-[80vh]",children:[(0,e.jsxs)(j.c7,{children:[(0,e.jsx)(j.L3,{children:"Select Icon"}),(0,e.jsxs)("div",{className:"text-xs text-muted-foreground",children:["Theme: ",u?"Dark":"Light"," | Icons: ",w.length," ","found"]})]}),(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)(k.vji,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,e.jsx)(h.p,{placeholder:"Search icons...",value:q,onChange:a=>r(a.target.value),className:"pl-10"})]}),(0,e.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,e.jsx)(g.$,{variant:"all"===s?"default":"outline",size:"sm",onClick:()=>t("all"),children:"All"}),(0,e.jsx)(g.$,{variant:"popular"===s?"default":"outline",size:"sm",onClick:()=>t("popular"),children:"Popular"}),Object.keys(o).map(a=>(0,e.jsx)(g.$,{variant:s===a?"default":"outline",size:"sm",onClick:()=>t(a),className:"capitalize",children:a},a))]}),(0,e.jsxs)("div",{className:"max-h-96 overflow-y-auto",children:[(0,e.jsx)("div",{className:"grid grid-cols-8 gap-2",children:w.map(c=>(0,e.jsxs)(g.$,{variant:a===c?"default":"outline",size:"sm",onClick:()=>{b(c),n(!1)},className:"h-12 flex flex-col items-center justify-center p-1 relative hover:bg-muted/50",title:c.replace(/_/g," "),children:[(0,e.jsx)("img",{src:x(c),alt:c,className:"h-6 w-6 mb-1",style:y(),onError:a=>(0,l.Us)(a)}),a===c&&(0,e.jsx)(k.Jlk,{className:"h-3 w-3 absolute top-1 right-1 text-primary"})]},c))}),0===w.length&&(0,e.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:(0,e.jsx)("p",{children:"No icons found matching your search."})})]})]})]})]}),a&&(0,e.jsx)("div",{className:"mt-2",children:(0,e.jsxs)("div",{className:"flex items-center gap-2 p-2 border rounded-md bg-gray-50",children:[(0,e.jsx)("img",{src:x(a),alt:a,className:"h-6 w-6",style:y(),onError:a=>(0,l.Us)(a)}),(0,e.jsx)("span",{className:"text-sm text-gray-600 capitalize",children:a.replace(/_/g," ")})]})}),(0,e.jsx)("p",{className:"text-xs text-gray-500",children:"Select an icon from Google Material Icons"})]})}d()}catch(a){d(a)}})},28462:a=>{a.exports=import("@tanstack/react-query")},33574:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{L1:()=>i});var e=c(28462),f=c(72457),g=c(76569),h=a([e]);e=(h.then?(await h)():h)[0];let i=()=>{let a=(0,e.useQueryClient)(),{toast:b}=(0,g.dj)(),{data:c=[],isLoading:d,error:h,refetch:i}=(0,e.useQuery)({queryKey:["interest-points"],queryFn:f.i.getAllInterestPoints,staleTime:3e5,retry:(a,b)=>!(b instanceof Error&&(b.message.includes("Authentication error")||b.message.includes("Database table not found")))&&a<3}),j=(0,e.useMutation)({mutationFn:f.i.createInterestPoint,onSuccess:()=>{a.invalidateQueries({queryKey:["interest-points"]}),b({title:"Success",description:"Interest point created successfully"})},onError:a=>{console.error("Error creating interest point:",{error:a,errorType:typeof a,errorConstructor:a?.constructor?.name,errorMessage:a?.message,errorStack:a?.stack,stringified:JSON.stringify(a,null,2)});let c=a instanceof Error?a.message:"Failed to create interest point";b({title:"Error",description:c,variant:"destructive"})}}),k=(0,e.useMutation)({mutationFn:({id:a,data:b})=>f.i.updateInterestPoint(a,b),onSuccess:()=>{a.invalidateQueries({queryKey:["interest-points"]}),b({title:"Success",description:"Interest point updated successfully"})},onError:a=>{console.error("Error updating interest point:",a);let c=a instanceof Error?a.message:"Failed to update interest point";b({title:"Error",description:c,variant:"destructive"})}}),l=(0,e.useMutation)({mutationFn:f.i.deleteInterestPoint,onSuccess:()=>{a.invalidateQueries({queryKey:["interest-points"]}),b({title:"Success",description:"Interest point deleted successfully"})},onError:a=>{console.error("Error deleting interest point:",a);let c=a instanceof Error?a.message:"Failed to delete interest point";b({title:"Error",description:c,variant:"destructive"})}}),m=(0,e.useMutation)({mutationFn:f.i.deactivateInterestPoint,onSuccess:()=>{a.invalidateQueries({queryKey:["interest-points"]}),b({title:"Success",description:"Interest point deactivated successfully"})},onError:a=>{console.error("Error deactivating interest point:",a);let c=a instanceof Error?a.message:"Failed to deactivate interest point";b({title:"Error",description:c,variant:"destructive"})}});return{interestPoints:c,isLoading:d,error:h,refetch:i,createInterestPoint:a=>{j.mutate(a)},updateInterestPoint:(a,b)=>{k.mutate({id:a,data:b})},deleteInterestPoint:a=>{l.mutate(a)},deactivateInterestPoint:a=>{m.mutate(a)},isCreating:j.isPending,isUpdating:k.isPending,isDeleting:l.isPending,isDeactivating:m.isPending}};d()}catch(a){d(a)}})},33873:a=>{a.exports=require("path")},34733:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{X:()=>r});var e=c(8732),f=c(82015),g=c(38661),h=c(66345),i=c(57049),j=c(40273),k=c(4720),l=c(16417),m=c(28462),n=c(95965),o=c(76569),p=c(41750),q=a([g,h,i,j,k,l,m]);function r({open:a,trip:b,onClose:c,onAssigned:d}){let{drivers:q=[],vehicles:r=[],trips:s=[]}=(0,l.s)(),t=(0,m.useQueryClient)(),{toast:u}=(0,o.dj)(),v=(0,m.useQuery)({queryKey:["escort_teams"],queryFn:async()=>{let{data:a,error:b}=await n.N.from("escort_teams").select("id, team_name, guard_ids, vehicle_id");if(b)throw b;return a||[]},enabled:a,refetchOnWindowFocus:!1,staleTime:1e4,retry:1}),[w,x]=(0,f.useState)([]),[y,z]=(0,f.useState)([]),[A,B]=(0,f.useState)([]),[C,D]=(0,f.useState)([]),E=(0,f.useMemo)(()=>b?[...Array(b.armoured_count||0).fill("armoured"),...Array(b.soft_skin_count||0).fill("soft_skin")]:[],[b]),F=(0,f.useMemo)(()=>b?.escort_count?Math.min(b.escort_count,2):0,[b]),G=(0,m.useMutation)({mutationFn:async()=>{if(!b)return;let a=y.filter(Boolean);if(a.length!==E.length)throw Error("Please assign all required vehicles for the trip.");let{error:c}=await n.N.from("trips").update({driver_id:w[0]||null,vehicle_id:a[0]||null,assigned_vehicle_ids:a,escort_vehicle_ids:A.filter(Boolean)}).eq("id",b.id);if(c)throw c;let d=[];if(w.forEach(a=>{a&&d.push({trip_id:b.id,driver_id:a,status:"pending"})}),d.length>0){let{error:a}=await n.N.from("trip_assignments").insert(d);if(a)throw a}},onSuccess:async()=>{await Promise.all([t.invalidateQueries({queryKey:["trips"]}),t.invalidateQueries({queryKey:["vehicles"]}),t.invalidateQueries({queryKey:["drivers"]})]),u({title:"Resources assigned",description:"Driver(s) and vehicle(s) assigned."}),d(),c()},onError:a=>{u({title:"Assignment failed",description:a?.message||"Unknown error",variant:"destructive"})}});return a&&b?(0,e.jsx)(g.lG,{open:a,onOpenChange:a=>{a||(x([]),z([]),B([]),D([]),setTimeout(()=>c(),0))},children:(0,e.jsxs)(g.Cf,{className:"max-w-2xl",children:[(0,e.jsxs)(g.c7,{children:[(0,e.jsx)(g.L3,{children:"Assign Resources"}),(0,e.jsxs)(g.rr,{children:["Trip ",b.id.substring(0,8).toUpperCase()," • ",b.date," ",b.time]})]}),(0,e.jsxs)("div",{className:"space-y-5 py-2",children:[(0,e.jsxs)("div",{className:"space-y-3",children:[(0,e.jsx)(j.J,{children:"Main vehicles and drivers"}),0===E.length&&(0,e.jsx)("div",{className:"text-sm text-muted-foreground",children:"No specific vehicle types requested."}),E.map((a,c)=>{let d=[...y.filter((a,b)=>b!==c&&y[b]),...A].filter(Boolean),f=((a,c=[])=>r.filter(d=>!c.includes(d.id)&&(!a||d.type===a)&&(!b||(0,p.AT)(d.id,b.date,b.time||"00:00",s,b.return_time,b.id,{bufferHours:0}).isAvailable)))(a,d),g=[...w.filter((a,b)=>b!==c&&w[b])].filter(Boolean),h=((a=[])=>q.filter(c=>!a.includes(c.id)&&(!b||(0,p.m6)(c.id,b.date,b.time||"00:00",s,b.return_time,b.id,{bufferHours:0}).isAvailable)))(g);return(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:[(0,e.jsxs)("div",{className:"space-y-1",children:[(0,e.jsxs)(j.J,{className:"text-xs",children:["Vehicle ",c+1," – ",a.replace("_"," ")," (",f.length," available)"]}),(0,e.jsxs)(i.l6,{value:y[c]||"none",onValueChange:a=>{let b=[...y];b[c]=a,z(b)},children:[(0,e.jsx)(i.bq,{children:(0,e.jsx)(i.yv,{placeholder:`Select ${a.replace("_"," ")} vehicle`})}),(0,e.jsx)(i.gC,{children:f.map(a=>(0,e.jsxs)(i.eb,{value:a.id,children:[a.make," ",a.model," (",a.registration,")",(0,e.jsx)(k.E,{variant:"outline",className:"ml-2 text-xs",children:"armoured"===a.type?"Armoured":"Soft Skin"})]},a.id))})]})]}),(0,e.jsxs)("div",{className:"space-y-1",children:[(0,e.jsxs)(j.J,{className:"text-xs",children:["Driver ",c+1]}),(0,e.jsxs)(i.l6,{value:w[c]||"none",onValueChange:a=>{let b=[...w];b[c]=a,x(b)},children:[(0,e.jsx)(i.bq,{children:(0,e.jsx)(i.yv,{placeholder:"Select driver"})}),(0,e.jsx)(i.gC,{children:h.map(a=>(0,e.jsx)(i.eb,{value:a.id,children:a.name},a.id))})]})]})]},c)})]}),F>0&&(0,e.jsxs)("div",{className:"space-y-3",children:[(0,e.jsx)(j.J,{children:"Escort teams"}),v.isError&&(0,e.jsx)("div",{className:"text-xs text-destructive",children:"Failed to load escort teams"}),Array.from({length:F},(a,c)=>{let d=[...y,...C.filter((a,b)=>b!==c).map(a=>(v.data||[]).find(b=>b.id===a)?.vehicle_id).filter(Boolean)].filter(Boolean),f=((a=[])=>(v.data||[]).filter(c=>!(!c.vehicle_id||a.includes(c.vehicle_id))&&(!b||(0,p.AT)(c.vehicle_id,b.date,b.time||"00:00",s,b.return_time,b.id,{bufferHours:0}).isAvailable)))(d);return(0,e.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:(0,e.jsxs)("div",{className:"md:col-span-2",children:[(0,e.jsxs)(j.J,{className:"text-xs",children:["Escort team ",c+1]}),(0,e.jsxs)(i.l6,{value:C[c]||"none",onValueChange:a=>{let b=[...C];b[c]=a,D(b);let d=(v.data||[]).find(b=>b.id===a),e=[...A];e[c]=d?.vehicle_id||"",B(e)},children:[(0,e.jsx)(i.bq,{children:(0,e.jsx)(i.yv,{placeholder:"Select escort team"})}),(0,e.jsx)(i.gC,{position:"popper",className:"z-[1000]",children:v.isLoading?(0,e.jsx)("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:"Loading teams..."}):0===(v.data||[]).length?(0,e.jsx)("div",{className:"px-2 py-1.5 text-sm text-muted-foreground",children:"No escort teams found"}):(()=>{let a=v.data||[],b=new Set(f.map(a=>a.id)),c=a.every(a=>!b.has(a.id));return(0,e.jsxs)(e.Fragment,{children:[a.map(a=>(0,e.jsxs)(i.eb,{value:a.id,disabled:!b.has(a.id),children:[a.team_name,a.vehicle_id?b.has(a.id)?"":" (vehicle unavailable)":" (no vehicle assigned)"]},a.id)),c&&(0,e.jsx)("div",{className:"px-2 py-1.5 text-xs text-muted-foreground",children:"All teams are unavailable for this time window"})]})})()})]})]})},c)})]})]}),(0,e.jsxs)(g.Es,{children:[(0,e.jsx)(h.$,{variant:"outline",onClick:c,children:"Cancel"}),(0,e.jsx)(h.$,{onClick:()=>G.mutate(),disabled:G.isPending,children:G.isPending?"Assigning...":"Assign Resources"})]})]})}):null}[g,h,i,j,k,l,m]=q.then?(await q)():q,d()}catch(a){d(a)}})},36307:a=>{a.exports=import("@radix-ui/react-dropdown-menu")},38661:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{Cf:()=>o,Es:()=>q,HM:()=>m,L3:()=>r,c7:()=>p,lG:()=>j,rr:()=>s,zM:()=>k});var e=c(8732),f=c(82015),g=c(13020),h=c(87092),i=a([g,h]);[g,h]=i.then?(await i)():i;let j=g.Root,k=g.Trigger,l=g.Portal,m=g.Close,n=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Overlay,{ref:c,className:(0,h.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...b}));n.displayName=g.Overlay.displayName;let o=f.forwardRef(({className:a,children:b,...c},d)=>(0,e.jsxs)(l,{children:[(0,e.jsx)(n,{}),(0,e.jsx)(g.Content,{ref:d,className:(0,h.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...c,children:b})]}));o.displayName=g.Content.displayName;let p=({className:a,...b})=>(0,e.jsx)("div",{className:(0,h.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...b});p.displayName="DialogHeader";let q=({className:a,...b})=>(0,e.jsx)("div",{className:(0,h.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...b});q.displayName="DialogFooter";let r=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Title,{ref:c,className:(0,h.cn)("text-lg font-semibold leading-none tracking-tight",a),...b}));r.displayName=g.Title.displayName;let s=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Description,{ref:c,className:(0,h.cn)("text-sm text-muted-foreground",a),...b}));s.displayName=g.Description.displayName,d()}catch(a){d(a)}})},40273:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{J:()=>l});var e=c(8732),f=c(82015),g=c(20598),h=c(8938),i=c(87092),j=a([g,h,i]);[g,h,i]=j.then?(await j)():j;let k=(0,h.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Root,{ref:c,className:(0,i.cn)(k(),a),...b}));l.displayName=g.Root.displayName,d()}catch(a){d(a)}})},40361:a=>{a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},41415:a=>{a.exports=import("sonner")},43348:(a,b,c)=>{c.d(b,{v:()=>d});let d=[{value:"places",label:"Places",icon:"\uD83D\uDCCD",color:"#2563EB"},{value:"checkpoints",label:"Checkpoints",icon:"\uD83D\uDEA7",color:"#0891B2"},{value:"market",label:"Market",icon:"\uD83D\uDED2",color:"#EA580C"},{value:"security",label:"Security",icon:"\uD83D\uDEA8",color:"#DC2626"},{value:"fuel",label:"Fuel Station",icon:"⛽",color:"#CA8A04"},{value:"health",label:"Health",icon:"\uD83C\uDFE5",color:"#7C3AED"},{value:"restaurant",label:"Restaurant",icon:"\uD83C\uDF7D️",color:"#E11D48"},{value:"hotel",label:"Hotel",icon:"\uD83C\uDFE8",color:"#16A34A"},{value:"bank",label:"Bank",icon:"\uD83C\uDFE6",color:"#0D9488"},{value:"school",label:"School",icon:"\uD83C\uDFEB",color:"#D97706"},{value:"mosque",label:"Mosque",icon:"\uD83D\uDD4C",color:"#9333EA"},{value:"general",label:"General",icon:"\uD83D\uDCCD",color:"#64748B"}]},46060:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},47860:a=>{a.exports=import("@radix-ui/react-select")},48303:a=>{a.exports=import("@radix-ui/react-tooltip")},50802:a=>{a.exports=import("clsx")},51055:(a,b,c)=>{c.d(b,{L:()=>h});var d=c(8732),e=c(82015),f=c(23852),g=c(939);let h=(0,e.memo)(function({trips:a,interestPoints:b=[],variant:h="card",onMapClick:i,showInterestPoints:j=!0}){let k=a.filter(a=>"in_progress"===a.status),l=(0,e.useRef)(null),[m,n]=(0,e.useState)(!1),{getGoogleMapsApiKey:o}=c(37839),[p,q]=(0,e.useState)(null),r=(0,e.useRef)(null),s=(0,e.useRef)([]),t=(0,e.useRef)([]),u=(0,e.useRef)([]),v=(0,e.useRef)(!1);(0,e.useEffect)(()=>{o().then(a=>{q(a)}).catch(a=>{console.error("Failed to load Google Maps API key:",a)})},[o]);let w=(0,e.useMemo)(()=>b.filter(a=>a.is_active),[b]);console.log("LiveMap Debug:",{gmapsKey:p?"Available":"Not available"});let x=(0,e.useMemo)(()=>k.map(a=>{let b=a.current_lat??a.pickup_lat,c=a.current_lng??a.pickup_lng;return"number"==typeof b&&"number"==typeof c?{lat:b,lng:c,id:a.id,label:a.driver_name||"Trip"}:null}).filter(Boolean),[k]),y=(0,e.useMemo)(()=>k.map(a=>{let b="number"==typeof a.pickup_lat&&"number"==typeof a.pickup_lng,c="number"==typeof a.dropoff_lat&&"number"==typeof a.dropoff_lng;return b&&c?{id:a.id,start:{lat:a.pickup_lat,lng:a.pickup_lng},end:{lat:a.dropoff_lat,lng:a.dropoff_lng}}:null}).filter(Boolean),[k]);return((0,e.useEffect)(()=>{if(console.log("Map initialization effect triggered",{mapRef:!!l.current,mapInstance:!!r.current,isInitialized:v.current}),!l.current||v.current)return;let a=async()=>{try{console.log("Starting Google Maps initialization..."),console.log("Google Maps API Key:",p?"Available":"Not available"),await (0,f.pO)();let a=window.google;if(!a?.maps)throw Error("Google Maps not available on window");console.log("Creating Google Maps instance...");let b=new a.maps.Map(l.current,{center:{lat:2.0469,lng:45.3182},zoom:12,mapTypeId:"satellite"});i&&b.addListener("click",a=>{let b=a.latLng.lat(),c=a.latLng.lng();i(b,c)}),console.log("Google Maps initialization complete!"),r.current=b,v.current=!0,n(!0)}catch(a){console.error("Google Maps init failed:",a)}};return p&&!v.current&&a(),()=>{if(v.current){try{s.current&&s.current.forEach(a=>{a&&a.setMap&&a.setMap(null)}),t.current&&t.current.forEach(a=>{a&&a.setMap&&a.setMap(null)}),u.current&&u.current.forEach(a=>a.setMap&&a.setMap(null))}catch{}s.current=[],t.current=[],u.current=[],r.current=null,v.current=!1}}},[p]),(0,e.useEffect)(()=>{if(!r.current||!m)return;try{s.current.forEach(a=>{a&&a.setMap&&a.setMap(null)}),t.current.forEach(a=>{a&&a.setMap&&a.setMap(null)}),u.current.forEach(a=>a.setMap&&a.setMap(null))}catch{}if(s.current=[],t.current=[],u.current=[],0===x.length&&0===y.length&&(!j||0===w.length))return;let a=window.google;a?.maps&&(x.forEach(b=>{let c=new a.maps.Marker({position:{lat:b.lat,lng:b.lng},map:r.current,title:b.label,icon:{path:a.maps.SymbolPath.CIRCLE,fillColor:"#00B3FF",fillOpacity:1,strokeColor:"white",strokeWeight:2,scale:12}});s.current.push(c)}),y.forEach(b=>{let c=new a.maps.Polyline({path:[b.start,b.end],geodesic:!0,strokeColor:"#00B3FF",strokeOpacity:.8,strokeWeight:3,map:r.current});s.current.push(c)}),j&&w.length>0&&w.forEach(b=>{try{let c=(0,g.q1)(b.icon||"place"),d=new a.maps.Marker({position:{lat:b.latitude,lng:b.longitude},map:r.current,title:b.name,icon:{url:c,scaledSize:new a.maps.Size(32,32),anchor:new a.maps.Point(16,16)}}),e=document.createElement("div");e.className="interest-point-label",e.textContent=b.name,e.style.position="absolute",e.style.transform="translate(-50%, -100%)",e.style.marginTop="-12px",e.style.pointerEvents="none",e.style.zIndex="1000",e.style.backgroundColor="white",e.style.color="#1f2937",e.style.padding="4px 8px",e.style.borderRadius="4px",e.style.fontSize="12px",e.style.fontWeight="500",e.style.fontFamily="-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif",e.style.boxShadow="0 1px 3px rgba(0, 0, 0, 0.12), 0 1px 2px rgba(0, 0, 0, 0.24)",e.style.border="1px solid rgba(0, 0, 0, 0.1)",e.style.whiteSpace="nowrap",e.style.maxWidth="200px",e.style.overflow="hidden",e.style.textOverflow="ellipsis";let f=new a.maps.OverlayView;f.onAdd=function(){this.getPanes().overlayLayer.appendChild(e)},f.draw=function(){let c=this.getProjection().fromLatLngToDivPixel(new a.maps.LatLng(b.latitude,b.longitude));c&&(e.style.left=c.x+"px",e.style.top=c.y+"px")},f.onRemove=function(){e.parentNode&&e.parentNode.removeChild(e)},f.setMap(r.current),u.current.push(f);let h=new a.maps.InfoWindow({content:`
                <div style="padding: 16px; min-width: 280px; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;">
                  <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                    <div style="width: 32px; height: 32px; border-radius: 50%; background: ${b.color}; display: flex; align-items: center; justify-content: center; color: white; font-size: 16px;">
                      <img src="https://fonts.gstatic.com/s/i/materialicons/${b.icon||"place"}/v1/24px.svg" 
                           style="width: 20px; height: 20px; filter: invert(1);" 
                           alt="${b.icon||"place"}" />
                    </div>
                    <div style="font-weight: 600; font-size: 16px; color: #1f2937;">${b.name}</div>
                  </div>
                  ${b.description?`<div style="margin-bottom: 12px; color: #6b7280; font-size: 14px; line-height: 1.4;">${b.description}</div>`:""}
                  <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 8px; border-top: 1px solid #e5e7eb;">
                    <div style="font-size: 12px; color: #9ca3af; font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;">
                      ${b.latitude.toFixed(4)}, ${b.longitude.toFixed(4)}
                    </div>
                    <div style="font-size: 11px; color: #9ca3af; text-transform: uppercase; font-weight: 500;">
                      ${b.category}
                    </div>
                  </div>
                </div>
            `});d.addListener("click",()=>{h.open(r.current,d)}),t.current.push(d)}catch(a){console.warn("Error creating interest point marker:",a,b)}}))},[x,y,w,j]),"fullscreen"===h)?(0,d.jsx)("div",{className:"h-full w-full relative",children:p?(0,d.jsx)("div",{ref:l,className:"h-full w-full"}):(0,d.jsx)("div",{className:"bg-muted/30 h-full w-full flex items-center justify-center",children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDDFA️"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Google Maps not available"}),(0,d.jsxs)("p",{className:"text-xs text-muted-foreground mb-2",children:["API Key: ",p?"Configured":"Missing"]}),(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"Check your environment configuration"})]})})}):(0,d.jsx)("div",{className:"h-[400px] w-full relative",children:p?(0,d.jsx)("div",{ref:l,className:"h-full w-full"}):(0,d.jsx)("div",{className:"bg-muted/30 h-full flex items-center justify-center",children:(0,d.jsxs)("div",{className:"text-center",children:[(0,d.jsx)("div",{className:"text-3xl mb-2",children:"\uD83D\uDDFA️"}),(0,d.jsx)("p",{className:"text-sm text-muted-foreground",children:"Google Maps not available"}),(0,d.jsxs)("p",{className:"text-xs text-muted-foreground mb-2",children:["API Key: ",p?"Configured":"Missing"]}),(0,d.jsx)("p",{className:"text-xs text-muted-foreground",children:"Check your environment configuration"})]})})})})},53253:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{V:()=>q});var e=c(8732),f=c(82015),g=c(66345),h=c(74952),i=c(34954),j=c(4720),k=c(90192),l=c(4193),m=c(59176),n=c(76569),o=c(34733),p=a([g,j,k,l,o]);function q({trips:a,onSendMessage:b,onCompleteTrip:c,onUpdateStatus:d,vehicles:p}){let{toast:q}=(0,n.dj)(),[s,t]=(0,f.useState)(!1),[u,v]=(0,f.useState)(null),w=p||[];console.log("DispatchTrips render:",{totalTrips:a?.length||0,securityEscortTrips:a?.filter(a=>a.has_security_escort)?.length||0,tripsWithSecurityEscort:a?.filter(a=>a.has_security_escort)?.map(a=>({id:a.id,has_security_escort:a.has_security_escort,escort_count:a.escort_count,escort_status:a.escort_status,escort_vehicle_ids:a.escort_vehicle_ids}))||[],vehiclesAvailable:w?.length||0,vehiclesSample:w?.slice(0,3).map(a=>({id:a.id,make:a.make,model:a.model,registration:a.registration,is_escort_assigned:a.is_escort_assigned}))||[]});let x=a?.filter(a=>a.has_security_escort&&(a.escort_vehicle_ids?.length||0)>0)||[];x.length>0&&console.log("\uD83D\uDD0D ESCORT VEHICLE DEBUGGING:",{escortTrips:x.map(a=>({tripId:a.id,escortVehicleIds:a.escort_vehicle_ids,escortCount:a.escort_count,escortStatus:a.escort_status})),allVehicleIds:w?.map(a=>a.id)||[],vehicleIdMatches:x.map(a=>({tripId:a.id,escortIds:a.escort_vehicle_ids,foundVehicles:a.escort_vehicle_ids?.map(a=>{let b=w?.find(b=>b.id===a);return{searchId:a,found:!!b,vehicle:b?{id:b.id,make:b.make,model:b.model,registration:b.registration}:null}})||[]}))});let y=Array.isArray(a)?a.filter(Boolean):[];if(0===y.length)return(0,e.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"No trips in this category"});let z=new Map,A=new Set,B=new Map;y.forEach(a=>{if(a&&a.date)try{let b=String(a.date);B.has(b)||B.set(b,[]),B.get(b)?.push(a)}catch(b){console.error("Error processing trip date:",b,a)}}),B.forEach(a=>{for(let b=0;b<a.length;b++){let c=a[b];if(c&&c.driver_id)for(let d=b+1;d<a.length;d++){let b=a[d];if(!b||!b.driver_id||c.driver_id!==b.driver_id)continue;let e=r(c.time),f=r(b.time);if(60>Math.abs(e-f)&&(c.id&&A.add(String(c.id)),b.id&&A.add(String(b.id)),c.driver_id)){let a=String(c.driver_id);z.has(a)||z.set(a,[]),z.get(a)?.some(a=>a.id===c.id)||z.get(a)?.push(c),z.get(a)?.some(a=>a.id===b.id)||z.get(a)?.push(b)}}}});let C=a=>{if(!a||"string"!=typeof a)return"No date";try{return(0,i.Yq)(a)}catch(a){return console.error("Error formatting date:",a),"Invalid date"}},D=a=>{if(!a||"string"!=typeof a)return"No time";try{return(0,i.fU)(a)}catch(a){return console.error("Error formatting time:",a),"Invalid time"}},E=(a,b="Not specified")=>a&&"string"==typeof a?a:b;return(0,e.jsxs)("div",{className:"space-y-4",children:[z.size>0&&(0,e.jsxs)("div",{className:"bg-amber-100 dark:bg-amber-900/30 border border-amber-300 dark:border-amber-500/50 p-4 rounded-lg mb-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 text-amber-800 dark:text-amber-300 font-medium mb-2",children:[(0,e.jsx)(h.hcu,{className:"h-5 w-5"}),(0,e.jsx)("h3",{children:"Scheduling Conflicts Detected"})]}),(0,e.jsx)("div",{className:"text-sm text-amber-700 dark:text-amber-200",children:Array.from(z.entries()).map(([a,b])=>{let c=E(b[0]?.driver_name,"Unknown Driver");return(0,e.jsxs)("div",{className:"mb-2",children:[(0,e.jsxs)("p",{children:[(0,e.jsx)("span",{className:"font-medium",children:c})," is assigned to ",b.length," trips at the same time:"]}),(0,e.jsx)("ul",{className:"list-disc list-inside pl-2",children:b.map(a=>(0,e.jsxs)("li",{children:[C(a.date)," at"," ",D(a.time)," -"," ",E(a.pickup_location,"No pickup")," to"," ",E(a.dropoff_location,"No dropoff")]},a.id||Math.random()))})]},a)})})]}),y.map((a,f)=>{let i=[a.airline,a.flight_number,a.terminal].filter(Boolean).join(" / "),{state:n,totalNeeded:o,totalAssigned:p}=(0,m.Uh)(a);return(0,e.jsx)(l.nD,{type:"single",collapsible:!0,className:`rounded-lg border shadow-sm transition ${a.id&&A.has(String(a.id))?"border-amber-400 bg-amber-50 dark:bg-amber-900/20":"border-border bg-card"}`,children:(0,e.jsxs)(l.As,{value:"item",children:[(0,e.jsx)(l.$m,{className:"px-6 py-4",children:(0,e.jsxs)("div",{className:"flex w-full items-center justify-between",children:[(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)("div",{className:"text-base font-medium text-foreground",children:C(a.date)}),a.time&&(0,e.jsxs)("div",{className:"flex items-center gap-1 text-muted-foreground",children:[(0,e.jsx)(h.zD7,{className:"h-5 w-5"}),(0,e.jsx)("span",{className:"text-sm font-medium",children:D(a.time)})]}),(0,e.jsxs)("div",{className:"text-[11px] font-mono text-muted-foreground bg-muted px-1.5 py-0.5 rounded",children:["#",(a=>{if(!a)return"N/A";try{return String(a).substring(0,8).toUpperCase()}catch(a){return console.error("Error formatting ID:",a),"Invalid ID"}})(a.id)]})]}),(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)("span",{className:"text-sm text-muted-foreground",children:a.type?.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())||"Not specified"}),a.id&&A.has(String(a.id))&&(0,e.jsxs)(j.E,{variant:"outline",className:"text-[11px] bg-amber-500/10 text-amber-700 border-amber-500/20 dark:bg-amber-500/15 dark:text-amber-300 dark:border-amber-500/30",children:[(0,e.jsx)(h.hcu,{className:"h-3 w-3 mr-1"}),"Conflict"]})]})]})}),(0,e.jsxs)(l.ub,{className:"px-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 py-3",children:[(0,e.jsxs)("div",{className:"lg:col-span-2",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,e.jsx)(h.Vxl,{className:"h-4 w-4 text-blue-500"}),(0,e.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Route"})]}),(0,e.jsxs)("div",{className:"space-y-3",children:[(0,e.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-green-50 dark:bg-green-900/20 rounded-lg border border-green-200 dark:border-green-800",children:[(0,e.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-2 flex-shrink-0"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"text-xs font-medium text-green-700 dark:text-green-400 uppercase tracking-wide",children:"Pickup"}),(0,e.jsx)("div",{className:"text-sm text-foreground font-medium",children:E(a.pickup_location)})]})]}),Array.isArray(a.stops)&&a.stops.length>0&&a.stops.map((a,b)=>(0,e.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg border border-yellow-200 dark:border-yellow-800",children:[(0,e.jsx)("div",{className:"w-2 h-2 bg-yellow-500 rounded-full mt-2 flex-shrink-0"}),(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"text-xs font-medium text-yellow-700 dark:text-yellow-400 uppercase tracking-wide",children:["Stop ",b+1]}),(0,e.jsx)("div",{className:"text-sm text-foreground font-medium",children:E(a)})]})]},b)),(0,e.jsxs)("div",{className:"flex items-start gap-3 p-3 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:[(0,e.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full mt-2 flex-shrink-0"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"text-xs font-medium text-red-700 dark:text-red-400 uppercase tracking-wide",children:"Dropoff"}),(0,e.jsx)("div",{className:"text-sm text-foreground font-medium",children:E(a.dropoff_location)})]})]})]})]}),(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,e.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Client"})}),(0,e.jsx)("div",{className:"text-sm text-foreground font-medium",children:E(a.client_name)}),a.client_type&&(0,e.jsx)(j.E,{variant:"outline",className:"text-[11px] mt-1 bg-muted text-muted-foreground border-border",children:"organization"===a.client_type?"Organization":"Individual"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"text-xs text-muted-foreground uppercase tracking-wide mb-1",children:"Service"}),(0,e.jsx)("div",{className:"text-sm text-foreground font-medium",children:a.type?.replace(/_/g," ").replace(/\b\w/g,a=>a.toUpperCase())||"Not specified"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,e.jsx)("span",{className:"text-sm font-medium text-muted-foreground",children:"Vehicles"})}),"none"===n&&(0,e.jsxs)(j.E,{variant:"outline",className:"text-[11px] bg-rose-500/10 text-rose-700 border-rose-500/20 dark:bg-rose-500/15 dark:text-rose-300 dark:border-rose-500/30",children:[(0,e.jsx)(h.hcu,{className:"h-3 w-3 mr-1"}),"Unassigned"]}),"partial"===n&&(0,e.jsxs)("div",{className:"space-y-1",children:[(0,e.jsxs)(j.E,{variant:"outline",className:"text-[11px] bg-amber-500/10 text-amber-700 border-amber-500/20 dark:bg-amber-500/15 dark:text-amber-300 dark:border-amber-500/30",children:[p," of ",o," assigned"]}),(0,e.jsxs)("div",{className:"text-xs text-muted-foreground",children:[o-p," vehicle(s) needed"]})]}),"full"===n&&(0,e.jsx)("div",{className:"flex flex-wrap gap-1",children:a.assigned_vehicle_ids?.map(a=>{let b=w.find(b=>b.id===a);return b?(0,e.jsx)(j.E,{variant:"outline",className:"text-[11px] bg-muted text-muted-foreground border-border",children:b.registration},a):null})})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"text-xs text-muted-foreground uppercase tracking-wide mb-1",children:"Driver"}),a.driver_id?(0,e.jsx)("div",{className:"text-sm text-foreground font-medium",children:E(a.driver_name,"Unknown Driver")}):(0,e.jsx)(j.E,{variant:"outline",className:"text-xs text-amber-600",children:"Unassigned"})]}),a.has_security_escort&&(0,e.jsxs)("div",{children:[(0,e.jsxs)("div",{className:"flex items-center gap-2 mb-2",children:[(0,e.jsx)(h.ekZ,{className:"h-4 w-4 text-rose-500"}),(0,e.jsx)("span",{className:"text-sm font-medium text-rose-700 dark:text-rose-400",children:"Security Escort"})]}),(0,e.jsxs)(j.E,{variant:"outline",className:"text-[11px] bg-rose-500/10 text-rose-700 border-rose-500/20 dark:bg-rose-500/15 dark:text-rose-300 dark:border-rose-500/30",children:[a.escort_count||1," escort vehicle(s) required"]})]})]})]}),(0,e.jsxs)("div",{className:"flex items-center justify-between mt-4 pt-4 border-t border-slate-100 dark:border-slate-700",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(j.E,{variant:"outline",className:`text-[11px] font-medium ${(a=>{switch(a){case"completed":return"bg-emerald-500/12 text-emerald-700 border-emerald-500/20 dark:bg-emerald-500/15 dark:text-emerald-300 dark:border-emerald-500/30";case"in_progress":return"bg-amber-500/12 text-amber-700 border-amber-500/20 dark:bg-amber-500/15 dark:text-amber-300 dark:border-amber-500/30";case"cancelled":return"bg-rose-500/12 text-rose-700 border-rose-500/20 dark:bg-rose-500/15 dark:text-rose-300 dark:border-rose-500/30";default:return"bg-muted text-muted-foreground border-border"}})(a.status)}`,children:a.status.replace("_"," ").toUpperCase()}),i&&(0,e.jsxs)("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[(0,e.jsx)(h.Zcv,{className:"h-3 w-3"}),(0,e.jsx)("span",{children:i})]})]}),(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsxs)(k.rI,{children:[(0,e.jsx)(k.ty,{asChild:!0,children:(0,e.jsx)(g.$,{variant:"outline",size:"sm",children:(0,e.jsx)(h.GvN,{className:"h-4 w-4"})})}),(0,e.jsxs)(k.SQ,{align:"end",children:[(0,e.jsx)(k.lp,{children:"Actions"}),(0,e.jsx)(k.mB,{}),(0,e.jsx)(k._2,{onClick:()=>{v(a),t(!0)},children:"Assign Resources"}),(0,e.jsxs)(k._2,{onClick:()=>b(a),children:[(0,e.jsx)(h.oFn,{className:"h-4 w-4 mr-2"}),"Send Message"]}),"scheduled"===a.status&&(0,e.jsxs)(k._2,{onClick:()=>{let{state:b,totalNeeded:c,totalAssigned:e}=(0,m.Uh)(a),f=!!a.driver_id,g="full"===b||0===c&&(a.vehicle_id||(a.assigned_vehicle_ids?.length||0)>0);if(!f||!g){let a=[];f||a.push("assign a driver"),g||a.push("assign required vehicle(s)"),q({title:"Cannot start trip",description:`Please ${a.join(" and ")} before starting.`,variant:"destructive"});return}d(a.id,"in_progress")},children:[(0,e.jsx)(h.Jlk,{className:"h-4 w-4 mr-2"}),"Start Trip"]}),"in_progress"===a.status&&(0,e.jsxs)(k._2,{onClick:()=>c(a),children:[(0,e.jsx)(h.rAV,{className:"h-4 w-4 mr-2"}),"Complete Trip"]}),"cancelled"!==a.status&&(0,e.jsxs)(k._2,{onClick:()=>d(a.id,"cancelled"),className:"text-red-600",children:[(0,e.jsx)(h.X,{className:"h-4 w-4 mr-2"}),"Cancel Trip"]})]})]})})]})]})]})},a.id||`trip-${f}`)}),(0,e.jsx)(o.X,{open:s,trip:u,onClose:()=>t(!1),onAssigned:()=>{}})]})}function r(a){if(!a||"string"!=typeof a)return 0;try{let b=a.split(":");if(2!==b.length)return 0;let c=parseInt(b[0],10),d=parseInt(b[1],10);return(isNaN(c)?0:60*c)+(isNaN(d)?0:d)}catch(b){return console.error("Error converting time to minutes:",a,b),0}}[g,j,k,l,o]=p.then?(await p)():p,d()}catch(a){d(a)}})},57049:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{bq:()=>m,eb:()=>q,gC:()=>p,l6:()=>k,yv:()=>l});var e=c(8732),f=c(82015),g=c(47860),h=c(74952),i=c(87092),j=a([g,i]);[g,i]=j.then?(await j)():j;let k=g.Root;g.Group;let l=g.Value,m=f.forwardRef(({className:a,children:b,...c},d)=>(0,e.jsxs)(g.Trigger,{ref:d,className:(0,i.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-0 focus-visible:ring-0 focus:ring-offset-0 focus-visible:ring-offset-0 focus:border-ring focus-visible:border-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 transition-colors",a),...c,children:[b,(0,e.jsx)(g.Icon,{asChild:!0,children:(0,e.jsx)(h.yQN,{className:"h-4 w-4 opacity-50"})})]}));m.displayName=g.Trigger.displayName;let n=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.ScrollUpButton,{ref:c,className:(0,i.cn)("flex cursor-default items-center justify-center py-1",a),...b,children:(0,e.jsx)(h.rXn,{className:"h-4 w-4"})}));n.displayName=g.ScrollUpButton.displayName;let o=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.ScrollDownButton,{ref:c,className:(0,i.cn)("flex cursor-default items-center justify-center py-1",a),...b,children:(0,e.jsx)(h.yQN,{className:"h-4 w-4"})}));o.displayName=g.ScrollDownButton.displayName;let p=f.forwardRef(({className:a,children:b,position:c="popper",...d},f)=>(0,e.jsx)(g.Portal,{children:(0,e.jsxs)(g.Content,{ref:f,className:(0,i.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===c&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:c,...d,children:[(0,e.jsx)(n,{}),(0,e.jsx)(g.Viewport,{className:(0,i.cn)("p-1","popper"===c&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:b}),(0,e.jsx)(o,{})]})}));p.displayName=g.Content.displayName,f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Label,{ref:c,className:(0,i.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...b})).displayName=g.Label.displayName;let q=f.forwardRef(({className:a,children:b,...c},d)=>(0,e.jsxs)(g.Item,{ref:d,className:(0,i.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...c,children:[(0,e.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,e.jsx)(g.ItemIndicator,{children:(0,e.jsx)(h.Jlk,{className:"h-4 w-4"})})}),(0,e.jsx)(g.ItemText,{children:b})]}));q.displayName=g.Item.displayName,f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Separator,{ref:c,className:(0,i.cn)("-mx-1 my-1 h-px bg-muted",a),...b})).displayName=g.Separator.displayName,d()}catch(a){d(a)}})},57312:a=>{a.exports=import("next-themes")},57973:a=>{a.exports=import("@radix-ui/react-alert-dialog")},58581:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{F:()=>m});var e=c(8732),f=c(82015),g=c(68953),h=c(53253),i=c(81575),j=c(32771),k=c(79837),l=a([g,h]);function m({trips:a,allTrips:b,drivers:c,vehicles:d,onSendMessage:l,onCompleteTrip:m,onUpdateStatus:n,onAssignEscort:o,variant:p="default"}){let[q,r]=(0,f.useState)("upcoming"),{todayStart:s,tomorrowStart:t}=(0,f.useMemo)(()=>{let a=new Date;a.setHours(0,0,0,0);let b=new Date(a);return b.setDate(b.getDate()+1),{todayStart:a,tomorrowStart:b}},[]),u=a.filter(a=>"in_progress"===a.status),v=a.filter(a=>"completed"===a.status),w=a.filter(a=>"scheduled"===a.status),x=w.filter(a=>{if(!a.date)return!1;let b=(0,i.H)(a.date);return(0,j.r)(b,s)||(0,j.r)(b,t)}),y=w.filter(a=>{if(!a.date)return!1;let b=(0,i.H)(a.date);return(0,k.d)(b,t)}),z=(0,e.jsxs)(g.tU,{value:q,onValueChange:r,className:"flex h-full flex-col overflow-hidden",children:[(0,e.jsx)("div",{className:"sticky top-0 z-10 bg-background/80 backdrop-blur border-b",children:(0,e.jsxs)(g.j7,{className:"w-full bg-transparent text-xs px-2 py-1 flex gap-1 overflow-x-auto",children:[(0,e.jsxs)(g.Xi,{value:"upcoming",className:"flex-1 whitespace-nowrap data-[state=active]:bg-accent data-[state=active]:text-accent-foreground",children:["Upcoming (",x.length,")"]}),(0,e.jsxs)(g.Xi,{value:"in-progress",className:"flex-1 whitespace-nowrap data-[state=active]:bg-accent data-[state=active]:text-accent-foreground",children:["In Progress (",u.length,")"]}),(0,e.jsxs)(g.Xi,{value:"scheduled",className:"flex-1 whitespace-nowrap data-[state=active]:bg-accent data-[state=active]:text-accent-foreground",children:["Scheduled (",y.length,")"]}),(0,e.jsxs)(g.Xi,{value:"completed",className:"flex-1 whitespace-nowrap data-[state=active]:bg-accent data-[state=active]:text-accent-foreground",children:["Completed (",v.length,")"]})]})}),(0,e.jsxs)("div",{className:"flex-1 overflow-y-auto p-3",children:[(0,e.jsx)(g.av,{value:"upcoming",className:"mt-0",children:(0,e.jsx)(h.V,{trips:x,vehicles:d,onSendMessage:l,onCompleteTrip:m,onUpdateStatus:n})}),(0,e.jsx)(g.av,{value:"in-progress",className:"mt-0",children:(0,e.jsx)(h.V,{trips:u,vehicles:d,onSendMessage:l,onCompleteTrip:m,onUpdateStatus:n})}),(0,e.jsx)(g.av,{value:"scheduled",className:"mt-0",children:(0,e.jsx)(h.V,{trips:y,vehicles:d,onSendMessage:l,onCompleteTrip:m,onUpdateStatus:n})}),(0,e.jsx)(g.av,{value:"completed",className:"mt-0",children:(0,e.jsx)(h.V,{trips:v,vehicles:d,onSendMessage:l,onCompleteTrip:m,onUpdateStatus:n})})]})]});return"overlay"===p?(0,e.jsx)("div",{className:"flex h-full flex-col overflow-hidden",children:z}):(0,e.jsx)("div",{className:"grid grid-cols-1 gap-3",children:(0,e.jsx)("div",{className:"col-span-1",children:(0,e.jsxs)("div",{className:"border rounded-md bg-card",children:[(0,e.jsx)("div",{className:"border-b p-3",children:(0,e.jsx)("div",{className:"text-sm font-medium",children:"Trip management"})}),(0,e.jsx)("div",{className:"p-3",children:z})]})})})}[g,h]=l.then?(await l)():l,d()}catch(a){d(a)}})},71845:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{j:()=>m});var e=c(8732),f=c(82015),g=c(38661),h=c(66345),i=c(78059),j=c(40273),k=c(74952),l=a([g,h,i,j]);function m({open:a,trip:b,onClose:c,onConfirm:d}){let[l,m]=(0,f.useState)(null),[n,o]=(0,f.useState)(!1),[p,q]=(0,f.useState)(null),r=async()=>{if(!b||!l)return void q("Please select a log sheet file.");o(!0),q(null);try{await d(b,l)}catch(a){q(a.message||"An unexpected error occurred.")}finally{o(!1)}},s=()=>{m(null),q(null),o(!1),c()};return(0,e.jsx)(g.lG,{open:a,onOpenChange:a=>!a&&s(),children:(0,e.jsxs)(g.Cf,{children:[(0,e.jsxs)(g.c7,{children:[(0,e.jsx)(g.L3,{children:"Complete Trip"}),(0,e.jsx)(g.rr,{children:"To complete the trip, please upload the signed log sheet from the passenger."})]}),(0,e.jsxs)("div",{className:"grid gap-4 py-4",children:[(0,e.jsxs)("div",{className:"grid grid-cols-4 items-center gap-4",children:[(0,e.jsx)(j.J,{htmlFor:"log-sheet",className:"text-right",children:"Log Sheet"}),(0,e.jsx)(i.p,{id:"log-sheet",type:"file",onChange:a=>{a.target.files&&a.target.files.length>0&&(m(a.target.files[0]),q(null))},className:"col-span-3",accept:"image/*,application/pdf"})]}),p&&(0,e.jsx)("p",{className:"text-sm text-red-500 col-span-4 text-center",children:p})]}),(0,e.jsxs)(g.Es,{children:[(0,e.jsx)(h.$,{variant:"outline",onClick:s,disabled:n,children:"Cancel"}),(0,e.jsxs)(h.$,{onClick:r,disabled:!l||n,children:[n?(0,e.jsx)(k.krw,{className:"mr-2 h-4 w-4 animate-spin"}):null,"Complete Trip"]})]})]})})}[g,h,i,j]=l.then?(await l)():l,d()}catch(a){d(a)}})},72457:(a,b,c)=>{c.d(b,{i:()=>e});var d=c(95965);class e{static async getAllInterestPoints(){try{if(!d.N)throw Error("Supabase client is not configured");let{data:a,error:b}=await d.N.from("interest_points").select("*").eq("is_active",!0).order("created_at",{ascending:!1});if(b)throw console.error("Supabase error:",b),b;return a||[]}catch(a){if(console.error("Error fetching interest points:",a),a instanceof Error){if(a.message.includes("JWT"))throw Error("Authentication error: Please check your Supabase credentials");else if(a.message.includes("relation")||a.message.includes("table"))throw Error("Database table not found: Please run the interest points migration first");else if(a.message.includes("network")||a.message.includes("fetch"))throw Error("Network error: Please check your internet connection and Supabase URL")}throw a}}static async getInterestPointsByCategory(a){try{let{data:b,error:c}=await d.N.from("interest_points").select("*").eq("category",a).eq("is_active",!0).order("name",{ascending:!0});if(c)throw c;return b||[]}catch(a){throw console.error("Error fetching interest points by category:",a),a}}static async getInterestPointById(a){try{let{data:b,error:c}=await d.N.from("interest_points").select("*").eq("id",a).single();if(c)throw c;return b||null}catch(a){throw console.error("Error fetching interest point by ID:",a),a}}static async createInterestPoint(a){try{if(console.log("Creating interest point with data:",a),!a.name||!a.name.trim())throw Error("Interest point name is required");let b="string"==typeof a.latitude?parseFloat(a.latitude):a.latitude,c="string"==typeof a.longitude?parseFloat(a.longitude):a.longitude;if("number"!=typeof b||"number"!=typeof c||isNaN(b)||isNaN(c))throw Error("Valid latitude and longitude are required");if(!a.category)throw Error("Category is required");let{data:{user:e}}=await d.N.auth.getUser(),f={name:a.name.trim(),description:a.description?.trim()||null,category:a.category,latitude:b,longitude:c,icon_url:a.icon_url||null,is_active:!0,created_by:e?.id||null};console.log("Inserting data:",f);let{data:g,error:h}=await d.N.from("interest_points").insert([f]).select().single();if(h)throw console.error("Supabase insert error:",{message:h.message,details:h.details,hint:h.hint,code:h.code,fullError:h}),h;return console.log("Successfully created interest point:",g),g||null}catch(a){if(console.error("Error creating interest point:",{error:a,errorType:typeof a,errorConstructor:a?.constructor?.name,errorMessage:a?.message,errorStack:a?.stack,stringified:JSON.stringify(a,null,2)}),a instanceof Error){if(a.message.includes("JWT"))throw Error("Authentication error: Please check your Supabase credentials");else if(a.message.includes("permission"))throw Error("Permission denied: You don't have permission to create interest points");else if(a.message.includes("relation")||a.message.includes("table"))throw Error("Database table not found: Please run the interest points migration first");else if(a.message.includes("duplicate")||a.message.includes("unique"))throw Error("Duplicate entry: An interest point with this name already exists")}throw a}}static async updateInterestPoint(a,b){try{let{data:c,error:e}=await d.N.from("interest_points").update(b).eq("id",a).select().single();if(e)throw e;return c||null}catch(a){throw console.error("Error updating interest point:",a),a}}static async deleteInterestPoint(a){try{console.log("Attempting to delete interest point with ID:",a);let{data:b,error:c}=await d.N.from("interest_points").delete().eq("id",a).select();if(c)throw console.error("Supabase delete error:",c),c;console.log("Delete operation result:",b)}catch(a){if(console.error("Error deleting interest point:",a),a instanceof Error){if(a.message.includes("JWT"))throw Error("Authentication error: Please check your Supabase credentials");else if(a.message.includes("permission"))throw Error("Permission denied: You don't have permission to delete this interest point");else if(a.message.includes("relation")||a.message.includes("table"))throw Error("Database table not found: Please run the interest points migration first")}throw a}}static async deactivateInterestPoint(a){try{let{error:b}=await d.N.from("interest_points").update({is_active:!1}).eq("id",a);if(b)throw b}catch(a){throw console.error("Error deactivating interest point:",a),a}}static async searchInterestPoints(a){try{let{data:b,error:c}=await d.N.from("interest_points").select("*").or(`name.ilike.%${a}%,description.ilike.%${a}%`).eq("is_active",!0).order("name",{ascending:!0});if(c)throw c;return b||[]}catch(a){throw console.error("Error searching interest points:",a),a}}static async getInterestPointsInBounds(a,b,c,e){try{let{data:f,error:g}=await d.N.from("interest_points").select("*").gte("latitude",b).lte("latitude",a).gte("longitude",e).lte("longitude",c).eq("is_active",!0).order("name",{ascending:!0});if(g)throw g;return f||[]}catch(a){throw console.error("Error fetching interest points in bounds:",a),a}}}},74479:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{z:()=>t});var e=c(8732),f=c(82015),g=c(66345),h=c(78059),i=c(57049),j=c(4720),k=c(68953),l=c(33574),m=c(43348),n=c(74952),o=c(80840),p=c(12475),q=c(13486),r=c(939),s=a([g,h,i,j,k,l,o,p,q]);function t({onInterestPointSelected:a,onInterestPointUpdated:b}){let{interestPoints:c,isLoading:d,error:s,refetch:t}=(0,l.L1)(),[u,v]=(0,f.useState)(""),[w,x]=(0,f.useState)("all"),[y,z]=(0,f.useState)(!1),[A,B]=(0,f.useState)(!1),[C,D]=(0,f.useState)(!1),[E,F]=(0,f.useState)(!1),[G,H]=(0,f.useState)(null),[I,J]=(0,f.useState)("all"),[K,L]=(0,f.useState)(!1),M=c.filter(a=>{let b=a.name.toLowerCase().includes(u.toLowerCase())||a.description&&a.description.toLowerCase().includes(u.toLowerCase()),c="all"===w||a.category===w,d=!!y||a.is_active;return b&&c&&d}),N=M.filter(a=>a.is_active);M.filter(a=>!a.is_active);let O=M.filter(a=>"places"===a.category),P=M.filter(a=>"checkpoints"===a.category);M.filter(a=>"market"===a.category),M.filter(a=>"security"===a.category),M.filter(a=>"fuel"===a.category),M.filter(a=>"health"===a.category),M.filter(a=>!["places","checkpoints","market","security","fuel","health"].includes(a.category));let Q=()=>{t(),b?.()},R=b=>0===b.length?(0,e.jsxs)("div",{className:"text-center py-8 text-muted-foreground",children:[(0,e.jsx)(n.sDd,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,e.jsx)("p",{className:"text-sm",children:"No interest points found"})]}):(0,e.jsx)("div",{className:"space-y-2",children:b.map(b=>{let c,d,f=(c=b.category,m.v.find(a=>a.value===c)||m.v[m.v.length-1]);return(0,e.jsxs)("div",{className:"flex items-center justify-between p-3 border rounded-lg hover:bg-muted/50 transition-colors cursor-pointer group",onClick:()=>a?.(b),children:[(0,e.jsxs)("div",{className:"flex items-center gap-3 flex-1 min-w-0",children:[(0,e.jsxs)("div",{className:"h-6 w-6 flex items-center justify-center",style:{color:b.color},children:[(0,e.jsx)("img",{src:(0,r.q1)(b.icon),alt:b.icon,className:"h-6 w-6",style:(d=b.color,(0,r.Ow)(K,d)),onError:a=>{let b=a.currentTarget.nextElementSibling;(0,r.Us)(a,b)}}),(0,e.jsx)("span",{className:"text-2xl hidden",style:{color:b.color},children:b.icon})]}),(0,e.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,e.jsx)("div",{className:"font-medium truncate",children:b.name}),(0,e.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,e.jsx)(j.E,{variant:"secondary",className:"text-xs",children:f.label}),(0,e.jsxs)("span",{className:"text-xs",children:[b.latitude.toFixed(4),", ",b.longitude.toFixed(4)]})]}),b.description&&(0,e.jsx)("p",{className:"text-xs text-muted-foreground truncate mt-1",children:b.description})]})]}),(0,e.jsxs)("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[(0,e.jsx)(g.$,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),H(b),D(!0)},className:"h-8 w-8 p-0",children:(0,e.jsx)(n.ffu,{className:"h-4 w-4"})}),(0,e.jsx)(g.$,{variant:"ghost",size:"sm",onClick:a=>{a.stopPropagation(),H(b),F(!0)},className:"h-8 w-8 p-0 text-destructive hover:text-destructive",children:(0,e.jsx)(n.TBR,{className:"h-4 w-4"})})]})]},b.id)})});return d?(0,e.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto"}),(0,e.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Loading interest points..."})]})}):s?(0,e.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"text-red-500 mb-4",children:(0,e.jsx)("svg",{className:"h-12 w-12 mx-auto mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,e.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"Failed to load interest points"}),(0,e.jsx)(g.$,{onClick:()=>t(),variant:"outline",size:"sm",children:"Try Again"})]})}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:"h-full flex flex-col",children:[(0,e.jsxs)("div",{className:"p-3 border-b",children:[(0,e.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(n.sDd,{className:"h-5 w-5"}),(0,e.jsxs)("h2",{className:"font-semibold",children:["Interest Points (",M.length,")"]})]}),(0,e.jsxs)(g.$,{onClick:()=>B(!0),size:"sm",className:"h-8",children:[(0,e.jsx)(n.FWt,{className:"h-4 w-4 mr-1"}),"Add Point"]})]}),(0,e.jsxs)("div",{className:"flex gap-2",children:[(0,e.jsxs)("div",{className:"relative flex-1",children:[(0,e.jsx)(n.vji,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),(0,e.jsx)(h.p,{placeholder:"Search interest points...",value:u,onChange:a=>v(a.target.value),className:"pl-10 h-8"})]}),(0,e.jsxs)(i.l6,{value:w,onValueChange:x,children:[(0,e.jsxs)(i.bq,{className:"w-[140px] h-8",children:[(0,e.jsx)(n.dJT,{className:"h-4 w-4 mr-2"}),(0,e.jsx)(i.yv,{})]}),(0,e.jsxs)(i.gC,{children:[(0,e.jsx)(i.eb,{value:"all",children:"All Categories"}),m.v.map(a=>(0,e.jsxs)(i.eb,{value:a.value,children:[a.icon," ",a.label]},a.value))]})]}),(0,e.jsx)(g.$,{variant:"outline",size:"sm",onClick:()=>z(!y),className:"h-8 px-3",children:y?(0,e.jsx)(n.X_F,{className:"h-4 w-4"}):(0,e.jsx)(n.kU3,{className:"h-4 w-4"})})]})]}),(0,e.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,e.jsxs)(k.tU,{value:I,onValueChange:J,className:"h-full flex flex-col",children:[(0,e.jsx)("div",{className:"px-3 pt-2",children:(0,e.jsxs)(k.j7,{className:"grid w-full grid-cols-3",children:[(0,e.jsxs)(k.Xi,{value:"all",className:"text-xs",children:["All (",N.length,")"]}),(0,e.jsxs)(k.Xi,{value:"places",className:"text-xs",children:["Places (",O.length,")"]}),(0,e.jsxs)(k.Xi,{value:"checkpoints",className:"text-xs",children:["Checkpoints (",P.length,")"]})]})}),(0,e.jsxs)("div",{className:"flex-1 overflow-y-auto p-3",children:[(0,e.jsx)(k.av,{value:"all",className:"mt-0",children:R(N)}),(0,e.jsx)(k.av,{value:"places",className:"mt-0",children:R(O)}),(0,e.jsx)(k.av,{value:"checkpoints",className:"mt-0",children:R(P)})]})]})})]}),A&&(0,e.jsx)(o.s,{open:A,onClose:()=>B(!1),onInterestPointAdded:Q}),C&&G&&(0,e.jsx)(p.D,{open:C,onClose:()=>D(!1),interestPoint:G,onInterestPointUpdated:Q}),E&&G&&(0,e.jsx)(q.O,{open:E,onOpenChange:F,interestPoint:G,onInterestPointDeleted:Q})]})}[g,h,i,j,k,l,o,p,q]=s.then?(await s)():s,d()}catch(a){d(a)}})},75979:a=>{a.exports=import("tailwind-merge")},78027:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>r,default:()=>n,getServerSideProps:()=>q,getStaticPaths:()=>p,getStaticProps:()=>o,handler:()=>z,reportWebVitals:()=>s,routeModule:()=>y,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>x,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>u,unstable_getStaticProps:()=>t});var e=c(63885),f=c(80237),g=c(81413),h=c(65611),i=c.n(h),j=c(74780),k=c(9762),l=c(12289),m=a([j,k]);[j,k]=m.then?(await m)():m;let n=(0,g.M)(k,"default"),o=(0,g.M)(k,"getStaticProps"),p=(0,g.M)(k,"getStaticPaths"),q=(0,g.M)(k,"getServerSideProps"),r=(0,g.M)(k,"config"),s=(0,g.M)(k,"reportWebVitals"),t=(0,g.M)(k,"unstable_getStaticProps"),u=(0,g.M)(k,"unstable_getStaticPaths"),v=(0,g.M)(k,"unstable_getStaticParams"),w=(0,g.M)(k,"unstable_getServerProps"),x=(0,g.M)(k,"unstable_getServerSideProps"),y=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/Dispatch",pathname:"/Dispatch",bundlePath:"",filename:""},distDir:".next-fleet",relativeProjectDir:"",components:{App:j.default,Document:i()},userland:k}),z=(0,l.U)({srcPage:"/Dispatch",config:r,userland:k,routeModule:y,getStaticPaths:p,getStaticProps:o,getServerSideProps:q});d()}catch(a){d(a)}})},78059:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{p:()=>i});var e=c(8732),f=c(82015),g=c(87092),h=a([g]);g=(h.then?(await h)():h)[0];let i=f.forwardRef(({className:a,type:b,onAddItem:c,onRemoveItem:d,showAddButton:f,showRemoveButton:h,addButtonLabel:i,removeButtonLabel:j,...k},l)=>(0,e.jsxs)("div",{className:f||h?"flex items-center gap-2":"",children:[(0,e.jsx)("input",{type:b,className:(0,g.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus:outline-none focus:ring-0 focus-visible:ring-0 focus:ring-offset-0 focus-visible:ring-offset-0 focus:border-ring focus-visible:border-ring disabled:cursor-not-allowed disabled:opacity-50 transition-colors",a),ref:l,onKeyDown:c?a=>{"Enter"===a.key&&c&&(a.preventDefault(),c())}:void 0,...k}),f&&c&&(0,e.jsx)("button",{type:"button",className:"inline-flex h-10 items-center justify-center rounded-md bg-primary px-3 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90",onClick:c,children:i||"Add"}),h&&d&&(0,e.jsx)("button",{type:"button",className:"inline-flex h-10 items-center justify-center rounded-md bg-destructive px-3 py-2 text-sm font-medium text-destructive-foreground hover:bg-destructive/90",onClick:d,children:j||"Remove"})]}));i.displayName="Input",d()}catch(a){d(a)}})},79837:(a,b,c)=>{c.d(b,{d:()=>e});var d=c(21638);function e(a,b){let c=(0,d.a)(a),e=(0,d.a)(b);return c.getTime()>e.getTime()}},80840:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{s:()=>r});var e=c(8732),f=c(82015),g=c(38661),h=c(66345),i=c(78059),j=c(40273),k=c(87967),l=c(57049),m=c(33574),n=c(43348),o=c(74952),p=c(87603),q=a([g,h,i,j,k,l,m,p]);function r({open:a,onClose:b,initialCoordinates:c,onInterestPointAdded:d}){let{createInterestPoint:q,isCreating:r}=(0,m.L1)(),[s,t]=(0,f.useState)({name:"",description:"",category:"general",latitude:0,longitude:0,icon:"place"}),u=async a=>{if(a.preventDefault(),!s.name.trim())return void console.error("Interest point name is required");if(0===s.latitude&&0===s.longitude)return void console.error("Valid coordinates are required");if(!s.category)return void console.error("Category is required");if(!s.icon)return void console.error("Icon selection is required");console.log("Submitting interest point form with data:",s);try{await q(s),t({name:"",description:"",category:"general",latitude:0,longitude:0,icon:"place"}),d?.(),b()}catch(a){console.error("Error creating interest point:",a)}},v=(a,b)=>{let c=parseFloat(b);isNaN(c)||t(b=>({...b,[a]:c}))};return(0,e.jsx)(g.lG,{open:a,onOpenChange:b,children:(0,e.jsxs)(g.Cf,{className:"sm:max-w-[500px]",children:[(0,e.jsx)(g.c7,{children:(0,e.jsxs)(g.L3,{className:"flex items-center gap-2",children:[(0,e.jsx)(o.sDd,{className:"h-5 w-5"}),"Add Interest Point"]})}),(0,e.jsxs)("form",{onSubmit:u,className:"space-y-4",children:[(0,e.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(j.J,{htmlFor:"latitude",children:"Latitude"}),(0,e.jsx)(i.p,{id:"latitude",type:"number",value:s.latitude,onChange:a=>v("latitude",a.target.value),placeholder:"e.g., 2.0469",required:!0})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(j.J,{htmlFor:"longitude",children:"Longitude"}),(0,e.jsx)(i.p,{id:"longitude",type:"number",value:s.longitude,onChange:a=>v("longitude",a.target.value),placeholder:"e.g., 45.3182",required:!0})]})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(j.J,{htmlFor:"name",children:"Name *"}),(0,e.jsx)(i.p,{id:"name",value:s.name,onChange:a=>t(b=>({...b,name:a.target.value})),placeholder:"Enter interest point name",required:!0})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(j.J,{htmlFor:"description",children:"Description"}),(0,e.jsx)(k.T,{id:"description",value:s.description,onChange:a=>t(b=>({...b,description:a.target.value})),placeholder:"Enter description (optional)",rows:3})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(j.J,{htmlFor:"category",children:"Category"}),(0,e.jsxs)(l.l6,{value:s.category,onValueChange:a=>{t(b=>({...b,category:a}))},children:[(0,e.jsx)(l.bq,{children:(0,e.jsx)(l.yv,{placeholder:"Select category"})}),(0,e.jsx)(l.gC,{children:n.v.map(a=>(0,e.jsx)(l.eb,{value:a.value,children:a.label},a.value))})]})]}),(0,e.jsx)(p.U,{value:s.icon,onChange:a=>t(b=>({...b,icon:a})),disabled:r}),(0,e.jsxs)(g.Es,{children:[(0,e.jsx)(h.$,{type:"button",variant:"outline",onClick:b,children:"Cancel"}),(0,e.jsx)(h.$,{type:"submit",disabled:r||!s.name.trim()||!s.icon,children:r?"Adding...":"Add Interest Point"})]})]})]})})}[g,h,i,j,k,l,m,p]=q.then?(await q)():q,d()}catch(a){d(a)}})},81575:(a,b,c)=>{c.d(b,{H:()=>e});var d=c(73502);function e(a,b){let c,e,n=b?.additionalDigits??2,o=function(a){let b,c={},d=a.split(f.dateTimeDelimiter);if(d.length>2)return c;if(/:/.test(d[0])?b=d[0]:(c.date=d[0],b=d[1],f.timeZoneDelimiter.test(c.date)&&(c.date=a.split(f.timeZoneDelimiter)[0],b=a.substr(c.date.length,a.length))),b){let a=f.timezone.exec(b);a?(c.time=b.replace(a[1],""),c.timezone=a[1]):c.time=b}return c}(a);if(o.date){let a=function(a,b){let c=RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+b)+"})|(\\d{2}|[+-]\\d{"+(2+b)+"})$)"),d=a.match(c);if(!d)return{year:NaN,restDateString:""};let e=d[1]?parseInt(d[1]):null,f=d[2]?parseInt(d[2]):null;return{year:null===f?e:100*f,restDateString:a.slice((d[1]||d[2]).length)}}(o.date,n);c=function(a,b){var c,d,e,f,h,i,k;if(null===b)return new Date(NaN);let n=a.match(g);if(!n)return new Date(NaN);let o=!!n[4],p=j(n[1]),q=j(n[2])-1,r=j(n[3]),s=j(n[4]),t=j(n[5])-1;if(o){return(c=s,d=t,c>=1&&c<=53&&d>=0&&d<=6)?function(a,b,c){let d=new Date(0);d.setUTCFullYear(a,0,4);let e=d.getUTCDay()||7;return d.setUTCDate(d.getUTCDate()+((b-1)*7+c+1-e)),d}(b,s,t):new Date(NaN)}{let a=new Date(0);return(e=b,f=q,h=r,f>=0&&f<=11&&h>=1&&h<=(l[f]||(m(e)?29:28))&&(i=b,(k=p)>=1&&k<=(m(i)?366:365)))?(a.setUTCFullYear(b,q,Math.max(p,r)),a):new Date(NaN)}}(a.restDateString,a.year)}if(!c||isNaN(c.getTime()))return new Date(NaN);let p=c.getTime(),q=0;if(o.time&&isNaN(q=function(a){var b,c,e;let f=a.match(h);if(!f)return NaN;let g=k(f[1]),i=k(f[2]),j=k(f[3]);return(b=g,c=i,e=j,24===b?0===c&&0===e:e>=0&&e<60&&c>=0&&c<60&&b>=0&&b<25)?g*d.s0+i*d.Cg+1e3*j:NaN}(o.time)))return new Date(NaN);if(o.timezone){if(isNaN(e=function(a){var b;if("Z"===a)return 0;let c=a.match(i);if(!c)return 0;let e="+"===c[1]?-1:1,f=parseInt(c[2]),g=c[3]&&parseInt(c[3])||0;return(b=g)>=0&&b<=59?e*(f*d.s0+g*d.Cg):NaN}(o.timezone)))return new Date(NaN)}else{let a=new Date(p+q),b=new Date(0);return b.setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()),b.setHours(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),b}return new Date(p+q+e)}let f={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},g=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,h=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,i=/^([+-])(\d{2})(?::?(\d{2}))?$/;function j(a){return a?parseInt(a):1}function k(a){return a&&parseFloat(a.replace(",","."))||0}let l=[31,null,31,30,31,30,31,31,30,31,30,31];function m(a){return a%400==0||a%4==0&&a%100!=0}},82015:a=>{a.exports=require("react")},87603:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{U:()=>h});var e=c(8732);c(82015);var f=c(24957),g=a([f]);function h(a){try{return(0,e.jsx)(f.J,{...a})}catch(b){return console.error("Error in SafeGoogleIconsSelector:",b),(0,e.jsxs)("div",{className:`space-y-2 ${a.className||""}`,children:[(0,e.jsx)("label",{className:"text-sm font-medium",children:"Icon"}),(0,e.jsxs)("div",{className:"flex items-center gap-2 p-2 border rounded-md bg-gray-50",children:[(0,e.jsx)("div",{className:"h-6 w-6 bg-gray-300 rounded flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-xs",children:"⚠️"})}),(0,e.jsx)("span",{className:"text-sm text-gray-600",children:"Icon selector temporarily unavailable"})]}),(0,e.jsx)("p",{className:"text-xs text-gray-500",children:"Please refresh the page to restore functionality"})]})}}f=(g.then?(await g)():g)[0],d()}catch(a){d(a)}})},92608:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{I:()=>t});var e=c(8732),f=c(82015),g=c(38661),h=c(66345),i=c(57049),j=c(40273),k=c(4720),l=c(16417),m=c(28462),n=c(95965),o=c(76569),p=c(44874),q=c(74952),r=c(41750),s=a([g,h,i,j,k,l,m]);function t({open:a,trip:b,onClose:c,onEscortAssigned:d}){let{vehicles:s=[],trips:t=[]}=(0,l.s)(),[u,v]=(0,f.useState)([]),w=(0,m.useQueryClient)(),{toast:x}=(0,o.dj)();console.log("AssignEscortDialog render:",{open:a,tripId:b?.id,hasSecurityEscort:b?.has_security_escort,escortCount:b?.escort_count,vehiclesCount:s?.length||0,vehicles:s});let y=b?.escort_count||1,z=Math.min(y,2),A=a=>{let c=[b?.vehicle_id,...u.filter((b,c)=>c!==a&&b)].filter(Boolean);return(s||[]).filter(a=>!c.includes(a.id)&&!!b&&(0,r.AT)(a.id,b.date,b.time||"00:00",t,b.return_time,b.id,{bufferHours:1}).isAvailable)},B=(0,m.useMutation)({mutationFn:async({tripId:a,escortVehicles:c})=>{let d=c.filter(Boolean),e=b?.escort_count||1,f="not_assigned";d.length===e?f="fully_assigned":d.length>0&&(f="partially_assigned");let{error:g}=await n.N.from("trips").update({escort_vehicle_ids:d,escort_status:f,escort_assigned_at:new Date().toISOString()}).eq("id",a);if(g)throw g;let{error:h}=await n.N.from("vehicles").update({is_escort_assigned:!1,escort_trip_id:null,escort_assigned_at:null}).eq("escort_trip_id",a);if(h&&console.warn("Error clearing old escort assignments:",h),d.length>0){let{error:b}=await n.N.from("vehicles").update({is_escort_assigned:!0,escort_trip_id:a,escort_assigned_at:new Date().toISOString()}).in("id",d);if(b)throw b}return{escortVehicles:d}},onSuccess:async({escortVehicles:a})=>{await Promise.all([w.invalidateQueries({queryKey:["trips"]}),w.invalidateQueries({queryKey:["vehicles"]}),w.refetchQueries({queryKey:["trips"]}),w.refetchQueries({queryKey:["vehicles"]})]),await new Promise(a=>setTimeout(a,100)),x({title:"Escort Vehicles Assigned",description:`${a.length} escort vehicle(s) have been assigned to the trip.`}),b&&(0,p.Mx)({title:`Security escorts assigned for trip ${b.id}`,type:"trip",relatedId:b.id.toString()}),d(),c()},onError:a=>{x({title:"Error",description:`Failed to assign escort vehicles: ${a.message}`,variant:"destructive"})}});return b?.has_security_escort?(0,e.jsx)(g.lG,{open:a,onOpenChange:a=>{a||c()},children:(0,e.jsxs)(g.Cf,{className:"max-w-md",children:[(0,e.jsxs)(g.c7,{children:[(0,e.jsxs)(g.L3,{className:"flex items-center gap-2",children:[(0,e.jsx)(q.ekZ,{className:"h-5 w-5 text-red-600"}),"Assign Security Escorts"]}),(0,e.jsxs)(g.rr,{children:["Assign ",z," escort vehicle",z>1?"s":""," for trip ",b?.id?b.id.substring(0,8).toUpperCase():"","."]}),(0,e.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,e.jsxs)(k.E,{variant:"destructive",className:"text-xs",children:[(0,e.jsx)(q.hcu,{className:"h-3 w-3 mr-1"}),"High Security"]}),(0,e.jsxs)(k.E,{variant:"outline",className:"text-xs",children:[z," escort",z>1?"s":""," required"]})]})]}),(0,e.jsxs)("form",{onSubmit:a=>{if(a.preventDefault(),!b)return;let c=u.filter(Boolean);if(0===c.length)return void x({title:"No Escorts Selected",description:"Please select at least one escort vehicle.",variant:"destructive"});B.mutate({tripId:b.id,escortVehicles:c})},children:[(0,e.jsxs)("div",{className:"space-y-4 py-4",children:[(0,e.jsx)("div",{className:"p-3 bg-blue-50 dark:bg-blue-950/30 rounded-lg border border-blue-200 dark:border-blue-800",children:(0,e.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,e.jsx)(q.THT,{className:"h-4 w-4 text-blue-600"}),(0,e.jsx)("span",{className:"font-medium",children:"Main Vehicle:"}),(0,e.jsx)("span",{children:b.vehicle_details||"Not assigned"})]})}),Array.from({length:z},(a,b)=>(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsxs)(j.J,{htmlFor:`escort-${b}`,children:["Escort Vehicle ",b+1,0===b&&(0,e.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,e.jsxs)(i.l6,{onValueChange:a=>((a,b)=>{let c=[...u];c[a]=b,v(c)})(b,a),value:u[b]||"none",children:[(0,e.jsx)(i.bq,{id:`escort-${b}`,children:(0,e.jsx)(i.yv,{placeholder:`Select escort vehicle ${b+1}`})}),(0,e.jsx)(i.gC,{children:0===A(b).length?(0,e.jsx)(i.eb,{value:"none",disabled:!0,children:"No available vehicles"}):A(b).map(a=>(0,e.jsx)(i.eb,{value:a.id,children:(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsxs)("span",{children:[a.make," ",a.model," (",a.registration,")"]}),a.type&&(0,e.jsx)(k.E,{variant:"armoured"===a.type?"default":"secondary",className:"text-xs",children:"armoured"===a.type?"Armoured":"Soft Skin"})]})},a.id))})]})]},b)),(0,e.jsxs)("div",{className:"text-xs text-muted-foreground p-2 bg-muted rounded",children:[(0,e.jsx)(q.hcu,{className:"h-3 w-3 inline mr-1"}),"Escort vehicles will follow the main vehicle and provide security coverage during the trip."]})]}),(0,e.jsxs)(g.Es,{children:[(0,e.jsx)(h.$,{type:"button",variant:"outline",onClick:c,children:"Cancel"}),(0,e.jsx)(h.$,{type:"submit",disabled:!u.some(Boolean)||B.isPending,className:"bg-red-600 hover:bg-red-700",children:B.isPending?"Assigning...":"Assign Escorts"})]})]})]})}):null}[g,h,i,j,k,l,m]=s.then?(await s)():s,d()}catch(a){d(a)}})},93939:a=>{a.exports=require("@supabase/supabase-js")}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[4952,5611,5781,1913,4780,7784],()=>b(b.s=78027));module.exports=c})();