"use strict";(()=>{var a={};a.id=2946,a.ids=[636,2946,3220],a.modules={8732:a=>{a.exports=require("react/jsx-runtime")},8938:a=>{a.exports=import("class-variance-authority")},9640:a=>{a.exports=import("@radix-ui/react-slot")},14443:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>r,default:()=>n,getServerSideProps:()=>q,getStaticPaths:()=>p,getStaticProps:()=>o,handler:()=>z,reportWebVitals:()=>s,routeModule:()=>y,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>x,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>u,unstable_getStaticProps:()=>t});var e=c(63885),f=c(80237),g=c(81413),h=c(65611),i=c.n(h),j=c(74780),k=c(28978),l=c(12289),m=a([j,k]);[j,k]=m.then?(await m)():m;let n=(0,g.M)(k,"default"),o=(0,g.M)(k,"getStaticProps"),p=(0,g.M)(k,"getStaticPaths"),q=(0,g.M)(k,"getServerSideProps"),r=(0,g.M)(k,"config"),s=(0,g.M)(k,"reportWebVitals"),t=(0,g.M)(k,"unstable_getStaticProps"),u=(0,g.M)(k,"unstable_getStaticPaths"),v=(0,g.M)(k,"unstable_getStaticParams"),w=(0,g.M)(k,"unstable_getServerProps"),x=(0,g.M)(k,"unstable_getServerSideProps"),y=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/Chat",pathname:"/Chat",bundlePath:"",filename:""},distDir:".next-fleet",relativeProjectDir:"",components:{App:j.default,Document:i()},userland:k}),z=(0,l.U)({srcPage:"/Chat",config:r,userland:k,routeModule:y,getStaticPaths:p,getStaticProps:o,getServerSideProps:q});d()}catch(a){d(a)}})},14505:a=>{a.exports=import("@radix-ui/react-scroll-area")},16235:a=>{a.exports=import("@radix-ui/react-toast")},28462:a=>{a.exports=import("@tanstack/react-query")},28978:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>h});var e=c(8732);c(82015);var f=c(85231),g=a([f]);function h(){return(0,e.jsxs)("div",{className:"h-full bg-background flex flex-col",children:[(0,e.jsx)("div",{className:"border-b border-border pb-4 pt-4 px-6 flex-shrink-0",children:(0,e.jsx)("div",{className:"flex items-center justify-between",children:(0,e.jsx)("div",{children:(0,e.jsx)("h1",{className:"text-2xl font-semibold text-foreground",children:"Chat"})})})}),(0,e.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,e.jsx)(f.D,{})})]})}f=(g.then?(await g)():g)[0],d()}catch(a){d(a)}})},33873:a=>{a.exports=require("path")},39655:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{BT:()=>l,Wu:()=>m,ZB:()=>k,Zp:()=>i,aR:()=>j,wL:()=>n});var e=c(8732),f=c(82015),g=c(87092),h=a([g]);g=(h.then?(await h)():h)[0];let i=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("div",{ref:c,className:(0,g.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...b}));i.displayName="Card";let j=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("div",{ref:c,className:(0,g.cn)("flex flex-col space-y-1.5 p-6",a),...b}));j.displayName="CardHeader";let k=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("h3",{ref:c,className:(0,g.cn)("text-2xl font-semibold leading-none tracking-tight",a),...b}));k.displayName="CardTitle";let l=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("p",{ref:c,className:(0,g.cn)("text-sm text-muted-foreground",a),...b}));l.displayName="CardDescription";let m=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("div",{ref:c,className:(0,g.cn)("p-6 pt-0",a),...b}));m.displayName="CardContent";let n=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("div",{ref:c,className:(0,g.cn)("flex items-center p-6 pt-0",a),...b}));n.displayName="CardFooter",d()}catch(a){d(a)}})},40361:a=>{a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},41415:a=>{a.exports=import("sonner")},46060:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},48303:a=>{a.exports=import("@radix-ui/react-tooltip")},50802:a=>{a.exports=import("clsx")},57312:a=>{a.exports=import("next-themes")},75979:a=>{a.exports=import("tailwind-merge")},78059:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{p:()=>i});var e=c(8732),f=c(82015),g=c(87092),h=a([g]);g=(h.then?(await h)():h)[0];let i=f.forwardRef(({className:a,type:b,onAddItem:c,onRemoveItem:d,showAddButton:f,showRemoveButton:h,addButtonLabel:i,removeButtonLabel:j,...k},l)=>(0,e.jsxs)("div",{className:f||h?"flex items-center gap-2":"",children:[(0,e.jsx)("input",{type:b,className:(0,g.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus:outline-none focus:ring-0 focus-visible:ring-0 focus:ring-offset-0 focus-visible:ring-offset-0 focus:border-ring focus-visible:border-ring disabled:cursor-not-allowed disabled:opacity-50 transition-colors",a),ref:l,onKeyDown:c?a=>{"Enter"===a.key&&c&&(a.preventDefault(),c())}:void 0,...k}),f&&c&&(0,e.jsx)("button",{type:"button",className:"inline-flex h-10 items-center justify-center rounded-md bg-primary px-3 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90",onClick:c,children:i||"Add"}),h&&d&&(0,e.jsx)("button",{type:"button",className:"inline-flex h-10 items-center justify-center rounded-md bg-destructive px-3 py-2 text-sm font-medium text-destructive-foreground hover:bg-destructive/90",onClick:d,children:j||"Remove"})]}));i.displayName="Input",d()}catch(a){d(a)}})},82015:a=>{a.exports=require("react")},85231:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{D:()=>q});var e=c(8732),f=c(82015),g=c(39655),h=c(66345),i=c(78059),j=c(87967),k=c(94142),l=c(91416),m=c(74952),n=c(95965),o=c(71913),p=a([g,h,i,j,k,l]);function q(){let[a,b]=(0,f.useState)([]),[c,d]=(0,f.useState)(null),[p,q]=(0,f.useState)(""),[r,s]=(0,f.useState)([]),[t,u]=(0,f.useState)([]),[v,w]=(0,f.useState)(""),[x,y]=(0,f.useState)(!1),z=(0,f.useMemo)(()=>{if(!t||0===t.length)return null;let a=t.find(a=>"in_progress"===a.status);if(a)return a.id;let b=t.find(a=>"scheduled"===a.status);return b?b.id:t[0]?.id||null},[t]),A=(0,f.useMemo)(()=>{let a={};for(let b of r){let c=(0,o.GP)(new Date(b.timestamp),"dd.MM.yyyy");a[c]||(a[c]=[]),a[c].push(b)}return a},[r]),B=(0,f.useMemo)(()=>{let b=p.trim().toLowerCase();return b?a.filter(a=>[a.name,a.license_number||""].some(a=>(a||"").toLowerCase().includes(b))):a},[a,p]),C=async()=>{if(v.trim()&&c&&z){y(!0);try{let a={trip_id:z,sender_type:"admin",sender_name:"Fleet Manager",message:v.trim(),timestamp:new Date().toISOString(),is_read:!1},{error:b}=await n.N.from("trip_messages").insert(a);if(b)throw b;w("");let{data:c}=await n.N.from("trip_messages").select("*").in("trip_id",(t||[]).map(a=>a.id)).order("timestamp",{ascending:!0});s(c||[])}catch(a){console.error("Error sending message",a)}finally{y(!1)}}};return(0,e.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-0 h-full p-0",children:[(0,e.jsx)(g.Zp,{className:"lg:col-span-4 flex flex-col rounded-none",children:(0,e.jsxs)(g.Wu,{className:"p-0 flex-1 flex flex-col",children:[(0,e.jsx)("div",{className:"p-3 border-b",children:(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)(m.vji,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,e.jsx)(i.p,{placeholder:"Search drivers...",value:p,onChange:a=>q(a.target.value),className:"pl-9 h-8 text-xs"})]})}),(0,e.jsx)(k.F,{className:"flex-1",children:B.map(a=>{let b=c===a.id;return(0,e.jsx)("div",{className:`px-3 py-2 border-b cursor-pointer text-sm hover:bg-muted/50 ${b?"bg-muted":""}`,onClick:()=>d(a.id),children:(0,e.jsxs)("div",{className:"flex items-center gap-3",children:[(0,e.jsx)(l.eu,{className:"h-6 w-6",children:(0,e.jsx)(l.q5,{className:"text-[10px]",children:a.name?.[0]?.toUpperCase()||"D"})}),(0,e.jsxs)("div",{className:"min-w-0",children:[(0,e.jsx)("div",{className:"truncate font-medium text-xs",children:a.name}),a.license_number&&(0,e.jsx)("div",{className:"text-[11px] text-muted-foreground",children:a.license_number})]})]})},a.id)})})]})}),(0,e.jsx)(g.Zp,{className:"lg:col-span-8 flex flex-col rounded-none",children:(0,e.jsxs)(g.Wu,{className:"p-0 flex-1 flex flex-col",children:[(0,e.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,e.jsx)(k.F,{className:"h-full p-4",children:c?0===r.length?(0,e.jsx)("div",{className:"h-full flex items-center justify-center text-sm text-muted-foreground",children:"No messages yet. Start a conversation!"}):(0,e.jsx)("div",{className:"space-y-5",children:Object.entries(A).map(([a,b])=>(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)("div",{className:"flex items-center justify-center",children:(0,e.jsx)("span",{className:"text-[11px] text-muted-foreground px-2 py-0.5 border rounded-none",children:a})}),b.map(a=>(0,e.jsx)("div",{className:`flex ${"admin"===a.sender_type?"justify-end":"justify-start"}`,children:(0,e.jsxs)("div",{className:`max-w-[80%] rounded-none px-3 py-2 text-xs ${"admin"===a.sender_type?"bg-primary text-primary-foreground ml-auto":"bg-muted"}`,children:[(0,e.jsx)("div",{className:"whitespace-pre-wrap break-words",children:a.message}),(0,e.jsx)("div",{className:"mt-1 opacity-70 text-[10px] text-right",children:(0,o.GP)(new Date(a.timestamp),"HH:mm")})]})},a.id))]},a))}):(0,e.jsx)("div",{className:"h-full flex items-center justify-center text-sm text-muted-foreground",children:"Select a driver to start chatting"})})}),(0,e.jsx)("div",{className:"border-t p-2",children:(0,e.jsxs)("div",{className:"flex gap-2 items-end",children:[(0,e.jsx)(h.$,{variant:"ghost",size:"icon",className:"h-8 w-8",children:(0,e.jsx)(m.xv8,{className:"h-4 w-4"})}),(0,e.jsx)(j.T,{placeholder:"Message",value:v,onChange:a=>w(a.target.value),className:"min-h-[36px] max-h-[120px] resize-y text-xs",onKeyDown:a=>{"Enter"!==a.key||a.shiftKey||(a.preventDefault(),C())}}),(0,e.jsx)(h.$,{onClick:C,disabled:!v.trim()||!c||!z||x,size:"sm",className:"h-8",children:(0,e.jsx)(m.Vnp,{className:"h-3 w-3"})})]})})]})})]})}[g,h,i,j,k,l]=p.then?(await p)():p,d()}catch(a){d(a)}})},87967:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{T:()=>i});var e=c(8732),f=c(82015),g=c(87092),h=a([g]);g=(h.then?(await h)():h)[0];let i=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("textarea",{className:(0,g.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-0 focus-visible:ring-0 focus:ring-offset-0 focus-visible:ring-offset-0 focus:border-ring focus-visible:border-ring disabled:cursor-not-allowed disabled:opacity-50 transition-colors",a),ref:c,...b}));i.displayName="Textarea",d()}catch(a){d(a)}})},91416:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{BK:()=>k,eu:()=>j,q5:()=>l});var e=c(8732),f=c(82015),g=c(92549),h=c(87092),i=a([g,h]);[g,h]=i.then?(await i)():i;let j=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Root,{ref:c,className:(0,h.cn)("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",a),...b}));j.displayName=g.Root.displayName;let k=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Image,{ref:c,className:(0,h.cn)("aspect-square h-full w-full",a),...b}));k.displayName=g.Image.displayName;let l=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Fallback,{ref:c,className:(0,h.cn)("flex h-full w-full items-center justify-center rounded-full bg-muted",a),...b}));l.displayName=g.Fallback.displayName,d()}catch(a){d(a)}})},92549:a=>{a.exports=import("@radix-ui/react-avatar")},93939:a=>{a.exports=require("@supabase/supabase-js")},94142:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{F:()=>j});var e=c(8732),f=c(82015),g=c(14505),h=c(87092),i=a([g,h]);[g,h]=i.then?(await i)():i;let j=f.forwardRef(({className:a,children:b,...c},d)=>(0,e.jsxs)(g.Root,{ref:d,className:(0,h.cn)("relative overflow-hidden",a),...c,children:[(0,e.jsx)(g.Viewport,{className:"h-full w-full rounded-[inherit]",children:b}),(0,e.jsx)(k,{}),(0,e.jsx)(g.Corner,{})]}));j.displayName=g.Root.displayName;let k=f.forwardRef(({className:a,orientation:b="vertical",...c},d)=>(0,e.jsx)(g.ScrollAreaScrollbar,{ref:d,orientation:b,className:(0,h.cn)("flex touch-none select-none transition-colors","vertical"===b&&"h-full w-2.5 border-l border-l-transparent p-[1px]","horizontal"===b&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",a),...c,children:(0,e.jsx)(g.ScrollAreaThumb,{className:"relative flex-1 rounded-full bg-border"})}));k.displayName=g.ScrollAreaScrollbar.displayName,d()}catch(a){d(a)}})}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[4952,5611,5781,1913,4780],()=>b(b.s=14443));module.exports=c})();