"use strict";(()=>{var a={};a.id=3121,a.ids=[636,3121,3220],a.modules={6516:a=>{a.exports=require("react-smooth")},7431:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{L:()=>k});var e=c(8732),f=c(39655),g=c(68953),h=c(90029),i=c(73778),j=a([f,g,i]);[f,g,i]=j.then?(await j)():j;let k=({monthlyData:a,financialData:b,isLoading:c=!1})=>{let d=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(a),j=a.map(a=>({...a,total:(a.maintenance||0)+(a.fuel||0)})),k=b?.monthlyData.map(a=>({month:a.month,revenue:a.revenue,expenses:a.expenses,profit:a.profit,tripRevenue:a.tripRevenue||0,leaseRevenue:a.leaseRevenue||0}))||[];return(0,e.jsxs)(g.av,{value:"overview",className:"space-y-6",children:[b&&(0,e.jsx)(i.T,{financialData:b,isLoading:c}),b&&k.length>0&&(0,e.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,e.jsxs)(f.Zp,{children:[(0,e.jsxs)(f.aR,{children:[(0,e.jsx)(f.ZB,{children:"Revenue vs Expenses"}),(0,e.jsx)(f.BT,{children:"Monthly comparison of revenue and operational expenses"})]}),(0,e.jsx)(f.Wu,{className:"h-[400px] w-full",children:(0,e.jsx)(h.uf,{width:"100%",height:"100%",children:(0,e.jsxs)(h.Es,{data:k,margin:{top:20,right:30,left:20,bottom:5},children:[(0,e.jsx)(h.WX,{dataKey:"month"}),(0,e.jsx)(h.h8,{}),(0,e.jsx)(h.m_,{formatter:(a,b)=>[d(a),b],contentStyle:{backgroundColor:"hsl(var(--background))",borderColor:"hsl(var(--border))",borderRadius:"6px",color:"hsl(var(--foreground))"}}),(0,e.jsx)(h.s$,{}),(0,e.jsx)(h.yP,{name:"Revenue",dataKey:"revenue",fill:"#10B981"}),(0,e.jsx)(h.yP,{name:"Expenses",dataKey:"expenses",fill:"#EF4444"})]})})})]}),(0,e.jsxs)(f.Zp,{children:[(0,e.jsxs)(f.aR,{children:[(0,e.jsx)(f.ZB,{children:"Profit Trend"}),(0,e.jsx)(f.BT,{children:"Monthly profit/loss trend analysis"})]}),(0,e.jsx)(f.Wu,{className:"h-[400px] w-full",children:(0,e.jsx)(h.uf,{width:"100%",height:"100%",children:(0,e.jsxs)(h.QF,{data:k,margin:{top:20,right:30,left:20,bottom:5},children:[(0,e.jsx)(h.WX,{dataKey:"month"}),(0,e.jsx)(h.h8,{}),(0,e.jsx)(h.m_,{formatter:a=>[d(a),"Profit"],contentStyle:{backgroundColor:"hsl(var(--background))",borderColor:"hsl(var(--border))",borderRadius:"6px",color:"hsl(var(--foreground))"}}),(0,e.jsx)(h.Gk,{type:"monotone",dataKey:"profit",stroke:"#8B5CF6",fill:"#8B5CF6",fillOpacity:.3})]})})})]})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,e.jsxs)(f.Zp,{children:[(0,e.jsxs)(f.aR,{children:[(0,e.jsx)(f.ZB,{children:"Monthly Cost Breakdown"}),(0,e.jsx)(f.BT,{children:"View maintenance and fuel costs by month"})]}),(0,e.jsx)(f.Wu,{className:"h-[400px] w-full",children:(0,e.jsx)(h.uf,{width:"100%",height:"100%",children:(0,e.jsxs)(h.Es,{data:j,margin:{top:20,right:30,left:20,bottom:5},children:[(0,e.jsx)(h.WX,{dataKey:"month"}),(0,e.jsx)(h.h8,{}),(0,e.jsx)(h.m_,{formatter:a=>[d(a),void 0],contentStyle:{backgroundColor:"hsl(var(--background))",borderColor:"hsl(var(--border))",borderRadius:"6px",color:"hsl(var(--foreground))"}}),(0,e.jsx)(h.s$,{}),(0,e.jsx)(h.yP,{name:"Maintenance",dataKey:"maintenance",fill:"#3B82F6"}),(0,e.jsx)(h.yP,{name:"Fuel",dataKey:"fuel",fill:"#10B981"})]})})})]}),(0,e.jsxs)(f.Zp,{children:[(0,e.jsxs)(f.aR,{children:[(0,e.jsx)(f.ZB,{children:"Cost Trend"}),(0,e.jsx)(f.BT,{children:"Monthly total cost trend"})]}),(0,e.jsx)(f.Wu,{className:"h-[400px] w-full",children:(0,e.jsx)(h.uf,{width:"100%",height:"100%",children:(0,e.jsxs)(h.bl,{data:j,margin:{top:20,right:30,left:20,bottom:5},children:[(0,e.jsx)(h.WX,{dataKey:"month"}),(0,e.jsx)(h.h8,{}),(0,e.jsx)(h.m_,{formatter:a=>[d(a),void 0],contentStyle:{backgroundColor:"hsl(var(--background))",borderColor:"hsl(var(--border))",borderRadius:"6px",color:"hsl(var(--foreground))"}}),(0,e.jsx)(h.s$,{}),(0,e.jsx)(h.N1,{type:"monotone",name:"Total Cost",dataKey:"total",stroke:"#F59E0B",activeDot:{r:8}})]})})})]})]})]})};d()}catch(a){d(a)}})},8732:a=>{a.exports=require("react/jsx-runtime")},8921:a=>{a.exports=require("lodash/maxBy")},8938:a=>{a.exports=import("class-variance-authority")},9640:a=>{a.exports=import("@radix-ui/react-slot")},9888:a=>{a.exports=require("lodash/first")},9948:a=>{a.exports=require("lodash/upperFirst")},11570:a=>{a.exports=require("lodash/isBoolean")},13261:a=>{a.exports=require("victory-vendor/d3-shape")},14014:a=>{a.exports=require("lodash/isFunction")},16235:a=>{a.exports=import("@radix-ui/react-toast")},16490:a=>{a.exports=require("lodash/mapValues")},18725:a=>{a.exports=require("lodash/every")},19640:a=>{a.exports=import("@radix-ui/react-tabs")},26703:a=>{a.exports=require("lodash/sortBy")},28395:a=>{a.exports=require("lodash/range")},28462:a=>{a.exports=import("@tanstack/react-query")},28648:a=>{a.exports=require("lodash/max")},33873:a=>{a.exports=require("path")},35503:a=>{a.exports=require("recharts-scale")},39315:a=>{a.exports=require("lodash/isNaN")},40361:a=>{a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},41415:a=>{a.exports=import("sonner")},44184:a=>{a.exports=require("lodash/sumBy")},46060:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},47860:a=>{a.exports=import("@radix-ui/react-select")},48303:a=>{a.exports=import("@radix-ui/react-tooltip")},49103:(a,b,c)=>{c.d(b,{r:()=>i});var d=c(97203),e=c(5146),f=c(22779),g=c(45075),h=c(55686);function i(a=[],b=[],c=[],j=[],k=[],l=[],m,n){let o=(0,d.J)(a,b,c),p=(0,e.O)(a,b,c),q=(0,f.H)(a,b,c),r=(0,g.o)(a);return{summaryCosts:o,monthlyData:p,vehicleCosts:q,maintenanceCategories:r,fuelTypes:(0,g.Y)(b),yearComparison:(0,h.l)(a,b,c,j,k,l,m,n)}}},49673:a=>{a.exports=require("lodash/flatMap")},50802:a=>{a.exports=import("clsx")},51999:a=>{a.exports=require("lodash/isString")},57312:a=>{a.exports=import("next-themes")},60133:a=>{a.exports=require("lodash/find")},60601:a=>{a.exports=require("lodash/isObject")},62546:a=>{a.exports=require("victory-vendor/d3-scale")},64813:a=>{a.exports=require("lodash/isPlainObject")},66770:a=>{a.exports=require("lodash/throttle")},69826:a=>{a.exports=require("lodash/memoize")},71247:a=>{a.exports=require("lodash/isNumber")},73778:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{T:()=>i});var e=c(8732),f=c(39655),g=c(74952),h=a([f]);function i({financialData:a,isLoading:b=!1}){let c;if(b)return(0,e.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:Array.from({length:4}).map((a,b)=>(0,e.jsxs)(f.Zp,{className:"animate-pulse",children:[(0,e.jsxs)(f.aR,{className:"pb-2",children:[(0,e.jsx)("div",{className:"h-4 bg-muted rounded w-3/4"}),(0,e.jsx)("div",{className:"h-3 bg-muted rounded w-1/2"})]}),(0,e.jsxs)(f.Wu,{children:[(0,e.jsx)("div",{className:"h-8 bg-muted rounded w-1/2 mb-2"}),(0,e.jsx)("div",{className:"h-3 bg-muted rounded w-2/3"})]})]},b))});let d=a=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(a),h=a.profit>=0,i=a.profitMargin>=0;return(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,e.jsxs)(f.Zp,{children:[(0,e.jsxs)(f.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(f.ZB,{className:"text-sm font-medium",children:"Total Revenue"}),(0,e.jsx)(g.G9t,{className:"h-4 w-4 text-green-500"})]}),(0,e.jsxs)(f.Wu,{children:[(0,e.jsx)("div",{className:"text-2xl font-bold text-green-600",children:d(a.totalRevenue)}),(0,e.jsxs)("p",{className:"text-xs text-muted-foreground",children:[a.tripCount," trips +"," ",d(a.revenueBreakdown.vehicleLeases)," ","leases"]})]})]}),(0,e.jsxs)(f.Zp,{children:[(0,e.jsxs)(f.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(f.ZB,{className:"text-sm font-medium",children:"Total Expenses"}),(0,e.jsx)(g.TA3,{className:"h-4 w-4 text-red-500"})]}),(0,e.jsxs)(f.Wu,{children:[(0,e.jsx)("div",{className:"text-2xl font-bold text-red-600",children:d(a.totalExpenses)}),(0,e.jsx)("p",{className:"text-xs text-muted-foreground",children:"Maintenance, fuel & parts"})]})]}),(0,e.jsxs)(f.Zp,{children:[(0,e.jsxs)(f.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(f.ZB,{className:"text-sm font-medium",children:"Net Profit"}),h?(0,e.jsx)(g.ntg,{className:"h-4 w-4 text-green-500"}):(0,e.jsx)(g.klo,{className:"h-4 w-4 text-red-500"})]}),(0,e.jsxs)(f.Wu,{children:[(0,e.jsx)("div",{className:`text-2xl font-bold ${h?"text-green-600":"text-red-600"}`,children:d(a.profit)}),(0,e.jsxs)("p",{className:"text-xs text-muted-foreground",children:[h?"Profit":"Loss"," this period"]})]})]}),(0,e.jsxs)(f.Zp,{children:[(0,e.jsxs)(f.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(f.ZB,{className:"text-sm font-medium",children:"Profit Margin"}),(0,e.jsx)(g.QEB,{className:"h-4 w-4 text-blue-500"})]}),(0,e.jsxs)(f.Wu,{children:[(0,e.jsx)("div",{className:`text-2xl font-bold ${i?"text-green-600":"text-red-600"}`,children:(c=a.profitMargin,`${c>=0?"+":""}${c.toFixed(1)}%`)}),(0,e.jsx)("p",{className:"text-xs text-muted-foreground",children:i?"Healthy":"Needs improvement"})]})]})]})}f=(h.then?(await h)():h)[0],d()}catch(a){d(a)}})},74956:a=>{a.exports=require("clsx")},75979:a=>{a.exports=import("tailwind-merge")},78894:a=>{a.exports=require("lodash/isEqual")},80589:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{X:()=>n});var e=c(8732),f=c(39655),g=c(68953),h=c(90029),i=c(38807),j=c(48383),k=c(74952),l=c(82015),m=a([f,g,j]);[f,g,j]=m.then?(await m)():m;let n=({vehicleCosts:a})=>{let b=a.reduce((a,b)=>a+b.total,0),[c,d]=(0,l.useState)("total"),[m,n]=(0,l.useState)("desc"),o=a=>{c===a?n(a=>"asc"===a?"desc":"asc"):(d(a),n("vehicle_name"===a?"asc":"desc"))},p=a=>c===a?"asc"===m?" ▲":" ▼":"",q=(0,l.useMemo)(()=>a.map(a=>({...a,percentage:b>0?a.total/b*100:0})).sort((a,b)=>{let d=a[c],e=b[c];if("string"==typeof d&&"string"==typeof e)return"asc"===m?d.localeCompare(e):e.localeCompare(d);let f=Number(d)||0,g=Number(e)||0;return"asc"===m?f-g:g-f}),[a,b,c,m]),r=[...a].sort((a,b)=>b.total-a.total).slice(0,5).map(a=>({name:a.vehicle_name.split(" ")[0]+" "+a.vehicle_name.split(" ")[1],value:a.total}));if(a.length>5){let b=a.sort((a,b)=>b.total-a.total).slice(5).reduce((a,b)=>a+b.total,0);r.push({name:"Others",value:b})}return(0,e.jsxs)(g.av,{value:"vehicles",className:"space-y-6",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,e.jsxs)(f.Zp,{children:[(0,e.jsxs)(f.aR,{children:[(0,e.jsx)(f.ZB,{children:"Cost by Vehicle"}),(0,e.jsx)(f.BT,{children:"Maintenance and fuel costs comparison"})]}),(0,e.jsx)(f.Wu,{className:"h-[500px] w-full",children:(0,e.jsx)(h.uf,{width:"100%",height:"100%",children:(0,e.jsxs)(h.Es,{data:a,layout:"vertical",margin:{top:20,right:30,left:150,bottom:5},children:[(0,e.jsx)(h.WX,{type:"number"}),(0,e.jsx)(h.h8,{type:"category",dataKey:"vehicle_name",width:140}),(0,e.jsx)(h.m_,{formatter:a=>[`$${a.toFixed(2)}`,void 0],contentStyle:{backgroundColor:"hsl(var(--background))",borderColor:"hsl(var(--border))",borderRadius:"6px"}}),(0,e.jsx)(h.s$,{}),(0,e.jsx)(h.yP,{name:"Maintenance",dataKey:"maintenance",fill:"#0088FE"}),(0,e.jsx)(h.yP,{name:"Fuel",dataKey:"fuel",fill:"#00C49F"})]})})})]}),(0,e.jsxs)(f.Zp,{children:[(0,e.jsxs)(f.aR,{children:[(0,e.jsx)(f.ZB,{children:"Cost Distribution"}),(0,e.jsx)(f.BT,{children:"Percentage of total fleet costs by vehicle"})]}),(0,e.jsx)(f.Wu,{className:"h-[500px] w-full",children:b>0?(0,e.jsx)(h.uf,{width:"100%",height:"100%",children:(0,e.jsxs)(h.rW,{children:[(0,e.jsx)(h.Fq,{data:r,cx:"50%",cy:"50%",labelLine:!0,outerRadius:150,fill:"#8884d8",dataKey:"value",label:({name:a,percent:b})=>`${a} (${(100*b).toFixed(1)}%)`,children:r.map((a,b)=>(0,e.jsx)(h.fh,{fill:i.l[b%i.l.length]},`cell-${b}`))}),(0,e.jsx)(h.m_,{formatter:a=>[`$${a.toFixed(2)}`,void 0],contentStyle:{backgroundColor:"hsl(var(--background))",borderColor:"hsl(var(--border))",borderRadius:"6px"}})]})}):(0,e.jsxs)("div",{className:"flex items-center justify-center h-full",children:[(0,e.jsx)(k.RIJ,{className:"h-8 w-8 mr-2 text-muted-foreground"}),(0,e.jsx)("span",{className:"text-muted-foreground",children:"No cost data available"})]})})]})]}),(0,e.jsxs)(f.Zp,{children:[(0,e.jsx)(f.aR,{children:(0,e.jsx)(f.ZB,{children:"Vehicle Cost Ranking"})}),(0,e.jsx)(f.Wu,{children:a.length>0?(0,e.jsxs)(j.XI,{children:[(0,e.jsx)(j.A0,{children:(0,e.jsxs)(j.Hj,{children:[(0,e.jsx)(j.nd,{className:"select-none",children:"Rank"}),(0,e.jsxs)(j.nd,{className:"cursor-pointer select-none",onClick:()=>o("vehicle_name"),children:["Vehicle",p("vehicle_name")]}),(0,e.jsxs)(j.nd,{className:"cursor-pointer select-none",onClick:()=>o("total"),children:["Total Cost",p("total")]}),(0,e.jsxs)(j.nd,{className:"cursor-pointer select-none",onClick:()=>o("maintenance"),children:["Maintenance",p("maintenance")]}),(0,e.jsxs)(j.nd,{className:"cursor-pointer select-none",onClick:()=>o("fuel"),children:["Fuel",p("fuel")]}),(0,e.jsxs)(j.nd,{className:"cursor-pointer select-none",onClick:()=>o("percentage"),children:["% of Fleet Total",p("percentage")]})]})}),(0,e.jsx)(j.BF,{children:q.map((a,b)=>{let c=a.percentage;return(0,e.jsxs)(j.Hj,{className:0===b?"bg-yellow-50 dark:bg-yellow-950/20":"",children:[(0,e.jsx)(j.nA,{className:"font-medium",children:b+1}),(0,e.jsx)(j.nA,{children:a.vehicle_name}),(0,e.jsxs)(j.nA,{className:"font-medium",children:["$",a.total.toFixed(2)]}),(0,e.jsxs)(j.nA,{children:["$",a.maintenance.toFixed(2)]}),(0,e.jsxs)(j.nA,{children:["$",a.fuel.toFixed(2)]}),(0,e.jsxs)(j.nA,{children:[c.toFixed(1),"%"]})]},a.vehicle_id)})})]}):(0,e.jsxs)("div",{className:"flex items-center justify-center p-4 text-muted-foreground",children:[(0,e.jsx)(k.RIJ,{className:"mr-2 h-4 w-4"}),"No cost data available"]})})]})]})};d()}catch(a){d(a)}})},80831:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>r,default:()=>n,getServerSideProps:()=>q,getStaticPaths:()=>p,getStaticProps:()=>o,handler:()=>z,reportWebVitals:()=>s,routeModule:()=>y,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>x,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>u,unstable_getStaticProps:()=>t});var e=c(63885),f=c(80237),g=c(81413),h=c(65611),i=c.n(h),j=c(74780),k=c(95671),l=c(12289),m=a([j,k]);[j,k]=m.then?(await m)():m;let n=(0,g.M)(k,"default"),o=(0,g.M)(k,"getStaticProps"),p=(0,g.M)(k,"getStaticPaths"),q=(0,g.M)(k,"getServerSideProps"),r=(0,g.M)(k,"config"),s=(0,g.M)(k,"reportWebVitals"),t=(0,g.M)(k,"unstable_getStaticProps"),u=(0,g.M)(k,"unstable_getStaticPaths"),v=(0,g.M)(k,"unstable_getStaticParams"),w=(0,g.M)(k,"unstable_getServerProps"),x=(0,g.M)(k,"unstable_getServerSideProps"),y=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/CostAnalytics",pathname:"/CostAnalytics",bundlePath:"",filename:""},distDir:".next-fleet",relativeProjectDir:"",components:{App:j.default,Document:i()},userland:k}),z=(0,l.U)({srcPage:"/CostAnalytics",config:r,userland:k,routeModule:y,getStaticPaths:p,getStaticProps:o,getServerSideProps:q});d()}catch(a){d(a)}})},82015:a=>{a.exports=require("react")},84106:a=>{a.exports=require("lodash/get")},85106:a=>{a.exports=require("lodash/min")},89947:a=>{a.exports=require("lodash/omit")},90030:a=>{a.exports=require("lodash/some")},90599:a=>{a.exports=require("lodash/minBy")},91651:a=>{a.exports=require("tiny-invariant")},92654:a=>{a.exports=require("lodash/last")},93939:a=>{a.exports=require("@supabase/supabase-js")},95009:a=>{a.exports=require("lodash/isNil")},95671:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>v});var e=c(8732),f=c(82015),g=c(39655),h=c(68953),i=c(57049),j=c(74952),k=c(15449),l=c(49103),m=c(17535),n=c(71277),o=c(95965),p=c(28462),q=c(7431),r=c(80589),s=c(90333),t=c(90029),u=a([g,h,i,k,m,p,q,r,s]);[g,h,i,k,m,p,q,r,s]=u.then?(await u)():u;let v=()=>{(0,f.useEffect)(()=>{console.log("Testing financial calculations..."),(0,n.A)()},[]);let[a,b]=(0,f.useState)(new Date().getFullYear().toString()),[c,d]=(0,f.useState)("overview"),{maintenanceData:u,fuelData:v,tripsData:w,sparePartsData:x,comparisonMaintenanceData:y,comparisonFuelData:z,comparisonTripsData:A,comparisonSparePartsData:B,isLoading:C,yearOptions:D,comparisonYear:E,setComparisonYear:F}=(0,k.j)(a),{summaryCosts:G,monthlyData:H,vehicleCosts:I,yearComparison:J}=(0,l.r)(u,v,x,y,z,B,a,E),K=Array.isArray(w)?w:[],L=Array.isArray(u)?u:[],M=Array.isArray(v)?v:[],N=Array.isArray(x)?x:[],{data:O=[]}=(0,p.useQuery)({queryKey:["vehicle-leases"],queryFn:async()=>{let{data:a,error:b}=await o.N.from("vehicle_leases").select("*");if(b)throw b;return a||[]}}),{leaseInvoices:P}=(0,m.S)(),Q=(0,n.a)(K,L,M,N,O,P||[]);return E&&(0,n.a)(Array.isArray(A)?A:[],Array.isArray(y)?y:[],Array.isArray(z)?z:[],Array.isArray(B)?B:[],[],[]),(0,f.useEffect)(()=>{"comparison"!==c||E||d("overview")},[c,E]),(()=>{if(!H||H.length<2)return;let a=new Date().getMonth(),b=a>0?a-1:11;if(!H[a]?.total&&!H[b]?.total){let c=H.map((a,b)=>({index:b,total:a.total})).filter(a=>a.total>0).sort((a,b)=>b.index-a.index);c.length>=2&&(a=c[0].index,b=c[1].index)}let c=Q.monthlyData.find(b=>b.month.includes(H[a]?.month||""))?.revenue||0,d=Q.monthlyData.find(a=>a.month.includes(H[b]?.month||""))?.revenue||0,e=H[a]?.total||0,f=H[b]?.total||0,g=d-f;if(0===g);})(),console.log("CostAnalytics - Raw Data Counts:",{trips:K.length,maintenance:L.length,fuel:M.length,spareParts:N.length}),console.log("CostAnalytics - Selected Year:",a),console.log("CostAnalytics - Spare Parts Data:",N),console.log("CostAnalytics - Summary Costs:",G),console.log("CostAnalytics - Financial Data:",Q),(0,e.jsx)("div",{className:"min-h-screen bg-background",children:(0,e.jsxs)("div",{className:"p-4 px-6 space-y-6",children:[(0,e.jsx)("div",{className:"border-b border-border pb-4 pt-4",children:(0,e.jsx)("div",{className:"flex items-center justify-between",children:(0,e.jsx)("div",{children:(0,e.jsx)("h1",{className:"text-2xl font-semibold text-foreground",children:"Analytics"})})})}),(0,e.jsx)("div",{className:"flex justify-end items-center",children:(0,e.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("span",{className:"text-sm font-medium",children:"Compare with:"}),(0,e.jsxs)(i.l6,{value:E||"none",onValueChange:a=>{F("none"===a?null:a)},children:[(0,e.jsx)(i.bq,{className:"w-[120px]",children:(0,e.jsx)(i.yv,{placeholder:"Select year"})}),(0,e.jsxs)(i.gC,{children:[(0,e.jsx)(i.eb,{value:"none",children:"None"}),D.filter(b=>b!==a).map(a=>(0,e.jsx)(i.eb,{value:a,children:a},a))]})]})]}),(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)("span",{className:"text-sm font-medium",children:"Year:"}),(0,e.jsxs)(i.l6,{value:a,onValueChange:b,children:[(0,e.jsx)(i.bq,{className:"w-[120px]",children:(0,e.jsx)(i.yv,{placeholder:"Select year"})}),(0,e.jsx)(i.gC,{children:D.map(a=>(0,e.jsx)(i.eb,{value:a,children:a},a))})]})]})]})}),C&&(0,e.jsxs)("div",{className:"flex items-center justify-center py-8",children:[(0,e.jsx)(j.aHM,{className:"h-8 w-8 animate-spin text-primary"}),(0,e.jsx)("span",{className:"ml-2 text-lg",children:"Loading data..."})]}),!C&&I&&I.length>0&&(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(h.tU,{value:c,onValueChange:a=>{d(a)},className:"space-y-4",children:[(0,e.jsxs)(h.j7,{children:[(0,e.jsx)(h.Xi,{value:"overview",children:"Overview"}),(0,e.jsx)(h.Xi,{value:"vehicles",children:"By Vehicle"}),(0,e.jsx)(h.Xi,{value:"spare-parts",children:"Spare Parts Analysis"}),E&&(0,e.jsx)(h.Xi,{value:"comparison",children:"Comparison"})]}),(0,e.jsx)(q.L,{monthlyData:H,financialData:Q,isLoading:C}),(0,e.jsx)(r.X,{vehicleCosts:I}),(0,e.jsxs)(h.av,{value:"spare-parts",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-6",children:[(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsxs)("div",{className:"text-2xl font-bold text-purple-600",children:["$",N.reduce((a,b)=>{let c=Number(b.quantity||0),d=Number(b.unit_price||0);return a+c*d},0).toFixed(2)]}),(0,e.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Inventory Value"})]}),(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"text-2xl font-bold text-blue-600",children:N.length}),(0,e.jsx)("div",{className:"text-sm text-muted-foreground",children:"Total Parts"})]}),(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"text-2xl font-bold text-green-600",children:N.filter(a=>Number(a.quantity||0)>0).length}),(0,e.jsx)("div",{className:"text-sm text-muted-foreground",children:"In Stock"})]}),(0,e.jsxs)("div",{className:"text-center",children:[(0,e.jsx)("div",{className:"text-2xl font-bold text-orange-600",children:N.filter(a=>Number(a.quantity||0)<=Number(a.min_stock_level||5)).length}),(0,e.jsx)("div",{className:"text-sm text-muted-foreground",children:"Low Stock"})]})]}),(0,e.jsx)("div",{className:"mt-8",children:(0,e.jsxs)(g.Zp,{children:[(0,e.jsxs)(g.aR,{children:[(0,e.jsx)(g.ZB,{className:"text-sm",children:"Monthly Total Cost Trend"}),(0,e.jsx)(g.BT,{children:"Spare parts spending trends over time"})]}),(0,e.jsx)(g.Wu,{children:(0,e.jsx)(t.uf,{width:"100%",height:300,children:(0,e.jsxs)(t.bl,{data:(()=>{let a={};console.log("Chart data generation - Processing spare parts:",N),N.forEach(b=>{if(b.purchase_date)try{let c=new Date(b.purchase_date);if(!isNaN(c.getTime())){let d=`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}`;c.toLocaleString("default",{month:"short",year:"numeric"}),a[d]||(a[d]=0);let e=Number(b.quantity||0)*Number(b.unit_price||0);a[d]+=e,console.log(`Added part ${b.name} cost $${e} to month ${d}`)}}catch(a){console.warn("Error processing purchase date:",b.purchase_date)}});let b=Object.entries(a).sort(([a],[b])=>a.localeCompare(b)).map(([a,b])=>{let[c,d]=a.split("-");return{month:new Date(parseInt(c),parseInt(d)-1).toLocaleString("default",{month:"short",year:"numeric"}),total:Number(b.toFixed(2))}});return console.log("Generated chart data:",b),b})(),margin:{top:5,right:30,left:20,bottom:5},children:[(0,e.jsx)(t.dC,{strokeDasharray:"3 3"}),(0,e.jsx)(t.WX,{dataKey:"month"}),(0,e.jsx)(t.h8,{}),(0,e.jsx)(t.m_,{formatter:a=>[`$${a}`,"Total Cost"],contentStyle:{backgroundColor:"hsl(var(--background))",borderColor:"hsl(var(--border))",borderRadius:"6px",color:"hsl(var(--foreground))"}}),(0,e.jsx)(t.N1,{type:"monotone",dataKey:"total",stroke:"#8B5CF6",strokeWidth:2,dot:{fill:"#8B5CF6",strokeWidth:2,r:4},activeDot:{r:6,stroke:"#8B5CF6",strokeWidth:2}})]})})})]})})]}),E&&J&&(0,e.jsx)(s.T,{comparisonData:J})]})})]})})};d()}catch(a){d(a)}})},96186:a=>{a.exports=require("lodash/uniqBy")}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[4952,5611,5781,1913,2410,4780,8747,5255],()=>b(b.s=80831));module.exports=c})();