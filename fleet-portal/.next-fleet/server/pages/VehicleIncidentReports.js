"use strict";(()=>{var a={};a.id=2503,a.ids=[636,2503,3220],a.modules={7327:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>r,default:()=>n,getServerSideProps:()=>q,getStaticPaths:()=>p,getStaticProps:()=>o,handler:()=>z,reportWebVitals:()=>s,routeModule:()=>y,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>x,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>u,unstable_getStaticProps:()=>t});var e=c(63885),f=c(80237),g=c(81413),h=c(65611),i=c.n(h),j=c(74780),k=c(66741),l=c(12289),m=a([j,k]);[j,k]=m.then?(await m)():m;let n=(0,g.M)(k,"default"),o=(0,g.M)(k,"getStaticProps"),p=(0,g.M)(k,"getStaticPaths"),q=(0,g.M)(k,"getServerSideProps"),r=(0,g.M)(k,"config"),s=(0,g.M)(k,"reportWebVitals"),t=(0,g.M)(k,"unstable_getStaticProps"),u=(0,g.M)(k,"unstable_getStaticPaths"),v=(0,g.M)(k,"unstable_getStaticParams"),w=(0,g.M)(k,"unstable_getServerProps"),x=(0,g.M)(k,"unstable_getServerSideProps"),y=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/VehicleIncidentReports",pathname:"/VehicleIncidentReports",bundlePath:"",filename:""},distDir:".next-fleet",relativeProjectDir:"",components:{App:j.default,Document:i()},userland:k}),z=(0,l.U)({srcPage:"/VehicleIncidentReports",config:r,userland:k,routeModule:y,getStaticPaths:p,getStaticProps:o,getServerSideProps:q});d()}catch(a){d(a)}})},8732:a=>{a.exports=require("react/jsx-runtime")},8938:a=>{a.exports=import("class-variance-authority")},9640:a=>{a.exports=import("@radix-ui/react-slot")},13020:a=>{a.exports=import("@radix-ui/react-dialog")},16235:a=>{a.exports=import("@radix-ui/react-toast")},20598:a=>{a.exports=import("@radix-ui/react-label")},25665:a=>{a.exports=import("@radix-ui/react-checkbox")},28462:a=>{a.exports=import("@tanstack/react-query")},33873:a=>{a.exports=require("path")},36307:a=>{a.exports=import("@radix-ui/react-dropdown-menu")},38827:a=>{a.exports=import("@radix-ui/react-separator")},40361:a=>{a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},41415:a=>{a.exports=import("sonner")},42971:a=>{a.exports=import("zod")},46060:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},47860:a=>{a.exports=import("@radix-ui/react-select")},48303:a=>{a.exports=import("@radix-ui/react-tooltip")},49937:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{r:()=>A});var e=c(8732),f=c(82015),g=c(56884),h=c(98825),i=c(42971),j=c(66345),k=c(52307),l=c(78059),m=c(87967),n=c(57049),o=c(85072),p=c(39655),q=c(52670),r=c(76569),s=c(95965),t=c(28462),u=c(81575),v=c(71913),w=c(74952),x=c(80661),y=a([g,h,i,j,k,l,m,n,o,p,q,t,x]);function z({incidentId:a,position:b="bottom"}){let c=(0,t.useQueryClient)(),{toast:d}=(0,r.dj)(),{data:f}=(0,t.useQuery)({queryKey:["incident-images",a],enabled:!!a,queryFn:async()=>{let{data:b,error:c}=await s.N.from("vehicle_incident_images").select("image_url, name").eq("incident_id",a);if(c)throw c;return b||[]}});if(!f||0===f.length)return null;let g=async b=>{let e=b.name||(a=>{try{let b=new URL(a).pathname.split("/");return b[b.length-1]||null}catch{return null}})(b.image_url);if(!e)return void d({title:"Unable to remove",description:"Missing filename.",variant:"destructive"});if(!window.confirm("Remove this photo from the incident?"))return;let f=`incidents/${a}/${e}`,{error:g}=await s.N.storage.from("images").remove([f]);if(g){console.error(g),d({title:"Failed to remove photo",description:g.message,variant:"destructive"});return}let{error:h}=await s.N.from("vehicle_incident_images").delete().eq("incident_id",a).eq("name",e);if(h){console.error(h),d({title:"Failed to update database",description:h.message,variant:"destructive"});return}let{count:i}=await s.N.from("vehicle_incident_images").select("id",{count:"exact",head:!0}).eq("incident_id",a);(i??0)===0&&await s.N.from("vehicle_incident_reports").update({photos_attached:!1}).eq("id",a),await c.invalidateQueries({queryKey:["incident-images",a]}),d({title:"Photo removed"})};return(0,e.jsxs)("div",{className:"mt-4",children:[(0,e.jsx)("div",{className:"text-sm font-medium mb-2",children:"Existing Photos"}),(0,e.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:f.map((a,b)=>(0,e.jsxs)("div",{className:"group relative border rounded-lg overflow-hidden",children:[(0,e.jsxs)("div",{className:"aspect-square bg-muted",children:[(0,e.jsx)("img",{src:a.image_url,alt:a.name||`Photo ${b+1}`,className:"w-full h-full object-cover"}),(0,e.jsxs)("button",{type:"button",onClick:()=>g(a),className:"absolute top-2 right-2 inline-flex items-center gap-1 rounded bg-red-600 text-white text-xs px-2 py-1 opacity-90 hover:opacity-100",title:"Remove photo",children:[(0,e.jsx)(w.TBR,{className:"h-3 w-3"})," Remove"]})]}),a.name&&(0,e.jsx)("div",{className:"px-2 py-1 text-xs text-muted-foreground truncate",children:a.name})]},b))})]})}[g,h,i,j,k,l,m,n,o,p,q,t,x]=y.then?(await y)():y;let B=i.z.object({vehicle_id:i.z.string().min(1,"Vehicle is required"),driver_id:i.z.string().optional(),incident_date:i.z.string().min(1,"Incident date is required"),incident_time:i.z.string().optional(),incident_type:i.z.enum(["accident","theft","vandalism","breakdown","traffic_violation","other"]),severity:i.z.enum(["minor","moderate","severe","critical"]),status:i.z.enum(["reported","investigating","resolved","closed"]),location:i.z.string().min(1,"Location is required"),description:i.z.string().min(10,"Description must be at least 10 characters"),injuries_reported:i.z.boolean(),police_report_number:i.z.string().optional(),insurance_claim_number:i.z.string().optional(),estimated_damage_cost:i.z.number().min(0).optional(),actual_repair_cost:i.z.number().min(0).optional(),third_party_involved:i.z.boolean(),third_party_details:i.z.string().optional(),witness_details:i.z.string().optional(),photos_attached:i.z.boolean(),reported_by:i.z.string().min(1,"Reporter name is required"),follow_up_required:i.z.boolean(),follow_up_date:i.z.string().optional(),notes:i.z.string().optional(),incident_images:i.z.array(i.z.object({id:i.z.string(),file:i.z.any(),preview:i.z.string(),name:i.z.string(),size:i.z.number(),type:i.z.string()})).optional()}).refine(a=>!a.third_party_involved||!!a.third_party_details,{message:"Third party details are required when third party is involved",path:["third_party_details"]}).refine(a=>!a.follow_up_required||!!a.follow_up_date,{message:"Follow-up date is required when follow-up is needed",path:["follow_up_date"]});function A({report:a,onSuccess:b,onCancel:c}){let{toast:d}=(0,r.dj)(),[i,y]=(0,f.useState)(!1),{data:A}=(0,t.useQuery)({queryKey:["vehicles-for-incidents"],queryFn:async()=>{let{data:a,error:b}=await s.N.from("vehicles").select("id, make, model, registration").order("make");if(b)throw b;return a}}),{data:C}=(0,t.useQuery)({queryKey:["drivers-for-incidents"],queryFn:async()=>{let{data:a,error:b}=await s.N.from("drivers").select("id, name, license_number").order("name");if(b)throw b;return a}}),D=(0,g.useForm)({resolver:(0,h.zodResolver)(B),defaultValues:a?{vehicle_id:a.vehicle_id,driver_id:a.driver_id||"none",incident_date:a.incident_date,incident_time:a.incident_time||"",incident_type:a.incident_type,severity:a.severity,status:a.status,location:a.location,description:a.description,injuries_reported:a.injuries_reported,police_report_number:a.police_report_number||"",insurance_claim_number:a.insurance_claim_number||"",estimated_damage_cost:a.estimated_damage_cost||0,actual_repair_cost:a.actual_repair_cost||0,third_party_involved:a.third_party_involved,third_party_details:a.third_party_details||"",witness_details:a.witness_details||"",photos_attached:a.photos_attached,reported_by:a.reported_by,follow_up_required:a.follow_up_required,follow_up_date:a.follow_up_date||"",notes:a.notes||"",incident_images:[]}:{vehicle_id:"",driver_id:"none",incident_date:new Date().toISOString().split("T")[0],incident_time:new Date().toTimeString().slice(0,5),incident_type:"accident",severity:"minor",status:"reported",location:"",description:"",injuries_reported:!1,police_report_number:"",insurance_claim_number:"",estimated_damage_cost:0,actual_repair_cost:0,third_party_involved:!1,third_party_details:"",witness_details:"",photos_attached:!1,reported_by:"",follow_up_required:!1,follow_up_date:"",notes:"",incident_images:[]}}),E=async c=>{y(!0);try{let{incident_images:e,...f}=c,g=(e||[]).filter(a=>a?.file),h={vehicle_id:c.vehicle_id,driver_id:"none"===c.driver_id?null:c.driver_id,incident_date:c.incident_date,incident_time:c.incident_time||null,incident_type:c.incident_type,severity:c.severity,status:c.status,location:c.location,description:c.description,injuries_reported:c.injuries_reported,police_report_number:c.police_report_number||null,insurance_claim_number:c.insurance_claim_number||null,estimated_damage_cost:c.estimated_damage_cost||null,actual_repair_cost:c.actual_repair_cost||null,third_party_involved:c.third_party_involved,third_party_details:c.third_party_details||null,witness_details:c.witness_details||null,photos_attached:g.length>0||c.photos_attached,reported_by:c.reported_by,follow_up_required:c.follow_up_required,follow_up_date:c.follow_up_date||null,notes:c.notes||null};if(a){let{error:b}=await s.N.from("vehicle_incident_reports").update(h).eq("id",a.id);if(b)throw b;if(g.length>0){let b=[];for(let c of g){let d=c.file,e=`${Date.now()}-${Math.random().toString(36).slice(2)}-${(d.name||"image").replace(/[^a-zA-Z0-9_.-]/g,"_")}`,f=`incidents/${a.id}/${e}`,{error:g}=await s.N.storage.from("images").upload(f,d,{cacheControl:"3600",upsert:!0,contentType:d.type||"image/jpeg"});if(g){console.error("Image upload failed:",g);continue}let{data:h}=s.N.storage.from("images").getPublicUrl(f);h?.publicUrl&&b.push({image_url:h.publicUrl,name:d.name})}b.length>0&&(await s.N.from("vehicle_incident_images").insert(b.map(b=>({incident_id:a.id,image_url:b.image_url,name:b.name||null}))),await s.N.from("vehicle_incident_reports").update({photos_attached:!0}).eq("id",a.id))}d({title:"Incident report updated",description:"The incident report has been updated successfully."})}else{let{data:a,error:b}=await s.N.from("vehicle_incident_reports").insert(h).select("id").single();if(b)throw b;if(a&&"id"in a&&a.id&&g.length>0){let b=[];for(let c of g){let d=c.file,e=`${Date.now()}-${Math.random().toString(36).slice(2)}-${(d.name||"image").replace(/[^a-zA-Z0-9_.-]/g,"_")}`,f=`incidents/${a.id}/${e}`,{error:g}=await s.N.storage.from("images").upload(f,d,{cacheControl:"3600",upsert:!0,contentType:d.type||"image/jpeg"});if(g){console.error("Image upload failed:",g);continue}let{data:h}=s.N.storage.from("images").getPublicUrl(f);h?.publicUrl&&b.push({image_url:h.publicUrl,name:d.name})}b.length>0&&(await s.N.from("vehicle_incident_images").insert(b.map(b=>({incident_id:a.id,image_url:b.image_url,name:b.name||null}))),await s.N.from("vehicle_incident_reports").update({photos_attached:!0}).eq("id",a.id))}d({title:"Incident report created",description:"The incident report has been created successfully."})}b()}catch(a){console.error("Error saving incident report:",a),d({title:"Error",description:"Failed to save incident report. Please try again.",variant:"destructive"})}finally{y(!1)}};return(0,e.jsx)(k.lV,{...D,children:(0,e.jsxs)("form",{onSubmit:D.handleSubmit(E),className:"space-y-6",children:[(0,e.jsxs)(p.Zp,{children:[(0,e.jsx)(p.aR,{className:"pb-4",children:(0,e.jsxs)(p.ZB,{className:"flex items-center gap-2",children:[(0,e.jsx)(w.hcu,{className:"h-5 w-5"}),"Incident Information"]})}),(0,e.jsxs)(p.Wu,{className:"space-y-4",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,e.jsx)(k.zB,{control:D.control,name:"vehicle_id",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Vehicle"}),(0,e.jsxs)(n.l6,{onValueChange:a.onChange,value:a.value,children:[(0,e.jsx)(k.MJ,{children:(0,e.jsx)(n.bq,{children:(0,e.jsx)(n.yv,{placeholder:"Select vehicle"})})}),(0,e.jsx)(n.gC,{children:A?.map(a=>(0,e.jsxs)(n.eb,{value:a.id,children:[a.make," ",a.model," (",a.registration,")"]},a.id))})]}),(0,e.jsx)(k.C5,{})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"driver_id",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Driver (Optional)"}),(0,e.jsxs)(n.l6,{onValueChange:a.onChange,value:a.value,children:[(0,e.jsx)(k.MJ,{children:(0,e.jsx)(n.bq,{children:(0,e.jsx)(n.yv,{placeholder:"Select driver"})})}),(0,e.jsxs)(n.gC,{children:[(0,e.jsx)(n.eb,{value:"none",children:"No driver specified"}),C?.map(a=>(0,e.jsxs)(n.eb,{value:a.id,children:[a.name," (",a.license_number,")"]},a.id))]})]}),(0,e.jsx)(k.C5,{})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"incident_date",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Incident Date"}),(0,e.jsx)(k.MJ,{children:(0,e.jsx)(q.l,{date:a.value?(0,u.H)(a.value):void 0,onDateChange:b=>a.onChange(b?(0,v.GP)(b,"yyyy-MM-dd"):""),className:"w-full"})}),(0,e.jsx)(k.C5,{})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"incident_time",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Incident Time (Optional)"}),(0,e.jsx)(k.MJ,{children:(0,e.jsx)(l.p,{type:"time",placeholder:"HH:MM",...a})}),(0,e.jsx)(k.C5,{})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"incident_type",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Incident Type"}),(0,e.jsxs)(n.l6,{onValueChange:a.onChange,value:a.value,children:[(0,e.jsx)(k.MJ,{children:(0,e.jsx)(n.bq,{children:(0,e.jsx)(n.yv,{})})}),(0,e.jsxs)(n.gC,{children:[(0,e.jsx)(n.eb,{value:"accident",children:"Accident"}),(0,e.jsx)(n.eb,{value:"theft",children:"Theft"}),(0,e.jsx)(n.eb,{value:"vandalism",children:"Vandalism"}),(0,e.jsx)(n.eb,{value:"breakdown",children:"Breakdown"}),(0,e.jsx)(n.eb,{value:"traffic_violation",children:"Traffic Violation"}),(0,e.jsx)(n.eb,{value:"other",children:"Other"})]})]}),(0,e.jsx)(k.C5,{})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"severity",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Severity"}),(0,e.jsxs)(n.l6,{onValueChange:a.onChange,value:a.value,children:[(0,e.jsx)(k.MJ,{children:(0,e.jsx)(n.bq,{children:(0,e.jsx)(n.yv,{})})}),(0,e.jsxs)(n.gC,{children:[(0,e.jsx)(n.eb,{value:"minor",children:"Minor"}),(0,e.jsx)(n.eb,{value:"moderate",children:"Moderate"}),(0,e.jsx)(n.eb,{value:"severe",children:"Severe"}),(0,e.jsx)(n.eb,{value:"critical",children:"Critical"})]})]}),(0,e.jsx)(k.C5,{})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"status",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Status"}),(0,e.jsxs)(n.l6,{onValueChange:a.onChange,value:a.value,children:[(0,e.jsx)(k.MJ,{children:(0,e.jsx)(n.bq,{children:(0,e.jsx)(n.yv,{})})}),(0,e.jsxs)(n.gC,{children:[(0,e.jsx)(n.eb,{value:"reported",children:"Reported"}),(0,e.jsx)(n.eb,{value:"investigating",children:"Investigating"}),(0,e.jsx)(n.eb,{value:"resolved",children:"Resolved"}),(0,e.jsx)(n.eb,{value:"closed",children:"Closed"})]})]}),(0,e.jsx)(k.C5,{})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"reported_by",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Reported By"}),(0,e.jsx)(k.MJ,{children:(0,e.jsx)(l.p,{placeholder:"Name of person reporting incident",...a})}),(0,e.jsx)(k.C5,{})]})})]}),(0,e.jsx)(k.zB,{control:D.control,name:"location",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Location"}),(0,e.jsx)(k.MJ,{children:(0,e.jsx)(l.p,{placeholder:"Exact location where incident occurred",...a})}),(0,e.jsx)(k.C5,{})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"description",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Description"}),(0,e.jsx)(k.MJ,{children:(0,e.jsx)(m.T,{placeholder:"Detailed description of what happened...",className:"min-h-[100px]",...a})}),(0,e.jsx)(k.C5,{})]})})]})]}),(0,e.jsxs)(p.Zp,{children:[(0,e.jsx)(p.aR,{className:"pb-4",children:(0,e.jsxs)(p.ZB,{className:"flex items-center gap-2",children:[(0,e.jsx)(w.iUU,{className:"h-5 w-5"}),"Additional Details"]})}),(0,e.jsxs)(p.Wu,{className:"space-y-4",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsx)(k.zB,{control:D.control,name:"injuries_reported",render:({field:a})=>(0,e.jsxs)(k.eI,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,e.jsx)(k.MJ,{children:(0,e.jsx)(o.S,{checked:a.value,onCheckedChange:a.onChange})}),(0,e.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,e.jsx)(k.lR,{children:"Injuries Reported"}),(0,e.jsx)(k.Rr,{children:"Check if any injuries were reported"})]})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"third_party_involved",render:({field:a})=>(0,e.jsxs)(k.eI,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,e.jsx)(k.MJ,{children:(0,e.jsx)(o.S,{checked:a.value,onCheckedChange:a.onChange})}),(0,e.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,e.jsx)(k.lR,{children:"Third Party Involved"}),(0,e.jsx)(k.Rr,{children:"Check if other parties were involved"})]})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"photos_attached",render:({field:a})=>(0,e.jsxs)(k.eI,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,e.jsx)(k.MJ,{children:(0,e.jsx)(o.S,{checked:a.value,onCheckedChange:a.onChange})}),(0,e.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,e.jsx)(k.lR,{children:"Photos Attached"}),(0,e.jsx)(k.Rr,{children:"Check if photos are available"})]})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"follow_up_required",render:({field:a})=>(0,e.jsxs)(k.eI,{className:"flex flex-row items-start space-x-3 space-y-0",children:[(0,e.jsx)(k.MJ,{children:(0,e.jsx)(o.S,{checked:a.value,onCheckedChange:a.onChange})}),(0,e.jsxs)("div",{className:"space-y-1 leading-none",children:[(0,e.jsx)(k.lR,{children:"Follow-up Required"}),(0,e.jsx)(k.Rr,{children:"Check if follow-up action is needed"})]})]})})]}),(0,e.jsxs)("div",{className:"space-y-4",children:[(0,e.jsx)(k.zB,{control:D.control,name:"police_report_number",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Police Report Number"}),(0,e.jsx)(k.MJ,{children:(0,e.jsx)(l.p,{placeholder:"Enter police report number",...a})}),(0,e.jsx)(k.C5,{})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"insurance_claim_number",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Insurance Claim Number"}),(0,e.jsx)(k.MJ,{children:(0,e.jsx)(l.p,{placeholder:"Enter insurance claim number",...a})}),(0,e.jsx)(k.C5,{})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"estimated_damage_cost",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Estimated Damage Cost ($)"}),(0,e.jsx)(k.MJ,{children:(0,e.jsx)(l.p,{type:"number",min:"0",step:"0.01",placeholder:"0.00",...a,onChange:b=>a.onChange(Number(b.target.value)||0)})}),(0,e.jsx)(k.C5,{})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"actual_repair_cost",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Actual Repair Cost ($)"}),(0,e.jsx)(k.MJ,{children:(0,e.jsx)(l.p,{type:"number",min:"0",step:"0.01",placeholder:"0.00",...a,onChange:b=>a.onChange(Number(b.target.value)||0)})}),(0,e.jsx)(k.C5,{})]})})]})]}),D.watch("third_party_involved")&&(0,e.jsx)(k.zB,{control:D.control,name:"third_party_details",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Third Party Details"}),(0,e.jsx)(k.MJ,{children:(0,e.jsx)(m.T,{placeholder:"Details about other parties involved (names, contact info, insurance details)...",className:"min-h-[80px]",...a})}),(0,e.jsx)(k.C5,{})]})}),D.watch("follow_up_required")&&(0,e.jsx)(k.zB,{control:D.control,name:"follow_up_date",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Follow-up Date"}),(0,e.jsx)(k.MJ,{children:(0,e.jsx)(q.l,{date:a.value?(0,u.H)(a.value):void 0,onDateChange:b=>a.onChange(b?(0,v.GP)(b,"yyyy-MM-dd"):""),className:"w-full"})}),(0,e.jsx)(k.C5,{})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"witness_details",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Witness Details (Optional)"}),(0,e.jsx)(k.MJ,{children:(0,e.jsx)(m.T,{placeholder:"Details about witnesses (names, contact info, statements)...",className:"min-h-[80px]",...a})}),(0,e.jsx)(k.C5,{})]})}),(0,e.jsx)(k.zB,{control:D.control,name:"notes",render:({field:a})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(k.lR,{children:"Additional Notes"}),(0,e.jsx)(k.MJ,{children:(0,e.jsx)(m.T,{placeholder:"Any additional information or observations...",className:"min-h-[80px]",...a})}),(0,e.jsx)(k.C5,{})]})})]})]}),(0,e.jsx)(k.zB,{control:D.control,name:"incident_images",render:({field:b})=>(0,e.jsxs)(k.eI,{children:[(0,e.jsx)(x.B,{value:(b.value||[]).map(a=>({id:a.id||Math.random().toString(),file:a.file,preview:a.preview||"",name:a.name||"",size:a.size||0,type:a.type||""})),onChange:b.onChange,maxImages:10,maxFileSize:5}),a&&(0,e.jsx)(z,{incidentId:a.id}),(0,e.jsx)(k.C5,{})]})}),(0,e.jsxs)("div",{className:"flex justify-end gap-4",children:[(0,e.jsx)(j.$,{type:"button",variant:"outline",onClick:c,children:"Cancel"}),(0,e.jsx)(j.$,{type:"submit",disabled:i,children:i?"Saving...":a?"Update Report":"Create Report"})]})]})})}d()}catch(a){d(a)}})},50802:a=>{a.exports=import("clsx")},56884:a=>{a.exports=import("react-hook-form")},57312:a=>{a.exports=import("next-themes")},60461:a=>{a.exports=import("@radix-ui/react-popover")},65515:a=>{a.exports=require("jspdf")},66741:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>A});var e=c(8732),f=c(82015),g=c(28462),h=c(66345),i=c(48383),j=c(74952),k=c(4720),l=c(78059),m=c(39655),n=c(57049),o=c(38661),p=c(90192),q=c(76569),r=c(95965),s=c(81575),t=c(72737),u=c(71913),v=c(11178),w=c(49937),x=c(89681),y=c(85657),z=a([g,h,i,k,l,m,n,o,p,v,w,x,y]);function A(){let{toast:a}=(0,q.dj)(),b=(0,g.useQueryClient)(),[c,d]=(0,f.useState)(!1),[z,A]=(0,f.useState)(!1),[B,C]=(0,f.useState)(null),[D,E]=(0,f.useState)(""),[F,G]=(0,f.useState)("all"),[H,I]=(0,f.useState)("all"),[J,K]=(0,f.useState)("all"),[L,M]=(0,f.useState)("all"),[N,O]=(0,f.useState)(),{data:P,isLoading:Q}=(0,g.useQuery)({queryKey:["vehicle-incident-reports"],queryFn:async()=>{let{data:a,error:b}=await r.N.from("vehicle_incident_reports").select("*").order("incident_date",{ascending:!1});if(b)throw b;let{data:c,error:d}=await r.N.from("vehicles").select("id, make, model, registration");if(d)throw d;let{data:e,error:f}=await r.N.from("drivers").select("id, name, license_number");if(f)throw f;let g=new Map(c?.map(a=>[a.id,a])||[]),h=new Map(e?.map(a=>[a.id,a])||[]);return a?.map(a=>({...a,vehicle:a.vehicle_id?g.get(a.vehicle_id):null,driver:a.driver_id?h.get(a.driver_id):null}))||[]}}),{data:R}=(0,g.useQuery)({queryKey:["vehicles-for-incidents"],queryFn:async()=>{let{data:a,error:b}=await r.N.from("vehicles").select("id, make, model, registration").order("make");if(b)throw b;return a}}),S=(0,f.useMemo)(()=>P?P.filter(a=>{if(D){let b=D.toLowerCase(),c=a.vehicle?`${a.vehicle.make} ${a.vehicle.model}`.toLowerCase():"",d=a.vehicle?.registration?.toLowerCase()||"",e=a.location.toLowerCase(),f=a.reported_by.toLowerCase();if(!c.includes(b)&&!d.includes(b)&&!e.includes(b)&&!f.includes(b))return!1}if("all"!==F&&a.vehicle_id!==F||"all"!==H&&a.incident_type!==H||"all"!==J&&a.severity!==J||"all"!==L&&a.status!==L)return!1;if(N?.from||N?.to){let b=(0,s.H)(a.incident_date);if(N.from&&b<N.from||N.to&&b>N.to)return!1}return!0}):[],[P,D,F,H,J,L,N]),[T,U]=(0,f.useState)(1),V=Math.ceil((S?.length||0)/20),W=(T-1)*20,X=S?.slice(W,W+20)||[];(0,f.useMemo)(()=>{if(!S)return{total:0,thisMonth:0,severe:0,pending:0,totalCost:0};let a=new Date;a.setDate(1);let b=S.filter(b=>(0,s.H)(b.incident_date)>=a).length,c=S.filter(a=>"severe"===a.severity||"critical"===a.severity).length,d=S.filter(a=>"reported"===a.status||"investigating"===a.status).length,e=S.reduce((a,b)=>a+(b.actual_repair_cost||b.estimated_damage_cost||0),0);return{total:S.length,thisMonth:b,severe:c,pending:d,totalCost:e}},[S]);let Y=(0,g.useMutation)({mutationFn:async a=>{let{error:b}=await r.N.from("vehicle_incident_reports").delete().eq("id",a);if(b)throw b},onSuccess:()=>{b.invalidateQueries({queryKey:["vehicle-incident-reports"]}),a({title:"Incident report deleted",description:"The incident report has been deleted successfully."})},onError:b=>{a({title:"Error",description:"Failed to delete incident report",variant:"destructive"})}}),Z=!!D||"all"!==F||"all"!==H||"all"!==J||"all"!==L||!!N?.from||!!N?.to;return(0,e.jsx)("div",{className:"min-h-screen bg-background",children:(0,e.jsxs)("div",{className:"p-4 px-6 space-y-6",children:[(0,e.jsx)("div",{className:"border-b border-border pb-4 pt-4",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsx)("div",{children:(0,e.jsx)("h1",{className:"text-2xl font-semibold text-foreground",children:"Vehicle Incident Reports"})}),(0,e.jsx)(h.$,{onClick:()=>{C(null),d(!0)},variant:"outline",className:"h-9 px-4",children:"New Incident Report"})]})}),(0,e.jsx)("div",{className:"space-y-4",children:(0,e.jsxs)("div",{className:"flex flex-col gap-4 md:flex-row md:items-center",children:[(0,e.jsx)("div",{className:"flex-1",children:(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)(j.vji,{className:"absolute left-2 top-2.5 h-4 w-4 text-muted-foreground"}),(0,e.jsx)(l.p,{placeholder:"Search by vehicle, location, or reporter...",value:D,onChange:a=>E(a.target.value),className:"pl-8"})]})}),(0,e.jsxs)(n.l6,{value:F,onValueChange:G,children:[(0,e.jsx)(n.bq,{className:"w-[200px]",children:(0,e.jsx)(n.yv,{placeholder:"All Vehicles"})}),(0,e.jsxs)(n.gC,{children:[(0,e.jsx)(n.eb,{value:"all",children:"All Vehicles"}),R?.map(a=>(0,e.jsxs)(n.eb,{value:a.id,children:[a.make," ",a.model," (",a.registration,")"]},a.id))]})]}),(0,e.jsxs)(n.l6,{value:H,onValueChange:I,children:[(0,e.jsx)(n.bq,{className:"w-[150px]",children:(0,e.jsx)(n.yv,{placeholder:"All Types"})}),(0,e.jsxs)(n.gC,{children:[(0,e.jsx)(n.eb,{value:"all",children:"All Types"}),(0,e.jsx)(n.eb,{value:"accident",children:"Accident"}),(0,e.jsx)(n.eb,{value:"theft",children:"Theft"}),(0,e.jsx)(n.eb,{value:"vandalism",children:"Vandalism"}),(0,e.jsx)(n.eb,{value:"breakdown",children:"Breakdown"}),(0,e.jsx)(n.eb,{value:"traffic_violation",children:"Traffic Violation"}),(0,e.jsx)(n.eb,{value:"other",children:"Other"})]})]}),(0,e.jsxs)(n.l6,{value:J,onValueChange:K,children:[(0,e.jsx)(n.bq,{className:"w-[130px]",children:(0,e.jsx)(n.yv,{placeholder:"All Severity"})}),(0,e.jsxs)(n.gC,{children:[(0,e.jsx)(n.eb,{value:"all",children:"All Severity"}),(0,e.jsx)(n.eb,{value:"minor",children:"Minor"}),(0,e.jsx)(n.eb,{value:"moderate",children:"Moderate"}),(0,e.jsx)(n.eb,{value:"severe",children:"Severe"}),(0,e.jsx)(n.eb,{value:"critical",children:"Critical"})]})]}),(0,e.jsxs)(n.l6,{value:L,onValueChange:M,children:[(0,e.jsx)(n.bq,{className:"w-[130px]",children:(0,e.jsx)(n.yv,{placeholder:"All Status"})}),(0,e.jsxs)(n.gC,{children:[(0,e.jsx)(n.eb,{value:"all",children:"All Status"}),(0,e.jsx)(n.eb,{value:"reported",children:"Reported"}),(0,e.jsx)(n.eb,{value:"investigating",children:"Investigating"}),(0,e.jsx)(n.eb,{value:"resolved",children:"Resolved"}),(0,e.jsx)(n.eb,{value:"closed",children:"Closed"})]})]}),(0,e.jsx)(v.U,{value:N,onChange:O,className:"w-[240px]"}),Z&&(0,e.jsxs)(h.$,{variant:"outline",size:"sm",onClick:()=>{E(""),G("all"),I("all"),K("all"),M("all"),O(void 0)},children:[(0,e.jsx)(j.dJT,{className:"h-4 w-4 mr-2"}),"Clear"]})]})}),(0,e.jsx)(m.Zp,{children:(0,e.jsx)(m.Wu,{className:"p-0",children:(0,e.jsx)("div",{className:"overflow-x-auto",children:(0,e.jsxs)(i.XI,{children:[(0,e.jsx)(i.A0,{children:(0,e.jsxs)(i.Hj,{children:[(0,e.jsx)(i.nd,{children:"Date & Time"}),(0,e.jsx)(i.nd,{children:"Report ID"}),(0,e.jsx)(i.nd,{children:"Vehicle"}),(0,e.jsx)(i.nd,{children:"Type"}),(0,e.jsx)(i.nd,{children:"Severity"}),(0,e.jsx)(i.nd,{children:"Status"}),(0,e.jsx)(i.nd,{children:"Location"}),(0,e.jsx)(i.nd,{children:"Cost"}),(0,e.jsx)(i.nd,{children:"Actions"})]})}),(0,e.jsx)(i.BF,{children:Q?(0,e.jsx)(i.Hj,{children:(0,e.jsx)(i.nA,{colSpan:9,className:"text-center py-8",children:"Loading incident reports..."})}):X?.length===0?(0,e.jsx)(i.Hj,{children:(0,e.jsx)(i.nA,{colSpan:9,className:"text-center py-8",children:"No incident reports found"})}):X?.map(b=>(0,e.jsxs)(i.Hj,{children:[(0,e.jsx)(i.nA,{children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"font-medium",children:(a=>{let b=(0,s.H)(a);return(0,t.f)(b)?(0,u.GP)(b,"dd/MM/yyyy"):"Invalid Date"})(b.incident_date)}),(0,e.jsx)("div",{className:"text-sm text-muted-foreground",children:b.incident_time||"Time not specified"})]})}),(0,e.jsx)(i.nA,{children:(0,e.jsx)("span",{className:"font-mono text-xs text-muted-foreground",children:b.id?.replace(/[^a-zA-Z0-9]/g,"").slice(0,8).toUpperCase()})}),(0,e.jsx)(i.nA,{children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"font-medium",children:b.vehicle?`${b.vehicle.make} ${b.vehicle.model}`:"Unknown Vehicle"}),(0,e.jsx)("div",{className:"text-sm text-muted-foreground",children:b.vehicle?.registration})]})}),(0,e.jsx)(i.nA,{children:(a=>{let b={accident:"bg-red-100 text-red-800",theft:"bg-purple-100 text-purple-800",vandalism:"bg-orange-100 text-orange-800",breakdown:"bg-blue-100 text-blue-800",traffic_violation:"bg-yellow-100 text-yellow-800",other:"bg-gray-100 text-gray-800"};return(0,e.jsx)(k.E,{className:`${b[a]} hover:${b[a]}`,children:{accident:"Accident",theft:"Theft",vandalism:"Vandalism",breakdown:"Breakdown",traffic_violation:"Traffic Violation",other:"Other"}[a]||a})})(b.incident_type)}),(0,e.jsx)(i.nA,{children:(a=>{switch(a){case"minor":return(0,e.jsx)(k.E,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Minor"});case"moderate":return(0,e.jsx)(k.E,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Moderate"});case"severe":return(0,e.jsx)(k.E,{className:"bg-orange-100 text-orange-800 hover:bg-orange-100",children:"Severe"});case"critical":return(0,e.jsx)(k.E,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"Critical"});default:return(0,e.jsx)(k.E,{variant:"secondary",children:a})}})(b.severity)}),(0,e.jsx)(i.nA,{children:(a=>{switch(a){case"reported":return(0,e.jsx)(k.E,{className:"bg-blue-100 text-blue-800 hover:bg-blue-100",children:"Reported"});case"investigating":return(0,e.jsx)(k.E,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Investigating"});case"resolved":return(0,e.jsx)(k.E,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Resolved"});case"closed":return(0,e.jsx)(k.E,{className:"bg-gray-100 text-gray-800 hover:bg-gray-100",children:"Closed"});default:return(0,e.jsx)(k.E,{variant:"secondary",children:a})}})(b.status)}),(0,e.jsx)(i.nA,{children:(0,e.jsxs)("div",{className:"flex items-center gap-1",children:[(0,e.jsx)(j.sDd,{className:"h-3 w-3 text-muted-foreground"}),(0,e.jsx)("span",{className:"text-sm",children:b.location})]})}),(0,e.jsx)(i.nA,{children:(0,e.jsx)("div",{className:"text-sm",children:b.actual_repair_cost?(0,e.jsxs)("span",{className:"font-medium",children:["$",b.actual_repair_cost.toLocaleString()]}):b.estimated_damage_cost?(0,e.jsxs)("span",{className:"text-muted-foreground",children:["~$",b.estimated_damage_cost.toLocaleString()]}):(0,e.jsx)("span",{className:"text-muted-foreground",children:"Not assessed"})})}),(0,e.jsx)(i.nA,{children:(0,e.jsxs)(p.rI,{children:[(0,e.jsx)(p.ty,{asChild:!0,children:(0,e.jsx)(h.$,{variant:"ghost",className:"h-8 w-8 p-0",children:(0,e.jsx)(j.GvN,{className:"h-4 w-4"})})}),(0,e.jsxs)(p.SQ,{align:"end",children:[(0,e.jsxs)(p._2,{onClick:()=>{C(b),A(!0)},children:[(0,e.jsx)(j.kU3,{className:"mr-2 h-4 w-4"}),"View Details"]}),(0,e.jsxs)(p._2,{onClick:()=>{C(b),d(!0)},children:[(0,e.jsx)(j.ffu,{className:"mr-2 h-4 w-4"}),"Edit"]}),(0,e.jsxs)(p._2,{onClick:async()=>{try{let c={...b,driver:b.driver?{name:b.driver.name,license_number:b.driver.license_number}:void 0,vehicle:b.vehicle?{make:b.vehicle.make,model:b.vehicle.model,registration:b.vehicle.registration}:void 0};try{let{data:a}=await r.N.from("vehicle_incident_images").select("image_url, name").eq("incident_id",b.id);if(a&&a.length>0)c.photos=a.map(a=>({url:a.image_url,name:a.name??void 0}));else{let a=await r.N.storage.from("images").list(`incidents/${b.id}`,{limit:50});a.data&&a.data.length>0&&(c.photos=a.data.filter(a=>!a.name.startsWith(".")).map(a=>{let{data:c}=r.N.storage.from("images").getPublicUrl(`incidents/${b.id}/${a.name}`);return{url:c.publicUrl,name:a.name}}))}}catch(a){}await (0,y.A)(c,{logoUrl:window.location.origin+"/images/Koormatics-logo.png"}),a({title:"PDF exported successfully",description:"Incident report has been exported to PDF."})}catch(b){console.error("Error exporting PDF:",b),a({title:"Export failed",description:"Failed to export incident report to PDF. Please try again.",variant:"destructive"})}},children:[(0,e.jsx)(j.f5X,{className:"mr-2 h-4 w-4"}),"Export PDF"]}),(0,e.jsxs)(p._2,{onClick:()=>{var a;return a=b.id,void(confirm("Are you sure you want to delete this incident report?")&&Y.mutate(a))},className:"text-red-600",children:[(0,e.jsx)(j.TBR,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})})]},b.id))})]})})})}),V>1&&(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(h.$,{variant:"outline",size:"sm",onClick:()=>U(Math.max(1,T-1)),disabled:1===T,className:"h-8 px-3",children:"Previous"}),(0,e.jsx)("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,V)},(a,b)=>{let c=b+1;return V<=5||1===c||c===V||c>=T-1&&c<=T+1?(0,e.jsx)(h.$,{variant:T===c?"default":"outline",size:"sm",onClick:()=>U(c),className:"h-8 w-8 p-0",children:c},c):c===T-2||c===T+2?(0,e.jsx)("span",{className:"px-2 text-muted-foreground",children:"..."},c):null})}),(0,e.jsx)(h.$,{variant:"outline",size:"sm",onClick:()=>U(Math.min(V,T+1)),disabled:T===V,className:"h-8 px-3",children:"Next"})]}),(0,e.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,e.jsx)("span",{children:"•"}),(0,e.jsxs)("span",{children:["Last updated: ",new Date().toLocaleTimeString()]})]})]}),(0,e.jsx)(o.lG,{open:c,onOpenChange:d,children:(0,e.jsxs)(o.Cf,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,e.jsxs)(o.c7,{children:[(0,e.jsx)(o.L3,{children:B?"Edit Incident Report":"New Incident Report"}),(0,e.jsx)(o.rr,{children:B?"Update the incident report details and status.":"Create a new incident report for vehicle-related incidents."})]}),(0,e.jsx)(w.r,{report:B,onSuccess:()=>{d(!1),C(null),b.invalidateQueries({queryKey:["vehicle-incident-reports"]})},onCancel:()=>{d(!1),C(null)}})]})}),(0,e.jsx)(x.$,{report:B,open:z,onOpenChange:A})]})})}[g,h,i,k,l,m,n,o,p,v,w,x,y]=z.then?(await z)():z,d()}catch(a){d(a)}})},73436:a=>{a.exports=import("react-dropzone")},75634:a=>{a.exports=require("qrcode")},75979:a=>{a.exports=import("tailwind-merge")},80661:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{B:()=>p});var e=c(8732),f=c(82015),g=c(73436),h=c(39655),i=c(66345),j=c(4720),k=c(74952),l=c(38661),m=c(76569),n=c(87092),o=a([g,h,i,j,l,n]);function p({value:a,onChange:b,maxImages:c=10,maxFileSize:d=5,className:o}){let{toast:p}=(0,m.dj)(),[q,r]=(0,f.useState)(null),s=(0,f.useCallback)((d,e)=>{if(e.length>0){let a=e.map(a=>a.errors[0]?.message).join(", ");p({title:"Some files were rejected",description:a,variant:"destructive"})}if(a.length+d.length>c)return void p({title:"Too many images",description:`Maximum ${c} images allowed. ${c-a.length} slots remaining.`,variant:"destructive"});let f=d.map(a=>({id:`${Date.now()}-${Math.random().toString(36).substr(2,9)}`,file:a,preview:URL.createObjectURL(a),name:a.name,size:a.size,type:a.type}));b([...a,...f]),f.length>0&&p({title:"Images uploaded",description:`${f.length} image(s) added successfully.`})},[a,b,c,p]),{getRootProps:t,getInputProps:u,isDragActive:v}=(0,g.useDropzone)({onDrop:s,accept:{"image/*":[".jpeg",".jpg",".png",".gif",".bmp",".webp"]},maxSize:1024*d*1024,disabled:a.length>=c}),w=c=>{let d=a.find(a=>a.id===c);d&&(URL.revokeObjectURL(d.preview),b(a.filter(a=>a.id!==c)),p({title:"Image removed",description:"Image has been removed from the incident report."}))},x=a=>{let b=document.createElement("a");b.href=a.preview,b.download=a.name,document.body.appendChild(b),b.click(),document.body.removeChild(b)},y=a=>{if(0===a)return"0 Bytes";let b=Math.floor(Math.log(a)/Math.log(1024));return parseFloat((a/Math.pow(1024,b)).toFixed(2))+" "+["Bytes","KB","MB","GB"][b]},z=()=>{r(null)},A=a.length>=c;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(h.Zp,{className:o,children:[(0,e.jsx)(h.aR,{className:"pb-4",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)(h.ZB,{className:"flex items-center gap-2",children:[(0,e.jsx)(k.i7d,{className:"h-5 w-5"}),"Incident Photos"]}),(0,e.jsxs)(j.E,{variant:"outline",children:[a.length,"/",c," images"]})]})}),(0,e.jsxs)(h.Wu,{className:"space-y-4",children:[(0,e.jsxs)("div",{...t(),className:(0,n.cn)("border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors",v?"border-primary bg-primary/5":"border-gray-300 hover:border-gray-400",A&&"opacity-50 cursor-not-allowed"),children:[(0,e.jsx)("input",{...u(),disabled:A}),(0,e.jsx)("div",{className:"flex flex-col items-center gap-2",children:v?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(k._OO,{className:"h-10 w-10 text-primary"}),(0,e.jsx)("p",{className:"text-sm font-medium text-primary",children:"Drop images here..."})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(k.xfq,{className:"h-10 w-10 text-gray-400"}),(0,e.jsx)("p",{className:"text-sm font-medium text-gray-700",children:A?"Maximum images reached":"Drop images here or click to upload"}),(0,e.jsxs)("p",{className:"text-xs text-gray-500",children:["PNG, JPG, GIF up to ",d,"MB each"]})]})})]}),(0,e.jsxs)("div",{className:"flex items-start gap-2 p-3 bg-yellow-50 rounded-lg",children:[(0,e.jsx)(k.RIJ,{className:"h-4 w-4 text-yellow-600 mt-0.5"}),(0,e.jsxs)("div",{className:"text-sm text-yellow-800",children:[(0,e.jsx)("p",{className:"font-medium mb-1",children:"Photo Guidelines:"}),(0,e.jsxs)("ul",{className:"text-xs space-y-1",children:[(0,e.jsx)("li",{children:"• Take photos from multiple angles"}),(0,e.jsx)("li",{children:"• Include close-ups of damage details"}),(0,e.jsx)("li",{children:"• Capture the overall scene and surroundings"}),(0,e.jsx)("li",{children:"• Include photos of other vehicles if involved"}),(0,e.jsx)("li",{children:"• Document any relevant road signs or conditions"})]})]})]}),a.length>0&&(0,e.jsxs)("div",{className:"space-y-3",children:[(0,e.jsxs)("h4",{className:"text-sm font-medium",children:["Uploaded Images (",a.length,")"]}),(0,e.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4",children:a.map(a=>(0,e.jsxs)("div",{className:"relative group border rounded-lg overflow-hidden bg-gray-50",children:[(0,e.jsxs)("div",{className:"aspect-square relative",children:[(0,e.jsx)("img",{src:a.preview,alt:a.name,className:"w-full h-full object-cover"}),(0,e.jsxs)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-50 transition-all duration-200 flex items-center justify-center gap-2",children:[(0,e.jsx)(i.$,{type:"button",size:"sm",variant:"secondary",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>{r(a)},children:(0,e.jsx)(k.kU3,{className:"h-4 w-4"})}),(0,e.jsx)(i.$,{type:"button",size:"sm",variant:"secondary",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>x(a),children:(0,e.jsx)(k.f5X,{className:"h-4 w-4"})}),(0,e.jsx)(i.$,{type:"button",size:"sm",variant:"destructive",className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>w(a.id),children:(0,e.jsx)(k.X,{className:"h-4 w-4"})})]})]}),(0,e.jsxs)("div",{className:"p-2",children:[(0,e.jsx)("p",{className:"text-xs font-medium truncate",title:a.name,children:a.name}),(0,e.jsx)("p",{className:"text-xs text-gray-500",children:y(a.size)})]})]},a.id))})]}),0===a.length&&(0,e.jsxs)("div",{className:"text-center py-8",children:[(0,e.jsx)(k.CA$,{className:"h-12 w-12 text-gray-300 mx-auto mb-3"}),(0,e.jsx)("p",{className:"text-sm text-gray-500",children:"No images uploaded yet"}),(0,e.jsx)("p",{className:"text-xs text-gray-400",children:"Add photos to document the incident details"})]})]})]}),(0,e.jsx)(l.lG,{open:!!q,onOpenChange:()=>z(),children:(0,e.jsxs)(l.Cf,{className:"max-w-4xl max-h-[90vh]",children:[(0,e.jsxs)(l.c7,{children:[(0,e.jsxs)(l.L3,{className:"flex items-center gap-2",children:[(0,e.jsx)(k.kU3,{className:"h-5 w-5"}),"Image Preview"]}),(0,e.jsxs)(l.rr,{children:[q?.name," -"," ",q&&y(q.size)]})]}),q&&(0,e.jsx)("div",{className:"flex justify-center",children:(0,e.jsx)("img",{src:q.preview,alt:q.name,className:"max-w-full max-h-[70vh] object-contain rounded-lg"})}),(0,e.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,e.jsxs)(i.$,{variant:"outline",onClick:()=>q&&x(q),children:[(0,e.jsx)(k.f5X,{className:"h-4 w-4 mr-2"}),"Download"]}),(0,e.jsxs)(i.$,{variant:"destructive",onClick:()=>{q&&(w(q.id),z())},children:[(0,e.jsx)(k.X,{className:"h-4 w-4 mr-2"}),"Remove"]})]})]})})]})}[g,h,i,j,l,n]=o.then?(await o)():o,d()}catch(a){d(a)}})},82015:a=>{a.exports=require("react")},83501:a=>{a.exports=import("jspdf-autotable")},85657:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{A:()=>r,p:()=>s});var e=c(65515),f=c.n(e),g=c(83501),h=c(11003),i=c(75634),j=c.n(i),k=a([g]);async function l(a){try{let b=await fetch(a,{cache:"no-store"}),c=await b.blob();return await new Promise((a,b)=>{let d=new FileReader;d.onload=()=>a(d.result),d.onerror=b,d.readAsDataURL(c)})}catch(a){return console.error("Error loading image:",a),""}}async function m(a){try{await new Promise(a=>setTimeout(a,0));let b=new Image;b.crossOrigin="anonymous",b.src=a,await b.decode();let c=document.createElement("canvas");c.width=b.naturalWidth,c.height=b.naturalHeight;let d=c.getContext("2d");if(!d)return"";return d.drawImage(b,0,0),c.toDataURL("image/png")}catch{return""}}function n(a){return null==a?"-":a?"Yes":"No"}function o(a){if(!a)return"-";try{let b=new Date(a);if(isNaN(b.getTime()))return a;return b.toISOString().slice(0,10)}catch{return a}}function p(a,b={}){if(null==a)return"-";let c=b.locale||"en-US",d=b.currency||"USD";try{return new Intl.NumberFormat(c,{style:"currency",currency:d,maximumFractionDigits:2}).format(a)}catch{return`$${a.toFixed(2)}`}}function q(a){let b=a.replace("#",""),c=parseInt(b.substring(0,2),16)||0,d=parseInt(b.substring(2,4),16)||0,e=parseInt(b.substring(4,6),16)||0;return[c,d,e]}async function r(a,b){let c,d=new(f())({unit:"pt",format:"a4"}),e=[46,74,135],i="#7AC943";d.setProperties({title:`Vehicle Incident Report ${(0,h.p)(a.id,8)}`,subject:"Vehicle Incident Report",author:b?.companyName||"Koormatics",keywords:"Incident, Vehicle, Report, Koormatics",creator:"Koormatics System"});let k=d.internal.pageSize.getWidth(),r=d.internal.pageSize.getHeight(),s=null;if(b?.logoUrl&&(s=await m(b.logoUrl)||await l(b.logoUrl)),d.setFillColor(255,255,255),d.rect(0,0,k,80,"F"),s)try{d.addImage(s,"PNG",40,22,160,42)}catch{try{d.addImage(s,"JPEG",40,22,160,42)}catch{}}d.setTextColor(e[0],e[1],e[2]),d.setFont("helvetica","bold"),d.setFontSize(18),d.text("Vehicle Incident Report",k-40,30,{align:"right"}),d.setFont("helvetica","normal"),d.setFontSize(10),d.text(b?.companyName||"Koormatics Fleet Management",k-40,48,{align:"right"}),b?.companyAddress&&d.text(b.companyAddress,k-40,64,{align:"right"}),d.setDrawColor(i),d.setFillColor(i),d.rect(40,76,k-80,2,"F");let t=100;(0,g.default)(d,{startY:t,styles:{fontSize:10,cellPadding:6},margin:{left:40,right:40},body:[["Incident ID",(0,h.p)(a.id,8),"Reported By",a.reported_by||"-"],["Date",o(a.incident_date),"Time",a.incident_time||"-"],["Vehicle",`${a.vehicle?.make||""} ${a.vehicle?.model||""}`.trim()||"-","Registration",a.vehicle?.registration||"-"],["Driver",a.driver?.name||"-","License",a.driver?.license_number||"-"],["Location",a.location||"-","",""]],showHead:"never",theme:"grid",columnStyles:{0:{fontStyle:"bold",cellWidth:120},1:{cellWidth:(k-80)/2-120},2:{fontStyle:"bold",cellWidth:120},3:{cellWidth:(k-80)/2-120}}}),t=d.lastAutoTable.finalY+16,(0,g.default)(d,{startY:t,head:[["Classification","Details"]],body:[["Type",(a.incident_type||"-").toString().toUpperCase()],["Severity",(a.severity||"-").toString().toUpperCase()],["Status",(a.status||"-").toString().toUpperCase()]],styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:e,textColor:[255,255,255]},theme:"grid",didParseCell:b=>{if("body"===b.section&&1===b.column.index){let c=b.row.raw?.[0];if("Severity"===c){let[c,d,e]=q(function(a){switch(a.toLowerCase()){case"minor":return"#28A745";case"moderate":return"#FFC107";case"severe":return"#FF6C37";case"critical":return"#DC3545";default:return"#6C757D"}}(a.severity||""));b.cell.styles.fillColor=[c,d,e],b.cell.styles.textColor=[255,255,255],b.cell.styles.fontStyle="bold"}if("Status"===c){let[c,d,e]=q(function(a){switch(a.toLowerCase()){case"reported":case"closed":default:return"#6C757D";case"investigating":return"#FFC107";case"resolved":return"#28A745"}}(a.status||""));b.cell.styles.fillColor=[c,d,e],b.cell.styles.textColor=[255,255,255],b.cell.styles.fontStyle="bold"}}},margin:{left:40,right:40}}),t=d.lastAutoTable.finalY+16,(0,g.default)(d,{startY:t,head:[["Incident Details","Status"]],body:[["Injuries Reported",n(a.injuries_reported)],["Third Party Involved",n(a.third_party_involved)],["Photos Attached",n(a.photos_attached)],["Follow-up Required",n(a.follow_up_required)],["Follow-up Date",o(a.follow_up_date)]],styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:e,textColor:[255,255,255]},theme:"striped",margin:{left:40,right:40}}),t=d.lastAutoTable.finalY+16;let u=[];void 0!==a.estimated_damage_cost&&u.push(["Estimated Damage Cost",p(a.estimated_damage_cost,{locale:b?.locale,currency:b?.currency})]),void 0!==a.actual_repair_cost&&u.push(["Actual Repair Cost",p(a.actual_repair_cost,{locale:b?.locale,currency:b?.currency})]),a.police_report_number&&u.push(["Police Report Number",a.police_report_number]),a.insurance_claim_number&&u.push(["Insurance Claim Number",a.insurance_claim_number]),u.length>0&&((0,g.default)(d,{startY:t,head:[["Financial & Reference Information","Details"]],body:u,styles:{fontSize:9,cellPadding:6},headStyles:{fillColor:e,textColor:[255,255,255]},theme:"grid",margin:{left:40,right:40}}),t=d.lastAutoTable.finalY+16),a.description&&((0,g.default)(d,{startY:t,head:[["Incident Description"]],body:[[a.description]],styles:{fontSize:10,cellPadding:8,valign:"top"},headStyles:{fillColor:e,textColor:[255,255,255],halign:"left"},columnStyles:{0:{cellWidth:k-80}},theme:"grid",margin:{left:40,right:40}}),t=d.lastAutoTable.finalY+16);let v=[];if(a.third_party_details&&v.push(["Third Party Details",a.third_party_details]),a.witness_details&&v.push(["Witness Details",a.witness_details]),a.notes&&v.push(["Additional Notes",a.notes]),v.length>0&&((0,g.default)(d,{startY:t,head:[["Additional Information","Details"]],body:v,styles:{fontSize:9,cellPadding:6,valign:"top"},headStyles:{fillColor:e,textColor:[255,255,255]},theme:"grid",margin:{left:40,right:40}}),t=d.lastAutoTable.finalY+16),a.photos&&a.photos.length>0){d.setTextColor(e[0],e[1],e[2]),d.setFont("helvetica","bold"),d.setFontSize(12),d.text("Evidence Photos",40,t),t+=10;let b=async a=>a?a.startsWith("data:")?a:await l(a):"",c=await Promise.all(a.photos.map(a=>b(a.url))),f=(k-80-16)/3,g=.75*f,h=g+12+6,i=d.internal.pageSize.getHeight()-120,j=a=>a.startsWith("data:image/png")?"PNG":"JPEG",m=0;for(let b=0;b<c.length;b++){let e=c[b];if(!e)continue;t+h>i&&(d.addPage(),t=36);let k=40+m*(f+8),l=t;try{d.addImage(e,j(e),k,l,f,g)}catch{}d.setFont("helvetica","normal"),d.setFontSize(8),d.setTextColor(60);let n=a.photos[b]?.name||`Photo ${b+1}`,o=n.length>40?n.slice(0,39)+"…":n;d.text(o,k,l+g+10,{maxWidth:f}),++m>=3&&(m=0,t+=h+8)}0!==m&&(t+=h+8)}if(b?.reportUrl)try{c=await j().toDataURL(b.reportUrl,{margin:0,width:96})}catch{}let w=r-96;if(c)try{d.addImage(c,"PNG",40,w-8,80,80),d.setFontSize(8),d.setTextColor(100),d.text("Scan for digital record",42,w+78)}catch{}let x=112*!!c,y=40+x,z=k-40-220;d.setDrawColor(e[0],e[1],e[2]),d.line(y,w,y+220,w),d.line(z,w,z+220,w),d.setFontSize(9),d.setTextColor(40),d.text("Reporter Signature",y+110,w+14,{align:"center"}),d.text("Manager Approval",z+110,w+14,{align:"center"}),b?.preparedBy&&d.text(`Prepared by: ${b.preparedBy}`,140,w+28);let A=d.getNumberOfPages();for(let a=1;a<=A;a++){d.setPage(a);let b=r-24;d.setFontSize(8),d.setTextColor(120),d.text(`Page ${a} of ${A} • Generated ${new Date().toISOString().slice(0,19).replace("T"," ")}`,k/2,b,{align:"center"})}let B=["incident-report",a.vehicle?.registration||"vehicle",o(a.incident_date)||"date",(0,h.p)(a.id,8)].filter(Boolean).join("-")+".pdf";d.save(B)}async function s(a){if(!a||0===a.length)throw Error("No incident reports available to export");let b=new(f())({orientation:"landscape",unit:"pt",format:"a4"}),c=[46,74,135],d=b.internal.pageSize.getWidth(),e=b.internal.pageSize.getHeight();b.setFillColor(c[0],c[1],c[2]),b.rect(0,0,d,72,"F"),b.setTextColor(255,255,255),b.setFont("helvetica","bold"),b.setFontSize(18),b.text("Incident Reports Summary",d/2,36,{align:"center"}),b.setFont("helvetica","normal"),b.setFontSize(12),b.text("Koormatics Fleet Management",d/2,56,{align:"center"}),b.setFillColor("#7AC943"),b.rect(36,72,d-72,2,"F");let h=96,i=a.length,j=a.filter(a=>"critical"===a.severity).length,k=a.filter(a=>"severe"===a.severity).length,l=a.reduce((a,b)=>a+(b.actual_repair_cost||0),0);(0,g.default)(b,{startY:h,styles:{fontSize:10,cellPadding:6},headStyles:{fillColor:c,textColor:[255,255,255]},body:[["Total Incidents",i.toString()],["Critical Incidents",j.toString()],["Severe Incidents",k.toString()],["Total Repair Cost",p(l)]],columns:[{header:"Metric",dataKey:"metric"},{header:"Value",dataKey:"value"}],theme:"grid"}),h=b.lastAutoTable.finalY+16;let m=a.map(a=>[o(a.incident_date),a.vehicle?`${a.vehicle.make||""} ${a.vehicle.model||""}`.trim():"N/A",(a.incident_type||"-").toString().toUpperCase(),(a.severity||"-").toString().toUpperCase(),(a.status||"-").toString().toUpperCase(),a.location.length>30?a.location.substring(0,30)+"...":a.location,a.estimated_damage_cost?p(a.estimated_damage_cost):"N/A",a.reported_by||"-"]);(0,g.default)(b,{head:[["Date","Vehicle","Type","Severity","Status","Location","Est. Cost","Reported By"]],body:m,startY:h,margin:{left:36,right:36},styles:{fontSize:8,cellPadding:{top:3,right:2,bottom:3,left:2},lineColor:[220,220,220],lineWidth:.1,textColor:[40,40,40],font:"helvetica",valign:"middle"},headStyles:{fillColor:c,textColor:[255,255,255],fontStyle:"bold",halign:"center",fontSize:9},columnStyles:{0:{cellWidth:60,halign:"center"},1:{cellWidth:100,halign:"left"},2:{cellWidth:60,halign:"center"},3:{cellWidth:60,halign:"center"},4:{cellWidth:70,halign:"center"},5:{cellWidth:130,halign:"left"},6:{cellWidth:70,halign:"right"},7:{cellWidth:90,halign:"left"}},alternateRowStyles:{fillColor:[248,249,250]}});let n=b.getNumberOfPages();for(let a=1;a<=n;a++){b.setPage(a);let c=e-24;b.setFontSize(8),b.setTextColor(120),b.text(`Page ${a} of ${n}`,d/2,c,{align:"center"})}let q=`incident-reports-summary-${new Date().toISOString().slice(0,10)}.pdf`;b.save(q)}g=(k.then?(await k)():k)[0],d()}catch(a){d(a)}})},86093:a=>{a.exports=require("react-day-picker")},89681:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{$:()=>q});var e=c(8732);c(82015);var f=c(28462),g=c(95965),h=c(38661),i=c(4720),j=c(39655),k=c(95148),l=c(74952),m=c(81575),n=c(72737),o=c(71913),p=a([f,h,i,j,k]);function q({report:a,open:b,onOpenChange:c}){let{data:d}=(0,f.useQuery)({queryKey:["incident-images",a?.id],enabled:!!a?.id,queryFn:async()=>{if(!a?.id)return[];let{data:b,error:c}=await g.N.from("vehicle_incident_images").select("image_url, name").eq("incident_id",a.id);if(c)throw c;return b||[]}});if(!a)return null;let p=a=>{let b=(0,m.H)(a);return(0,n.f)(b)?(0,o.GP)(b,"dd/MM/yyyy 'at' HH:mm"):"Invalid Date"};return(0,e.jsx)(h.lG,{open:b,onOpenChange:c,children:(0,e.jsxs)(h.Cf,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,e.jsxs)(h.c7,{children:[(0,e.jsxs)(h.L3,{className:"flex items-center gap-2",children:[(0,e.jsx)(l.hcu,{className:"h-5 w-5"}),"Incident Report Details"]}),(0,e.jsx)(h.rr,{children:"Comprehensive details of the vehicle incident report"})]}),(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)(j.Zp,{children:[(0,e.jsx)(j.aR,{className:"pb-4",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)(j.ZB,{className:"flex items-center gap-2",children:[(a=>{switch(a){case"minor":return(0,e.jsx)(l.rAV,{className:"h-4 w-4 text-green-600"});case"moderate":return(0,e.jsx)(l.RIJ,{className:"h-4 w-4 text-yellow-600"});case"severe":return(0,e.jsx)(l.hcu,{className:"h-4 w-4 text-orange-600"});case"critical":return(0,e.jsx)(l.Jpz,{className:"h-4 w-4 text-red-600"});default:return(0,e.jsx)(l.RIJ,{className:"h-4 w-4 text-gray-600"})}})(a.severity),"Incident Overview"]}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(a=>{let b={accident:"bg-red-100 text-red-800",theft:"bg-purple-100 text-purple-800",vandalism:"bg-orange-100 text-orange-800",breakdown:"bg-blue-100 text-blue-800",traffic_violation:"bg-yellow-100 text-yellow-800",other:"bg-gray-100 text-gray-800"};return(0,e.jsx)(i.E,{className:`${b[a]} hover:${b[a]}`,children:{accident:"Accident",theft:"Theft",vandalism:"Vandalism",breakdown:"Breakdown",traffic_violation:"Traffic Violation",other:"Other"}[a]||a})})(a.incident_type),(a=>{switch(a){case"minor":return(0,e.jsx)(i.E,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Minor"});case"moderate":return(0,e.jsx)(i.E,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Moderate"});case"severe":return(0,e.jsx)(i.E,{className:"bg-orange-100 text-orange-800 hover:bg-orange-100",children:"Severe"});case"critical":return(0,e.jsx)(i.E,{className:"bg-red-100 text-red-800 hover:bg-red-100",children:"Critical"});default:return(0,e.jsx)(i.E,{variant:"secondary",children:a})}})(a.severity),(a=>{switch(a){case"reported":return(0,e.jsx)(i.E,{className:"bg-blue-100 text-blue-800 hover:bg-blue-100",children:"Reported"});case"investigating":return(0,e.jsx)(i.E,{className:"bg-yellow-100 text-yellow-800 hover:bg-yellow-100",children:"Investigating"});case"resolved":return(0,e.jsx)(i.E,{className:"bg-green-100 text-green-800 hover:bg-green-100",children:"Resolved"});case"closed":return(0,e.jsx)(i.E,{className:"bg-gray-100 text-gray-800 hover:bg-gray-100",children:"Closed"});default:return(0,e.jsx)(i.E,{variant:"secondary",children:a})}})(a.status)]})]})}),(0,e.jsx)(j.Wu,{children:(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(l.VvS,{className:"h-4 w-4 text-muted-foreground"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium",children:"Date"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:(a=>{let b=(0,m.H)(a);return(0,n.f)(b)?(0,o.GP)(b,"dd/MM/yyyy"):"Invalid Date"})(a.incident_date)})]})]}),a.incident_time&&(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(l.zD7,{className:"h-4 w-4 text-muted-foreground"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium",children:"Time"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:a.incident_time})]})]}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(l.sDd,{className:"h-4 w-4 text-muted-foreground"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium",children:"Location"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:a.location})]})]}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(l.KJW,{className:"h-4 w-4 text-muted-foreground"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium",children:"Reported By"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:a.reported_by})]})]})]})})]}),(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,e.jsxs)(j.Zp,{children:[(0,e.jsx)(j.aR,{className:"pb-4",children:(0,e.jsxs)(j.ZB,{className:"flex items-center gap-2",children:[(0,e.jsx)(l.THT,{className:"h-5 w-5"}),"Vehicle Information"]})}),(0,e.jsx)(j.Wu,{children:a.vehicle?(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium",children:"Vehicle"}),(0,e.jsxs)("p",{className:"text-sm text-muted-foreground",children:[a.vehicle.make," ",a.vehicle.model]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium",children:"Registration"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:a.vehicle.registration})]})]}):(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:"Vehicle information not available"})})]}),(0,e.jsxs)(j.Zp,{children:[(0,e.jsx)(j.aR,{className:"pb-4",children:(0,e.jsxs)(j.ZB,{className:"flex items-center gap-2",children:[(0,e.jsx)(l.KJW,{className:"h-5 w-5"}),"Driver Information"]})}),(0,e.jsx)(j.Wu,{children:a.driver?(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium",children:"Driver Name"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:a.driver.name})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium",children:"License Number"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:a.driver.license_number})]})]}):(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:"No driver specified"})})]})]}),(0,e.jsxs)(j.Zp,{children:[(0,e.jsx)(j.aR,{className:"pb-4",children:(0,e.jsxs)(j.ZB,{className:"flex items-center gap-2",children:[(0,e.jsx)(l.iUU,{className:"h-5 w-5"}),"Incident Description"]})}),(0,e.jsx)(j.Wu,{children:(0,e.jsx)("p",{className:"text-sm leading-relaxed",children:a.description})})]}),(0,e.jsxs)(j.Zp,{children:[(0,e.jsx)(j.aR,{className:"pb-4",children:(0,e.jsxs)(j.ZB,{className:"flex items-center gap-2",children:[(0,e.jsx)(l.G9t,{className:"h-5 w-5"}),"Financial Details"]})}),(0,e.jsx)(j.Wu,{children:(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium",children:"Estimated Damage Cost"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:a.estimated_damage_cost?`$${a.estimated_damage_cost.toLocaleString()}`:"Not assessed"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium",children:"Actual Repair Cost"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:a.actual_repair_cost?`$${a.actual_repair_cost.toLocaleString()}`:"Not available"})]})]})})]}),(0,e.jsxs)(j.Zp,{children:[(0,e.jsx)(j.aR,{className:"pb-4",children:(0,e.jsxs)(j.ZB,{className:"flex items-center gap-2",children:[(0,e.jsx)(l.ekZ,{className:"h-5 w-5"}),"Official Reports"]})}),(0,e.jsx)(j.Wu,{children:(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium",children:"Police Report Number"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:a.police_report_number||"Not available"})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium",children:"Insurance Claim Number"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:a.insurance_claim_number||"Not available"})]})]})})]}),(0,e.jsxs)(j.Zp,{children:[(0,e.jsx)(j.aR,{className:"pb-4",children:(0,e.jsxs)(j.ZB,{className:"flex items-center gap-2",children:[(0,e.jsx)(l.zWC,{className:"h-5 w-5"}),"Additional Information"]})}),(0,e.jsxs)(j.Wu,{className:"space-y-4",children:[(0,e.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("div",{className:`w-3 h-3 rounded-full ${a.injuries_reported?"bg-red-500":"bg-green-500"}`}),(0,e.jsx)("span",{className:"text-sm",children:a.injuries_reported?"Injuries Reported":"No Injuries"})]}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("div",{className:`w-3 h-3 rounded-full ${a.third_party_involved?"bg-yellow-500":"bg-green-500"}`}),(0,e.jsx)("span",{className:"text-sm",children:a.third_party_involved?"Third Party":"No Third Party"})]}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(l.i7d,{className:`w-4 h-4 ${a.photos_attached?"text-green-600":"text-gray-400"}`}),(0,e.jsx)("span",{className:"text-sm",children:a.photos_attached?"Photos Available":"No Photos"})]}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("div",{className:`w-3 h-3 rounded-full ${a.follow_up_required?"bg-orange-500":"bg-green-500"}`}),(0,e.jsx)("span",{className:"text-sm",children:a.follow_up_required?"Follow-up Required":"No Follow-up"})]})]}),a.third_party_involved&&a.third_party_details&&(0,e.jsxs)("div",{children:[(0,e.jsx)(k.w,{className:"my-4"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium mb-2",children:"Third Party Details"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:a.third_party_details})]})]}),a.witness_details&&(0,e.jsxs)("div",{children:[(0,e.jsx)(k.w,{className:"my-4"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium mb-2",children:"Witness Information"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:a.witness_details})]})]}),a.follow_up_required&&a.follow_up_date&&(0,e.jsxs)("div",{children:[(0,e.jsx)(k.w,{className:"my-4"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium",children:"Follow-up Date"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:(a=>{let b=(0,m.H)(a);return(0,n.f)(b)?(0,o.GP)(b,"EEEE, MMMM do, yyyy"):"Invalid Date"})(a.follow_up_date)})]})]}),a.notes&&(0,e.jsxs)("div",{children:[(0,e.jsx)(k.w,{className:"my-4"}),(0,e.jsxs)("div",{children:[(0,e.jsx)("p",{className:"text-sm font-medium mb-2",children:"Additional Notes"}),(0,e.jsx)("p",{className:"text-sm text-muted-foreground leading-relaxed",children:a.notes})]})]})]})]}),d&&d.length>0&&(0,e.jsxs)(j.Zp,{children:[(0,e.jsx)(j.aR,{className:"pb-4",children:(0,e.jsxs)(j.ZB,{className:"flex items-center gap-2",children:[(0,e.jsx)(l.i7d,{className:"h-5 w-5"}),"Incident Photos"]})}),(0,e.jsx)(j.Wu,{children:(0,e.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3",children:d.map((a,b)=>(0,e.jsxs)("div",{className:"border rounded-lg overflow-hidden",children:[(0,e.jsx)("div",{className:"aspect-square bg-muted",children:(0,e.jsx)("img",{src:a.image_url,alt:a.name||`Photo ${b+1}`,className:"w-full h-full object-cover"})}),a.name&&(0,e.jsx)("div",{className:"px-2 py-1 text-xs text-muted-foreground truncate",children:a.name})]},b))})})]}),(0,e.jsx)(j.Zp,{children:(0,e.jsx)(j.Wu,{className:"pt-6",children:(0,e.jsxs)("div",{className:"flex justify-between items-center text-xs text-muted-foreground",children:[(0,e.jsxs)("span",{children:["Created: ",p(a.created_at)]}),(0,e.jsxs)("span",{children:["Updated: ",p(a.updated_at)]})]})})})]})]})})}[f,h,i,j,k]=p.then?(await p)():p,d()}catch(a){d(a)}})},93939:a=>{a.exports=require("@supabase/supabase-js")},95148:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{w:()=>j});var e=c(8732),f=c(82015),g=c(38827),h=c(87092),i=a([g,h]);[g,h]=i.then?(await i)():i;let j=f.forwardRef(({className:a,orientation:b="horizontal",decorative:c=!0,...d},f)=>(0,e.jsx)(g.Root,{ref:f,decorative:c,orientation:b,className:(0,h.cn)("shrink-0 bg-border","horizontal"===b?"h-[1px] w-full":"h-full w-[1px]",a),...d}));j.displayName=g.Root.displayName,d()}catch(a){d(a)}})},98825:a=>{a.exports=import("@hookform/resolvers/zod")}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[4952,5611,5781,1913,4780,5833,8224],()=>b(b.s=7327));module.exports=c})();