"use strict";(()=>{var a={};a.id=7593,a.ids=[636,3220,7593],a.modules={4720:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{E:()=>i});var e=c(8732);c(82015);var f=c(8938),g=c(87092),h=a([f,g]);[f,g]=h.then?(await h)():h;let j=(0,f.cva)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function i({className:a,variant:b,...c}){return(0,e.jsx)("div",{className:(0,g.cn)(j({variant:b}),a),...c})}d()}catch(a){d(a)}})},8732:a=>{a.exports=require("react/jsx-runtime")},8938:a=>{a.exports=import("class-variance-authority")},9640:a=>{a.exports=import("@radix-ui/react-slot")},13020:a=>{a.exports=import("@radix-ui/react-dialog")},13856:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{f:()=>D});var e=c(8732),f=c(82015),g=c(28462),h=c(38661),i=c(66345),j=c(76569),k=c(74952),l=c(78059),m=c(87967),n=c(56884),o=c(52307),p=c(57049),q=c(95965),r=c(42971),s=c(98825),t=c(71913),u=c(21839),v=c(85072),w=c(40273),x=c(48578),y=c(39655),z=c(95148),A=c(4720),B=c(54269),C=a([g,h,i,l,m,n,o,p,r,s,v,w,x,y,z,A,B]);[g,h,i,l,m,n,o,p,r,s,v,w,x,y,z,A,B]=C.then?(await C)():C;let E=r.z.object({client_id:r.z.string({required_error:"Please select a client"}).min(1,"Client is required"),date:r.z.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Invalid date format"),valid_until:r.z.string().regex(/^\d{4}-\d{2}-\d{2}$/,"Invalid date format"),notes:r.z.string().optional(),status:r.z.enum(["draft","sent","approved","rejected","expired"]),items:r.z.array(r.z.object({description:r.z.string().min(1,"Description is required").max(200,"Description too long"),quantity:r.z.number().min(1,"Quantity must be at least 1").max(9999,"Quantity too large"),unit_price:r.z.number().min(0,"Price must be 0 or higher").max(999999,"Price too large"),amount:r.z.number()})).min(1,"At least one item is required").max(50,"Too many items (max 50)"),vat_percentage:r.z.number().min(0).max(100).optional(),discount_percentage:r.z.number().min(0).max(100).optional()}).refine(a=>{let b=new Date(a.valid_until),c=new Date(a.date);return b>=c},{message:"Valid until date must be after or equal to the quotation date",path:["valid_until"]});function D({open:a,onOpenChange:b,quotation:c,clients:d}){let{toast:r}=(0,j.dj)(),C=(0,g.useQueryClient)(),[D,F]=(0,f.useState)(!1),[G,H]=(0,f.useState)(!1),[I,J]=(0,f.useState)(0),[K,L]=(0,f.useState)(null),M=(0,t.GP)(new Date,"yyyy-MM-dd"),N=(0,t.GP)((0,u.f)(new Date,30),"yyyy-MM-dd"),O=(0,n.useForm)({resolver:(0,s.zodResolver)(E),defaultValues:c?{client_id:c.client_id,date:c.date,valid_until:c.valid_until,notes:c.notes||"",status:c.status,items:c.items.length>0?c.items:[{description:"",quantity:1,unit_price:0,amount:0}],vat_percentage:c.vat_percentage||void 0,discount_percentage:c.discount_percentage||void 0}:{client_id:"",date:M,valid_until:N,notes:"",status:"draft",items:[{description:"",quantity:1,unit_price:0,amount:0}],vat_percentage:void 0,discount_percentage:void 0}}),{fields:P,append:Q,remove:R}=(0,n.useFieldArray)({control:O.control,name:"items"});(0,f.useEffect)(()=>{let a=O.watch("client_id");if(a&&d){let b=d.find(b=>b.id===a);L(b||null)}else L(null)},[O.watch("client_id"),d]);let S=a=>{let b=O.getValues("items"),c=b[a].quantity||0,d=b[a].unit_price||0,e=c*d;return O.setValue(`items.${a}.amount`,e),e},T=O.watch("items"),U=T.reduce((a,b)=>a+(b.amount||0),0),V=G?.05*U:0,W=(I||0)/100*U,X=U+V-W,Y=async a=>{F(!0);try{if(a.items.some(a=>!a.description.trim()||a.quantity<=0))throw Error("Please ensure all items have descriptions and valid quantities.");let d={client_id:a.client_id,date:a.date,valid_until:a.valid_until,status:a.status,notes:a.notes?.trim()||null,total_amount:X,items:a.items,vat_percentage:G?5:null,discount_percentage:I>0?I:null};if(console.log("Submitting quotation with data:",d),c){let{error:a}=await q.N.from("quotations").update({client_id:d.client_id,date:d.date,valid_until:d.valid_until,status:d.status,notes:d.notes,total_amount:d.total_amount,items:d.items,vat_percentage:d.vat_percentage,discount_percentage:d.discount_percentage}).eq("id",c.id);if(a)throw console.error("Update error:",a),a;r({title:"Quotation updated",description:"The quotation has been updated successfully."})}else{let{error:a}=await q.N.from("quotations").insert([d]);if(a)throw console.error("Insert error:",a),a;r({title:"Quotation created",description:"A new quotation has been created successfully."})}b(!1),C.invalidateQueries({queryKey:["quotations"]})}catch(a){console.error("Error saving quotation:",a),r({title:"Error",description:a instanceof Error?a.message:"Failed to save quotation",variant:"destructive"})}finally{F(!1)}};return(0,e.jsx)(h.lG,{open:a,onOpenChange:b,children:(0,e.jsxs)(h.Cf,{className:"max-w-6xl max-h-[95vh] overflow-y-auto",children:[(0,e.jsx)(h.c7,{className:"pb-4",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)(h.L3,{className:"text-2xl",children:c?"Edit Quotation":"Create New Quotation"}),c&&(0,e.jsxs)("div",{className:"flex items-center gap-2 mt-2",children:[(0,e.jsx)(A.E,{variant:"outline",className:(a=>{switch(a){case"draft":default:return"bg-gray-100 text-gray-700";case"sent":return"bg-blue-100 text-blue-700";case"approved":return"bg-green-100 text-green-700";case"rejected":return"bg-red-100 text-red-700";case"expired":return"bg-yellow-100 text-yellow-700"}})(c.status),children:c.status.charAt(0).toUpperCase()+c.status.slice(1)}),(0,e.jsxs)("span",{className:"text-sm text-muted-foreground",children:["ID: ",c.id.substring(0,8).toUpperCase()]})]})]}),(0,e.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>b(!1),disabled:D,children:(0,e.jsx)(k.X,{className:"h-4 w-4"})})]})}),(0,e.jsx)(o.lV,{...O,children:(0,e.jsxs)("form",{onSubmit:O.handleSubmit(Y),className:"space-y-8",children:[(0,e.jsxs)(y.Zp,{children:[(0,e.jsxs)(y.aR,{children:[(0,e.jsx)(y.ZB,{className:"text-lg",children:"Basic Information"}),(0,e.jsx)(y.BT,{children:"Set up the fundamental details for this quotation"})]}),(0,e.jsxs)(y.Wu,{className:"space-y-4",children:[(0,e.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,e.jsx)(o.zB,{control:O.control,name:"client_id",render:({field:a})=>(0,e.jsxs)(o.eI,{children:[(0,e.jsx)(o.lR,{children:"Client *"}),(0,e.jsxs)(p.l6,{onValueChange:a.onChange,defaultValue:a.value,value:a.value,children:[(0,e.jsx)(o.MJ,{children:(0,e.jsx)(p.bq,{children:(0,e.jsx)(p.yv,{placeholder:"Select a client"})})}),(0,e.jsx)(p.gC,{children:d.map(a=>(0,e.jsx)(p.eb,{value:a.id,children:(0,e.jsxs)("div",{className:"flex items-center justify-between w-full",children:[(0,e.jsx)("span",{children:a.name}),a.email&&(0,e.jsx)("span",{className:"text-xs text-muted-foreground ml-2",children:a.email})]})},a.id))})]}),K&&(0,e.jsx)(o.Rr,{children:K.email&&`Email: ${K.email}`}),(0,e.jsx)(o.C5,{})]})}),(0,e.jsx)(o.zB,{control:O.control,name:"status",render:({field:a})=>(0,e.jsxs)(o.eI,{children:[(0,e.jsx)(o.lR,{children:"Status"}),(0,e.jsxs)(p.l6,{onValueChange:a.onChange,defaultValue:a.value,value:a.value,children:[(0,e.jsx)(o.MJ,{children:(0,e.jsx)(p.bq,{children:(0,e.jsx)(p.yv,{placeholder:"Select status"})})}),(0,e.jsxs)(p.gC,{children:[(0,e.jsx)(p.eb,{value:"draft",children:(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("div",{className:"w-2 h-2 rounded-full bg-gray-400"}),"Draft"]})}),(0,e.jsx)(p.eb,{value:"sent",children:(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("div",{className:"w-2 h-2 rounded-full bg-blue-400"}),"Sent"]})}),(0,e.jsx)(p.eb,{value:"approved",children:(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("div",{className:"w-2 h-2 rounded-full bg-green-400"}),"Approved"]})}),(0,e.jsx)(p.eb,{value:"rejected",children:(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("div",{className:"w-2 h-2 rounded-full bg-red-400"}),"Rejected"]})}),(0,e.jsx)(p.eb,{value:"expired",children:(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)("div",{className:"w-2 h-2 rounded-full bg-yellow-400"}),"Expired"]})})]})]}),(0,e.jsx)(o.C5,{})]})}),(0,e.jsx)(o.zB,{control:O.control,name:"date",render:({field:a})=>(0,e.jsxs)(o.eI,{children:[(0,e.jsx)(o.lR,{children:"Quotation Date *"}),(0,e.jsx)(o.MJ,{children:(0,e.jsx)(l.p,{type:"date",...a,onChange:b=>{a.onChange(b);var c=b.target.value;let d=new Date(c),e=(0,t.GP)((0,u.f)(d,30),"yyyy-MM-dd");O.setValue("valid_until",e)}})}),(0,e.jsx)(o.C5,{})]})}),(0,e.jsx)(o.zB,{control:O.control,name:"valid_until",render:({field:a})=>(0,e.jsxs)(o.eI,{children:[(0,e.jsx)(o.lR,{children:"Valid Until *"}),(0,e.jsx)(o.MJ,{children:(0,e.jsx)(l.p,{type:"date",...a})}),(0,e.jsx)(o.Rr,{children:"Automatically set to 30 days from quotation date"}),(0,e.jsx)(o.C5,{})]})})]}),(0,e.jsx)(o.zB,{control:O.control,name:"notes",render:({field:a})=>(0,e.jsxs)(o.eI,{children:[(0,e.jsx)(o.lR,{children:"Notes & Terms"}),(0,e.jsx)(o.MJ,{children:(0,e.jsx)(m.T,{placeholder:"Add any additional notes, terms, or conditions...",className:"resize-none min-h-[100px]",...a})}),(0,e.jsx)(o.Rr,{children:"These notes will appear on the quotation document"}),(0,e.jsx)(o.C5,{})]})})]})]}),(0,e.jsxs)(y.Zp,{children:[(0,e.jsx)(y.aR,{children:(0,e.jsxs)("div",{className:"flex justify-between items-center",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)(y.ZB,{className:"text-lg",children:"Quotation Items"}),(0,e.jsx)(y.BT,{children:"Add items and services for this quotation"})]}),(0,e.jsxs)(i.$,{type:"button",variant:"outline",size:"sm",onClick:()=>{Q({description:"",quantity:1,unit_price:0,amount:0})},disabled:P.length>=50,children:[(0,e.jsx)(k.FWt,{className:"h-4 w-4 mr-1"})," Add Item"]})]})}),(0,e.jsxs)(y.Wu,{children:[P.length>=50&&(0,e.jsxs)(B.Fc,{className:"mb-4",children:[(0,e.jsx)(k.R2D,{className:"h-4 w-4"}),(0,e.jsx)(B.TN,{children:"Maximum of 50 items allowed per quotation."})]}),(0,e.jsx)("div",{className:"space-y-4",children:P.map((a,b)=>(0,e.jsx)(y.Zp,{className:"relative",children:(0,e.jsx)(y.Wu,{className:"pt-4",children:(0,e.jsxs)("div",{className:"grid grid-cols-12 gap-4 items-start",children:[(0,e.jsx)("div",{className:"col-span-12 md:col-span-5",children:(0,e.jsx)(o.zB,{control:O.control,name:`items.${b}.description`,render:({field:a})=>(0,e.jsxs)(o.eI,{children:[(0,e.jsx)(o.lR,{className:"text-sm",children:"Description *"}),(0,e.jsx)(o.MJ,{children:(0,e.jsx)(m.T,{...a,placeholder:"Describe the item or service...",className:"resize-none min-h-[60px]"})}),(0,e.jsx)(o.C5,{})]})})}),(0,e.jsx)("div",{className:"col-span-4 md:col-span-2",children:(0,e.jsx)(o.zB,{control:O.control,name:`items.${b}.quantity`,render:({field:a})=>(0,e.jsxs)(o.eI,{children:[(0,e.jsx)(o.lR,{className:"text-sm",children:"Quantity *"}),(0,e.jsx)(o.MJ,{children:(0,e.jsx)(l.p,{type:"number",min:1,max:9999,...a,onChange:c=>{let d=parseInt(c.target.value||"1");a.onChange(d||1),S(b)},value:a.value})}),(0,e.jsx)(o.C5,{})]})})}),(0,e.jsx)("div",{className:"col-span-4 md:col-span-2",children:(0,e.jsx)(o.zB,{control:O.control,name:`items.${b}.unit_price`,render:({field:a})=>(0,e.jsxs)(o.eI,{children:[(0,e.jsx)(o.lR,{className:"text-sm",children:"Unit Price ($) *"}),(0,e.jsx)(o.MJ,{children:(0,e.jsx)(l.p,{type:"number",step:"0.01",min:0,max:999999,...a,onChange:c=>{let d=parseFloat(c.target.value||"0");a.onChange(d||0),S(b)},value:a.value})}),(0,e.jsx)(o.C5,{})]})})}),(0,e.jsx)("div",{className:"col-span-3 md:col-span-2",children:(0,e.jsx)(o.zB,{control:O.control,name:`items.${b}.amount`,render:({field:a})=>(0,e.jsxs)(o.eI,{children:[(0,e.jsx)(o.lR,{className:"text-sm",children:"Amount"}),(0,e.jsx)(o.MJ,{children:(0,e.jsxs)("div",{className:"relative",children:[(0,e.jsx)(l.p,{type:"text",value:(0,x.vv)(a.value),disabled:!0,className:"bg-muted font-medium"}),(0,e.jsx)(k.tEU,{className:"absolute right-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"})]})})]})})}),(0,e.jsx)("div",{className:"col-span-1 flex justify-end pt-8",children:(0,e.jsx)(i.$,{type:"button",variant:"ghost",size:"sm",onClick:()=>{P.length>1&&R(b)},disabled:P.length<=1,className:"text-red-600 hover:text-red-700 hover:bg-red-50",children:(0,e.jsx)(k.lMJ,{className:"h-4 w-4"})})})]})})},a.id))})]})]}),(0,e.jsxs)(y.Zp,{children:[(0,e.jsxs)(y.aR,{children:[(0,e.jsx)(y.ZB,{className:"text-lg",children:"Pricing & Totals"}),(0,e.jsx)(y.BT,{children:"Configure VAT, discounts, and review totals"})]}),(0,e.jsx)(y.Wu,{children:(0,e.jsxs)("div",{className:"flex flex-col lg:flex-row gap-6",children:[(0,e.jsxs)("div",{className:"flex-1 space-y-4",children:[(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)(v.S,{id:"vat",checked:G,onCheckedChange:a=>H(a)}),(0,e.jsx)(w.J,{htmlFor:"vat",className:"text-sm font-medium",children:"Apply VAT (5%)"})]}),(0,e.jsxs)("div",{className:"space-y-2",children:[(0,e.jsx)(w.J,{htmlFor:"discount",className:"text-sm font-medium",children:"Discount Percentage"}),(0,e.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,e.jsx)(l.p,{id:"discount",type:"number",min:0,max:100,step:.1,value:I||"",onChange:a=>J(parseFloat(a.target.value)||0),className:"w-24",placeholder:"0"}),(0,e.jsx)("span",{className:"text-sm text-muted-foreground",children:"%"})]})]})]}),(0,e.jsx)("div",{className:"lg:w-80",children:(0,e.jsxs)(y.Zp,{children:[(0,e.jsx)(y.aR,{className:"pb-3",children:(0,e.jsx)(y.ZB,{className:"text-base",children:"Summary"})}),(0,e.jsxs)(y.Wu,{className:"space-y-3",children:[(0,e.jsxs)("div",{className:"flex justify-between text-sm",children:[(0,e.jsx)("span",{children:"Subtotal:"}),(0,e.jsx)("span",{className:"font-medium",children:(0,x.vv)(U)})]}),G&&(0,e.jsxs)("div",{className:"flex justify-between text-sm text-blue-600",children:[(0,e.jsx)("span",{children:"VAT (5%):"}),(0,e.jsxs)("span",{className:"font-medium",children:["+",(0,x.vv)(V)]})]}),I>0&&(0,e.jsxs)("div",{className:"flex justify-between text-sm text-green-600",children:[(0,e.jsxs)("span",{children:["Discount (",I,"%):"]}),(0,e.jsxs)("span",{className:"font-medium",children:["-",(0,x.vv)(W)]})]}),(0,e.jsx)(z.w,{}),(0,e.jsxs)("div",{className:"flex justify-between font-bold text-lg",children:[(0,e.jsx)("span",{children:"Total:"}),(0,e.jsx)("span",{className:"text-primary",children:(0,x.vv)(X)})]}),(0,e.jsxs)("div",{className:"text-xs text-muted-foreground",children:[T.length," item",1!==T.length?"s":""]})]})]})})]})})]}),(0,e.jsxs)("div",{className:"flex justify-end space-x-3 pt-6 border-t",children:[(0,e.jsx)(i.$,{type:"button",variant:"outline",onClick:()=>b(!1),disabled:D,children:"Cancel"}),(0,e.jsx)(i.$,{type:"submit",disabled:D||X<=0,children:D?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(k.krw,{className:"mr-2 h-4 w-4 animate-spin"}),"Saving..."]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(k.eMP,{className:"mr-2 h-4 w-4"}),c?"Update Quotation":"Create Quotation"]})})]})]})})]})})}d()}catch(a){d(a)}})},16235:a=>{a.exports=import("@radix-ui/react-toast")},20598:a=>{a.exports=import("@radix-ui/react-label")},24603:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>z});var e=c(8732),f=c(82015),g=c(28462),h=c(66345),i=c(48383),j=c(74952),k=c(71913),l=c(4720),m=c(78059),n=c(95965),o=c(76569),p=c(13856),q=c(90192),r=c(38661),s=c(95020),t=c(48578),u=c(28225),v=c(57049),w=c(39655),x=c(58894),y=a([g,h,i,l,m,p,q,r,s,t,u,v,w]);function z(){let{toast:a}=(0,o.dj)(),b=(0,g.useQueryClient)(),[c,d]=(0,f.useState)(""),[y,z]=(0,f.useState)("all"),[A,B]=(0,f.useState)("all"),[C,D]=(0,f.useState)(!1),[E,F]=(0,f.useState)(null),[G,H]=(0,f.useState)(null),[I,J]=(0,f.useState)(!1),[K,L]=(0,f.useState)(null),[M,N]=(0,f.useState)(!1),[O,P]=(0,f.useState)(!1),[Q,R]=(0,f.useState)("table"),[S,T]=(0,f.useState)(1),{data:U,isLoading:V,refetch:W}=(0,g.useQuery)({queryKey:["quotations"],queryFn:async()=>{let{data:a,error:b}=await n.N.from("quotations").select(`
          *,
          clients:client_id(name, email, address, phone)
        `).order("date",{ascending:!1});if(b)throw b;return a.map(a=>({id:a.id,date:a.date,client_id:a.client_id,client_name:a.clients?.name||"Unknown Client",client_email:a.clients?.email,client_address:a.clients?.address,client_phone:a.clients?.phone,status:a.status,total_amount:a.total_amount,valid_until:a.valid_until,notes:a.notes,items:a.items,created_at:a.created_at,updated_at:a.updated_at,vat_percentage:a.vat_percentage,discount_percentage:a.discount_percentage}))}}),{data:X}=(0,g.useQuery)({queryKey:["clients"],queryFn:async()=>{let{data:a,error:b}=await n.N.from("clients").select("id, name, email").order("name");if(b)throw b;return(0,x.wH)(a)}}),Y=(0,f.useMemo)(()=>{if(!U)return{total:0,draft:0,sent:0,approved:0,rejected:0,expired:0,totalValue:0,avgValue:0,pendingValue:0,approvedValue:0};let a=U.length,b=U.filter(a=>"draft"===a.status).length,c=U.filter(a=>"sent"===a.status).length,d=U.filter(a=>"approved"===a.status).length,e=U.filter(a=>"rejected"===a.status).length,f=U.filter(a=>"expired"===a.status).length,g=U.reduce((a,b)=>a+(b.total_amount||0),0),h=U.filter(a=>"sent"===a.status||"draft"===a.status).reduce((a,b)=>a+(b.total_amount||0),0),i=U.filter(a=>"approved"===a.status).reduce((a,b)=>a+(b.total_amount||0),0);return{total:a,draft:b,sent:c,approved:d,rejected:e,expired:f,totalValue:g,avgValue:a>0?g/a:0,pendingValue:h,approvedValue:i}},[U]),Z=(0,f.useMemo)(()=>{if(!U)return[];let a=U;return c&&(a=a.filter(a=>(a.client_name?.toLowerCase()||"").includes(c.toLowerCase())||(a.id?.toLowerCase()||"").includes(c.toLowerCase())||(a.notes?.toLowerCase()||"").includes(c.toLowerCase()))),"all"!==y&&(a=a.filter(a=>a.status===y)),"all"!==A&&(a=a.filter(a=>a.client_id===A)),a},[U,c,y,A]),$=Math.ceil(Z.length/20)||1,_=(S-1)*20,aa=_+20,ab=Z.slice(_,aa),ac=async()=>{P(!0),await W(),P(!1)},ad=(0,f.useCallback)(a=>{D(a),a||F(null)},[]),ae=(0,f.useCallback)(a=>{F(a),D(!0)},[]),af=(0,f.useCallback)(a=>{L(a)},[]),ag=(0,f.useCallback)(a=>{a||L(null)},[]),ah=(0,f.useCallback)(a=>{H(a),J(!0)},[]),ai=async()=>{if(G&&G.id)try{let{error:c}=await n.N.from("quotations").delete().eq("id",G.id);if(c)throw c;a({title:"Quotation deleted",description:"The quotation has been deleted successfully."}),b.invalidateQueries({queryKey:["quotations"]})}catch(b){console.error("Error deleting quotation:",b),a({title:"Error",description:"Failed to delete the quotation.",variant:"destructive"})}finally{J(!1),H(null)}},aj=async a=>{a&&(N(!0),await (0,u.a)(a)&&(b.invalidateQueries({queryKey:["quotations"]}),L(null)),N(!1))},ak=async c=>{try{let d={client_id:c.client_id,date:new Date().toISOString().split("T")[0],status:"draft",total_amount:c.total_amount,valid_until:new Date(new Date().setDate(new Date().getDate()+30)).toISOString().split("T")[0],notes:c.notes,items:c.items},{error:e}=await n.N.from("quotations").insert([d]);if(e)throw e;a({title:"Quotation duplicated",description:"A new draft quotation has been created."}),b.invalidateQueries({queryKey:["quotations"]})}catch(b){console.error("Error duplicating quotation:",b),a({title:"Error",description:"Failed to duplicate the quotation.",variant:"destructive"})}},al=a=>{if(!a)return"bg-gray-100 text-gray-700";switch(a){case"draft":default:return"bg-gray-100 text-gray-700";case"sent":return"bg-blue-100 text-blue-700";case"approved":return"bg-green-100 text-green-700";case"rejected":return"bg-red-100 text-red-700";case"expired":return"bg-yellow-100 text-yellow-700"}},am=a=>{switch(a){case"draft":return(0,e.jsx)(j.ffu,{className:"h-3 w-3"});case"sent":return(0,e.jsx)(j.Vnp,{className:"h-3 w-3"});case"approved":return(0,e.jsx)(j.rAV,{className:"h-3 w-3"});case"rejected":return(0,e.jsx)(j.Jpz,{className:"h-3 w-3"});case"expired":return(0,e.jsx)(j.RIJ,{className:"h-3 w-3"});default:return(0,e.jsx)(j.zD7,{className:"h-3 w-3"})}},an=a=>{if(!a)return"UNKNOWN";try{return a.substring(0,8).toUpperCase()}catch(a){return console.error("Error formatting ID:",a),"UNKNOWN"}},ao=a=>{if(!a)return"Unknown date";try{return(0,k.GP)(new Date(a),"MMM d, yyyy")}catch(a){return console.error("Error formatting date:",a),"Invalid date"}};return V?(0,e.jsx)("div",{className:"min-h-screen bg-background",children:(0,e.jsxs)("div",{className:"p-4 px-6 space-y-6",children:[(0,e.jsx)("div",{className:"border-b border-border pb-4 pt-4",children:(0,e.jsx)("div",{children:(0,e.jsx)("h1",{className:"text-2xl font-semibold text-foreground",children:"Quotations"})})}),(0,e.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[void 0,void 0,void 0,void 0].map((a,b)=>(0,e.jsxs)(w.Zp,{children:[(0,e.jsxs)(w.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(w.ZB,{className:"text-sm font-medium",children:(0,e.jsx)("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})}),(0,e.jsx)("div",{className:"h-4 w-4 bg-gray-200 rounded animate-pulse"})]}),(0,e.jsxs)(w.Wu,{children:[(0,e.jsx)("div",{className:"h-8 bg-gray-200 rounded animate-pulse mb-2"}),(0,e.jsx)("div",{className:"h-3 bg-gray-200 rounded animate-pulse"})]})]},b))})]})}):(0,e.jsx)("div",{className:"min-h-screen bg-background",children:(0,e.jsxs)("div",{className:"p-4 px-6 space-y-6",children:[(0,e.jsx)("div",{className:"border-b border-border pb-4 pt-4",children:(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsx)("div",{children:(0,e.jsx)("h1",{className:"text-2xl font-semibold text-foreground",children:"Quotations"})}),(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsxs)(h.$,{variant:"outline",size:"sm",onClick:ac,disabled:O,children:[(0,e.jsx)(j.e9t,{className:`mr-2 h-4 w-4 ${O?"animate-spin":""}`}),"Refresh"]}),(0,e.jsxs)(h.$,{onClick:()=>D(!0),children:[(0,e.jsx)(j.FWt,{className:"mr-2 h-4 w-4"}),"Create Quotation"]})]})]})}),(0,e.jsxs)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[(0,e.jsxs)(w.Zp,{children:[(0,e.jsxs)(w.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(w.ZB,{className:"text-sm font-medium",children:"Total Quotations"}),(0,e.jsx)(j.iUU,{className:"h-4 w-4 text-muted-foreground"})]}),(0,e.jsxs)(w.Wu,{children:[(0,e.jsx)("div",{className:"text-2xl font-bold",children:Y.total}),(0,e.jsxs)("p",{className:"text-xs text-muted-foreground",children:[Y.draft," draft, ",Y.sent," sent"]})]})]}),(0,e.jsxs)(w.Zp,{children:[(0,e.jsxs)(w.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(w.ZB,{className:"text-sm font-medium",children:"Total Value"}),(0,e.jsx)(j.G9t,{className:"h-4 w-4 text-muted-foreground"})]}),(0,e.jsxs)(w.Wu,{children:[(0,e.jsx)("div",{className:"text-2xl font-bold",children:(0,t.vv)(Y.totalValue)}),(0,e.jsxs)("p",{className:"text-xs text-muted-foreground",children:["Avg: ",(0,t.vv)(Y.avgValue)]})]})]}),(0,e.jsxs)(w.Zp,{children:[(0,e.jsxs)(w.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(w.ZB,{className:"text-sm font-medium",children:"Pending Value"}),(0,e.jsx)(j.zD7,{className:"h-4 w-4 text-muted-foreground"})]}),(0,e.jsxs)(w.Wu,{children:[(0,e.jsx)("div",{className:"text-2xl font-bold",children:(0,t.vv)(Y.pendingValue)}),(0,e.jsxs)("p",{className:"text-xs text-muted-foreground",children:[Y.draft+Y.sent," quotations"]})]})]}),(0,e.jsxs)(w.Zp,{children:[(0,e.jsxs)(w.aR,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,e.jsx)(w.ZB,{className:"text-sm font-medium",children:"Approved Value"}),(0,e.jsx)(j.ntg,{className:"h-4 w-4 text-muted-foreground"})]}),(0,e.jsxs)(w.Wu,{children:[(0,e.jsx)("div",{className:"text-2xl font-bold text-green-600",children:(0,t.vv)(Y.approvedValue)}),(0,e.jsxs)("p",{className:"text-xs text-muted-foreground",children:[Y.approved," approved"]})]})]})]}),(0,e.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,e.jsxs)("div",{className:"relative flex-1",children:[(0,e.jsx)(j.vji,{className:"absolute left-3 top-3 h-4 w-4 text-muted-foreground"}),(0,e.jsx)(m.p,{placeholder:"Search quotations by client, ID, or notes...",value:c,onChange:a=>d(a.target.value),className:"pl-9"})]}),(0,e.jsxs)(v.l6,{value:y,onValueChange:a=>z(a),children:[(0,e.jsx)(v.bq,{className:"w-full sm:w-[180px]",children:(0,e.jsx)(v.yv,{placeholder:"Filter by status"})}),(0,e.jsxs)(v.gC,{children:[(0,e.jsx)(v.eb,{value:"all",children:"All Statuses"}),(0,e.jsx)(v.eb,{value:"draft",children:"Draft"}),(0,e.jsx)(v.eb,{value:"sent",children:"Sent"}),(0,e.jsx)(v.eb,{value:"approved",children:"Approved"}),(0,e.jsx)(v.eb,{value:"rejected",children:"Rejected"}),(0,e.jsx)(v.eb,{value:"expired",children:"Expired"})]})]}),(0,e.jsxs)(v.l6,{value:A,onValueChange:B,children:[(0,e.jsx)(v.bq,{className:"w-full sm:w-[180px]",children:(0,e.jsx)(v.yv,{placeholder:"Filter by client"})}),(0,e.jsxs)(v.gC,{children:[(0,e.jsx)(v.eb,{value:"all",children:"All Clients"}),X?.map(a=>(0,e.jsx)(v.eb,{value:a.id,children:a.name},a.id))]})]})]}),(0,e.jsx)("div",{className:"rounded-lg border",children:(0,e.jsxs)(i.XI,{children:[(0,e.jsx)(i.A0,{children:(0,e.jsxs)(i.Hj,{children:[(0,e.jsx)(i.nd,{children:"ID"}),(0,e.jsx)(i.nd,{children:"Date"}),(0,e.jsx)(i.nd,{children:"Client"}),(0,e.jsx)(i.nd,{children:"Status"}),(0,e.jsx)(i.nd,{children:"Amount"}),(0,e.jsx)(i.nd,{children:"Valid Until"}),(0,e.jsx)(i.nd,{children:"Actions"})]})}),(0,e.jsx)(i.BF,{children:0===ab.length?(0,e.jsx)(i.Hj,{children:(0,e.jsx)(i.nA,{colSpan:7,className:"text-center h-24 text-muted-foreground",children:c||"all"!==y||"all"!==A?"No quotations match your filters.":"No quotations found. Create your first quotation!"})}):ab.map(a=>(0,e.jsxs)(i.Hj,{className:"hover:bg-muted/50",children:[(0,e.jsx)(i.nA,{className:"font-medium",children:(0,e.jsx)("div",{className:"flex items-center gap-2",children:(0,e.jsx)("span",{className:"font-mono text-sm",children:an(a.id)})})}),(0,e.jsx)(i.nA,{children:ao(a.date)}),(0,e.jsx)(i.nA,{children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{className:"font-medium",children:a.client_name||"Unknown Client"}),a.client_email&&(0,e.jsx)("div",{className:"text-sm text-muted-foreground",children:a.client_email})]})}),(0,e.jsx)(i.nA,{children:(0,e.jsxs)(l.E,{variant:"outline",className:`${al(a.status)} flex items-center gap-1 w-fit`,children:[am(a.status),a.status?a.status.charAt(0).toUpperCase()+a.status.slice(1):"Unknown"]})}),(0,e.jsx)(i.nA,{children:(0,e.jsx)("div",{className:"font-medium",children:(0,t.vv)(a.total_amount||0)})}),(0,e.jsx)(i.nA,{children:(0,e.jsx)("div",{className:`${new Date(a.valid_until)<new Date?"text-red-600":""}`,children:ao(a.valid_until)})}),(0,e.jsx)(i.nA,{children:(0,e.jsxs)("div",{className:"flex items-center gap-1",children:[(0,e.jsx)(h.$,{variant:"ghost",size:"sm",onClick:()=>af(a),children:(0,e.jsx)(j.kU3,{className:"h-4 w-4"})}),(0,e.jsx)(h.$,{variant:"ghost",size:"sm",onClick:()=>ae(a),children:(0,e.jsx)(j.ffu,{className:"h-4 w-4"})}),(0,e.jsxs)(q.rI,{children:[(0,e.jsx)(q.ty,{asChild:!0,children:(0,e.jsx)(h.$,{variant:"ghost",size:"sm",children:(0,e.jsx)(j.a4,{className:"h-4 w-4"})})}),(0,e.jsxs)(q.SQ,{align:"end",children:[(0,e.jsx)(q.lp,{children:"Actions"}),(0,e.jsxs)(q._2,{onClick:()=>af(a),children:[(0,e.jsx)(j.kU3,{className:"mr-2 h-4 w-4"}),"View Details"]}),(0,e.jsxs)(q._2,{onClick:()=>ae(a),children:[(0,e.jsx)(j.ffu,{className:"mr-2 h-4 w-4"}),"Edit"]}),(0,e.jsxs)(q._2,{onClick:async()=>await (0,u.A)(a),children:[(0,e.jsx)(j.f5X,{className:"mr-2 h-4 w-4"}),"Download PDF"]}),(0,e.jsxs)(q._2,{onClick:()=>aj(a),disabled:"sent"===a.status||"approved"===a.status||M,children:[(0,e.jsx)(j.gE4,{className:"mr-2 h-4 w-4"}),"Send PDF to Client"]}),(0,e.jsx)(q.mB,{}),(0,e.jsxs)(q._2,{onClick:()=>ak(a),children:[(0,e.jsx)(j.QRo,{className:"mr-2 h-4 w-4"}),"Duplicate"]}),(0,e.jsxs)(q._2,{onClick:()=>ah(a),className:"text-red-600",children:[(0,e.jsx)(j.lMJ,{className:"mr-2 h-4 w-4"}),"Delete"]})]})]})]})})]},a.id))})]})}),(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsx)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:(0,e.jsxs)("span",{children:["Showing ",Math.min(_+1,Z.length),"-",Math.min(aa,Z.length)," of"," ",Z.length," quotations"]})}),(0,e.jsx)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:(0,e.jsxs)("span",{children:["Page ",S," of ",$]})})]}),$>1&&(0,e.jsxs)("div",{className:"flex items-center justify-between",children:[(0,e.jsxs)("div",{className:"flex items-center gap-2",children:[(0,e.jsx)(h.$,{variant:"outline",size:"sm",onClick:()=>T(Math.max(1,S-1)),disabled:1===S,className:"h-8 px-3",children:"Previous"}),(0,e.jsx)("div",{className:"flex items-center gap-1",children:Array.from({length:Math.min(5,$)},(a,b)=>{let c=b+1;return $<=5||1===c||c===$||c>=S-1&&c<=S+1?(0,e.jsx)(h.$,{variant:S===c?"default":"outline",size:"sm",onClick:()=>T(c),className:"h-8 w-8 p-0",children:c},c):c===S-2||c===S+2?(0,e.jsx)("span",{className:"px-2 text-muted-foreground",children:"..."},c):null})}),(0,e.jsx)(h.$,{variant:"outline",size:"sm",onClick:()=>T(Math.min($,S+1)),disabled:S===$,className:"h-8 px-3",children:"Next"})]}),(0,e.jsxs)("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[(0,e.jsx)("span",{children:"•"}),(0,e.jsxs)("span",{children:["Last updated: ",new Date().toLocaleTimeString()]})]})]}),(0,e.jsx)(p.f,{open:C,onOpenChange:ad,quotation:E,clients:X||[]}),(0,e.jsx)(r.lG,{open:!!K,onOpenChange:ag,children:(0,e.jsxs)(r.Cf,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,e.jsx)(r.L3,{children:"Quotation Details"}),K&&(0,e.jsxs)("div",{className:"space-y-6",children:[(0,e.jsxs)("div",{className:"flex justify-between items-start border-b pb-4",children:[(0,e.jsxs)("div",{children:[(0,e.jsxs)("h3",{className:"text-xl font-semibold",children:["#",an(K.id)]}),(0,e.jsxs)("p",{className:"text-muted-foreground",children:["Created: ",ao(K.date)]})]}),(0,e.jsxs)(l.E,{variant:"outline",className:`${al(K.status)} flex items-center gap-1`,children:[am(K.status),K.status?K.status.charAt(0).toUpperCase()+K.status.slice(1):"Unknown"]})]}),(0,e.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-semibold mb-2",children:"Client Information"}),(0,e.jsxs)("div",{className:"space-y-1",children:[(0,e.jsx)("p",{className:"font-medium",children:K.client_name||"Unknown Client"}),K.client_email&&(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:K.client_email}),K.client_phone&&(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:K.client_phone}),K.client_address&&(0,e.jsx)("p",{className:"text-sm text-muted-foreground",children:K.client_address})]})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-semibold mb-2",children:"Quotation Details"}),(0,e.jsxs)("div",{className:"space-y-1",children:[(0,e.jsxs)("p",{className:"text-sm",children:[(0,e.jsx)("span",{className:"font-medium",children:"Valid Until:"})," ",ao(K.valid_until)]}),(0,e.jsxs)("p",{className:"text-sm",children:[(0,e.jsx)("span",{className:"font-medium",children:"Total Amount:"})," ",(0,t.vv)(K.total_amount)]}),K.vat_percentage&&(0,e.jsxs)("p",{className:"text-sm",children:[(0,e.jsx)("span",{className:"font-medium",children:"VAT:"})," ",K.vat_percentage,"%"]}),K.discount_percentage&&(0,e.jsxs)("p",{className:"text-sm",children:[(0,e.jsx)("span",{className:"font-medium",children:"Discount:"})," ",K.discount_percentage,"%"]})]})]})]}),K.notes&&(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-semibold mb-2",children:"Notes"}),(0,e.jsx)("p",{className:"text-muted-foreground bg-muted p-3 rounded-md",children:K.notes})]}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h4",{className:"text-sm font-semibold mb-2",children:"Items"}),(0,e.jsx)("div",{className:"rounded-md border",children:(0,e.jsxs)(i.XI,{children:[(0,e.jsx)(i.A0,{children:(0,e.jsxs)(i.Hj,{children:[(0,e.jsx)(i.nd,{children:"Description"}),(0,e.jsx)(i.nd,{className:"text-right",children:"Qty"}),(0,e.jsx)(i.nd,{className:"text-right",children:"Unit Price"}),(0,e.jsx)(i.nd,{className:"text-right",children:"Amount"})]})}),(0,e.jsx)(i.BF,{children:K.items&&Array.isArray(K.items)?K.items.map((a,b)=>(0,e.jsxs)(i.Hj,{children:[(0,e.jsx)(i.nA,{children:a?.description||"Unknown item"}),(0,e.jsx)(i.nA,{className:"text-right",children:a?.quantity||0}),(0,e.jsx)(i.nA,{className:"text-right",children:(0,t.vv)(a?.unit_price||0)}),(0,e.jsx)(i.nA,{className:"text-right",children:(0,t.vv)(a?.amount||0)})]},b)):(0,e.jsx)(i.Hj,{children:(0,e.jsx)(i.nA,{colSpan:4,className:"text-center",children:"No items found"})})}),(0,e.jsxs)(i.Gg,{children:[(0,e.jsxs)(i.Hj,{children:[(0,e.jsx)(i.nA,{colSpan:3,className:"text-right",children:"Subtotal"}),(0,e.jsx)(i.nA,{className:"text-right",children:(0,t.vv)((0,t.N9)(K.items))})]}),K.vat_percentage&&K.vat_percentage>0&&(0,e.jsxs)(i.Hj,{children:[(0,e.jsxs)(i.nA,{colSpan:3,className:"text-right",children:["VAT (",K.vat_percentage,"%)"]}),(0,e.jsx)(i.nA,{className:"text-right",children:(0,t.vv)((0,t.N9)(K.items)*(K.vat_percentage/100))})]}),K.discount_percentage&&K.discount_percentage>0&&(0,e.jsxs)(i.Hj,{children:[(0,e.jsxs)(i.nA,{colSpan:3,className:"text-right",children:["Discount (",K.discount_percentage,"%)"]}),(0,e.jsxs)(i.nA,{className:"text-right",children:["-",(0,t.vv)((0,t.N9)(K.items)*(K.discount_percentage/100))]})]}),(0,e.jsxs)(i.Hj,{className:"font-bold border-t",children:[(0,e.jsx)(i.nA,{colSpan:3,className:"text-right",children:"Total"}),(0,e.jsx)(i.nA,{className:"text-right",children:(0,t.vv)(K.total_amount)})]})]})]})})]}),(0,e.jsxs)(r.Es,{className:"flex justify-end space-x-2 pt-4",children:[(0,e.jsx)(h.$,{variant:"outline",onClick:()=>L(null),children:"Close"}),(0,e.jsxs)(h.$,{variant:"outline",onClick:async()=>await (0,u.A)(K),children:[(0,e.jsx)(j.f5X,{className:"mr-2 h-4 w-4"}),"Download PDF"]}),(0,e.jsx)(h.$,{onClick:()=>aj(K),disabled:"sent"===K.status||"approved"===K.status||M,children:M?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.krw,{className:"mr-2 h-4 w-4 animate-spin"}),"Sending PDF..."]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.gE4,{className:"mr-2 h-4 w-4"}),"Send PDF to Client"]})})]})]})]})}),(0,e.jsx)(s.Lt,{open:I,onOpenChange:J,children:(0,e.jsxs)(s.EO,{children:[(0,e.jsxs)(s.wd,{children:[(0,e.jsx)(s.r7,{children:"Are you sure?"}),(0,e.jsxs)(s.$v,{children:['This will permanently delete the quotation "',G?.client_name,'" -'," ",an(G?.id||""),". This action cannot be undone."]})]}),(0,e.jsxs)(s.ck,{children:[(0,e.jsx)(s.Zr,{children:"Cancel"}),(0,e.jsx)(s.Rx,{onClick:ai,className:"bg-red-600 hover:bg-red-700",children:"Delete Quotation"})]})]})})]})})}[g,h,i,l,m,p,q,r,s,t,u,v,w]=y.then?(await y)():y,d()}catch(a){d(a)}})},25665:a=>{a.exports=import("@radix-ui/react-checkbox")},28225:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{A:()=>m,a:()=>n});var e=c(65515),f=c.n(e),g=c(83501),h=c(8301),i=c(76569),j=c(48578),k=c(95965),l=a([g,j]);[g,j]=l.then?(await l)():l;let m=async a=>{let b=new(f())({orientation:"p",unit:"mm",format:"a4"}),c=b.internal.pageSize.getWidth();b.setFont("helvetica");try{let a=await new Promise((a,b)=>{let c=new Image;c.crossOrigin="anonymous",c.onload=()=>{let d=document.createElement("canvas");d.width=Math.max(1,Math.floor(240)),d.height=Math.max(1,Math.floor(72));let e=d.getContext("2d");if(!e)return b(Error("Canvas 2D context unavailable"));e.imageSmoothingEnabled=!0,e.imageSmoothingQuality="high",e.drawImage(c,0,0,d.width,d.height),a(d.toDataURL("image/png",1))},c.onerror=a=>b(a),c.src="/images/Koormatics-logo.png"});b.addImage(a,"PNG",15,15,60,18)}catch(a){console.error("Error adding logo:",a),b.setFontSize(16),b.setFont("helvetica","bold"),b.setTextColor(h.h6.primary[0],h.h6.primary[1],h.h6.primary[2]),b.text("Koormatics",15,25)}b.setFontSize(9),b.setFont("helvetica","normal"),b.setTextColor(h.h6.text[0],h.h6.text[1],h.h6.text[2]);let d=["Wadajir district.","Airport Road, Mogadishu, Somalia","www.koormatics.com","+252-619494974"];b.text(d,15,38),b.setFontSize(26),b.setFont("helvetica","bold"),b.setTextColor(h.h6.primary[0],h.h6.primary[1],h.h6.primary[2]),b.text("QUOTATION",c-15,25,{align:"right"}),b.setFontSize(10),b.setFont("helvetica","normal"),b.setTextColor(h.h6.text[0],h.h6.text[1],h.h6.text[2]);let e=35;b.text(`Quotation #: ${(0,j.I$)(a.id)}`,c-15,e,{align:"right"}),e+=6,b.text(`Date: ${(0,j.Yq)(a.date)}`,c-15,e,{align:"right"}),e+=6,b.text(`Valid Until: ${(0,j.Yq)(a.valid_until)}`,c-15,e,{align:"right"});let k=38+5*d.length+5,l=k;b.setDrawColor(h.h6.border[0],h.h6.border[1],h.h6.border[2]),b.setLineWidth(.5),b.rect(15,l,80,35),b.setFont("helvetica","normal"),b.setTextColor(h.h6.text[0],h.h6.text[1],h.h6.text[2]);let m=l+6;if(b.setFont("helvetica","bold"),b.text(a.client_name,19,m),m+=5,a.client_address){b.setFont("helvetica","normal");let c=b.splitTextToSize(a.client_address,72);b.text(c,19,m),m+=b.getTextDimensions(c).h+3}a.client_email&&(b.setFont("helvetica","normal"),b.text(a.client_email,19,m),m+=4),a.client_phone&&(b.setFont("helvetica","normal"),b.text(a.client_phone,19,m)),k=l+35+6;let n=Math.max(k,70)+8;(0,g.default)(b,{startY:n,head:[["Description","Qty","Unit Price","Amount"]],body:a.items.map(a=>[a.description,a.quantity,(0,j.vv)(a.unit_price),(0,j.vv)(a.amount)]),theme:"grid",headStyles:{fillColor:[h.h6.headerBg[0],h.h6.headerBg[1],h.h6.headerBg[2]],textColor:[h.h6.headerText[0],h.h6.headerText[1],h.h6.headerText[2]],fontStyle:"bold"},styles:{font:"helvetica",fontSize:9,cellPadding:3,overflow:"linebreak",textColor:[h.h6.text[0],h.h6.text[1],h.h6.text[2]],lineColor:[h.h6.border[0],h.h6.border[1],h.h6.border[2]]},alternateRowStyles:{fillColor:[h.h6.rowAlt[0],h.h6.rowAlt[1],h.h6.rowAlt[2]]}});let o=(b.lastAutoTable.finalY||100)+10,p=a.items.reduce((a,b)=>a+b.amount,0),q=a.vat_percentage?p*(a.vat_percentage/100):0,r=a.discount_percentage?p*(a.discount_percentage/100):0,s=a.total_amount,t=c-15-50,u=c-15;b.setFontSize(10),b.setFont("helvetica","normal"),b.setTextColor(h.h6.text[0],h.h6.text[1],h.h6.text[2]),b.text("Subtotal:",t,o,{align:"right"}),b.text((0,j.vv)(p),u,o,{align:"right"}),o+=7,q>0&&(b.text(`VAT (${a.vat_percentage}%)`,t,o,{align:"right"}),b.text((0,j.vv)(q),u,o,{align:"right"}),o+=7),r>0&&(b.text(`Discount (${a.discount_percentage}%):`,t,o,{align:"right"}),b.text(`-${(0,j.vv)(r)}`,u,o,{align:"right"}),o+=7),b.setDrawColor(h.h6.border[0],h.h6.border[1],h.h6.border[2]),b.line(t-5,o-3,u,o-3),b.setFont("helvetica","bold"),b.setTextColor(h.h6.primary[0],h.h6.primary[1],h.h6.primary[2]),b.text("Total:",t,o,{align:"right"}),b.text((0,j.vv)(s),u,o,{align:"right"});let v=o+=15;if(a.notes){b.setFontSize(10),b.setFont("helvetica","bold"),b.setTextColor(h.h6.primary[0],h.h6.primary[1],h.h6.primary[2]),b.text("Notes:",15,v),b.setFont("helvetica","normal"),b.setTextColor(h.h6.text[0],h.h6.text[1],h.h6.text[2]);let d=b.splitTextToSize(a.notes,c-30);b.text(d,15,v+5),v+=b.getTextDimensions(d).h+10}let w=[];w.push([{content:"Payment Communication:",styles:{fontStyle:"bold",textColor:[h.h6.primary[0],h.h6.primary[1],h.h6.primary[2]],fontSize:10}}]),w.push([{content:"Please use the following communication for your payment : 78991069",styles:{fontSize:9}}]),w.push([""]),w.push([{content:"Terms and Conditions:",styles:{fontStyle:"bold",textColor:[h.h6.primary[0],h.h6.primary[1],h.h6.primary[2]],fontSize:10}}]),w.push([{content:"1. The quotation provided is valid for a period of thirty (30) days from the date of issue unless otherwise stated\n\n2. For all clients without an account or contract with us, a 50% down payment of the quoted amount, payable by cash or bank transfer, is required to confirm bookings.\n\n3. Payment for services is due upon receipt of invoice, unless otherwise specified.",styles:{fontSize:8}}]),w.push([""]),w.push([{content:"Bank Details:",styles:{fontStyle:"bold",textColor:[h.h6.primary[0],h.h6.primary[1],h.h6.primary[2]],fontSize:10}}]),w.push([{content:"Dahabshil Bank",styles:{fontStyle:"bold",fontSize:9}}]),w.push([{content:"Account Name: Peace Business Group\nAccount Number: 104 102 369\nSwift Codes: EABDDJJD\nBranch: Mogadishu, Somalia\nIBAN: SO600002301301008035901",styles:{fontSize:9}}]),w.push([""]),w.push([{content:"Premier Bank",styles:{fontStyle:"bold",fontSize:9}}]),w.push([{content:"Account Name: Peace Business Group\nAccount Number: 020600296001\nIBAN: SO600005002020600296001",styles:{fontSize:9}}]),(0,g.default)(b,{startY:v,body:w,theme:"plain",styles:{font:"helvetica",textColor:[h.h6.text[0],h.h6.text[1],h.h6.text[2]],cellPadding:{top:0,right:0,bottom:1,left:0}},columnStyles:{0:{cellWidth:c-30}}});let x=b.internal.getNumberOfPages();for(let a=1;a<=x;a++)b.setPage(a),b.setFontSize(8),b.setTextColor(h.h6.text[0],h.h6.text[1],h.h6.text[2]),b.text("Thank you for your business!",15,b.internal.pageSize.height-10),b.text(`Page ${a} of ${x}`,c-15,b.internal.pageSize.height-10,{align:"right"});b.save(`Quotation-${(0,j.I$)(a.id)}.pdf`),(0,i.oR)({title:"Quotation PDF Generated",description:"Your quotation has been downloaded."})},n=async a=>{if(!a.client_email)return(0,i.oR)({title:"Error",description:"Client does not have an email address.",variant:"destructive"}),!1;try{console.log("Sending quotation email with PDF attachment for quotation ID:",a.id);let b=(0,i.oR)({title:"Sending quotation...",description:"Generating PDF and sending email to client"}),{data:c,error:d}=await k.N.functions.invoke("send-quotation",{body:{quotationId:a.id,clientEmail:a.client_email,clientName:a.client_name}});if(d)throw console.error("Invoke error:",d),d;if(c?.error)throw console.error("Function returned error:",c.error),Error(c.error);let{error:e}=await k.N.from("quotations").update({status:"sent"}).eq("id",a.id);if(e)throw console.error("Status update error:",e),e;return b.dismiss?.(),(0,i.oR)({title:"\uD83D\uDCE7 Quotation sent successfully!",description:`PDF quotation has been sent to ${a.client_email}`}),!0}catch(b){console.error("Error sending quotation:",b);let a="Failed to send the quotation";return b instanceof Error&&(a=b.message),(0,i.oR)({title:"❌ Failed to send quotation",description:a,variant:"destructive"}),!1}};d()}catch(a){d(a)}})},28462:a=>{a.exports=import("@tanstack/react-query")},33873:a=>{a.exports=require("path")},36307:a=>{a.exports=import("@radix-ui/react-dropdown-menu")},37015:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>r,default:()=>n,getServerSideProps:()=>q,getStaticPaths:()=>p,getStaticProps:()=>o,handler:()=>z,reportWebVitals:()=>s,routeModule:()=>y,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>x,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>u,unstable_getStaticProps:()=>t});var e=c(63885),f=c(80237),g=c(81413),h=c(65611),i=c.n(h),j=c(74780),k=c(24603),l=c(12289),m=a([j,k]);[j,k]=m.then?(await m)():m;let n=(0,g.M)(k,"default"),o=(0,g.M)(k,"getStaticProps"),p=(0,g.M)(k,"getStaticPaths"),q=(0,g.M)(k,"getServerSideProps"),r=(0,g.M)(k,"config"),s=(0,g.M)(k,"reportWebVitals"),t=(0,g.M)(k,"unstable_getStaticProps"),u=(0,g.M)(k,"unstable_getStaticPaths"),v=(0,g.M)(k,"unstable_getStaticParams"),w=(0,g.M)(k,"unstable_getServerProps"),x=(0,g.M)(k,"unstable_getServerSideProps"),y=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/Quotations",pathname:"/Quotations",bundlePath:"",filename:""},distDir:".next-fleet",relativeProjectDir:"",components:{App:j.default,Document:i()},userland:k}),z=(0,l.U)({srcPage:"/Quotations",config:r,userland:k,routeModule:y,getStaticPaths:p,getStaticProps:o,getServerSideProps:q});d()}catch(a){d(a)}})},38661:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{Cf:()=>o,Es:()=>q,HM:()=>m,L3:()=>r,c7:()=>p,lG:()=>j,rr:()=>s,zM:()=>k});var e=c(8732),f=c(82015),g=c(13020),h=c(87092),i=a([g,h]);[g,h]=i.then?(await i)():i;let j=g.Root,k=g.Trigger,l=g.Portal,m=g.Close,n=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Overlay,{ref:c,className:(0,h.cn)("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",a),...b}));n.displayName=g.Overlay.displayName;let o=f.forwardRef(({className:a,children:b,...c},d)=>(0,e.jsxs)(l,{children:[(0,e.jsx)(n,{}),(0,e.jsx)(g.Content,{ref:d,className:(0,h.cn)("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",a),...c,children:b})]}));o.displayName=g.Content.displayName;let p=({className:a,...b})=>(0,e.jsx)("div",{className:(0,h.cn)("flex flex-col space-y-1.5 text-center sm:text-left",a),...b});p.displayName="DialogHeader";let q=({className:a,...b})=>(0,e.jsx)("div",{className:(0,h.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...b});q.displayName="DialogFooter";let r=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Title,{ref:c,className:(0,h.cn)("text-lg font-semibold leading-none tracking-tight",a),...b}));r.displayName=g.Title.displayName;let s=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Description,{ref:c,className:(0,h.cn)("text-sm text-muted-foreground",a),...b}));s.displayName=g.Description.displayName,d()}catch(a){d(a)}})},38827:a=>{a.exports=import("@radix-ui/react-separator")},40273:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{J:()=>l});var e=c(8732),f=c(82015),g=c(20598),h=c(8938),i=c(87092),j=a([g,h,i]);[g,h,i]=j.then?(await j)():j;let k=(0,h.cva)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),l=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Root,{ref:c,className:(0,i.cn)(k(),a),...b}));l.displayName=g.Root.displayName,d()}catch(a){d(a)}})},40361:a=>{a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},41415:a=>{a.exports=import("sonner")},42971:a=>{a.exports=import("zod")},46060:a=>{a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},47860:a=>{a.exports=import("@radix-ui/react-select")},48303:a=>{a.exports=import("@radix-ui/react-tooltip")},48383:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{A0:()=>j,BF:()=>k,Gg:()=>l,Hj:()=>m,XI:()=>i,nA:()=>o,nd:()=>n,r6:()=>p});var e=c(8732),f=c(82015),g=c(87092),h=a([g]);g=(h.then?(await h)():h)[0];let i=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("div",{className:"relative w-full overflow-auto rounded-lg",children:(0,e.jsx)("table",{ref:c,className:(0,g.cn)("w-full caption-bottom text-sm bg-card text-card-foreground",a),...b})}));i.displayName="Table";let j=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("thead",{ref:c,className:(0,g.cn)("[&_tr]:border-b border-border bg-muted/50",a),...b}));j.displayName="TableHeader";let k=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("tbody",{ref:c,className:(0,g.cn)("[&_tr:last-child]:border-0",a),...b}));k.displayName="TableBody";let l=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("tfoot",{ref:c,className:(0,g.cn)("border-t border-border bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...b}));l.displayName="TableFooter";let m=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("tr",{ref:c,className:(0,g.cn)("border-b border-border transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...b}));m.displayName="TableRow";let n=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("th",{ref:c,className:(0,g.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...b}));n.displayName="TableHead";let o=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("td",{ref:c,className:(0,g.cn)("p-4 align-middle text-card-foreground [&:has([role=checkbox])]:pr-0",a),...b}));o.displayName="TableCell";let p=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("caption",{ref:c,className:(0,g.cn)("mt-4 text-sm text-muted-foreground",a),...b}));p.displayName="TableCaption",d()}catch(a){d(a)}})},50802:a=>{a.exports=import("clsx")},56884:a=>{a.exports=import("react-hook-form")},57049:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{bq:()=>m,eb:()=>q,gC:()=>p,l6:()=>k,yv:()=>l});var e=c(8732),f=c(82015),g=c(47860),h=c(74952),i=c(87092),j=a([g,i]);[g,i]=j.then?(await j)():j;let k=g.Root;g.Group;let l=g.Value,m=f.forwardRef(({className:a,children:b,...c},d)=>(0,e.jsxs)(g.Trigger,{ref:d,className:(0,i.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-0 focus-visible:ring-0 focus:ring-offset-0 focus-visible:ring-offset-0 focus:border-ring focus-visible:border-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 transition-colors",a),...c,children:[b,(0,e.jsx)(g.Icon,{asChild:!0,children:(0,e.jsx)(h.yQN,{className:"h-4 w-4 opacity-50"})})]}));m.displayName=g.Trigger.displayName;let n=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.ScrollUpButton,{ref:c,className:(0,i.cn)("flex cursor-default items-center justify-center py-1",a),...b,children:(0,e.jsx)(h.rXn,{className:"h-4 w-4"})}));n.displayName=g.ScrollUpButton.displayName;let o=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.ScrollDownButton,{ref:c,className:(0,i.cn)("flex cursor-default items-center justify-center py-1",a),...b,children:(0,e.jsx)(h.yQN,{className:"h-4 w-4"})}));o.displayName=g.ScrollDownButton.displayName;let p=f.forwardRef(({className:a,children:b,position:c="popper",...d},f)=>(0,e.jsx)(g.Portal,{children:(0,e.jsxs)(g.Content,{ref:f,className:(0,i.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===c&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:c,...d,children:[(0,e.jsx)(n,{}),(0,e.jsx)(g.Viewport,{className:(0,i.cn)("p-1","popper"===c&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:b}),(0,e.jsx)(o,{})]})}));p.displayName=g.Content.displayName,f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Label,{ref:c,className:(0,i.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...b})).displayName=g.Label.displayName;let q=f.forwardRef(({className:a,children:b,...c},d)=>(0,e.jsxs)(g.Item,{ref:d,className:(0,i.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...c,children:[(0,e.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,e.jsx)(g.ItemIndicator,{children:(0,e.jsx)(h.Jlk,{className:"h-4 w-4"})})}),(0,e.jsx)(g.ItemText,{children:b})]}));q.displayName=g.Item.displayName,f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Separator,{ref:c,className:(0,i.cn)("-mx-1 my-1 h-px bg-muted",a),...b})).displayName=g.Separator.displayName,d()}catch(a){d(a)}})},57312:a=>{a.exports=import("next-themes")},57973:a=>{a.exports=import("@radix-ui/react-alert-dialog")},58894:(a,b,c)=>{function d(a){return a&&"object"==typeof a&&"error"in a&&!0===a.error}function e(a){return Array.isArray(a)?a.filter(a=>!d(a)):[]}function f(a){return d(a)?null:a}c.d(b,{to:()=>f,wH:()=>e})},65515:a=>{a.exports=require("jspdf")},75979:a=>{a.exports=import("tailwind-merge")},78059:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{p:()=>i});var e=c(8732),f=c(82015),g=c(87092),h=a([g]);g=(h.then?(await h)():h)[0];let i=f.forwardRef(({className:a,type:b,onAddItem:c,onRemoveItem:d,showAddButton:f,showRemoveButton:h,addButtonLabel:i,removeButtonLabel:j,...k},l)=>(0,e.jsxs)("div",{className:f||h?"flex items-center gap-2":"",children:[(0,e.jsx)("input",{type:b,className:(0,g.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus:outline-none focus:ring-0 focus-visible:ring-0 focus:ring-offset-0 focus-visible:ring-offset-0 focus:border-ring focus-visible:border-ring disabled:cursor-not-allowed disabled:opacity-50 transition-colors",a),ref:l,onKeyDown:c?a=>{"Enter"===a.key&&c&&(a.preventDefault(),c())}:void 0,...k}),f&&c&&(0,e.jsx)("button",{type:"button",className:"inline-flex h-10 items-center justify-center rounded-md bg-primary px-3 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90",onClick:c,children:i||"Add"}),h&&d&&(0,e.jsx)("button",{type:"button",className:"inline-flex h-10 items-center justify-center rounded-md bg-destructive px-3 py-2 text-sm font-medium text-destructive-foreground hover:bg-destructive/90",onClick:d,children:j||"Remove"})]}));i.displayName="Input",d()}catch(a){d(a)}})},82015:a=>{a.exports=require("react")},83501:a=>{a.exports=import("jspdf-autotable")},93939:a=>{a.exports=require("@supabase/supabase-js")},98825:a=>{a.exports=import("@hookform/resolvers/zod")}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[4952,5611,5781,1913,4780,3720],()=>b(b.s=37015));module.exports=c})();