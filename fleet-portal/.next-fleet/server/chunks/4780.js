"use strict";exports.id=4780,exports.ids=[4780],exports.modules={14872:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{Sb:()=>q,US:()=>m,aD:()=>r,eC:()=>p,tE:()=>l,y8:()=>o});var e=c(8732),f=c(82015),g=c(16235),h=c(8938),i=c(74952),j=c(87092),k=a([g,h,j]);[g,h,j]=k.then?(await k)():k;let l=g.Provider,m=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Viewport,{ref:c,className:(0,j.cn)("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",a),...b}));m.displayName=g.Viewport.displayName;let n=(0,h.cva)("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),o=f.forwardRef(({className:a,variant:b,...c},d)=>(0,e.jsx)(g.Root,{ref:d,className:(0,j.cn)(n({variant:b}),a),...c}));o.displayName=g.Root.displayName,f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Action,{ref:c,className:(0,j.cn)("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",a),...b})).displayName=g.Action.displayName;let p=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Close,{ref:c,className:(0,j.cn)("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",a),"toast-close":"",...b,children:(0,e.jsx)(i.X,{className:"h-4 w-4"})}));p.displayName=g.Close.displayName;let q=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Title,{ref:c,className:(0,j.cn)("text-sm font-semibold",a),...b}));q.displayName=g.Title.displayName;let r=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Description,{ref:c,className:(0,j.cn)("text-sm opacity-90",a),...b}));r.displayName=g.Description.displayName,d()}catch(a){d(a)}})},23188:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{l:()=>i});var e=c(8732),f=c(57312),g=c(41415),h=a([f,g]);[f,g]=h.then?(await h)():h;let i=({...a})=>{let{theme:b="system"}=(0,f.useTheme)();return(0,e.jsx)(g.Toaster,{theme:b,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...a})};d()}catch(a){d(a)}})},29650:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{A:()=>m});var e=c(8732),f=c(82015),g=c(66345),h=c(54269),i=c(74952),j=c(67979),k=a([g,h]);[g,h]=k.then?(await k)():k;class n extends f.Component{constructor(a){super(a),this.state={hasError:!1}}static getDerivedStateFromError(a){return console.error("React Error Boundary caught error:",a),{hasError:!0,error:a}}componentDidCatch(a,b){console.error("React Error Boundary componentDidCatch:",a,b),this.setState({hasError:!0,error:a,errorInfo:b})}render(){return this.state.hasError?(0,e.jsx)(l,{error:this.state.error,errorInfo:this.state.errorInfo}):this.props.children}}function l({error:a,errorInfo:b}){return(0,e.jsx)("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:(0,e.jsxs)(h.Fc,{className:"max-w-md",children:[(0,e.jsx)(i.hcu,{className:"h-4 w-4"}),(0,e.jsx)(h.XL,{children:"Something went wrong"}),(0,e.jsxs)(h.TN,{className:"mt-2",children:[(0,e.jsx)("p",{className:"text-sm text-muted-foreground mb-4",children:"An unexpected error occurred. Please try refreshing the page or contact support if the problem persists."}),a&&(0,e.jsxs)("details",{className:"text-xs text-muted-foreground",children:[(0,e.jsx)("summary",{className:"cursor-pointer mb-2",children:"Error details"}),(0,e.jsx)("pre",{className:"bg-muted p-2 rounded overflow-auto",children:a.toString()})]}),(0,e.jsxs)("div",{className:"mt-4 flex gap-2",children:[(0,e.jsx)(g.$,{onClick:()=>window.location.reload(),variant:"default",size:"sm",children:"Refresh Page"}),(0,e.jsx)(g.$,{onClick:()=>window.location.reload(),variant:"outline",size:"sm",children:"Try Again"})]})]})]})})}function m({children:a}){let[b,c]=(0,f.useState)({hasError:!1});return b.hasError?(0,e.jsx)(l,{error:b.error,errorInfo:b.errorInfo}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.K,{}),(0,e.jsx)(n,{children:a})]})}d()}catch(a){d(a)}})},29894:(a,b,c)=>{c.d(b,{cacheInvalidationManager:()=>f});var d=c(88266);class e{constructor(){this.queryClient=null}static getInstance(){return e.instance||(e.instance=new e),e.instance}setQueryClient(a){this.queryClient=a}async clearAllCaches(){if(this.queryClient)try{d.T.clearCache(),this.queryClient.clear(),console.log("All caches cleared successfully")}catch(a){console.error("Error clearing caches:",a)}}async invalidateAndRefetch(a){if(this.queryClient)try{await Promise.all(a.map(a=>this.queryClient.invalidateQueries({queryKey:a}))),await Promise.all(a.map(a=>this.queryClient.refetchQueries({queryKey:a}))),console.log("Queries invalidated and refetched:",a)}catch(a){console.error("Error invalidating queries:",a)}}async refreshAuthData(){await this.invalidateAndRefetch([["page_access"],["user_roles"],["user_profile"],["auth_session"]])}async refreshCoreData(){await this.invalidateAndRefetch([["trips"],["vehicles"],["drivers"],["clients"],["maintenance"],["fuel_logs"]])}setupAutoClearOnUnload(){}markRecentUpdates(){}forcePageRefresh(){}}let f=e.getInstance()},33705:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{A:()=>n});var e=c(8732),f=c(82015),g=c(67423),h=c(23188),i=c(77184),j=c(28462),k=c(57312),l=c(29650);c(29894);var m=a([g,h,i,j,k,l]);function n({children:a}){let[b]=(0,f.useState)(()=>new j.QueryClient({defaultOptions:{queries:{staleTime:5e3,gcTime:3e5,retry:1,refetchOnWindowFocus:!0,refetchOnMount:!0,refetchOnReconnect:!0,placeholderData:a=>a,retryOnMount:!0,retryDelay:1e3},mutations:{retry:1,retryDelay:1e3}}}));return(0,e.jsx)(j.QueryClientProvider,{client:b,children:(0,e.jsx)(k.ThemeProvider,{attribute:"class",defaultTheme:"system",enableSystem:!0,disableTransitionOnChange:!0,storageKey:"koormatics-theme",children:(0,e.jsxs)(i.Bc,{children:[(0,e.jsx)("meta",{name:"x-next-build-id",content:"1.0.0"}),(0,e.jsx)(g.l,{}),(0,e.jsx)(h.l,{}),(0,e.jsx)(l.A,{children:a})]})})})}[g,h,i,j,k,l]=m.then?(await m)():m,d()}catch(a){d(a)}})},37839:(a,b,c)=>{c.r(b),c.d(b,{API_KEYS:()=>e,GOOGLE_MAPS_API_KEY:()=>i,SUPABASE_ANON_KEY:()=>h,SUPABASE_URL:()=>g,getGoogleMapsApiKey:()=>d,validateAPIKeys:()=>f});let d=async()=>process.env.NEXT_PUBLIC_GOOGLE_MAPS_KEY||"AIzaSyB6wCOi9B8kcTLiwrE7KjV93882exWNKAY",e={GOOGLE_MAPS:d,SUPABASE:{URL:process.env.NEXT_PUBLIC_SUPABASE_URL||"https://kgmjttamzppmypwzargk.supabase.co",ANON_KEY:process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtnbWp0dGFtenBwbXlwd3phcmdrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk4MjY2MjYsImV4cCI6MjA1NTQwMjYyNn0.HMfRqxeKQSjRY2ydzyxuJoTqr06nTVjOmGp0TpXtYpk"}},f=async()=>{let a=[],b=await d();return(b&&""!==b||a.push("Google Maps API Key (database or NEXT_PUBLIC_GOOGLE_MAPS_KEY)"),e.SUPABASE.URL&&""!==e.SUPABASE.URL||a.push("NEXT_PUBLIC_SUPABASE_URL"),e.SUPABASE.ANON_KEY&&""!==e.SUPABASE.ANON_KEY||a.push("NEXT_PUBLIC_SUPABASE_ANON_KEY"),a.length>0)?(console.warn("⚠️ Missing API Keys:",a.join(", ")),console.warn("Please check your database or .env.local file"),!1):(console.log("✅ All API keys are configured"),!0)},g=e.SUPABASE.URL,h=e.SUPABASE.ANON_KEY,i="AIzaSyB6wCOi9B8kcTLiwrE7KjV93882exWNKAY"},51577:(a,b,c)=>{c.d(b,{tu:()=>h});var d=c(95965),e=c(88266);class f{static getInstance(){return f.instance||(f.instance=new f),f.instance}isRefreshTokenError(a){return!!a?.message&&["Invalid Refresh Token","Refresh Token Not Found","refresh_token_not_found","invalid_grant","Token has expired","JWT expired"].some(b=>a.message.includes(b))}async handleRefreshTokenError(a){if(!this.isHandling){this.isHandling=!0,console.warn("Handling refresh token error:",a.message);try{e.T.clearCache(),await this.clearAuthStorage(),await d.N.auth.signOut({scope:"local"})}catch(a){console.error("Error during auth cleanup:",a)}finally{this.isHandling=!1}}}async clearAuthStorage(){}async handleAuthError(a){this.isRefreshTokenError(a)?await this.handleRefreshTokenError(a):console.error("Authentication error:",a)}reset(){this.isHandling=!1}constructor(){this.isHandling=!1}}let g=f.getInstance();async function h(a){return g.handleAuthError(a)}},54269:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{Fc:()=>k,TN:()=>m,XL:()=>l});var e=c(8732),f=c(82015),g=c(8938),h=c(87092),i=a([g,h]);[g,h]=i.then?(await i)():i;let j=(0,g.cva)("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive",warning:"border-amber-200 text-amber-800 dark:border-amber-600 bg-amber-50 dark:bg-amber-900/20 [&>svg]:text-amber-600 dark:[&>svg]:text-amber-500"}},defaultVariants:{variant:"default"}}),k=f.forwardRef(({className:a,variant:b,...c},d)=>(0,e.jsx)("div",{ref:d,role:"alert",className:(0,h.cn)(j({variant:b}),a),...c}));k.displayName="Alert";let l=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("h5",{ref:c,className:(0,h.cn)("mb-1 font-medium leading-none tracking-tight",a),...b}));l.displayName="AlertTitle";let m=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("div",{ref:c,className:(0,h.cn)("text-sm [&_p]:leading-relaxed",a),...b}));m.displayName="AlertDescription",d()}catch(a){d(a)}})},66345:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{$:()=>l,r:()=>k});var e=c(8732),f=c(82015),g=c(9640),h=c(8938),i=c(87092),j=a([g,h,i]);[g,h,i]=j.then?(await j)():j;let k=(0,h.cva)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),l=f.forwardRef(({className:a,variant:b,size:c,asChild:d=!1,...f},h)=>{let j=d?g.Slot:"button";return(0,e.jsx)(j,{className:(0,i.cn)(k({variant:b,size:c,className:a})),ref:h,...f})});l.displayName="Button",d()}catch(a){d(a)}})},67423:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{l:()=>i});var e=c(8732),f=c(76569),g=c(14872),h=a([g]);function i(){let{toasts:a}=(0,f.dj)();return(0,e.jsxs)(g.tE,{children:[a.map(function({id:a,title:b,description:c,action:d,...f}){return(0,e.jsxs)(g.y8,{...f,children:[(0,e.jsxs)("div",{className:"grid gap-1",children:[b&&(0,e.jsx)(g.Sb,{children:b}),c&&(0,e.jsx)(g.aD,{children:c})]}),d,(0,e.jsx)(g.eC,{})]},a)}),(0,e.jsx)(g.US,{})]})}g=(h.then?(await h)():h)[0],d()}catch(a){d(a)}})},67979:(a,b,c)=>{function d(){return null}c.d(b,{K:()=>d}),c(82015)},74780:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>h});var e=c(8732),f=c(33705),g=a([f]);function h({Component:a,pageProps:b}){return(0,e.jsx)(f.A,{children:(0,e.jsx)(a,{...b})})}f=(g.then?(await g)():g)[0],d()}catch(a){d(a)}})},76569:(a,b,c)=>{c.d(b,{dj:()=>l,oR:()=>k});var d=c(82015);let e=0,f=new Map,g=a=>{if(f.has(a))return;let b=setTimeout(()=>{f.delete(a),j({type:"REMOVE_TOAST",toastId:a})},1e6);f.set(a,b)},h=[],i={toasts:[]};function j(a){i=((a,b)=>{switch(b.type){case"ADD_TOAST":return{...a,toasts:[b.toast,...a.toasts].slice(0,1)};case"UPDATE_TOAST":return{...a,toasts:a.toasts.map(a=>a.id===b.toast.id?{...a,...b.toast}:a)};case"DISMISS_TOAST":{let{toastId:c}=b;return c?g(c):a.toasts.forEach(a=>{g(a.id)}),{...a,toasts:a.toasts.map(a=>a.id===c||void 0===c?{...a,open:!1}:a)}}case"REMOVE_TOAST":if(void 0===b.toastId)return{...a,toasts:[]};return{...a,toasts:a.toasts.filter(a=>a.id!==b.toastId)}}})(i,a),h.forEach(a=>{a(i)})}function k({...a}){let b=(e=(e+1)%Number.MAX_SAFE_INTEGER).toString(),c=()=>j({type:"DISMISS_TOAST",toastId:b});return j({type:"ADD_TOAST",toast:{...a,id:b,open:!0,onOpenChange:a=>{a||c()}}}),{id:b,dismiss:c,update:a=>j({type:"UPDATE_TOAST",toast:{...a,id:b}})}}function l(){let[a,b]=d.useState(i);return d.useEffect(()=>(h.push(b),()=>{let a=h.indexOf(b);a>-1&&h.splice(a,1)}),[]),{...a,toast:k,dismiss:a=>j({type:"DISMISS_TOAST",toastId:a})}}},77184:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{Bc:()=>j});var e=c(8732),f=c(82015),g=c(48303),h=c(87092),i=a([g,h]);[g,h]=i.then?(await i)():i;let j=g.Provider;g.Root,g.Trigger,f.forwardRef(({className:a,sideOffset:b=4,...c},d)=>(0,e.jsx)(g.Content,{ref:d,sideOffset:b,className:(0,h.cn)("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...c})).displayName=g.Content.displayName,d()}catch(a){d(a)}})},87092:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{cn:()=>h,r:()=>i});var e=c(50802),f=c(75979),g=a([e,f]);function h(...a){return(0,f.twMerge)((0,e.clsx)(a))}function i(a){let b=parseInt(a.slice(0,3),16)%1e3;return`V${b.toString().padStart(3,"0")}`}[e,f]=g.then?(await g)():g,d()}catch(a){d(a)}})},88266:(a,b,c)=>{c.d(b,{H:()=>g,T:()=>f});var d=c(51577);class e{getCachedSession(){if(this.isLoggingOut||!this.cache)return null;let a=Date.now(),b=a-this.cache.timestamp>this.MAX_AGE,c=a-this.cache.timestamp>this.CACHE_DURATION;return b||this.cache.session?.expires_at&&a>1e3*this.cache.session.expires_at?(this.cache=null,null):{...this.cache.session,isStale:c}}setCachedSession(a){if(!a){this.cache=null;return}this.cache={session:a,timestamp:Date.now(),expiresAt:a.expires_at?1e3*a.expires_at:Date.now()+this.MAX_AGE}}clearCache(){this.cache=null}setLoggingOut(a){this.isLoggingOut=a,a&&(this.cache=null)}isSessionValid(){return!!this.cache&&Date.now()<this.cache.expiresAt}constructor(){this.cache=null,this.CACHE_DURATION=1e4,this.MAX_AGE=12e4,this.isLoggingOut=!1}}let f=new e;async function g(a){let b=f.getCachedSession();if(b&&!b.isStale)return{data:{session:b}};if(b&&b.isStale)return a.auth.getSession().then(({data:a})=>{a.session&&f.setCachedSession(a.session)}),{data:{session:b}};try{let b=await a.auth.getSession();return b.data.session&&f.setCachedSession(b.data.session),b}catch(a){return console.error("Error fetching session:",a),await (0,d.tu)(a),{data:{session:null}}}}},95965:(a,b,c)=>{c.d(b,{N:()=>f});var d=c(93939),e=c(37839);(()=>{if(!process.env.NEXT_PUBLIC_SUPABASE_FUNCTIONS_URL)try{let a=new URL(e.SUPABASE_URL);return`${a.protocol}//${a.host}`}catch{return}})();let f=(0,d.createClient)(e.SUPABASE_URL,e.SUPABASE_ANON_KEY,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"pkce"},global:{headers:{"X-Client-Info":"supabase-js/2.x"}},db:{schema:"public"},realtime:{params:{eventsPerSecond:10}}})}};