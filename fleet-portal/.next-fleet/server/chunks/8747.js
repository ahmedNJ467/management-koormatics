"use strict";exports.id=8747,exports.ids=[8747],exports.modules={8218:(a,b,c)=>{c.d(b,{w:()=>e});var d=c(21638);function e(a){let b=(0,d.a)(a);return b.setDate(1),b.setHours(0,0,0,0),b}},10493:(a,b,c)=>{c.d(b,{p:()=>e});var d=c(21638);function e(a){let b=(0,d.a)(a),c=b.getMonth();return b.setFullYear(b.getFullYear(),c+1,0),b.setHours(23,59,59,999),b}},12919:(a,b,c)=>{c.d(b,{P:()=>f});var d=c(21638),e=c(68794);function f(a,b){let c=(0,d.a)(a);if(isNaN(b))return(0,e.w)(a,NaN);if(!b)return c;let f=c.getDate(),g=(0,e.w)(a,c.getTime());return(g.setMonth(c.getMonth()+b+1,0),f>=g.getDate())?g:(c.setFullYear(g.getFullYear(),g.getMonth(),f),c)}},16823:(a,b,c)=>{c.d(b,{Cx:()=>m,Qz:()=>n,R9:()=>o,zw:()=>l});var d=c(95965),e=c(8218),f=c(10493),g=c(71913),h=c(83332),i=c(81575),j=c(79837),k=c(17156);async function l(){let a={success:!0,generatedCount:0,errors:[],generatedInvoices:[]};try{let b=new Date,c=(0,e.w)(b),h=(0,f.p)(b),{data:i,error:j}=await d.N.from("vehicle_leases").select("*").eq("lease_status","active").lte("lease_start_date",(0,g.GP)(h,"yyyy-MM-dd")).gte("lease_end_date",(0,g.GP)(c,"yyyy-MM-dd"));if(j)throw Error(`Failed to fetch active leases: ${j.message}`);if(!i||0===i.length)return console.log("No active leases found for billing period"),a;let{data:k,error:l}=await d.N.from("lease_invoices").select("lease_id").eq("billing_period_start",(0,g.GP)(c,"yyyy-MM-dd")).eq("billing_period_end",(0,g.GP)(h,"yyyy-MM-dd"));if(l)throw Error(`Failed to check existing invoices: ${l.message}`);let n=new Set(k?.map(a=>a.lease_id)||[]),o=i.filter(a=>!n.has(a.id));for(let b of(console.log(`Found ${o.length} leases to bill for ${(0,g.GP)(c,"MMM yyyy")}`),o))try{let d=await m(b,c,h);a.generatedInvoices.push(d),a.generatedCount++}catch(d){let c=`Failed to generate invoice for lease ${b.contract_number}: ${d instanceof Error?d.message:"Unknown error"}`;a.errors.push(c),console.error(c)}return a.errors.length>0&&(a.success=!1),a}catch(b){return a.success=!1,a.errors.push(b instanceof Error?b.message:"Unknown error occurred"),a}}async function m(a,b,c){let e=function(a,b,c){let d=(0,i.H)(a.lease_start_date),e=(0,i.H)(a.lease_end_date),f=(0,j.d)(d,b)?d:b,g=Math.ceil((((0,k.Y)(e,c)?e:c).getTime()-f.getTime())/864e5)+1,h=Math.ceil((c.getTime()-b.getTime())/864e5)+1;if(a.monthly_rate&&a.monthly_rate>0)return Math.round(a.monthly_rate*g/h*100)/100;if(a.daily_rate&&a.daily_rate>0)return Math.round(a.daily_rate*g*100)/100;throw Error(`No valid rate found for lease ${a.contract_number}`)}(a,b,c),f=[{description:`Vehicle Lease - ${a.contract_number} (${(0,g.GP)(b,"dd/MM/yyyy")} - ${(0,g.GP)(c,"dd/MM/yyyy")})`,quantity:1,unit_price:e,amount:e}],{data:l,error:m}=await d.N.from("invoices").insert({client_id:null,date:(0,g.GP)(new Date,"yyyy-MM-dd"),due_date:(0,g.GP)((0,h.W)(new Date,{days:30}),"yyyy-MM-dd"),status:"draft",items:f,total_amount:e,paid_amount:0,notes:""}).select("id").single();if(m)throw Error(`Failed to create invoice: ${m.message}`);let{data:n,error:o}=await d.N.from("lease_invoices").insert({lease_id:a.id,invoice_id:l.id,billing_period_start:(0,g.GP)(b,"yyyy-MM-dd"),billing_period_end:(0,g.GP)(c,"yyyy-MM-dd"),amount:e,status:"generated",auto_generated:!0}).select("*").single();if(o)throw await d.N.from("invoices").delete().eq("id",l.id),Error(`Failed to create lease invoice record: ${o.message}`);return n}async function n(a){let b=d.N.from("lease_invoice_details").select("*");a&&(b=b.eq("lease_id",a));let{data:c,error:e}=await b.order("billing_period_start",{ascending:!1});if(e)throw Error(`Failed to fetch lease invoice details: ${e.message}`);return c||[]}async function o(a,b){let{error:c}=await d.N.from("lease_invoices").update({status:b}).eq("id",a);if(c)throw Error(`Failed to update lease invoice status: ${c.message}`)}},17156:(a,b,c)=>{c.d(b,{Y:()=>e});var d=c(21638);function e(a,b){return+(0,d.a)(a)<+(0,d.a)(b)}},21839:(a,b,c)=>{c.d(b,{f:()=>f});var d=c(21638),e=c(68794);function f(a,b){let c=(0,d.a)(a);return isNaN(b)?(0,e.w)(a,NaN):(b&&c.setDate(c.getDate()+b),c)}},39655:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{BT:()=>l,Wu:()=>m,ZB:()=>k,Zp:()=>i,aR:()=>j,wL:()=>n});var e=c(8732),f=c(82015),g=c(87092),h=a([g]);g=(h.then?(await h)():h)[0];let i=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("div",{ref:c,className:(0,g.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",a),...b}));i.displayName="Card";let j=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("div",{ref:c,className:(0,g.cn)("flex flex-col space-y-1.5 p-6",a),...b}));j.displayName="CardHeader";let k=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("h3",{ref:c,className:(0,g.cn)("text-2xl font-semibold leading-none tracking-tight",a),...b}));k.displayName="CardTitle";let l=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("p",{ref:c,className:(0,g.cn)("text-sm text-muted-foreground",a),...b}));l.displayName="CardDescription";let m=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("div",{ref:c,className:(0,g.cn)("p-6 pt-0",a),...b}));m.displayName="CardContent";let n=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("div",{ref:c,className:(0,g.cn)("flex items-center p-6 pt-0",a),...b}));n.displayName="CardFooter",d()}catch(a){d(a)}})},48383:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{A0:()=>j,BF:()=>k,Gg:()=>l,Hj:()=>m,XI:()=>i,nA:()=>o,nd:()=>n,r6:()=>p});var e=c(8732),f=c(82015),g=c(87092),h=a([g]);g=(h.then?(await h)():h)[0];let i=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("div",{className:"relative w-full overflow-auto rounded-lg",children:(0,e.jsx)("table",{ref:c,className:(0,g.cn)("w-full caption-bottom text-sm bg-card text-card-foreground",a),...b})}));i.displayName="Table";let j=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("thead",{ref:c,className:(0,g.cn)("[&_tr]:border-b border-border bg-muted/50",a),...b}));j.displayName="TableHeader";let k=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("tbody",{ref:c,className:(0,g.cn)("[&_tr:last-child]:border-0",a),...b}));k.displayName="TableBody";let l=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("tfoot",{ref:c,className:(0,g.cn)("border-t border-border bg-muted/50 font-medium [&>tr]:last:border-b-0",a),...b}));l.displayName="TableFooter";let m=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("tr",{ref:c,className:(0,g.cn)("border-b border-border transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",a),...b}));m.displayName="TableRow";let n=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("th",{ref:c,className:(0,g.cn)("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",a),...b}));n.displayName="TableHead";let o=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("td",{ref:c,className:(0,g.cn)("p-4 align-middle text-card-foreground [&:has([role=checkbox])]:pr-0",a),...b}));o.displayName="TableCell";let p=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)("caption",{ref:c,className:(0,g.cn)("mt-4 text-sm text-muted-foreground",a),...b}));p.displayName="TableCaption",d()}catch(a){d(a)}})},57049:(a,b,c)=>{c.a(a,async(a,d)=>{try{c.d(b,{bq:()=>m,eb:()=>q,gC:()=>p,l6:()=>k,yv:()=>l});var e=c(8732),f=c(82015),g=c(47860),h=c(74952),i=c(87092),j=a([g,i]);[g,i]=j.then?(await j)():j;let k=g.Root;g.Group;let l=g.Value,m=f.forwardRef(({className:a,children:b,...c},d)=>(0,e.jsxs)(g.Trigger,{ref:d,className:(0,i.cn)("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-0 focus-visible:ring-0 focus:ring-offset-0 focus-visible:ring-offset-0 focus:border-ring focus-visible:border-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1 transition-colors",a),...c,children:[b,(0,e.jsx)(g.Icon,{asChild:!0,children:(0,e.jsx)(h.yQN,{className:"h-4 w-4 opacity-50"})})]}));m.displayName=g.Trigger.displayName;let n=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.ScrollUpButton,{ref:c,className:(0,i.cn)("flex cursor-default items-center justify-center py-1",a),...b,children:(0,e.jsx)(h.rXn,{className:"h-4 w-4"})}));n.displayName=g.ScrollUpButton.displayName;let o=f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.ScrollDownButton,{ref:c,className:(0,i.cn)("flex cursor-default items-center justify-center py-1",a),...b,children:(0,e.jsx)(h.yQN,{className:"h-4 w-4"})}));o.displayName=g.ScrollDownButton.displayName;let p=f.forwardRef(({className:a,children:b,position:c="popper",...d},f)=>(0,e.jsx)(g.Portal,{children:(0,e.jsxs)(g.Content,{ref:f,className:(0,i.cn)("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2","popper"===c&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",a),position:c,...d,children:[(0,e.jsx)(n,{}),(0,e.jsx)(g.Viewport,{className:(0,i.cn)("p-1","popper"===c&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:b}),(0,e.jsx)(o,{})]})}));p.displayName=g.Content.displayName,f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Label,{ref:c,className:(0,i.cn)("py-1.5 pl-8 pr-2 text-sm font-semibold",a),...b})).displayName=g.Label.displayName;let q=f.forwardRef(({className:a,children:b,...c},d)=>(0,e.jsxs)(g.Item,{ref:d,className:(0,i.cn)("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a),...c,children:[(0,e.jsx)("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:(0,e.jsx)(g.ItemIndicator,{children:(0,e.jsx)(h.Jlk,{className:"h-4 w-4"})})}),(0,e.jsx)(g.ItemText,{children:b})]}));q.displayName=g.Item.displayName,f.forwardRef(({className:a,...b},c)=>(0,e.jsx)(g.Separator,{ref:c,className:(0,i.cn)("-mx-1 my-1 h-px bg-muted",a),...b})).displayName=g.Separator.displayName,d()}catch(a){d(a)}})},79837:(a,b,c)=>{c.d(b,{d:()=>e});var d=c(21638);function e(a,b){let c=(0,d.a)(a),e=(0,d.a)(b);return c.getTime()>e.getTime()}},81575:(a,b,c)=>{c.d(b,{H:()=>e});var d=c(73502);function e(a,b){let c,e,n=b?.additionalDigits??2,o=function(a){let b,c={},d=a.split(f.dateTimeDelimiter);if(d.length>2)return c;if(/:/.test(d[0])?b=d[0]:(c.date=d[0],b=d[1],f.timeZoneDelimiter.test(c.date)&&(c.date=a.split(f.timeZoneDelimiter)[0],b=a.substr(c.date.length,a.length))),b){let a=f.timezone.exec(b);a?(c.time=b.replace(a[1],""),c.timezone=a[1]):c.time=b}return c}(a);if(o.date){let a=function(a,b){let c=RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+b)+"})|(\\d{2}|[+-]\\d{"+(2+b)+"})$)"),d=a.match(c);if(!d)return{year:NaN,restDateString:""};let e=d[1]?parseInt(d[1]):null,f=d[2]?parseInt(d[2]):null;return{year:null===f?e:100*f,restDateString:a.slice((d[1]||d[2]).length)}}(o.date,n);c=function(a,b){var c,d,e,f,h,i,k;if(null===b)return new Date(NaN);let n=a.match(g);if(!n)return new Date(NaN);let o=!!n[4],p=j(n[1]),q=j(n[2])-1,r=j(n[3]),s=j(n[4]),t=j(n[5])-1;if(o){return(c=s,d=t,c>=1&&c<=53&&d>=0&&d<=6)?function(a,b,c){let d=new Date(0);d.setUTCFullYear(a,0,4);let e=d.getUTCDay()||7;return d.setUTCDate(d.getUTCDate()+((b-1)*7+c+1-e)),d}(b,s,t):new Date(NaN)}{let a=new Date(0);return(e=b,f=q,h=r,f>=0&&f<=11&&h>=1&&h<=(l[f]||(m(e)?29:28))&&(i=b,(k=p)>=1&&k<=(m(i)?366:365)))?(a.setUTCFullYear(b,q,Math.max(p,r)),a):new Date(NaN)}}(a.restDateString,a.year)}if(!c||isNaN(c.getTime()))return new Date(NaN);let p=c.getTime(),q=0;if(o.time&&isNaN(q=function(a){var b,c,e;let f=a.match(h);if(!f)return NaN;let g=k(f[1]),i=k(f[2]),j=k(f[3]);return(b=g,c=i,e=j,24===b?0===c&&0===e:e>=0&&e<60&&c>=0&&c<60&&b>=0&&b<25)?g*d.s0+i*d.Cg+1e3*j:NaN}(o.time)))return new Date(NaN);if(o.timezone){if(isNaN(e=function(a){var b;if("Z"===a)return 0;let c=a.match(i);if(!c)return 0;let e="+"===c[1]?-1:1,f=parseInt(c[2]),g=c[3]&&parseInt(c[3])||0;return(b=g)>=0&&b<=59?e*(f*d.s0+g*d.Cg):NaN}(o.timezone)))return new Date(NaN)}else{let a=new Date(p+q),b=new Date(0);return b.setFullYear(a.getUTCFullYear(),a.getUTCMonth(),a.getUTCDate()),b.setHours(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds(),a.getUTCMilliseconds()),b}return new Date(p+q+e)}let f={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},g=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,h=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,i=/^([+-])(\d{2})(?::?(\d{2}))?$/;function j(a){return a?parseInt(a):1}function k(a){return a&&parseFloat(a.replace(",","."))||0}let l=[31,null,31,30,31,30,31,31,30,31,30,31];function m(a){return a%400==0||a%4==0&&a%100!=0}},83332:(a,b,c)=>{c.d(b,{W:()=>h});var d=c(21839),e=c(12919),f=c(68794),g=c(21638);function h(a,b){let{years:c=0,months:h=0,weeks:i=0,days:j=0,hours:k=0,minutes:l=0,seconds:m=0}=b,n=(0,g.a)(a),o=h||c?(0,e.P)(n,h+12*c):n,p=j||i?(0,d.f)(o,j+7*i):o;return(0,f.w)(a,p.getTime()+1e3*(m+60*(l+60*k)))}}};